{% extends "base.html" %}
{% block content %}
<section id="apps">
<div class="container">
<job-box></job-box>
</div>
</section>

<script>
	{% verbatim %}
	Vue.component('job-box', {
		template: `
<table class="table">
	<thead>
		<tr>
			<th>Job</th>
			<th>User</th>
			<th>Date</th>
			<th>Tasks</th>
		</tr>
	</thead>
		<tr v-for="job in error">
			<td>
				<a v-if="job.retry" v-on:click="retryJob(job.id)" class="button is-outlined is-small is-danger">{{ job.name }}</a>
				<a v-if="!job.retry" class="button is-small is-danger">{{ job.name }}</a>
			</td>
			<td>{{ job.user }}</td>
			<td>{{ job.date }}</td>
			<td>
				<a class="button is-info">{{ job.tasks.PENDING }}</a>
				<a class="button is-danger">{{ job.tasks.FAILURE }}</a>
				<a class="button is-success">{{ job.tasks.SUCCESS }}</a>
			</td>
		</tr>
		<tr v-for="job in processing">
			<td><a class="button is-small is-warning">{{ job.name }}</a></td>
			<td>{{ job.user }}</td>
			<td>{{ job.date }}</td>
			<td>
				<a class="button is-info">{{ job.tasks.PENDING }}</a>
				<a class="button is-danger">{{ job.tasks.FAILURE }}</a>
				<a class="button is-success">{{ job.tasks.SUCCESS }}</a>
			</td>
		</tr>
		<tr v-for="job in pending">
			<td><a class="button is-small is-info">{{ job.name }}</a></td>
			<td>{{ job.user }}</td>
			<td>{{ job.date }}</td>
			<td>
				<a class="button is-info">{{ job.tasks.PENDING }}</a>
				<a class="button is-danger">{{ job.tasks.FAILURE }}</a>
				<a class="button is-success">{{ job.tasks.SUCCESS }}</a>
			</td>
		</tr>

</table>
		`,
		data: function() {
			return {
                        	processing: [],
                        	pending: [],
                        	error: [],
			}
		},
		mounted: function() {
			this.getJobs();
		},
		methods: {
			getJobs: function() {
				this.$http.get('/dash/jobs/')
				.then(response => {
					return response.json()
				}, response => {
				}).then(result => {
					for (key in result) {
						this[key] = result[key];
					}
				})
			},
                        retryJob: function(job_id) {
				this.$http.post(`/jobs/retry/${job_id}`)
				.then(response => {
					return response
				}, response => {
					console.log(response);
					// error code
				}).then(result => {
					this.getJobs();
				})
                        },
		},
	})
	{% endverbatim %}

	var dashboard = new Vue({
	el: '#apps',
	data: function() {
		return { 
		}
	},
})
</script>
{% endblock content %}
