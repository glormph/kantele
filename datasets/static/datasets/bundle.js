var app=function(){"use strict";function e(){}function t(e){return e()}function n(){return Object.create(null)}function a(e){e.forEach(t)}function l(e){return"function"==typeof e}function s(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function i(e,t,n){e.$$.on_destroy.push(function(e,t){const n=e.subscribe(t);return n.unsubscribe?()=>n.unsubscribe():n}(t,n))}function r(e){return null==e?"":e}function c(e,t,n=t){return e.set(n),t}function o(e,t){e.appendChild(t)}function d(e,t,n){e.insertBefore(t,n||null)}function p(e){e.parentNode.removeChild(e)}function u(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function f(e){return document.createElement(e)}function m(e){return document.createTextNode(e)}function h(){return m(" ")}function _(){return m("")}function g(e,t,n,a){return e.addEventListener(t,n,a),()=>e.removeEventListener(t,n,a)}function v(e){return function(t){return t.stopPropagation(),e.call(this,t)}}function b(e,t,n){null==n?e.removeAttribute(t):e.setAttribute(t,n)}function y(e){return""===e?void 0:+e}function j(e,t){t=""+t,e.data!==t&&(e.data=t)}function w(e,t){(null!=t||e.value)&&(e.value=t)}function x(e,t,n,a){e.style.setProperty(t,n,a?"important":"")}function $(e,t){for(let n=0;n<e.options.length;n+=1){const a=e.options[n];if(a.__value===t)return void(a.selected=!0)}}function k(e){const t=e.querySelector(":checked")||e.options[0];return t&&t.__value}let O;function q(e){O=e}function N(e){(function(){if(!O)throw new Error("Function called outside component initialization");return O})().$$.on_mount.push(e)}function C(){const e=O;return(t,n)=>{const a=e.$$.callbacks[t];if(a){const l=function(e,t){const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!1,!1,t),n}(t,n);a.slice().forEach(t=>{t.call(e,l)})}}}const F=[],S=[],E=[],L=[],M=Promise.resolve();let P=!1;function z(e){E.push(e)}function D(e){L.push(e)}function T(){const e=new Set;do{for(;F.length;){const e=F.shift();q(e),H(e.$$)}for(;S.length;)S.pop()();for(let t=0;t<E.length;t+=1){const n=E[t];e.has(n)||(n(),e.add(n))}E.length=0}while(F.length);for(;L.length;)L.pop()();P=!1}function H(e){e.fragment&&(e.update(e.dirty),a(e.before_update),e.fragment.p(e.dirty,e.ctx),e.dirty=null,e.after_update.forEach(z))}const R=new Set;let A;function I(){A={r:0,c:[],p:A}}function U(){A.r||a(A.c),A=A.p}function Q(e,t){e&&e.i&&(R.delete(e),e.i(t))}function B(e,t,n,a){if(e&&e.o){if(R.has(e))return;R.add(e),A.c.push(()=>{R.delete(e),a&&(n&&e.d(1),a())}),e.o(t)}}const K="undefined"!=typeof window?window:global;function G(e,t,n){-1!==e.$$.props.indexOf(t)&&(e.$$.bound[t]=n,n(e.$$.ctx[t]))}function J(e,n,s){const{fragment:i,on_mount:r,on_destroy:c,after_update:o}=e.$$;i.m(n,s),z(()=>{const n=r.map(t).filter(l);c?c.push(...n):a(n),e.$$.on_mount=[]}),o.forEach(z)}function V(e,t){e.$$.fragment&&(a(e.$$.on_destroy),e.$$.fragment.d(t),e.$$.on_destroy=e.$$.fragment=null,e.$$.ctx={})}function W(e,t){e.$$.dirty||(F.push(e),P||(P=!0,M.then(T)),e.$$.dirty=n()),e.$$.dirty[t]=!0}function X(t,l,s,i,r,c){const o=O;q(t);const d=l.props||{},p=t.$$={fragment:null,ctx:null,props:c,update:e,not_equal:r,bound:n(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(o?o.$$.context:[]),callbacks:n(),dirty:null};let u=!1;var f;p.ctx=s?s(t,d,(e,n,a=n)=>(p.ctx&&r(p.ctx[e],p.ctx[e]=a)&&(p.bound[e]&&p.bound[e](a),u&&W(t,e)),n)):d,p.update(),u=!0,a(p.before_update),p.fragment=i(p.ctx),l.target&&(l.hydrate?p.fragment.l((f=l.target,Array.from(f.childNodes))):p.fragment.c(),l.intro&&Q(t.$$.fragment),J(t,l.target,l.anchor),T()),q(o)}class Y{$destroy(){V(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(){}}async function Z(e){let t;try{t=await e.json()}catch(t){return{ok:!1,error:"Server error encountered",status:e.status}}return t.ok=e.ok,t}async function ee(e){let t;try{t=await fetch(e)}catch{return{ok:!1,error:"Kantele encountered a network error",status:!1}}return await Z(t)}async function te(e,t){let n;try{n=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}catch{return{ok:!1,error:"Kantele encountered a network error",status:!1}}return await Z(n)}const ne=[];function ae(t,n=e){let a;const l=[];function i(e){if(s(t,e)&&(t=e,a)){const e=!ne.length;for(let e=0;e<l.length;e+=1){const n=l[e];n[1](),ne.push(n,t)}if(e){for(let e=0;e<ne.length;e+=2)ne[e][0](ne[e+1]);ne.length=0}}}return{set:i,update:function(e){i(e(t))},subscribe:function(s,r=e){const c=[s,r];return l.push(c),1===l.length&&(a=n(i)||e),s(t),()=>{const e=l.indexOf(c);-1!==e&&l.splice(e,1),0===l.length&&(a(),a=null)}}}}const le=ae(!1),se=ae({}),ie=ae({});function re(e,t,n){const a=Object.create(e);return a.option=t[n],a.each_value_1=t,a.option_index_1=n,a}function ce(e,t,n){const a=Object.create(e);return a.option=t[n],a}function oe(e){var t;let n=e.param.fields,a=[];for(let t=0;t<n.length;t+=1)a[t]=fe(re(e,n,t));return{c(){for(let e=0;e<a.length;e+=1)a[e].c();t=_()},m(e,n){for(let t=0;t<a.length;t+=1)a[t].m(e,n);d(e,t,n)},p(e,l){if(e.param){let s;for(n=l.param.fields,s=0;s<n.length;s+=1){const i=re(l,n,s);a[s]?a[s].p(e,i):(a[s]=fe(i),a[s].c(),a[s].m(t.parentNode,t))}for(;s<a.length;s+=1)a[s].d(1);a.length=n.length}},d(e){u(a,e),e&&p(t)}}}function de(e){var t,n,l,s=!1;function i(){s=!0,e.input_input_handler_1.call(t)}return{c(){b(t=f("input"),"type","number"),b(t,"class","input"),b(t,"placeholder",n=e.param.placeholder),l=[g(t,"input",i),g(t,"change",e.edited)]},m(n,a){d(n,t,a),w(t,e.param.model)},p(e,a){!s&&e.param&&w(t,a.param.model),s=!1,e.param&&n!==(n=a.param.placeholder)&&b(t,"placeholder",n)},d(e){e&&p(t),a(l)}}}function pe(e){var t,n,l;return{c(){b(t=f("input"),"type","text"),b(t,"class","input"),b(t,"placeholder",n=e.param.placeholder),l=[g(t,"input",e.input_input_handler),g(t,"change",e.edited)]},m(n,a){d(n,t,a),w(t,e.param.model)},p(e,a){e.param&&t.value!==a.param.model&&w(t,a.param.model),e.param&&n!==(n=a.param.placeholder)&&b(t,"placeholder",n)},d(e){e&&p(t),a(l)}}}function ue(e){var t,n,l,s;let i=e.param.fields,r=[];for(let t=0;t<i.length;t+=1)r[t]=me(ce(e,i,t));return{c(){t=f("div"),n=f("select"),(l=f("option")).textContent="Please select one";for(let e=0;e<r.length;e+=1)r[e].c();l.disabled=!0,l.__value="",l.value=l.__value,void 0===e.param.model&&z(()=>e.select_change_handler.call(n)),b(t,"class","select"),s=[g(n,"change",e.select_change_handler),g(n,"change",e.edited)]},m(a,s){d(a,t,s),o(t,n),o(n,l);for(let e=0;e<r.length;e+=1)r[e].m(n,null);$(n,e.param.model)},p(e,t){if(e.param){let a;for(i=t.param.fields,a=0;a<i.length;a+=1){const l=ce(t,i,a);r[a]?r[a].p(e,l):(r[a]=me(l),r[a].c(),r[a].m(n,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=i.length}e.param&&$(n,t.param.model)},d(e){e&&p(t),u(r,e),a(s)}}}function fe(e){var t,n,l,s,i,r=e.option.text+"";function c(){e.input_change_handler.call(n,e)}return{c(){t=f("div"),n=f("input"),l=m(r),s=h(),b(n,"type","checkbox"),b(t,"class","control"),i=[g(n,"change",c),g(n,"change",e.edited)]},m(a,i){d(a,t,i),o(t,n),n.checked=e.option.checked,o(t,l),o(t,s)},p(t,a){e=a,t.param&&(n.checked=e.option.checked),t.param&&r!==(r=e.option.text+"")&&j(l,r)},d(e){e&&p(t),a(i)}}}function me(e){var t,n,a,l=e.option.text+"";return{c(){t=f("option"),n=m(l),t.__value=a=e.option.value,t.value=t.__value},m(e,a){d(e,t,a),o(t,n)},p(e,s){e.param&&l!==(l=s.option.text+"")&&j(n,l),e.param&&a!==(a=s.option.value)&&(t.__value=a),t.value=t.__value},d(e){e&&p(t)}}}function he(t){var n,a,l,s,i,r=t.param.title+"";function c(e,t){return"select"===t.param.inputtype?ue:"text"===t.param.inputtype?pe:"number"===t.param.inputtype?de:"checkbox"===t.param.inputtype?oe:void 0}var u=c(0,t),_=u&&u(t);return{c(){n=f("div"),a=f("label"),l=m(r),s=h(),i=f("div"),_&&_.c(),b(a,"class","label"),b(i,"class","control"),b(n,"class","field")},m(e,t){d(e,n,t),o(n,a),o(a,l),o(n,s),o(n,i),_&&_.m(i,null)},p(e,t){e.param&&r!==(r=t.param.title+"")&&j(l,r),u===(u=c(0,t))&&_?_.p(e,t):(_&&_.d(1),(_=u&&u(t))&&(_.c(),_.m(i,null)))},i:e,o:e,d(e){e&&p(n),_&&_.d()}}}function _e(e,t,n){const a=C();let{param:l}=t;return e.$set=(e=>{"param"in e&&n("param",l=e.param)}),{param:l,edited:function(){a("edited")},select_change_handler:function(){l.model=k(this),n("param",l)},input_input_handler:function(){l.model=this.value,n("param",l)},input_input_handler_1:function(){l.model=y(this.value),n("param",l)},input_change_handler:function({option:e,each_value_1:t,option_index_1:a}){t[a].checked=this.checked,n("param",l)}}}class ge extends Y{constructor(e){super(),X(this,e,_e,he,s,["param"])}}function ve(e,t,n){const a=Object.create(e);return a.error=t[n],a}function be(e){var t,n,a;let l=e.errors,s=[];for(let t=0;t<l.length;t+=1)s[t]=ye(ve(e,l,t));return{c(){t=f("div"),n=f("ul");for(let e=0;e<s.length;e+=1)s[e].c();b(t,"class",a=r(`notification is-danger ${e.cssclass}`)+" svelte-16a6jab")},m(e,a){d(e,t,a),o(t,n);for(let e=0;e<s.length;e+=1)s[e].m(n,null)},p(e,i){if(e.errors){let t;for(l=i.errors,t=0;t<l.length;t+=1){const a=ve(i,l,t);s[t]?s[t].p(e,a):(s[t]=ye(a),s[t].c(),s[t].m(n,null))}for(;t<s.length;t+=1)s[t].d(1);s.length=l.length}e.cssclass&&a!==(a=r(`notification is-danger ${i.cssclass}`)+" svelte-16a6jab")&&b(t,"class",a)},d(e){e&&p(t),u(s,e)}}}function ye(e){var t,n,a,l=e.error+"";return{c(){t=f("li"),n=m("â€¢ "),a=m(l)},m(e,l){d(e,t,l),o(t,n),o(t,a)},p(e,t){e.errors&&l!==(l=t.error+"")&&j(a,l)},d(e){e&&p(t)}}}function je(t){var n,a=t.errors.length&&be(t);return{c(){a&&a.c(),n=_()},m(e,t){a&&a.m(e,t),d(e,n,t)},p(e,t){t.errors.length?a?a.p(e,t):((a=be(t)).c(),a.m(n.parentNode,n)):a&&(a.d(1),a=null)},i:e,o:e,d(e){a&&a.d(e),e&&p(n)}}}function we(e,t,n){let{errors:a,cssclass:l=""}=t;return e.$set=(e=>{"errors"in e&&n("errors",a=e.errors),"cssclass"in e&&n("cssclass",l=e.cssclass)}),{errors:a,cssclass:l}}class xe extends Y{constructor(e){super(),X(this,e,we,je,s,["errors","cssclass"])}}const{Object:$e}=K;function ke(e,t,n){const a=$e.create(e);return a.param_id=t[n][0],a.param=t[n][1],a.each_value=t,a.each_index=n,a}function Oe(e,t,n){const a=$e.create(e);return a.operator=t[n],a}function qe(e){var t;return{c(){b(t=f("i"),"class","icon fas fa-edit")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function Ne(e){var t;return{c(){b(t=f("i"),"class","icon fas fa-check-circle")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function Ce(e){var t,n,a,l=e.operator.name+"";return{c(){t=f("option"),n=m(l),t.__value=a=e.operator.id,t.value=t.__value},m(e,a){d(e,t,a),o(t,n)},p(e,s){e.acqdata&&l!==(l=s.operator.name+"")&&j(n,l),e.acqdata&&a!==(a=s.operator.id)&&(t.__value=a),t.value=t.__value},d(e){e&&p(t)}}}function Fe(e){var t,n,l=!1;function s(){l=!0,e.input_input_handler.call(t)}return{c(){b(t=f("input"),"type","number"),b(t,"class","input"),b(t,"placeholder","in minutes"),n=[g(t,"input",s),g(t,"change",e.editMade)]},m(n,a){d(n,t,a),w(t,e.dsinfo.rp_length)},p(e,n){!l&&e.dsinfo&&w(t,n.dsinfo.rp_length),l=!1},d(e){e&&p(t),a(n)}}}function Se(e){var t,n;function a(n){e.param_param_binding.call(null,n,e),t=!0,D(()=>t=!1)}let l={};void 0!==e.param&&(l.param=e.param);var s=new ge({props:l});return S.push(()=>G(s,"param",a)),s.$on("edited",e.editMade),{c(){s.$$.fragment.c()},m(e,t){J(s,e,t),n=!0},p(n,a){e=a;var l={};(!t&&n.Object||n.dsinfo)&&(l.param=e.param),s.$set(l)},i(e){n||(Q(s.$$.fragment,e),n=!0)},o(e){B(s.$$.fragment,e),n=!1},d(e){V(s,e)}}}function Ee(e){var t,n,l,s,i,r,c,v,y,j,w,x,k,O,q,N,C,F,S,E,L,M,P,D,T,H,R,A,K;function G(e,t){return t.stored?Ne:t.edited?qe:void 0}var W=G(0,e),X=W&&W(e),Y=new xe({props:{errors:e.acquierrors}});let Z=e.acqdata.operators,ee=[];for(let t=0;t<Z.length;t+=1)ee[t]=Ce(Oe(e,Z,t));var te=!e.dsinfo.dynamic_rp&&Fe(e);let ne=e.Object.entries(e.dsinfo.params),ae=[];for(let t=0;t<ne.length;t+=1)ae[t]=Se(ke(e,ne,t));const le=e=>B(ae[e],1,1,()=>{ae[e]=null});return{c(){t=f("h5"),X&&X.c(),n=m("\n  Acquisition\n  "),l=f("button"),s=m("Save"),r=h(),c=f("button"),v=m("Revert"),j=h(),Y.$$.fragment.c(),w=h(),x=f("div"),(k=f("label")).textContent="Operator",O=h(),q=f("div"),N=f("div"),C=f("select"),(F=f("option")).textContent="Please select one";for(let e=0;e<ee.length;e+=1)ee[e].c();S=h(),E=f("div"),(L=f("label")).textContent="Reverse phase length",M=h(),P=f("div"),D=f("input"),T=m("Dynamic\n    "),te&&te.c(),H=h();for(let e=0;e<ae.length;e+=1)ae[e].c();R=_(),b(l,"class","button is-small is-danger has-text-weight-bold"),l.disabled=i=!e.edited,b(c,"class","button is-small is-info has-text-weight-bold"),c.disabled=y=!e.edited,b(t,"class","has-text-primary title is-5"),b(k,"class","label"),F.disabled=!0,F.__value="",F.value=F.__value,void 0===e.dsinfo.operator_id&&z(()=>e.select_change_handler.call(C)),b(N,"class","select"),b(q,"class","control"),b(x,"class","field"),b(L,"class","label"),b(D,"type","checkbox"),b(P,"class","control"),b(E,"class","field"),K=[g(l,"click",e.save),g(c,"click",e.fetchData),g(C,"change",e.select_change_handler),g(C,"change",e.editMade),g(D,"change",e.input_change_handler),g(D,"change",e.editMade)]},m(a,i){d(a,t,i),X&&X.m(t,null),o(t,n),o(t,l),o(l,s),o(t,r),o(t,c),o(c,v),d(a,j,i),J(Y,a,i),d(a,w,i),d(a,x,i),o(x,k),o(x,O),o(x,q),o(q,N),o(N,C),o(C,F);for(let e=0;e<ee.length;e+=1)ee[e].m(C,null);$(C,e.dsinfo.operator_id),d(a,S,i),d(a,E,i),o(E,L),o(E,M),o(E,P),o(P,D),D.checked=e.dsinfo.dynamic_rp,o(P,T),te&&te.m(P,null),d(a,H,i);for(let e=0;e<ae.length;e+=1)ae[e].m(a,i);d(a,R,i),A=!0},p(e,a){W!==(W=G(0,a))&&(X&&X.d(1),(X=W&&W(a))&&(X.c(),X.m(t,n))),A&&!e.edited||i===(i=!a.edited)||(l.disabled=i),A&&!e.edited||y===(y=!a.edited)||(c.disabled=y);var s={};if(e.acquierrors&&(s.errors=a.acquierrors),Y.$set(s),e.acqdata){let t;for(Z=a.acqdata.operators,t=0;t<Z.length;t+=1){const n=Oe(a,Z,t);ee[t]?ee[t].p(e,n):(ee[t]=Ce(n),ee[t].c(),ee[t].m(C,null))}for(;t<ee.length;t+=1)ee[t].d(1);ee.length=Z.length}if(e.dsinfo&&$(C,a.dsinfo.operator_id),e.dsinfo&&(D.checked=a.dsinfo.dynamic_rp),a.dsinfo.dynamic_rp?te&&(te.d(1),te=null):te?te.p(e,a):((te=Fe(a)).c(),te.m(P,null)),e.Object||e.dsinfo){let t;for(ne=a.Object.entries(a.dsinfo.params),t=0;t<ne.length;t+=1){const n=ke(a,ne,t);ae[t]?(ae[t].p(e,n),Q(ae[t],1)):(ae[t]=Se(n),ae[t].c(),Q(ae[t],1),ae[t].m(R.parentNode,R))}for(I(),t=ne.length;t<ae.length;t+=1)le(t);U()}},i(e){if(!A){Q(Y.$$.fragment,e);for(let e=0;e<ne.length;e+=1)Q(ae[e]);A=!0}},o(e){B(Y.$$.fragment,e),ae=ae.filter(Boolean);for(let e=0;e<ae.length;e+=1)B(ae[e]);A=!1},d(e){e&&p(t),X&&X.d(),e&&p(j),V(Y,e),e&&(p(w),p(x)),u(ee,e),e&&(p(S),p(E)),te&&te.d(),e&&p(H),u(ae,e),e&&p(R),a(K)}}}function Le(e,t,n){let a;i(e,le,e=>{n("$dataset_id",a=e)});let l,{errors:s}=t,r=[],c={operator_id:"",dynamic_rp:!1,rp_length:"",params:[]},o={operators:[]},d=!1;function p(){let e=[];c.operator_id||e.push("Operator is required"),c.dynamic_rp||c.rp_length||e.push("Reverse phase is required");for(let t in c.params)void 0!==c.params[t].model&&""!==c.params[t].model||e.push(c.params[t].title+" is required");return e}async function u(){let e="/datasets/show/acquisition/";e=a?e+a:e;const t=await ee(e);for(let[e,a]of Object.entries(t.acqdata))n("acqdata",o[e]=a,o);for(let[e,a]of Object.entries(t.dsinfo))n("dsinfo",c[e]=a,c);n("edited",d=!1)}return N(async()=>{u()}),e.$set=(e=>{"errors"in e&&n("errors",s=e.errors)}),e.$$.update=((e={$dataset_id:1,edited:1})=>{(e.$dataset_id||e.edited)&&n("stored",l=a&&!d)}),{errors:s,acquierrors:r,dsinfo:c,acqdata:o,edited:d,editMade:function(){n("errors",s=s.length?p():[]),n("edited",d=!0)},validate:p,save:async function(){if(n("acquierrors",r=[]),n("errors",s=p()),0===s.length){let e={dataset_id:a,operator_id:c.operator_id,params:c.params,rp_length:c.dynamic_rp?"":c.rp_length},t="/datasets/save/acquisition/";try{await te(t,e),u()}catch(e){"404"===e.message&&n("acquierrors",r=[...r,"Save dataset before saving acquisition"])}}},fetchData:u,stored:l,Object:Object,select_change_handler:function(){c.operator_id=k(this),n("dsinfo",c),n("acqdata",o)},input_change_handler:function(){c.dynamic_rp=this.checked,n("dsinfo",c),n("acqdata",o)},input_input_handler:function(){c.rp_length=y(this.value),n("dsinfo",c),n("acqdata",o)},param_param_binding:function(e,{param:t,each_value:a,each_index:l}){a[l][1]=e,n("Object",Object)}}}class Me extends Y{constructor(e){super(),X(this,e,Le,Ee,s,["errors","validate","save"])}get validate(){return this.$$.ctx.validate}get save(){return this.$$.ctx.save}}const{Object:Pe}=K;function ze(e,t,n){const a=Pe.create(e);return a.optid=t[n],a}function De(e){var t,n,a,l,s=!e.optorder.length&&Te();let i=e.optorder,r=[];for(let t=0;t<i.length;t+=1)r[t]=He(ze(e,i,t));return{c(){t=f("div"),n=f("select"),s&&s.c(),a=_();for(let e=0;e<r.length;e+=1)r[e].c();n.multiple=!0,b(t,"class","select is-multiple"),l=g(n,"mousedown",e.mousedown_handler)},m(e,l){d(e,t,l),o(t,n),s&&s.m(n,null),o(n,a);for(let e=0;e<r.length;e+=1)r[e].m(n,null)},p(e,t){if(t.optorder.length?s&&(s.d(1),s=null):s||((s=Te()).c(),s.m(n,a)),e.optorder||e.hoveropt||e.niceName||e.options){let a;for(i=t.optorder,a=0;a<i.length;a+=1){const l=ze(t,i,a);r[a]?r[a].p(e,l):(r[a]=He(l),r[a].c(),r[a].m(n,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=i.length}},d(e){e&&p(t),s&&s.d(),u(r,e),l()}}}function Te(e){var t;return{c(){(t=f("option")).textContent="Type more or type less...",t.disabled=!0,t.__value="Type more or type less...",t.value=t.__value},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function He(e){var t,n,l,s,i,r=e.niceName(e.options[e.optid])+"";function c(...t){return e.mouseup_handler(e,...t)}function u(...t){return e.mousemove_handler(e,...t)}return{c(){t=f("option"),n=m(r),t.selected=l=e.optid===e.hoveropt,t.__value=s=e.optid,t.value=t.__value,i=[g(t,"mouseup",c),g(t,"mousemove",u)]},m(e,a){d(e,t,a),o(t,n)},p(a,i){e=i,(a.niceName||a.options||a.optorder)&&r!==(r=e.niceName(e.options[e.optid])+"")&&j(n,r),(a.optorder||a.hoveropt)&&l!==(l=e.optid===e.hoveropt)&&(t.selected=l),a.optorder&&s!==(s=e.optid)&&(t.__value=s),t.value=t.__value},d(e){e&&p(t),a(i)}}}function Re(t){var n,l,s,i,r,c,u=t.typing&&De(t);return{c(){var e;n=f("div"),l=f("input"),s=h(),(i=f("span")).innerHTML='<i class="fas fa-chevron-down"></i>',r=h(),u&&u.c(),b(l,"type","text"),b(l,"class","input is-narrow"),b(l,"placeholder",t.placeholder),b(i,"class","icon is-right"),b(n,"class","control has-icons-right"),b(n,"tabindex","0"),c=[g(l,"input",t.input_input_handler),g(l,"blur",t.inputdone),g(l,"keyup",v((e=t.handleKeyInput,function(t){return t.preventDefault(),e.call(this,t)}))),g(l,"focus",t.starttyping)]},m(e,a){d(e,n,a),o(n,l),w(l,t.intext),o(n,s),o(n,i),o(n,r),u&&u.m(n,null)},p(e,t){e.intext&&l.value!==t.intext&&w(l,t.intext),e.placeholder&&b(l,"placeholder",t.placeholder),t.typing?u?u.p(e,t):((u=De(t)).c(),u.m(n,null)):u&&(u.d(1),u=null)},i:e,o:e,d(e){e&&p(n),u&&u.d(),a(c)}}}function Ae(e,t,n){const a=C();let l,s,{selectval:i="",fixedoptions:r={},fixedorder:c=[],intext:o,fetchUrl:d=!1,fetchedData:p,niceName:u=function(e){return e}}=t,{unknowninput:f="__ILLEGAL_PLACEHOLDER__"}=t,m=[],h=!1,_="Filter by typing",g=!1,v=!1;function b(){v||(n("typing",g=!1),i&&i in l?n("intext",o=u(l[i])):"__ILLEGAL_PLACEHOLDER__"===f?(console.log("illegal value dectected"),a("illegalvalue",{})):(n("unknowninput",f=o),a("newvalue",{})))}function y(e){n("mouseSelect",v=!1),n("selectval",i=l[e].id),n("intext",o=u(l[i])),"__ILLEGAL_PLACEHOLDER__"!==f&&n("unknowninput",f=""),a("selectedvalue",{}),b()}return e.$set=(e=>{"selectval"in e&&n("selectval",i=e.selectval),"fixedoptions"in e&&n("fixedoptions",r=e.fixedoptions),"fixedorder"in e&&n("fixedorder",c=e.fixedorder),"intext"in e&&n("intext",o=e.intext),"fetchUrl"in e&&n("fetchUrl",d=e.fetchUrl),"fetchedData"in e&&n("fetchedData",p=e.fetchedData),"niceName"in e&&n("niceName",u=e.niceName),"unknowninput"in e&&n("unknowninput",f=e.unknowninput)}),e.$$.update=((e={fixedoptions:1,optorder:1})=>{e.fixedoptions&&n("options",l=Object.fromEntries(Object.entries(r))),e.optorder&&(s=Object.fromEntries(m.map((e,t)=>[e,t])))}),{selectval:i,fixedoptions:r,fixedorder:c,intext:o,fetchUrl:d,fetchedData:p,niceName:u,unknowninput:f,options:l,optorder:m,hoveropt:h,placeholder:_,typing:g,mouseSelect:v,inputdone:b,selectvalue:y,handleKeyInput:async function(e){if(27===e.keyCode)n("mouseSelect",v=!1),b();else if(!h||13!==e.keyCode&&9!==e.keyCode)if(h||13!==e.keyCode&&9!==e.keyCode)if(m.length&&40===e.keyCode)h&&s[h]+1<=m.length?n("hoveropt",h=m[s[h]+1]):h||n("hoveropt",h=m[0]);else if(m.length&&38===e.keyCode)n("hoveropt",h=!!(h&&s[h]>0)&&m[s[h]-1]);else if(o.length){if(e.key.length>1&&8!==e.keyCode&&46!==e.keyCode)return;if(o.length>2&&d)n("selectval",i=""),n("options",l=await ee(`${d}?q=${o}`)),n("fetchedData",p=Object.assign({},l)),delete l.ok,n("optorder",m=Object.keys(l)),n("typing",g=!0);else if(!d&&r&&o){n("selectval",i=""),n("options",l=Object.fromEntries(Object.entries(r).filter(e=>e[1].name.toLowerCase().indexOf(o.toLowerCase())>-1)));const e=Object.keys(l);n("optorder",m=c.length?c.filter(t=>e.indexOf(t.toString())>-1):e),n("typing",g=!0)}else!d&&r&&(n("options",l=Object.fromEntries(Object.entries(r))),n("optorder",m=c.length?c:Object.keys(l)),n("typing",g=!0))}else n("hoveropt",h=!1),n("options",l=Object.fromEntries(Object.entries(r))),n("optorder",m=Object.keys(l));else b();else n("mouseSelect",v=!1),y(h);m.length||n("hoveropt",h=!1)},starttyping:function(){const e=Object.keys(l);n("optorder",m=c.length?c:e),n("options",l=c.length?r:l),n("typing",g=!0),n("placeholder",_=i?u(i):"")},input_input_handler:function(){o=this.value,n("intext",o)},mouseup_handler:({optid:e},t)=>y(e),mousemove_handler:({optid:e},t)=>n("hoveropt",h=e),mousedown_handler:e=>n("mouseSelect",v=!0)}}class Ie extends Y{constructor(e){super(),X(this,e,Ae,Re,s,["selectval","fixedoptions","fixedorder","intext","fetchUrl","fetchedData","niceName","unknowninput"])}}const{Object:Ue}=K;function Qe(e,t,n){const a=Ue.create(e);return a.s_id=t[n][0],a.sample=t[n][1],a}function Be(e,t,n){const a=Ue.create(e);return a.s_id=t[n][0],a.sample=t[n][1],a}function Ke(e,t,n){const a=Ue.create(e);return a.file=t[n],a}function Ge(e,t,n){const a=Ue.create(e);return a.s_id=t[n][0],a.sample=t[n][1],a}function Je(e,t,n){const a=Ue.create(e);return a.channel=t[n],a.each_value=t,a.chix=n,a}function Ve(e,t,n){const a=Ue.create(e);return a.quant=t[n],a}function We(e,t,n){const a=Ue.create(e);return a.param_id=t[n][0],a.param=t[n][1],a.each_value_6=t,a.each_index_3=n,a}function Xe(e,t,n){const a=Ue.create(e);return a.enzyme=t[n],a.each_value_7=t,a.enzyme_index=n,a}function Ye(e,t,n){const a=Ue.create(e);return a.spec=t[n],a}function Ze(e){var t;return{c(){b(t=f("i"),"class","icon fas fa-edit")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function et(e){var t;return{c(){b(t=f("i"),"class","icon fas fa-check-circle")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function tt(e){var t,n,a,l,s,i,r=xt(e.spec)+"";function c(...t){return e.click_handler(e,...t)}return{c(){t=f("span"),n=m(r),a=h(),l=f("button"),s=h(),b(l,"class","delete is-small"),b(t,"class","tag is-medium is-info"),i=g(l,"click",c)},m(e,i){d(e,t,i),o(t,n),o(t,a),o(t,l),o(t,s)},p(t,a){e=a,t.prepdata&&r!==(r=xt(e.spec)+"")&&j(n,r)},d(e){e&&p(t),i()}}}function nt(e){var t;let n=e.prepdata.enzymes,a=[];for(let t=0;t<n.length;t+=1)a[t]=at(Xe(e,n,t));return{c(){for(let e=0;e<a.length;e+=1)a[e].c();t=_()},m(e,n){for(let t=0;t<a.length;t+=1)a[t].m(e,n);d(e,t,n)},p(e,l){if(e.prepdata){let s;for(n=l.prepdata.enzymes,s=0;s<n.length;s+=1){const i=Xe(l,n,s);a[s]?a[s].p(e,i):(a[s]=at(i),a[s].c(),a[s].m(t.parentNode,t))}for(;s<a.length;s+=1)a[s].d(1);a.length=n.length}},d(e){u(a,e),e&&p(t)}}}function at(e){var t,n,l,s,i,r=e.enzyme.name+"";function c(){e.input_change_handler_1.call(n,e)}return{c(){t=f("div"),n=f("input"),l=m(r),s=h(),b(n,"type","checkbox"),b(t,"class","control"),i=[g(n,"change",c),g(n,"change",e.editMade)]},m(a,i){d(a,t,i),o(t,n),n.checked=e.enzyme.checked,o(t,l),o(t,s)},p(t,a){e=a,t.prepdata&&(n.checked=e.enzyme.checked),t.prepdata&&r!==(r=e.enzyme.name+"")&&j(l,r)},d(e){e&&p(t),a(i)}}}function lt(e){var t,n;function a(n){e.param_param_binding.call(null,n,e),t=!0,D(()=>t=!1)}let l={};void 0!==e.param&&(l.param=e.param);var s=new ge({props:l});return S.push(()=>G(s,"param",a)),s.$on("edited",e.editMade),{c(){s.$$.fragment.c()},m(e,t){J(s,e,t),n=!0},p(n,a){e=a;var l={};(!t&&n.Object||n.prepdata)&&(l.param=e.param),s.$set(l)},i(e){n||(Q(s.$$.fragment,e),n=!0)},o(e){B(s.$$.fragment,e),n=!1},d(e){V(s,e)}}}function st(e){var t,n,a,l=e.quant.name+"";return{c(){t=f("option"),n=m(l),t.__value=a=e.quant.id,t.value=t.__value},m(e,a){d(e,t,a),o(t,n)},p(e,s){(e.Object||e.prepdata)&&l!==(l=s.quant.name+"")&&j(n,l),(e.Object||e.prepdata)&&a!==(a=s.quant.id)&&(t.__value=a),t.value=t.__value},d(e){e&&p(t)}}}function it(e){var t,n,l,s,i,r,c,u,_,v,y,j,x,$,k,O,q,N,C,F=e.isLabelfree&&rt(e);function S(e,t){return t.isLabelfree&&t.prepdata.labelfree_multisample?ot:t.isLabelfree?void 0:ct}var E=S(0,e),L=E&&E(e);function M(e,t){return t.foundNewSamples?pt:dt}var P=M(0,e),z=P(e);function D(e,t){return t.isLabelfree?t.isLabelfree&&t.prepdata.labelfree_multisample?ft:((null==N||e.isLabelfree||e.Object||e.$datasetFiles)&&(N=!(!t.isLabelfree||!t.Object.keys(t.$datasetFiles).length)),N?ut:void 0):mt}var T=D(null,e),H=T&&T(e);return{c(){t=f("div"),(n=f("label")).textContent="Samples",l=h(),s=f("textarea"),i=h(),(r=f("a")).textContent="Parse sample names",c=h(),u=f("div"),F&&F.c(),_=h(),v=f("table"),y=f("thead"),j=f("tr"),L&&L.c(),x=h(),$=f("th"),k=m("Sample name \n        "),z.c(),O=h(),q=f("tbody"),H&&H.c(),b(n,"class","label"),b(s,"class","textarea"),b(s,"placeholder","Paste your sample names here (one line per sample, tab separated sample/file or channel)"),b(r,"class","button is-primary"),b(u,"class","control"),b(t,"class","field"),b($,"colspan","2"),b(v,"class","table is-fullwidth"),C=[g(s,"input",e.textarea_input_handler),g(r,"click",e.parseSampleNames)]},m(a,p){d(a,t,p),o(t,n),o(t,l),o(t,s),w(s,e.trysamplenames),o(t,i),o(t,r),o(t,c),o(t,u),F&&F.m(u,null),d(a,_,p),d(a,v,p),o(v,y),o(y,j),L&&L.m(j,null),o(j,x),o(j,$),o($,k),z.m($,null),o(v,O),o(v,q),H&&H.m(q,null)},p(e,t){e.trysamplenames&&w(s,t.trysamplenames),t.isLabelfree?F?F.p(e,t):((F=rt(t)).c(),F.m(u,null)):F&&(F.d(1),F=null),E!==(E=S(0,t))&&(L&&L.d(1),(L=E&&E(t))&&(L.c(),L.m(j,x))),P!==(P=M(0,t))&&(z.d(1),(z=P(t))&&(z.c(),z.m($,null))),T===(T=D(e,t))&&H?H.p(e,t):(H&&H.d(1),(H=T&&T(t))&&(H.c(),H.m(q,null)))},d(e){e&&p(t),F&&F.d(),e&&(p(_),p(v)),L&&L.d(),z.d(),H&&H.d(),a(C)}}}function rt(e){var t,n,l,s;return{c(){t=f("div"),n=f("input"),l=m("One sample per file?"),b(n,"type","checkbox"),b(t,"id","labelfree_samples"),s=[g(n,"change",e.input_change_handler_2),g(n,"change",e.checkIfNewSamples)]},m(a,s){d(a,t,s),o(t,n),n.checked=e.prepdata.labelfree_multisample,o(t,l)},p(e,t){e.prepdata&&(n.checked=t.prepdata.labelfree_multisample)},d(e){e&&p(t),a(s)}}}function ct(e){var t;return{c(){(t=f("th")).textContent="Channel"},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function ot(e){var t;return{c(){(t=f("th")).textContent="Filename"},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function dt(e){var t;return{c(){(t=f("a")).textContent="Save new samples",b(t,"class","button is-danger is-small is-pulled-right"),b(t,"disabled","")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function pt(e){var t,n;return{c(){(t=f("a")).textContent="Save new samples",b(t,"class","button is-danger is-small is-pulled-right"),n=g(t,"click",e.saveNewSamples)},m(e,n){d(e,t,n)},d(e){e&&p(t),n()}}}function ut(e){var t,n,l,s,i,r,c,m,_;let v=e.Object.entries(ie),y=[];for(let t=0;t<v.length;t+=1)y[t]=ht(Qe(e,v,t));return{c(){t=f("tr"),n=f("td"),l=f("div"),s=f("select"),(i=f("option")).textContent="Pick a project-sample";for(let e=0;e<y.length;e+=1)y[e].c();r=h(),c=f("td"),m=f("input"),i.disabled=!0,i.__value="",i.value=i.__value,void 0===e.prepdata.labelfree_singlesample.model&&z(()=>e.select_change_handler_3.call(s)),b(l,"class","select"),b(m,"placeholder","or define a new sample"),b(m,"class","input is-normal"),_=[g(s,"change",e.select_change_handler_3),g(s,"change",e.change_handler_4),g(m,"input",e.input_input_handler_2),g(m,"change",e.change_handler_5)]},m(a,p){d(a,t,p),o(t,n),o(n,l),o(l,s),o(s,i);for(let e=0;e<y.length;e+=1)y[e].m(s,null);$(s,e.prepdata.labelfree_singlesample.model),o(t,r),o(t,c),o(c,m),w(m,e.prepdata.labelfree_singlesample.newprojsample)},p(e,t){if(e.Object||e.projsamples){let n;for(v=t.Object.entries(ie),n=0;n<v.length;n+=1){const a=Qe(t,v,n);y[n]?y[n].p(e,a):(y[n]=ht(a),y[n].c(),y[n].m(s,null))}for(;n<y.length;n+=1)y[n].d(1);y.length=v.length}e.prepdata&&$(s,t.prepdata.labelfree_singlesample.model),e.prepdata&&m.value!==t.prepdata.labelfree_singlesample.newprojsample&&w(m,t.prepdata.labelfree_singlesample.newprojsample)},d(e){e&&p(t),u(y,e),a(_)}}}function ft(e){var t;let n=e.Object.values(e.$datasetFiles),a=[];for(let t=0;t<n.length;t+=1)a[t]=vt(Ke(e,n,t));return{c(){for(let e=0;e<a.length;e+=1)a[e].c();t=_()},m(e,n){for(let t=0;t<a.length;t+=1)a[t].m(e,n);d(e,t,n)},p(e,l){if(e.Object||e.$datasetFiles||e.prepdata||e.projsamples){let s;for(n=l.Object.values(l.$datasetFiles),s=0;s<n.length;s+=1){const i=Ke(l,n,s);a[s]?a[s].p(e,i):(a[s]=vt(i),a[s].c(),a[s].m(t.parentNode,t))}for(;s<a.length;s+=1)a[s].d(1);a.length=n.length}},d(e){u(a,e),e&&p(t)}}}function mt(e){var t;let n=e.prepdata.quants[e.prepdata.quanttype].chans,a=[];for(let t=0;t<n.length;t+=1)a[t]=jt(Je(e,n,t));return{c(){for(let e=0;e<a.length;e+=1)a[e].c();t=_()},m(e,n){for(let t=0;t<a.length;t+=1)a[t].m(e,n);d(e,t,n)},p(e,l){if(e.prepdata||e.foundNewSamples||e.Object||e.projsamples){let s;for(n=l.prepdata.quants[l.prepdata.quanttype].chans,s=0;s<n.length;s+=1){const i=Je(l,n,s);a[s]?a[s].p(e,i):(a[s]=jt(i),a[s].c(),a[s].m(t.parentNode,t))}for(;s<a.length;s+=1)a[s].d(1);a.length=n.length}},d(e){u(a,e),e&&p(t)}}}function ht(e){var t,n,a,l=e.sample.name+"";return{c(){t=f("option"),n=m(l),t.__value=a=e.s_id,t.value=t.__value},m(e,a){d(e,t,a),o(t,n)},p(e,s){(e.Object||e.projsamples)&&l!==(l=s.sample.name+"")&&j(n,l),(e.Object||e.projsamples)&&a!==(a=s.s_id)&&(t.__value=a),t.value=t.__value},d(e){e&&p(t)}}}function _t(e){var t,n,l,s,i,r,c,_,v,y,x,k,O,q=e.file.name+"";let N=e.Object.entries(ie),C=[];for(let t=0;t<N.length;t+=1)C[t]=gt(Be(e,N,t));function F(){e.select_change_handler_2.call(c,e)}function S(...t){return e.change_handler_2(e,...t)}function E(){e.input_input_handler_1.call(x,e)}function L(...t){return e.change_handler_3(e,...t)}return{c(){t=f("tr"),n=f("td"),l=m(q),s=h(),i=f("td"),r=f("div"),c=f("select"),(_=f("option")).textContent="Pick a project-sample";for(let e=0;e<C.length;e+=1)C[e].c();v=h(),y=f("td"),x=f("input"),k=h(),_.disabled=!0,_.__value="",_.value=_.__value,void 0===e.prepdata.samples[e.file.associd].model&&z(F),b(r,"class","select"),b(x,"placeholder","or define a new sample"),b(x,"class","input is-normal"),O=[g(c,"change",F),g(c,"change",S),g(x,"input",E),g(x,"change",L)]},m(a,p){d(a,t,p),o(t,n),o(n,l),o(t,s),o(t,i),o(i,r),o(r,c),o(c,_);for(let e=0;e<C.length;e+=1)C[e].m(c,null);$(c,e.prepdata.samples[e.file.associd].model),o(t,v),o(t,y),o(y,x),w(x,e.prepdata.samples[e.file.associd].newprojsample),o(t,k)},p(t,n){if(e=n,(t.Object||t.$datasetFiles)&&q!==(q=e.file.name+"")&&j(l,q),t.Object||t.projsamples){let n;for(N=e.Object.entries(ie),n=0;n<N.length;n+=1){const a=Be(e,N,n);C[n]?C[n].p(t,a):(C[n]=gt(a),C[n].c(),C[n].m(c,null))}for(;n<C.length;n+=1)C[n].d(1);C.length=N.length}(t.prepdata||t.Object||t.$datasetFiles)&&$(c,e.prepdata.samples[e.file.associd].model),(t.prepdata||t.Object||t.$datasetFiles)&&x.value!==e.prepdata.samples[e.file.associd].newprojsample&&w(x,e.prepdata.samples[e.file.associd].newprojsample)},d(e){e&&p(t),u(C,e),a(O)}}}function gt(e){var t,n,a,l=e.sample.name+"";return{c(){t=f("option"),n=m(l),t.__value=a=e.s_id,t.value=t.__value},m(e,a){d(e,t,a),o(t,n)},p(e,s){(e.Object||e.projsamples)&&l!==(l=s.sample.name+"")&&j(n,l),(e.Object||e.projsamples)&&a!==(a=s.s_id)&&(t.__value=a),t.value=t.__value},d(e){e&&p(t)}}}function vt(e){var t,n=e.file.associd in e.prepdata.samples&&_t(e);return{c(){n&&n.c(),t=_()},m(e,a){n&&n.m(e,a),d(e,t,a)},p(e,a){a.file.associd in a.prepdata.samples?n?n.p(e,a):((n=_t(a)).c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},d(e){n&&n.d(e),e&&p(t)}}}function bt(e){var t,n,a,l=e.sample.name+"";return{c(){t=f("option"),n=m(l),t.__value=a=e.s_id,t.value=t.__value},m(e,a){d(e,t,a),o(t,n)},p(e,s){(e.Object||e.projsamples)&&l!==(l=s.sample.name+"")&&j(n,l),(e.Object||e.projsamples)&&a!==(a=s.s_id)&&(t.__value=a),t.value=t.__value},d(e){e&&p(t)}}}function yt(e){var t;return{c(){(t=f("span")).innerHTML='<i class="fas fa-asterisk"></i>',b(t,"class","icon is-left has-text-danger")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function jt(e){var t,n,l,s,i,r,c,_,v,y,x,k,O,q,N,C,F=e.channel.name+"";let S=e.Object.entries(ie),E=[];for(let t=0;t<S.length;t+=1)E[t]=bt(Ge(e,S,t));function L(){e.select_change_handler_1.call(c,e)}function M(...t){return e.change_handler(e,...t)}function P(){e.input_input_handler.call(k,e)}function D(...t){return e.change_handler_1(e,...t)}var T=e.foundNewSamples&&e.channel.newprojsample&&yt();return{c(){t=f("tr"),n=f("td"),l=m(F),s=h(),i=f("td"),r=f("div"),c=f("select"),(_=f("option")).textContent="Pick a project-sample";for(let e=0;e<E.length;e+=1)E[e].c();v=h(),y=f("td"),x=f("p"),k=f("input"),O=h(),T&&T.c(),N=h(),_.disabled=!0,_.__value="",_.value=_.__value,void 0===e.channel.model&&z(L),b(r,"class","select"),b(k,"class","input is-normal"),b(k,"placeholder","or define a new sample"),b(x,"class",q=e.channel.newprojsample&&e.foundNewSamples?"control has-icons-left":"control"),C=[g(c,"change",L),g(c,"change",M),g(k,"input",P),g(k,"change",D)]},m(a,p){d(a,t,p),o(t,n),o(n,l),o(t,s),o(t,i),o(i,r),o(r,c),o(c,_);for(let e=0;e<E.length;e+=1)E[e].m(c,null);$(c,e.channel.model),o(t,v),o(t,y),o(y,x),o(x,k),w(k,e.channel.newprojsample),o(x,O),T&&T.m(x,null),o(t,N)},p(t,n){if(e=n,t.prepdata&&F!==(F=e.channel.name+"")&&j(l,F),t.Object||t.projsamples){let n;for(S=e.Object.entries(ie),n=0;n<S.length;n+=1){const a=Ge(e,S,n);E[n]?E[n].p(t,a):(E[n]=bt(a),E[n].c(),E[n].m(c,null))}for(;n<E.length;n+=1)E[n].d(1);E.length=S.length}t.prepdata&&$(c,e.channel.model),t.prepdata&&k.value!==e.channel.newprojsample&&w(k,e.channel.newprojsample),e.foundNewSamples&&e.channel.newprojsample?T||((T=yt()).c(),T.m(x,null)):T&&(T.d(1),T=null),(t.prepdata||t.foundNewSamples)&&q!==(q=e.channel.newprojsample&&e.foundNewSamples?"control has-icons-left":"control")&&b(x,"class",q)},d(e){e&&p(t),u(E,e),T&&T.d(),a(C)}}}function wt(e){var t,n,l,s,i,r,c,v,y,j,w,x,k,O,q,N,C,F,E,L,M,P,T,H,R,A,K,W,X,Y,Z,ee,te,ne,ae,le,se;function ie(e,t){return t.stored?et:t.edited?Ze:void 0}var re=ie(0,e),ce=re&&re(e),oe=new xe({props:{errors:e.preperrors}});function de(t){e.dynamicselect_selectval_binding.call(null,t),q=!0,D(()=>q=!1)}function pe(t){e.dynamicselect_fetchedData_binding.call(null,t),N=!0,D(()=>N=!1)}let ue={intext:"Type to get more organisms",fixedoptions:e.prepdata.allspecies,fixedorder:e.Object.values(e.prepdata.allspecies).sort($t).map(kt),fetchUrl:"/datasets/show/species/",niceName:xt};void 0!==e.selectedspecies&&(ue.selectval=e.selectedspecies),void 0!==e.fetchedSpecies&&(ue.fetchedData=e.fetchedSpecies);var fe=new Ie({props:ue});S.push(()=>G(fe,"selectval",de)),S.push(()=>G(fe,"fetchedData",pe)),fe.$on("selectedvalue",e.addOrganism);let me=e.prepdata.species,he=[];for(let t=0;t<me.length;t+=1)he[t]=tt(Ye(e,me,t));var _e=!e.prepdata.no_enzyme&&nt(e);let ge=e.Object.entries(e.prepdata.params),ve=[];for(let t=0;t<ge.length;t+=1)ve[t]=lt(We(e,ge,t));const be=e=>B(ve[e],1,1,()=>{ve[e]=null});let ye=e.Object.values(e.prepdata.quants),je=[];for(let t=0;t<ye.length;t+=1)je[t]=st(Ve(e,ye,t));var we=e.prepdata.quanttype&&it(e);return{c(){t=f("h5"),ce&&ce.c(),n=m("\n  Sample prep\n  "),l=f("button"),s=m("Save"),r=h(),c=f("button"),v=m("Revert"),j=h(),oe.$$.fragment.c(),w=h(),x=f("div"),(k=f("label")).textContent="Organism",O=h(),fe.$$.fragment.c(),C=h(),F=f("div");for(let e=0;e<he.length;e+=1)he[e].c();E=h(),L=f("div"),(M=f("label")).textContent="Enzymes",P=h(),T=f("input"),H=m("No enzyme\n  "),_e&&_e.c(),R=h();for(let e=0;e<ve.length;e+=1)ve[e].c();A=h(),K=f("div"),(W=f("label")).textContent="Quant type",X=h(),Y=f("div"),Z=f("div"),ee=f("select"),(te=f("option")).textContent="Please select one";for(let e=0;e<je.length;e+=1)je[e].c();ne=h(),we&&we.c(),ae=_(),b(l,"class","button is-small is-danger has-text-weight-bold"),l.disabled=i=!e.edited,b(c,"class","button is-small is-info has-text-weight-bold"),c.disabled=y=!e.edited,b(t,"id","sampleprep"),b(t,"class","has-text-primary title is-5"),b(k,"class","label"),b(x,"class","field"),b(F,"class","tags"),b(M,"class","label"),b(T,"type","checkbox"),b(L,"class","field"),b(W,"class","label"),te.disabled=!0,te.__value="",te.value=te.__value,void 0===e.prepdata.quanttype&&z(()=>e.select_change_handler.call(ee)),b(Z,"class","select"),b(Y,"class","control"),b(K,"class","field"),se=[g(l,"click",e.save),g(c,"click",e.fetchData),g(T,"change",e.input_change_handler),g(T,"change",e.editMade),g(ee,"change",e.select_change_handler),g(ee,"change",e.checkIfNewSamples)]},m(a,i){d(a,t,i),ce&&ce.m(t,null),o(t,n),o(t,l),o(l,s),o(t,r),o(t,c),o(c,v),d(a,j,i),J(oe,a,i),d(a,w,i),d(a,x,i),o(x,k),o(x,O),J(fe,x,null),d(a,C,i),d(a,F,i);for(let e=0;e<he.length;e+=1)he[e].m(F,null);d(a,E,i),d(a,L,i),o(L,M),o(L,P),o(L,T),T.checked=e.prepdata.no_enzyme,o(L,H),_e&&_e.m(L,null),d(a,R,i);for(let e=0;e<ve.length;e+=1)ve[e].m(a,i);d(a,A,i),d(a,K,i),o(K,W),o(K,X),o(K,Y),o(Y,Z),o(Z,ee),o(ee,te);for(let e=0;e<je.length;e+=1)je[e].m(ee,null);$(ee,e.prepdata.quanttype),d(a,ne,i),we&&we.m(a,i),d(a,ae,i),le=!0},p(e,a){re!==(re=ie(0,a))&&(ce&&ce.d(1),(ce=re&&re(a))&&(ce.c(),ce.m(t,n))),le&&!e.edited||i===(i=!a.edited)||(l.disabled=i),le&&!e.edited||y===(y=!a.edited)||(c.disabled=y);var s={};e.preperrors&&(s.errors=a.preperrors),oe.$set(s);var r={};if(e.prepdata&&(r.fixedoptions=a.prepdata.allspecies),(e.Object||e.prepdata)&&(r.fixedorder=a.Object.values(a.prepdata.allspecies).sort($t).map(kt)),!q&&e.selectedspecies&&(r.selectval=a.selectedspecies),!N&&e.fetchedSpecies&&(r.fetchedData=a.fetchedSpecies),fe.$set(r),e.niceSpecies||e.prepdata){let t;for(me=a.prepdata.species,t=0;t<me.length;t+=1){const n=Ye(a,me,t);he[t]?he[t].p(e,n):(he[t]=tt(n),he[t].c(),he[t].m(F,null))}for(;t<he.length;t+=1)he[t].d(1);he.length=me.length}if(e.prepdata&&(T.checked=a.prepdata.no_enzyme),a.prepdata.no_enzyme?_e&&(_e.d(1),_e=null):_e?_e.p(e,a):((_e=nt(a)).c(),_e.m(L,null)),e.Object||e.prepdata){let t;for(ge=a.Object.entries(a.prepdata.params),t=0;t<ge.length;t+=1){const n=We(a,ge,t);ve[t]?(ve[t].p(e,n),Q(ve[t],1)):(ve[t]=lt(n),ve[t].c(),Q(ve[t],1),ve[t].m(A.parentNode,A))}for(I(),t=ge.length;t<ve.length;t+=1)be(t);U()}if(e.Object||e.prepdata){let t;for(ye=a.Object.values(a.prepdata.quants),t=0;t<ye.length;t+=1){const n=Ve(a,ye,t);je[t]?je[t].p(e,n):(je[t]=st(n),je[t].c(),je[t].m(ee,null))}for(;t<je.length;t+=1)je[t].d(1);je.length=ye.length}e.prepdata&&$(ee,a.prepdata.quanttype),a.prepdata.quanttype?we?we.p(e,a):((we=it(a)).c(),we.m(ae.parentNode,ae)):we&&(we.d(1),we=null)},i(e){if(!le){Q(oe.$$.fragment,e),Q(fe.$$.fragment,e);for(let e=0;e<ge.length;e+=1)Q(ve[e]);le=!0}},o(e){B(oe.$$.fragment,e),B(fe.$$.fragment,e),ve=ve.filter(Boolean);for(let e=0;e<ve.length;e+=1)B(ve[e]);le=!1},d(e){e&&p(t),ce&&ce.d(),e&&p(j),V(oe,e),e&&(p(w),p(x)),V(fe),e&&(p(C),p(F)),u(he,e),e&&(p(E),p(L)),_e&&_e.d(),e&&p(R),u(ve,e),e&&(p(A),p(K)),u(je,e),e&&p(ne),we&&we.d(e),e&&p(ae),a(se)}}}function xt(e){let t;return t=void 0===e?"":e.name?`${e.name}, ${e.linnean}`:`${e.linnean}`}const $t=(e,t)=>t.total-e.total,kt=e=>e.id;function Ot(e,t,n){let a,l;i(e,le,e=>{n("$dataset_id",a=e)}),i(e,se,e=>{n("$datasetFiles",l=e)});let{errors:s}=t,r=[],c=!1,o={};function d(){n("errors",s=s.length?w():[]),n("edited",c=!0)}let p,u,f={params:[],enzymes:[],no_enzyme:!1,quanttype:"",quants:{},labelfree_multisample:!0,labelfree_singlesample:{},allspecies:[],species:[],samples:{}},m="",h=!1;function _(e){n("prepdata",f.species=f.species.filter(t=>t.id!==e),f),d()}function g(){f.quanttype!==u?n("foundNewSamples",h=f.quants[f.quanttype].chans.some(e=>""!==e.newprojsample)):f.labelfree_multisample?n("foundNewSamples",h=Object.values(f.samples).some(e=>""!==e.newprojsample)):n("foundNewSamples",h=""!==f.labelfree_singlesample.newprojsample)}function v(e=!1){let t;if(""!=(t=f.labelfree_multisample?f.samples[e].newprojsample:f.labelfree_singlesample.newprojsample)){let a=t.trim().toUpperCase(),l=Object.entries(ie).filter(e=>e[1].name.toUpperCase()==a).map(e=>e[0])[0];l&&!f.labelfree_multisample?(n("prepdata",f.labelfree_singlesample.model=l,f),n("prepdata",f.labelfree_singlesample.newprojsample="",f)):l&&(n("prepdata",f.samples[e].model=l,f),n("prepdata",f.samples[e].newprojsample="",f)),g()}}function b(e){if(""!=f.quants[f.quanttype].chans[e].newprojsample){let t=f.quants[f.quanttype].chans[e].newprojsample.trim().toUpperCase(),a=Object.entries(ie).filter(e=>e[1].name.toUpperCase()==t).map(e=>e[0])[0];a&&(n("prepdata",f.quants[f.quanttype].chans[e].model=a,f),n("prepdata",f.quants[f.quanttype].chans[e].newprojsample="",f)),g()}}function y(e){e.newprojsample="",g(),d()}async function j(e,t){let l,s={dataset_id:a,samplename:e.newprojsample};try{l=await te("/datasets/save/projsample/",s)}catch(e){return void("404"===e.message&&n("preperrors",r=[r,"Save dataset before saving new samples"]))}return ie[l.psid]={name:l.psname,id:l.psid},[l.psid,t]}function w(){let e=[];if(f.no_enzyme||f.enzymes.filter.length||e.push("Enzyme selection is required"),f.quanttype||e.push("Quant type selection is required"),O&&f.labelfree_multisample){for(let t of Object.values(l))if(!f.samples[t.associd].model&&!f.samples[t.associd].newprojsample){e.push("Labelfree requires sample name for each file");break}}else if(O)""===f.labelfree_singlesample.model&&e.push("Labelfree singlesample requires a sample name");else if(f.quanttype in f.quants)for(let t of f.quants[f.quanttype].chans)if(""===t.model){e.push("Sample name for each channel is required");break}for(let t of Object.values(f.params).filter(e=>"checkbox"!==e.inputtype))void 0!==t.model&&""!==t.model||e.push(t.title+" is required");for(let t of Object.values(f.params).filter(e=>"checkbox"===e.inputtype))t.fields.some(e=>e.checked)||e.push(t.title+" is required");return Object.keys(f.species).length||e.push("Organism(s) is/are required"),e}async function x(){let e="/datasets/show/sampleprep/";e=a?e+a:e;const t=await ee(e);for(let[e,a]of Object.entries(t))n("prepdata",f[e]=a,f);n("labelfree_quant_id",u=Object.entries(f.quants).filter(e=>"labelfree"===e[1].name).map(e=>Number(e[0])).pop()),n("edited",c=!1)}N(async()=>{await x()});let $,O;return e.$set=(e=>{"errors"in e&&n("errors",s=e.errors)}),e.$$.update=((e={$dataset_id:1,edited:1,prepdata:1,labelfree_quant_id:1,$datasetFiles:1})=>{(e.$dataset_id||e.edited)&&n("stored",$=a&&!c),(e.prepdata||e.labelfree_quant_id)&&n("isLabelfree",O=f.quanttype===u),e.$datasetFiles&&l&&function(){const e=Object.values(l).map(e=>e.associd);n("prepdata",f.samples=Object.fromEntries(Object.entries(f.samples).filter(t=>e.indexOf(Number(t[0]))>-1)),f);for(let t of e.filter(e=>!(e in f.samples)))n("prepdata",f.samples[t]={model:"",newprojsample:""},f)}()}),{errors:s,preperrors:r,edited:c,fetchedSpecies:o,editMade:d,prepdata:f,selectedspecies:p,trysamplenames:m,foundNewSamples:h,removeOrganism:_,addOrganism:function(){console.log(p),console.log(o[p]),console.log(f.species);const e=p in f.allspecies?f.allspecies[p]:o[p];n("prepdata",f.species=[...f.species,e],f),d()},checkIfNewSamples:g,checkNewSampleLabelfree:v,checkNewSampleIso:b,parseSampleNames:function(){let e={},t={};if(O&&!f.labelfree_multisample)return 0;if(O)for(let e of Object.values(l))t[e.name]=e;else f.quants[f.quanttype].chans.forEach(function(t,n){e[t.name]=n});for(let a of m.trim().split("\n")){let l,s,i;a.indexOf("\t")>-1?a=a.trim().split("\t").map(e=>e.trim()):a.indexOf("    ")>-1&&(a=a.trim().split("    ").map(e=>e.trim())),O?(a[0]in t&&(i=t[a[0]],l=a[1]),a[1]in t&&(i=t[a[1]],l=a[0]),i&&(n("prepdata",f.samples[i.associd].newprojsample=l,f),v(i.associd))):(a[0]in e&&(s=e[a[0]],l=a[1]),a[1]in e&&(s=e[a[1]],l=a[0]),s>-1&&(n("prepdata",f.quants[f.quanttype].chans[s].newprojsample=l,f),b(s)))}d()},resetNewSampleName:y,saveNewSamples:async function(){let e=[];if(O)if(!f.labelfree_multisample&&h){const e=await j(f.labelfree_singlesample);n("prepdata",f.labelfree_singlesample.model=e[0],f),n("prepdata",f.labelfree_singlesample.newprojsample="",f)}else{Object.entries(f.samples).filter(e=>e[1].newprojsample).forEach(function(t){e.push(j(t[1],t[0]))});for(let t of e){let[e,a]=await t;n("prepdata",f.samples[a].newprojsample="",f),n("prepdata",f.samples[a].model=e,f)}}else{f.quants[f.quanttype].chans.map(function(e,t){return[t,e]}).filter(e=>e[1].newprojsample).forEach(function(t){e.push(j(t[1],t[0]))});for(let t of e){let[e,a]=await t;n("prepdata",f.quants[f.quanttype].chans[a].newprojsample="",f),n("prepdata",f.quants[f.quanttype].chans[a].model=e,f)}}g()},validate:w,save:async function(){if(n("errors",s=w()),!Object.keys(l).length&&O&&n("preperrors",r=[...r,"Add files before saving data"]),a||n("preperrors",r=[...r,"Save dataset before saving sample prep"]),0===s.length&&0===r.length){let e={dataset_id:a,enzymes:f.no_enzyme?[]:f.enzymes,params:f.params,quanttype:f.quanttype,labelfree:O,species:f.species};O?f.labelfree_multisample?(e.filenames=Object.values(l),e.samples=f.samples):(e.filenames=Object.values(l),e.samples=Object.fromEntries(e.filenames.map(e=>[e.associd,f.labelfree_singlesample]))):e.samples=f.quants[f.quanttype].chans;let t="/datasets/save/sampleprep/";await te(t,e),x()}},fetchData:x,stored:$,isLabelfree:O,Object:Object,$datasetFiles:l,dynamicselect_selectval_binding:function(e){n("selectedspecies",p=e)},dynamicselect_fetchedData_binding:function(e){n("fetchedSpecies",o=e)},click_handler:({spec:e},t)=>_(e.id),input_change_handler:function(){f.no_enzyme=this.checked,n("prepdata",f),n("Object",Object)},input_change_handler_1:function({enzyme:e,each_value_7:t,enzyme_index:a}){t[a].checked=this.checked,n("prepdata",f),n("Object",Object)},param_param_binding:function(e,{param:t,each_value_6:a,each_index_3:l}){a[l][1]=e,n("Object",Object)},select_change_handler:function(){f.quanttype=k(this),n("prepdata",f),n("Object",Object)},textarea_input_handler:function(){m=this.value,n("trysamplenames",m)},input_change_handler_2:function(){f.labelfree_multisample=this.checked,n("prepdata",f),n("Object",Object)},select_change_handler_1:function({channel:e,each_value:t,chix:a}){t[a].model=k(this),n("prepdata",f),n("Object",Object)},change_handler:({channel:e},t)=>y(e),input_input_handler:function({channel:e,each_value:t,chix:a}){t[a].newprojsample=this.value,n("prepdata",f),n("Object",Object)},change_handler_1:({chix:e},t)=>b(e),select_change_handler_2:function({file:e}){f.samples[e.associd].model=k(this),n("prepdata",f),n("Object",Object),n("projsamples",ie)},change_handler_2:({file:e},t)=>y(f.samples[e.associd]),input_input_handler_1:function({file:e}){f.samples[e.associd].newprojsample=this.value,n("prepdata",f),n("Object",Object),n("projsamples",ie)},change_handler_3:({file:e},t)=>v(e.associd),select_change_handler_3:function(){f.labelfree_singlesample.model=k(this),n("prepdata",f),n("Object",Object)},change_handler_4:e=>y(f.labelfree_singlesample),input_input_handler_2:function(){f.labelfree_singlesample.newprojsample=this.value,n("prepdata",f),n("Object",Object)},change_handler_5:e=>v(f.labelfree_singlesample)}}class qt extends Y{constructor(e){super(),X(this,e,Ot,wt,s,["errors","validate","save"])}get validate(){return this.$$.ctx.validate}get save(){return this.$$.ctx.save}}function Nt(e,t,n){const a=Object.create(e);return a.range=t[n],a}function Ct(e,t,n){const a=Object.create(e);return a.prefrac=t[n],a}function Ft(e){var t,n,a,l=e.prefrac.name+"";return{c(){t=f("option"),n=m(l),t.__value=a=e.prefrac.id,t.value=t.__value},m(e,a){d(e,t,a),o(t,n)},p(e,s){e.prefracs&&l!==(l=s.prefrac.name+"")&&j(n,l),e.prefracs&&a!==(a=s.prefrac.id)&&(t.__value=a),t.value=t.__value},d(e){e&&p(t)}}}function St(e){var t,n,l,s,i,r,c=!1;function u(){c=!0,e.input_input_handler.call(i)}return{c(){t=f("div"),(n=f("label")).textContent="Prefractionation length",l=h(),s=f("div"),i=f("input"),b(n,"class","label"),b(i,"type","number"),b(i,"class","input"),b(i,"placeholder","in minutes"),b(s,"class","control"),b(t,"class","field"),r=[g(i,"input",u),g(i,"change",e.editMade)]},m(a,r){d(a,t,r),o(t,n),o(t,l),o(t,s),o(s,i),w(i,e.dsinfo.prefrac_length)},p(e,t){!c&&e.dsinfo&&w(i,t.dsinfo.prefrac_length),c=!1},d(e){e&&p(t),a(r)}}}function Et(e){var t,n,l,s,i,r,c,m;let _=e.hirief_ranges,v=[];for(let t=0;t<_.length;t+=1)v[t]=Lt(Nt(e,_,t));return{c(){t=f("div"),(n=f("label")).textContent="HiRIEF range",l=h(),s=f("div"),i=f("div"),r=f("select"),(c=f("option")).textContent="Please select one";for(let e=0;e<v.length;e+=1)v[e].c();b(n,"class","label"),c.disabled=!0,c.__value="",c.value=c.__value,void 0===e.dsinfo.hiriefrange&&z(()=>e.select_change_handler_1.call(r)),b(i,"class","select"),b(s,"class","control"),b(t,"class","field"),m=[g(r,"change",e.select_change_handler_1),g(r,"change",e.editMade)]},m(a,p){d(a,t,p),o(t,n),o(t,l),o(t,s),o(s,i),o(i,r),o(r,c);for(let e=0;e<v.length;e+=1)v[e].m(r,null);$(r,e.dsinfo.hiriefrange)},p(e,t){if(e.hirief_ranges){let n;for(_=t.hirief_ranges,n=0;n<_.length;n+=1){const a=Nt(t,_,n);v[n]?v[n].p(e,a):(v[n]=Lt(a),v[n].c(),v[n].m(r,null))}for(;n<v.length;n+=1)v[n].d(1);v.length=_.length}e.dsinfo&&$(r,t.dsinfo.hiriefrange)},d(e){e&&p(t),u(v,e),a(m)}}}function Lt(e){var t,n,a,l=e.range.name+"";return{c(){t=f("option"),n=m(l),t.__value=a=e.range.id,t.value=t.__value},m(e,a){d(e,t,a),o(t,n)},p(e,s){e.hirief_ranges&&l!==(l=s.range.name+"")&&j(n,l),e.hirief_ranges&&a!==(a=s.range.id)&&(t.__value=a),t.value=t.__value},d(e){e&&p(t)}}}function Mt(e){var t,n,l,s,i,r,c=!1;function u(){c=!0,e.input_input_handler_1.call(i)}return{c(){t=f("div"),(n=f("label")).textContent="Number of fractions",l=h(),s=f("div"),i=f("input"),b(n,"class","label"),b(i,"type","number"),b(i,"class","input"),b(i,"placeholder","How many fractions of prefractionation"),b(s,"class","control"),b(t,"class","field"),r=[g(i,"input",u),g(i,"change",e.editMade)]},m(a,r){d(a,t,r),o(t,n),o(t,l),o(t,s),o(s,i),w(i,e.dsinfo.prefrac_amount)},p(e,t){!c&&e.dsinfo&&w(i,t.dsinfo.prefrac_amount),c=!1},d(e){e&&p(t),a(r)}}}function Pt(t){var n,l,s,i,r,c,m,v,y,j,w;let x=t.prefracs,k=[];for(let e=0;e<x.length;e+=1)k[e]=Ft(Ct(t,x,e));function O(e,t){return t.hiriefselected?Et:t.dsinfo.prefrac_id?St:void 0}var q=O(0,t),N=q&&q(t),C=t.dsinfo.prefrac_id&&Mt(t);return{c(){n=f("div"),(l=f("label")).textContent="Prefractionation",s=h(),i=f("div"),r=f("div"),c=f("select"),(m=f("option")).textContent="None";for(let e=0;e<k.length;e+=1)k[e].c();v=h(),N&&N.c(),y=h(),C&&C.c(),j=_(),b(l,"class","label"),m.__value="",m.value=m.__value,void 0===t.dsinfo.prefrac_id&&z(()=>t.select_change_handler.call(c)),b(r,"class","select"),b(i,"class","control"),b(n,"class","field"),w=[g(c,"change",t.select_change_handler),g(c,"change",t.editMade)]},m(e,a){d(e,n,a),o(n,l),o(n,s),o(n,i),o(i,r),o(r,c),o(c,m);for(let e=0;e<k.length;e+=1)k[e].m(c,null);$(c,t.dsinfo.prefrac_id),d(e,v,a),N&&N.m(e,a),d(e,y,a),C&&C.m(e,a),d(e,j,a)},p(e,t){if(e.prefracs){let n;for(x=t.prefracs,n=0;n<x.length;n+=1){const a=Ct(t,x,n);k[n]?k[n].p(e,a):(k[n]=Ft(a),k[n].c(),k[n].m(c,null))}for(;n<k.length;n+=1)k[n].d(1);k.length=x.length}e.dsinfo&&$(c,t.dsinfo.prefrac_id),q===(q=O(0,t))&&N?N.p(e,t):(N&&N.d(1),(N=q&&q(t))&&(N.c(),N.m(y.parentNode,y))),t.dsinfo.prefrac_id?C?C.p(e,t):((C=Mt(t)).c(),C.m(j.parentNode,j)):C&&(C.d(1),C=null)},i:e,o:e,d(e){e&&p(n),u(k,e),e&&p(v),N&&N.d(e),e&&p(y),C&&C.d(e),e&&p(j),a(w)}}}function zt(e,t,n){const a=C();let l,{dsinfo:s,hirief_ranges:i,prefracs:r}=t,c=[];return e.$set=(e=>{"dsinfo"in e&&n("dsinfo",s=e.dsinfo),"hirief_ranges"in e&&n("hirief_ranges",i=e.hirief_ranges),"prefracs"in e&&n("prefracs",r=e.prefracs)}),e.$$.update=((e={prefracs:1,dsinfo:1})=>{(e.prefracs||e.dsinfo)&&n("hiriefselected",l=r.some(e=>e.id==s.prefrac_id&&e.name.toLowerCase().indexOf("hirief")>-1))}),{dsinfo:s,hirief_ranges:i,prefracs:r,editMade:function(){a("edited")},validate:function(){return c=[],l&&!s.hiriefrange?c.push("HiRIEF range is required"):l||!s.prefrac_id||s.prefrac_length||c.push("Prefractionation length is required"),s.prefrac_id&&!s.prefrac_amount&&c.push("Prefractionation fraction amount is required"),c},hiriefselected:l,select_change_handler:function(){s.prefrac_id=k(this),n("dsinfo",s),n("prefracs",r)},select_change_handler_1:function(){s.hiriefrange=k(this),n("dsinfo",s),n("prefracs",r)},input_input_handler:function(){s.prefrac_length=y(this.value),n("dsinfo",s),n("prefracs",r)},input_input_handler_1:function(){s.prefrac_amount=y(this.value),n("dsinfo",s),n("prefracs",r)}}}class Dt extends Y{constructor(e){super(),X(this,e,zt,Pt,s,["dsinfo","hirief_ranges","prefracs","validate"])}get validate(){return this.$$.ctx.validate}}const{Object:Tt}=K;function Ht(e,t,n){const a=Tt.create(e);return a.file=t[n],a}function Rt(e,t,n){const a=Tt.create(e);return a.quant=t[n],a}function At(e){var t;return{c(){b(t=f("i"),"class","icon fas fa-edit")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function It(e){var t;return{c(){b(t=f("i"),"class","icon fas fa-check-circle")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function Ut(e){var t,n,a,l=e.quant.name+"";return{c(){t=f("option"),n=m(l),t.__value=a=e.quant.id,t.value=t.__value},m(e,a){d(e,t,a),o(t,n)},p(e,s){e.lcdata&&l!==(l=s.quant.name+"")&&j(n,l),e.lcdata&&a!==(a=s.quant.id)&&(t.__value=a),t.value=t.__value},d(e){e&&p(t)}}}function Qt(e){var t;return{c(){(t=f("a")).textContent="Save new samples",b(t,"class","button is-danger is-small is-pulled-right"),b(t,"disabled","")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function Bt(e){var t,n;return{c(){(t=f("a")).textContent="Save new samples",b(t,"class","button is-danger is-small is-pulled-right"),n=g(t,"click",e.saveNewSamples)},m(e,n){d(e,t,n)},d(e){e&&p(t),n()}}}function Kt(e){var t,n;let a=e.Object.values(e.$datasetFiles),l=[];for(let t=0;t<a.length;t+=1)l[t]=Xt(Ht(e,a,t));const s=e=>B(l[e],1,1,()=>{l[e]=null});return{c(){t=f("tbody");for(let e=0;e<l.length;e+=1)l[e].c()},m(e,a){d(e,t,a);for(let e=0;e<l.length;e+=1)l[e].m(t,null);n=!0},p(e,n){if(e.Object||e.$datasetFiles||e.lcdata||e.projsamples){let i;for(a=n.Object.values(n.$datasetFiles),i=0;i<a.length;i+=1){const s=Ht(n,a,i);l[i]?(l[i].p(e,s),Q(l[i],1)):(l[i]=Xt(s),l[i].c(),Q(l[i],1),l[i].m(t,null))}for(I(),i=a.length;i<l.length;i+=1)s(i);U()}},i(e){if(!n){for(let e=0;e<a.length;e+=1)Q(l[e]);n=!0}},o(e){l=l.filter(Boolean);for(let e=0;e<l.length;e+=1)B(l[e]);n=!1},d(e){e&&p(t),u(l,e)}}}function Gt(e){var t,n,a,l,s,i,r,c,u,_,g,v,y,w,x,$,k,O,q=e.file.name+"",N=e.lcdata.samples[e.file.associd].newprojsample&&Jt();function C(t){e.dynamicselect_intext_binding.call(null,t,e),c=!0,D(()=>c=!1)}function F(t){e.dynamicselect_unknowninput_binding.call(null,t,e),u=!0,D(()=>u=!1)}function E(t){e.dynamicselect_selectval_binding.call(null,t,e),_=!0,D(()=>_=!1)}let L={fixedoptions:ie,niceName:Zt};void 0!==e.lcdata.samples[e.file.associd].samplename&&(L.intext=e.lcdata.samples[e.file.associd].samplename),void 0!==e.lcdata.samples[e.file.associd].newprojsample&&(L.unknowninput=e.lcdata.samples[e.file.associd].newprojsample),void 0!==e.lcdata.samples[e.file.associd].sample&&(L.selectval=e.lcdata.samples[e.file.associd].sample);var M=new Ie({props:L});S.push(()=>G(M,"intext",C)),S.push(()=>G(M,"unknowninput",F)),S.push(()=>G(M,"selectval",E)),M.$on("selectedvalue",e.editMade),M.$on("newvalue",function(...t){return e.newvalue_handler(e,...t)});var P=e.lcdata.quanttype&&Vt(e);return{c(){t=f("tr"),n=f("td"),a=f("label"),N&&N.c(),l=h(),s=m(q),i=h(),r=f("div"),M.$$.fragment.c(),g=h(),v=f("td"),y=f("div"),w=f("div"),x=f("p"),P&&P.c(),k=h(),b(a,"class","label"),b(r,"class","field"),b(x,"class",$=e.lcdata.samples[e.file.associd].badChannel?"control has-icons-left":""),b(w,"class","control"),b(y,"class","field")},m(e,c){d(e,t,c),o(t,n),o(n,a),N&&N.m(a,null),o(a,l),o(a,s),o(n,i),o(n,r),J(M,r,null),o(t,g),o(t,v),o(v,y),o(y,w),o(w,x),P&&P.m(x,null),o(t,k),O=!0},p(t,n){(e=n).lcdata.samples[e.file.associd].newprojsample?N||((N=Jt()).c(),N.m(a,l)):N&&(N.d(1),N=null),O&&!t.$datasetFiles||q===(q=e.file.name+"")||j(s,q);var i={};t.projsamples&&(i.fixedoptions=ie),(!c&&t.lcdata||t.Object||t.$datasetFiles)&&(i.intext=e.lcdata.samples[e.file.associd].samplename),(!u&&t.lcdata||t.Object||t.$datasetFiles)&&(i.unknowninput=e.lcdata.samples[e.file.associd].newprojsample),(!_&&t.lcdata||t.Object||t.$datasetFiles)&&(i.selectval=e.lcdata.samples[e.file.associd].sample),M.$set(i),e.lcdata.quanttype?P?(P.p(t,e),Q(P,1)):((P=Vt(e)).c(),Q(P,1),P.m(x,null)):P&&(I(),B(P,1,1,()=>{P=null}),U()),O&&!t.lcdata&&!t.$datasetFiles||$===($=e.lcdata.samples[e.file.associd].badChannel?"control has-icons-left":"")||b(x,"class",$)},i(e){O||(Q(M.$$.fragment,e),Q(P),O=!0)},o(e){B(M.$$.fragment,e),B(P),O=!1},d(e){e&&p(t),N&&N.d(),V(M),P&&P.d()}}}function Jt(e){var t;return{c(){(t=f("span")).innerHTML='<i class="fas fa-asterisk"></i>',b(t,"class","icon has-text-danger")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function Vt(e){var t,n,a,l,s,i,r;function c(n){e.dynamicselect_intext_binding_1.call(null,n,e),t=!0,D(()=>t=!1)}function o(t){e.dynamicselect_fixedoptions_binding.call(null,t),n=!0,D(()=>n=!1)}function u(t){e.dynamicselect_fixedorder_binding.call(null,t),a=!0,D(()=>a=!1)}function f(t){e.dynamicselect_selectval_binding_1.call(null,t,e),l=!0,D(()=>l=!1)}let m={niceName:en};void 0!==e.lcdata.samples[e.file.associd].channelname&&(m.intext=e.lcdata.samples[e.file.associd].channelname),void 0!==e.lcdata.quants[e.lcdata.quanttype].chans&&(m.fixedoptions=e.lcdata.quants[e.lcdata.quanttype].chans),void 0!==e.lcdata.quants[e.lcdata.quanttype].chanorder&&(m.fixedorder=e.lcdata.quants[e.lcdata.quanttype].chanorder),void 0!==e.lcdata.samples[e.file.associd].channel&&(m.selectval=e.lcdata.samples[e.file.associd].channel);var g=new Ie({props:m});S.push(()=>G(g,"intext",c)),S.push(()=>G(g,"fixedoptions",o)),S.push(()=>G(g,"fixedorder",u)),S.push(()=>G(g,"selectval",f)),g.$on("selectedvalue",function(...t){return e.selectedvalue_handler(e,...t)}),g.$on("illegalvalue",function(...t){return e.illegalvalue_handler(e,...t)});var v=e.lcdata.samples[e.file.associd].badChannel&&Wt();return{c(){g.$$.fragment.c(),s=h(),v&&v.c(),i=_()},m(e,t){J(g,e,t),d(e,s,t),v&&v.m(e,t),d(e,i,t),r=!0},p(s,r){e=r;var c={};(!t&&s.lcdata||s.Object||s.$datasetFiles)&&(c.intext=e.lcdata.samples[e.file.associd].channelname),!n&&s.lcdata&&(c.fixedoptions=e.lcdata.quants[e.lcdata.quanttype].chans),!a&&s.lcdata&&(c.fixedorder=e.lcdata.quants[e.lcdata.quanttype].chanorder),(!l&&s.lcdata||s.Object||s.$datasetFiles)&&(c.selectval=e.lcdata.samples[e.file.associd].channel),g.$set(c),e.lcdata.samples[e.file.associd].badChannel?v||((v=Wt()).c(),v.m(i.parentNode,i)):v&&(v.d(1),v=null)},i(e){r||(Q(g.$$.fragment,e),r=!0)},o(e){B(g.$$.fragment,e),r=!1},d(e){V(g,e),e&&p(s),v&&v.d(e),e&&p(i)}}}function Wt(e){var t;return{c(){(t=f("span")).innerHTML='<i class="fas fa-asterisk"></i>',b(t,"class","icon is-left has-text-danger")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function Xt(e){var t,n,a=e.file.associd in e.lcdata.samples&&Gt(e);return{c(){a&&a.c(),t=_()},m(e,l){a&&a.m(e,l),d(e,t,l),n=!0},p(e,n){n.file.associd in n.lcdata.samples?a?(a.p(e,n),Q(a,1)):((a=Gt(n)).c(),Q(a,1),a.m(t.parentNode,t)):a&&(I(),B(a,1,1,()=>{a=null}),U())},i(e){n||(Q(a),n=!0)},o(e){B(a),n=!1},d(e){a&&a.d(e),e&&p(t)}}}function Yt(e){var t,n,l,s,i,r,c,_,v,y,j,w,x,k,O,q,N,C,F,S,E,L,M,P,D,T=e.Object.keys(e.lcdata.samples).length;function H(e,t){return t.stored?It:t.edited?At:void 0}var R=H(0,e),A=R&&R(e),K=new xe({props:{errors:e.lcerrors}});let G=e.Object.values(e.lcdata.quants),W=[];for(let t=0;t<G.length;t+=1)W[t]=Ut(Rt(e,G,t));function X(e,t){return t.foundNewSamples?Bt:Qt}var Y=X(0,e),Z=Y(e),ee=T&&Kt(e);return{c(){t=f("h5"),A&&A.c(),n=m("\n  Label check\n  "),l=f("button"),s=m("Save"),r=h(),c=f("button"),_=m("Revert"),y=h(),K.$$.fragment.c(),j=h(),w=f("div"),(x=f("label")).textContent="Quant type",k=h(),O=f("div"),q=f("div"),N=f("select"),(C=f("option")).textContent="Please select one";for(let e=0;e<W.length;e+=1)W[e].c();F=h(),Z.c(),S=h(),E=f("table"),(L=f("thead")).innerHTML="<tr><th>Sample</th> <th>Channel</th></tr>",M=h(),ee&&ee.c(),b(l,"class","button is-small is-danger has-text-weight-bold"),l.disabled=i=!e.edited,b(c,"class","button is-small is-info has-text-weight-bold"),c.disabled=v=!e.edited,b(t,"id","labelcheck"),b(t,"class","has-text-primary title is-5"),b(x,"class","label"),C.disabled=!0,C.__value="",C.value=C.__value,void 0===e.lcdata.quanttype&&z(()=>e.select_change_handler.call(N)),b(q,"class","select"),b(O,"class","control"),b(w,"class","field"),b(E,"class","table is-fullwidth"),D=[g(l,"click",e.save),g(c,"click",e.fetchData),g(N,"change",e.select_change_handler),g(N,"change",e.editMade)]},m(a,i){d(a,t,i),A&&A.m(t,null),o(t,n),o(t,l),o(l,s),o(t,r),o(t,c),o(c,_),d(a,y,i),J(K,a,i),d(a,j,i),d(a,w,i),o(w,x),o(w,k),o(w,O),o(O,q),o(q,N),o(N,C);for(let e=0;e<W.length;e+=1)W[e].m(N,null);$(N,e.lcdata.quanttype),d(a,F,i),Z.m(a,i),d(a,S,i),d(a,E,i),o(E,L),o(E,M),ee&&ee.m(E,null),P=!0},p(e,a){R!==(R=H(0,a))&&(A&&A.d(1),(A=R&&R(a))&&(A.c(),A.m(t,n))),P&&!e.edited||i===(i=!a.edited)||(l.disabled=i),P&&!e.edited||v===(v=!a.edited)||(c.disabled=v);var s={};if(e.lcerrors&&(s.errors=a.lcerrors),K.$set(s),e.Object||e.lcdata){let t;for(G=a.Object.values(a.lcdata.quants),t=0;t<G.length;t+=1){const n=Rt(a,G,t);W[t]?W[t].p(e,n):(W[t]=Ut(n),W[t].c(),W[t].m(N,null))}for(;t<W.length;t+=1)W[t].d(1);W.length=G.length}e.lcdata&&$(N,a.lcdata.quanttype),Y!==(Y=X(0,a))&&(Z.d(1),(Z=Y(a))&&(Z.c(),Z.m(S.parentNode,S))),e.lcdata&&(T=a.Object.keys(a.lcdata.samples).length),T?ee?(ee.p(e,a),Q(ee,1)):((ee=Kt(a)).c(),Q(ee,1),ee.m(E,null)):ee&&(I(),B(ee,1,1,()=>{ee=null}),U())},i(e){P||(Q(K.$$.fragment,e),Q(ee),P=!0)},o(e){B(K.$$.fragment,e),B(ee),P=!1},d(e){e&&p(t),A&&A.d(),e&&p(y),V(K,e),e&&(p(j),p(w)),u(W,e),e&&p(F),Z.d(e),e&&(p(S),p(E)),ee&&ee.d(),a(D)}}}const Zt=e=>e.name,en=e=>e.name;function tn(e,t,n){let a,l;i(e,se,e=>{n("$datasetFiles",a=e)}),i(e,le,e=>{n("$dataset_id",l=e)});let{errors:s}=t,r=[],c={quants:{},quanttype:"",samples:{}},o=!1;function d(){n("edited",o=!0)}function p(e){n("lcdata",c.samples[e].badChannel=!1,c),d()}function u(e){console.log("bad ch"),console.log(e),n("lcdata",c.samples[e].badChannel=!0,c)}function f(e){let t=c.samples[e.associd].newprojsample.trim().toUpperCase(),a=Object.entries(ie).filter(e=>e[1].name.toUpperCase()==t).map(e=>e[0])[0];a&&(n("lcdata",c.samples[e.associd].sample=parseInt(a),c),n("lcdata",c.samples[e.associd].newprojsample="",c)),d()}async function m(){let e="/datasets/show/labelcheck/";e=l?e+l:e;const t=await ee(e);for(let[e,a]of Object.entries(t))n("lcdata",c[e]=a,c);n("edited",o=!1)}N(async()=>{await m()});let h,_;return e.$set=(e=>{"errors"in e&&n("errors",s=e.errors)}),e.$$.update=((e={$datasetFiles:1,lcdata:1,$dataset_id:1,edited:1})=>{e.$datasetFiles&&Object.keys(a).length&&m(),e.lcdata&&n("foundNewSamples",h=Object.values(c.samples).some(e=>""!==e.newprojsample)),(e.$dataset_id||e.edited)&&n("stored",_=l&&!o)}),{errors:s,lcerrors:r,lcdata:c,edited:o,editMade:d,okChannel:p,badChannel:u,saveNewSamples:async function(){let e=[];Object.entries(c.samples).filter(e=>e[1].newprojsample).forEach(function(t){e.push(async function(e,t){let n={dataset_id:l,samplename:e.newprojsample};const a=await te("/datasets/save/projsample/",n);return ie[a.psid]=a.psname,[a.psid,t]}(t[1],t[0]))});for(let t of e){let[e,a]=await t;n("lcdata",c.samples[a].newprojsample="",c),n("lcdata",c.samples[a].sample=e,c)}},checkNewSample:f,save:async function(){if(n("errors",s=function(){let e=[];c.quanttype||e.push("Quant type selection is required");for(let t of Object.values(a))c.samples[t.associd].sample||e.push("Sample name for each file/channel is required"),c.samples[t.associd].channel||e.push("Channel for each file/sample is required");return e}()),Object.keys(a).length||n("lcerrors",r=[...r,"Add files before saving data"]),0===s.length){let e={dataset_id:l,quanttype:c.quanttype,samples:c.samples,filenames:Object.values(a)};console.log(e);const t="/datasets/save/labelcheck/";await te(t,e),m()}},fetchData:m,Object:Object,$datasetFiles:a,foundNewSamples:h,stored:_,select_change_handler:function(){c.quanttype=k(this),n("lcdata",c),n("Object",Object)},dynamicselect_intext_binding:function(e,{file:t}){c.samples[t.associd].samplename=e,n("lcdata",c)},dynamicselect_unknowninput_binding:function(e,{file:t}){c.samples[t.associd].newprojsample=e,n("lcdata",c)},dynamicselect_selectval_binding:function(e,{file:t}){c.samples[t.associd].sample=e,n("lcdata",c)},newvalue_handler:({file:e},t)=>f(e),dynamicselect_intext_binding_1:function(e,{file:t}){c.samples[t.associd].channelname=e,n("lcdata",c)},dynamicselect_fixedoptions_binding:function(e){c.quants[c.quanttype].chans=e,n("lcdata",c)},dynamicselect_fixedorder_binding:function(e){c.quants[c.quanttype].chanorder=e,n("lcdata",c)},dynamicselect_selectval_binding_1:function(e,{file:t}){c.samples[t.associd].channel=e,n("lcdata",c)},selectedvalue_handler:({file:e},t)=>p(e.associd),illegalvalue_handler:({file:e},t)=>u(e.associd)}}class nn extends Y{constructor(e){super(),X(this,e,tn,Yt,s,["errors"])}}const{Object:an}=K;function ln(e,t,n){const a=an.create(e);return a.fn=t[n],a.each_value=t,a.fn_index=n,a}function sn(e,t,n){const a=an.create(e);return a.fn=t[n],a}function rn(e){var t;return{c(){(t=f("span")).innerHTML='<i class="fas fa-database"></i>',b(t,"class","icon is-small has-text-primary")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function cn(e){var t,n,a,l,s,i,r,c,u,_,v,y,w,x,$,k,O,q,N,C=e.fn.name+"",F=pn(e.fn.date)+"",S=e.fn.size+"",E=e.fn.instrument+"";function L(...t){return e.click_handler_4(e,...t)}var M=e.fn.id in e.$datasetFiles&&rn();return{c(){t=f("tr"),n=f("td"),(a=f("span")).innerHTML='<i class="fas fa-times"></i>',l=h(),s=f("td"),M&&M.c(),i=h(),r=f("td"),c=m(C),u=h(),_=f("td"),v=m(F),y=h(),w=f("td"),x=m(S),$=m("MB"),k=h(),O=f("td"),q=m(E),b(a,"class","icon is-small has-text-danger"),N=g(a,"click",L)},m(e,p){d(e,t,p),o(t,n),o(n,a),o(t,l),o(t,s),M&&M.m(s,null),o(t,i),o(t,r),o(r,c),o(t,u),o(t,_),o(_,v),o(t,y),o(t,w),o(w,x),o(w,$),o(t,k),o(t,O),o(O,q)},p(t,n){(e=n).fn.id in e.$datasetFiles?M||((M=rn()).c(),M.m(s,null)):M&&(M.d(1),M=null),t.ok_files&&C!==(C=e.fn.name+"")&&j(c,C),t.ok_files&&F!==(F=pn(e.fn.date)+"")&&j(v,F),t.ok_files&&S!==(S=e.fn.size+"")&&j(x,S),t.ok_files&&E!==(E=e.fn.instrument+"")&&j(q,E)},d(e){e&&p(t),M&&M.d(),N()}}}function on(e){var t,n,a,l,s,i,r,c,u,_,v,y,w,x,$,k,O,q,N,C,F=e.fn.name+"",S=pn(e.fn.date)+"",E=e.fn.size+"",L=e.fn.instrument+"";function M(){e.input_change_handler.call(a,e)}return{c(){t=f("tr"),n=f("td"),a=f("input"),l=h(),s=f("td"),i=h(),r=f("td"),c=m(F),u=h(),_=f("td"),v=m(S),y=h(),w=f("td"),x=m(E),$=m("MB"),k=h(),O=f("td"),q=m(L),N=h(),b(a,"type","checkbox"),C=g(a,"change",M)},m(p,f){d(p,t,f),o(t,n),o(n,a),a.checked=e.fn.checked,o(t,l),o(t,s),o(t,i),o(t,r),o(r,c),o(t,u),o(t,_),o(_,v),o(t,y),o(t,w),o(w,x),o(w,$),o(t,k),o(t,O),o(O,q),o(t,N)},p(t,n){e=n,t.outside_files&&(a.checked=e.fn.checked),t.outside_files&&F!==(F=e.fn.name+"")&&j(c,F),t.outside_files&&S!==(S=pn(e.fn.date)+"")&&j(v,S),t.outside_files&&E!==(E=e.fn.size+"")&&j(x,E),t.outside_files&&L!==(L=e.fn.instrument+"")&&j(q,L)},d(e){e&&p(t),C()}}}function dn(t){var n,l,s,i,r,c,_,v,y,x,$,k,O,q,N,C,F,S,E,L,M,P,z,D,T,H,R,A,I,U,Q,B,K,G,J,V,W,X,Y,Z,ee,te,ne,ae,le,se,ie,re,ce,oe,de,pe,ue,fe,me=t.files.newfn_order.length+"",he=t.selectedFiles.length+"",_e=t.files.dsfn_order.length+"",ge=t.Object.keys(t.removed_files).length+"",ve=t.Object.keys(t.addedFiles).length+"";let be=t.ok_files,ye=[];for(let e=0;e<be.length;e+=1)ye[e]=cn(sn(t,be,e));let je=t.outside_files,we=[];for(let e=0;e<je.length;e+=1)we[e]=on(ln(t,je,e));return{c(){n=f("div"),l=f("input"),s=h(),i=f("div"),r=m("Showing "),c=m(me),_=m(" new files ("),v=m(he),y=m(" selected), "),x=m(_e),$=m(" files in dataset (incl. "),k=m(ge),O=m(", excl. "),q=m(ve),N=m(" added files)"),C=h(),F=f("div"),S=f("button"),E=m("Save"),M=h(),(P=f("button")).textContent="Revert",z=h(),D=f("button"),T=m("Add selected files"),R=h(),A=f("table"),I=f("thead"),U=f("tr"),Q=f("th"),B=f("input"),K=h(),G=f("th"),J=h(),V=f("th"),W=m("File "),(X=f("span")).innerHTML='<i class="fas fa-sort"></i>',Y=h(),Z=f("th"),ee=m("Date "),(te=f("span")).innerHTML='<i class="fas fa-sort"></i>',ne=h(),ae=f("th"),le=m("Size "),(se=f("span")).innerHTML='<i class="fas fa-sort"></i>',ie=h(),re=f("th"),ce=m("Instrument "),(oe=f("span")).innerHTML='<i class="fas fa-sort"></i>',de=h(),pe=f("tbody");for(let e=0;e<ye.length;e+=1)ye[e].c();ue=h();for(let e=0;e<we.length;e+=1)we[e].c();b(l,"class","input is-small"),b(l,"type","text"),b(l,"placeholder","Type a query and press enter to find analyses"),b(S,"class","button is-danger is-small"),S.disabled=L=!t.changed,b(P,"class","button is-info is-small"),b(D,"class","button is-small"),D.disabled=H=!t.selectedFiles.length,b(B,"type","checkbox"),b(X,"class","icon is-small"),b(te,"class","icon is-small"),b(se,"class","icon is-small"),b(oe,"class","icon is-small"),b(A,"class","table"),b(n,"class","content is-small"),fe=[g(l,"input",t.input0_input_handler),g(l,"keyup",t.findFiles),g(S,"click",t.save),g(P,"click",t.fetchFiles),g(D,"click",t.addFiles),g(B,"change",t.input1_change_handler),g(B,"click",t.selectAllNew),g(X,"click",t.click_handler),g(te,"click",t.click_handler_1),g(se,"click",t.click_handler_2),g(oe,"click",t.click_handler_3)]},m(e,a){d(e,n,a),o(n,l),w(l,t.findQuery),o(n,s),o(n,i),o(i,r),o(i,c),o(i,_),o(i,v),o(i,y),o(i,x),o(i,$),o(i,k),o(i,O),o(i,q),o(i,N),o(n,C),o(n,F),o(F,S),o(S,E),o(F,M),o(F,P),o(F,z),o(F,D),o(D,T),o(n,R),o(n,A),o(A,I),o(I,U),o(U,Q),o(Q,B),B.checked=t.allNewSelector,o(U,K),o(U,G),o(U,J),o(U,V),o(V,W),o(V,X),o(U,Y),o(U,Z),o(Z,ee),o(Z,te),o(U,ne),o(U,ae),o(ae,le),o(ae,se),o(U,ie),o(U,re),o(re,ce),o(re,oe),o(A,de),o(A,pe);for(let e=0;e<ye.length;e+=1)ye[e].m(pe,null);o(pe,ue);for(let e=0;e<we.length;e+=1)we[e].m(pe,null)},p(e,t){if(e.findQuery&&l.value!==t.findQuery&&w(l,t.findQuery),e.files&&me!==(me=t.files.newfn_order.length+"")&&j(c,me),e.selectedFiles&&he!==(he=t.selectedFiles.length+"")&&j(v,he),e.files&&_e!==(_e=t.files.dsfn_order.length+"")&&j(x,_e),e.removed_files&&ge!==(ge=t.Object.keys(t.removed_files).length+"")&&j(k,ge),e.addedFiles&&ve!==(ve=t.Object.keys(t.addedFiles).length+"")&&j(q,ve),e.changed&&L!==(L=!t.changed)&&(S.disabled=L),e.selectedFiles&&H!==(H=!t.selectedFiles.length)&&(D.disabled=H),e.allNewSelector&&(B.checked=t.allNewSelector),e.ok_files||e.isoTime||e.$datasetFiles){let n;for(be=t.ok_files,n=0;n<be.length;n+=1){const a=sn(t,be,n);ye[n]?ye[n].p(e,a):(ye[n]=cn(a),ye[n].c(),ye[n].m(pe,ue))}for(;n<ye.length;n+=1)ye[n].d(1);ye.length=be.length}if(e.outside_files||e.isoTime){let n;for(je=t.outside_files,n=0;n<je.length;n+=1){const a=ln(t,je,n);we[n]?we[n].p(e,a):(we[n]=on(a),we[n].c(),we[n].m(pe,null))}for(;n<we.length;n+=1)we[n].d(1);we.length=je.length}},i:e,o:e,d(e){e&&p(n),u(ye,e),u(we,e),a(fe)}}}function pn(e){return new Date(e).toISOString()}function un(e,t,n){let a,l;i(e,se,e=>{n("$datasetFiles",a=e)}),i(e,le,e=>{n("$dataset_id",l=e)});let s={newFiles:{},dsfn_order:[],newfn_order:[]},r={},o={},d="",p=!1,u="date",f={date:!0,name:!0,size:!0,instrument:!0},m=[],h=[];function _(e){u===e?n("sortascending",f[e]=!1===f[e],f):n("sortkey",u=e)}function g(e){e in a?(n("removed_files",o[e]=a[e],o),n("files",s.dsfn_order=s.dsfn_order.filter(t=>t!==e),s)):e in r&&n("addedFiles",r=Object.fromEntries(Object.entries(r).filter(t=>t[1].id!==e)))}async function v(){let e="/datasets/show/files/";e=l?e+l:e;const t=await ee(e);for(let[e,a]of Object.entries(t))n("files",s[e]=a,s);for(let e in a)delete a[e];for(let[e,n]of Object.entries(t.datasetFiles))c(se,a[e]=n,a);n("addedFiles",r={}),n("removed_files",o={})}N(async()=>{v()});let b,y;return e.$$.update=((e={addedFiles:1,files:1,$datasetFiles:1,sortkey:1,sortascending:1,removed_files:1})=>{(e.addedFiles||e.files||e.$datasetFiles||e.sortkey||e.sortascending)&&n("ok_files",m=Object.values(r).concat(s.dsfn_order.map(e=>a[e])).sort((e,t)=>e[u]>t[u]===f[u])),(e.removed_files||e.files||e.sortkey||e.sortascending)&&n("outside_files",h=Object.values(o).concat(s.newfn_order.map(e=>s.newFiles[e])).sort((e,t)=>e[u]>t[u]===f[u])),(e.addedFiles||e.removed_files)&&n("changed",b=Object.keys(r).length||Object.keys(o).length),(e.files||e.removed_files)&&n("selectedFiles",y=Object.values(s.newFiles).concat(Object.values(o)).filter(e=>e.checked))}),{files:s,addedFiles:r,removed_files:o,findQuery:d,allNewSelector:p,ok_files:m,outside_files:h,reSort:_,findFiles:async function(e){if(13===e.keyCode){const e=await ee(`/datasets/find/files?q=${d.split(" ").join(",")}`);for(let[t,a]of Object.entries(e))n("files",s[t]=a,s)}},selectAllNew:function(){let e=!1===p;for(let t in s.newFiles)n("files",s.newFiles[t].checked=e,s)},deleteFile:g,addFiles:function(){for(let e of Object.values(o).filter(e=>e.checked))e.checked=!1,delete o[e.id],n("files",s.dsfn_order=[e.id].concat(s.dsfn_order),s);for(let e of Object.values(s.newFiles).filter(e=>e.checked))e.checked=!1,n("addedFiles",r[e.id]=e,r),n("files",s.newfn_order=s.newfn_order.filter(t=>t!==e.id),s)},save:async function(){let e={dataset_id:l,added_files:r,removed_files:o};await te("/datasets/save/files/",e),v()},fetchFiles:v,Object:Object,$datasetFiles:a,changed:b,selectedFiles:y,input0_input_handler:function(){d=this.value,n("findQuery",d)},input1_change_handler:function(){p=this.checked,n("allNewSelector",p)},click_handler:e=>_("name"),click_handler_1:e=>_("date"),click_handler_2:e=>_("size"),click_handler_3:e=>_("instrument"),click_handler_4:({fn:e},t)=>g(e.id),input_change_handler:function({fn:e,each_value:t,fn_index:a}){t[a].checked=this.checked,n("outside_files",h),n("removed_files",o),n("files",s),n("sortkey",u),n("sortascending",f)}}}class fn extends Y{constructor(e){super(),X(this,e,un,dn,s,[])}}const{Object:mn}=K;function hn(e,t,n){const a=mn.create(e);return a.exp=t[n],a}function _n(e,t,n){const a=mn.create(e);return a.dstype=t[n],a}function gn(e,t,n){const a=mn.create(e);return a.ptype=t[n],a}function vn(e){var t,n,a,l;return{c(){t=f("li"),(n=f("a")).innerHTML="<span>Files</span>",b(t,"class",a="files"===e.tabshow?"is-active":""),l=g(n,"click",e.showFiles)},m(e,a){d(e,t,a),o(t,n)},p(e,n){e.tabshow&&a!==(a="files"===n.tabshow?"is-active":"")&&b(t,"class",a)},d(e){e&&p(t),l()}}}function bn(e){var t,n,a,l,s,i=e.dsinfo.storage_location+"";return{c(){t=f("article"),(n=f("div")).textContent="Storage location",a=h(),l=f("div"),s=m(i),b(n,"class","message-header"),b(l,"class","message-body"),b(t,"class","message is-info")},m(e,i){d(e,t,i),o(t,n),o(t,a),o(t,l),o(l,s)},p(e,t){e.dsinfo&&i!==(i=t.dsinfo.storage_location+"")&&j(s,i)},d(e){e&&p(t)}}}function yn(e){var t,n,a,l=e.$dataset_id&&jn();return{c(){(t=f("span")).textContent="New project",n=h(),l&&l.c(),a=_(),b(t,"class","tag is-danger is-outlined is-small")},m(e,s){d(e,t,s),d(e,n,s),l&&l.m(e,s),d(e,a,s)},p(e,t){t.$dataset_id?l||((l=jn()).c(),l.m(a.parentNode,a)):l&&(l.d(1),l=null)},d(e){e&&(p(t),p(n)),l&&l.d(e),e&&p(a)}}}function jn(e){var t;return{c(){(t=f("span")).textContent="Are you sure?",b(t,"class","tag is-danger is-outlined is-small")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function wn(e){var t,n,a,l,s,i;let r=e.pdata.ptypes,c=[];for(let t=0;t<r.length;t+=1)c[t]=xn(gn(e,r,t));return{c(){(t=f("label")).textContent="Project type",n=h(),a=f("div"),l=f("select"),(s=f("option")).textContent="Please select one";for(let e=0;e<c.length;e+=1)c[e].c();b(t,"class","label"),s.disabled=!0,s.__value="",s.value=s.__value,void 0===e.dsinfo.ptype_id&&z(()=>e.select_change_handler.call(l)),b(a,"class","select"),i=g(l,"change",e.select_change_handler)},m(i,r){d(i,t,r),d(i,n,r),d(i,a,r),o(a,l),o(l,s);for(let e=0;e<c.length;e+=1)c[e].m(l,null);$(l,e.dsinfo.ptype_id)},p(e,t){if(e.pdata){let n;for(r=t.pdata.ptypes,n=0;n<r.length;n+=1){const a=gn(t,r,n);c[n]?c[n].p(e,a):(c[n]=xn(a),c[n].c(),c[n].m(l,null))}for(;n<c.length;n+=1)c[n].d(1);c.length=r.length}e.dsinfo&&$(l,t.dsinfo.ptype_id)},d(e){e&&(p(t),p(n),p(a)),u(c,e),i()}}}function xn(e){var t,n,a,l=e.ptype.name+"";return{c(){t=f("option"),n=m(l),t.__value=a=e.ptype.id,t.value=t.__value},m(e,a){d(e,t,a),o(t,n)},p(e,s){e.pdata&&l!==(l=s.ptype.name+"")&&j(n,l),e.pdata&&a!==(a=s.ptype.id)&&(t.__value=a),t.value=t.__value},d(e){e&&p(t)}}}function $n(e){var t,n,a,l=e.dsinfo.pi_name+"";return{c(){t=f("span"),n=m("External project: "),a=m(l),b(t,"class","tag is-success is-medium")},m(e,l){d(e,t,l),o(t,n),o(t,a)},p(e,t){e.dsinfo&&l!==(l=t.dsinfo.pi_name+"")&&j(a,l)},d(e){e&&p(t)}}}function kn(e){var t,n,l,s,i,r,c,u,_,v=e.dsinfo.newpiname&&On(),y=e.isNewProject&&qn(e);return{c(){t=f("div"),n=f("label"),l=m("contact(s)\n        "),v&&v.c(),s=h(),i=f("div"),y&&y.c(),r=h(),b(c=f("input"),"class","input"),b(c,"type","text"),b(c,"placeholder","operational contact email (e.g. postdoc)"),b(i,"class","control"),b(n,"class","label"),b(t,"class","field"),_=[g(c,"input",e.input_input_handler),g(c,"change",e.editMade)]},m(a,p){d(a,t,p),o(t,n),o(n,l),v&&v.m(n,null),o(n,s),o(n,i),y&&y.m(i,null),o(i,r),o(i,c),w(c,e.dsinfo.externalcontactmail),u=!0},p(e,t){t.dsinfo.newpiname?v||((v=On()).c(),v.m(n,s)):v&&(v.d(1),v=null),t.isNewProject?y?(y.p(e,t),Q(y,1)):((y=qn(t)).c(),Q(y,1),y.m(i,r)):y&&(I(),B(y,1,1,()=>{y=null}),U()),e.dsinfo&&c.value!==t.dsinfo.externalcontactmail&&w(c,t.dsinfo.externalcontactmail)},i(e){u||(Q(y),u=!0)},o(e){B(y),u=!1},d(e){e&&p(t),v&&v.d(),y&&y.d(),a(_)}}}function On(e){var t;return{c(){(t=f("span")).textContent="New PI",b(t,"class","tag is-danger is-outlined is-small")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function qn(e){var t,n,a,l;function s(n){e.dynamicselect_intext_binding_1.call(null,n),t=!0,D(()=>t=!1)}function i(t){e.dynamicselect_unknowninput_binding_1.call(null,t),n=!0,D(()=>n=!1)}function r(t){e.dynamicselect_selectval_binding_1.call(null,t),a=!0,D(()=>a=!1)}let c={fixedoptions:e.pdata.external_pis,niceName:In};void 0!==e.dsinfo.pi_name&&(c.intext=e.dsinfo.pi_name),void 0!==e.dsinfo.newpiname&&(c.unknowninput=e.dsinfo.newpiname),void 0!==e.dsinfo.pi_id&&(c.selectval=e.dsinfo.pi_id);var o=new Ie({props:c});return S.push(()=>G(o,"intext",s)),S.push(()=>G(o,"unknowninput",i)),S.push(()=>G(o,"selectval",r)),{c(){o.$$.fragment.c()},m(e,t){J(o,e,t),l=!0},p(e,l){var s={};e.pdata&&(s.fixedoptions=l.pdata.external_pis),!t&&e.dsinfo&&(s.intext=l.dsinfo.pi_name),!n&&e.dsinfo&&(s.unknowninput=l.dsinfo.newpiname),!a&&e.dsinfo&&(s.selectval=l.dsinfo.pi_id),o.$set(s)},i(e){l||(Q(o.$$.fragment,e),l=!0)},o(e){B(o.$$.fragment,e),l=!1},d(e){V(o,e)}}}function Nn(e){var t,n,a,l=e.dstype.name+"";return{c(){t=f("option"),n=m(l),t.__value=a=e.dstype.id,t.value=t.__value},m(e,a){d(e,t,a),o(t,n)},p(e,s){e.pdata&&l!==(l=s.dstype.name+"")&&j(n,l),e.pdata&&a!==(a=s.dstype.id)&&(t.__value=a),t.value=t.__value},d(e){e&&p(t)}}}function Cn(e){var t,n,a,l,s,i,r;function c(e,t){return t.isNewExperiment?Sn:Fn}var u=c(0,e),_=u(e);function v(e,t){return t.isNewExperiment?Ln:En}var y=v(0,e),j=y(e);return{c(){t=f("div"),n=f("label"),a=m("Experiment name\n          "),l=f("a"),_.c(),s=h(),i=f("div"),j.c(),b(l,"class","button is-danger is-outlined is-small"),b(n,"class","label"),b(i,"class","control"),b(t,"class","field"),r=g(l,"click",e.click_handler)},m(e,r){d(e,t,r),o(t,n),o(n,a),o(n,l),_.m(l,null),o(t,s),o(t,i),j.m(i,null)},p(e,t){u!==(u=c(0,t))&&(_.d(1),(_=u(t))&&(_.c(),_.m(l,null))),y===(y=v(0,t))&&j?j.p(e,t):(j.d(1),(j=y(t))&&(j.c(),j.m(i,null)))},d(e){e&&p(t),_.d(),j.d(),r()}}}function Fn(e){var t;return{c(){t=m("Create new experiment")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function Sn(e){var t;return{c(){t=m("Existing experiment")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function En(e){var t,n,l,s;let i=e.experiments,r=[];for(let t=0;t<i.length;t+=1)r[t]=Mn(hn(e,i,t));return{c(){t=f("div"),n=f("select"),(l=f("option")).textContent="Please select one";for(let e=0;e<r.length;e+=1)r[e].c();l.disabled=!0,l.__value="",l.value=l.__value,void 0===e.dsinfo.experiment_id&&z(()=>e.select_change_handler_2.call(n)),b(t,"class","select"),s=[g(n,"change",e.select_change_handler_2),g(n,"change",e.editMade)]},m(a,s){d(a,t,s),o(t,n),o(n,l);for(let e=0;e<r.length;e+=1)r[e].m(n,null);$(n,e.dsinfo.experiment_id)},p(e,t){if(e.experiments){let a;for(i=t.experiments,a=0;a<i.length;a+=1){const l=hn(t,i,a);r[a]?r[a].p(e,l):(r[a]=Mn(l),r[a].c(),r[a].m(n,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=i.length}e.dsinfo&&$(n,t.dsinfo.experiment_id)},d(e){e&&p(t),u(r,e),a(s)}}}function Ln(e){var t,n;return{c(){b(t=f("input"),"class","input"),b(t,"type","text"),b(t,"placeholder","Experiment name"),n=[g(t,"input",e.input_input_handler_1),g(t,"change",e.editMade)]},m(n,a){d(n,t,a),w(t,e.dsinfo.newexperimentname)},p(e,n){e.dsinfo&&t.value!==n.dsinfo.newexperimentname&&w(t,n.dsinfo.newexperimentname)},d(e){e&&p(t),a(n)}}}function Mn(e){var t,n,a,l=e.exp.name+"";return{c(){t=f("option"),n=m(l),t.__value=a=e.exp.id,t.value=t.__value},m(e,a){d(e,t,a),o(t,n)},p(e,s){e.experiments&&l!==(l=s.exp.name+"")&&j(n,l),e.experiments&&a!==(a=s.exp.id)&&(t.__value=a),t.value=t.__value},d(e){e&&p(t)}}}function Pn(t){var n,l,s,i,r,c;return{c(){n=f("div"),(l=f("label")).textContent="Run name",s=h(),i=f("div"),r=f("input"),b(l,"class","label"),b(r,"class","input"),b(r,"type","text"),b(r,"placeholder","E.g set1, lc3, rerun5b, etc"),b(i,"class","control"),b(n,"class","field"),c=[g(r,"input",t.input_input_handler_3),g(r,"change",t.editMade)]},m(e,a){d(e,n,a),o(n,l),o(n,s),o(n,i),o(i,r),w(r,t.dsinfo.runname)},p(e,t){e.dsinfo&&r.value!==t.dsinfo.runname&&w(r,t.dsinfo.runname)},i:e,o:e,d(e){e&&p(n),a(c)}}}function zn(e){var t,n,l,s,i,r,c,u,m,_,v;function y(n){e.msdata_dsinfo_binding.call(null,n),t=!0,D(()=>t=!1)}let j={prefracs:e.pdata.prefracs,hirief_ranges:e.pdata.hirief_ranges};void 0!==e.dsinfo&&(j.dsinfo=e.dsinfo);var x=new Dt({props:j});function $(t){e.acquicomp_1_errors_binding.call(null,t),m=!0,D(()=>m=!1)}e.msdata_binding(x),S.push(()=>G(x,"dsinfo",y)),x.$on("edited",e.editMade);let k={};void 0!==e.errors.acqui&&(k.errors=e.errors.acqui);var O=new Me({props:k});return e.acquicomp_1_binding(O),S.push(()=>G(O,"errors",$)),{c(){x.$$.fragment.c(),n=h(),l=f("div"),(s=f("label")).textContent="Run name",i=h(),r=f("div"),c=f("input"),u=h(),O.$$.fragment.c(),b(s,"class","label"),b(c,"class","input"),b(c,"type","text"),b(c,"placeholder","E.g set1, lc3, rerun5b, etc"),b(r,"class","control"),b(l,"class","field"),v=[g(c,"input",e.input_input_handler_2),g(c,"change",e.editMade)]},m(t,a){J(x,t,a),d(t,n,a),d(t,l,a),o(l,s),o(l,i),o(l,r),o(r,c),w(c,e.dsinfo.runname),d(t,u,a),J(O,t,a),_=!0},p(e,n){var a={};e.pdata&&(a.prefracs=n.pdata.prefracs),e.pdata&&(a.hirief_ranges=n.pdata.hirief_ranges),!t&&e.dsinfo&&(a.dsinfo=n.dsinfo),x.$set(a),e.dsinfo&&c.value!==n.dsinfo.runname&&w(c,n.dsinfo.runname);var l={};!m&&e.errors&&(l.errors=n.errors.acqui),O.$set(l)},i(e){_||(Q(x.$$.fragment,e),Q(O.$$.fragment,e),_=!0)},o(e){B(x.$$.fragment,e),B(O.$$.fragment,e),_=!1},d(t){e.msdata_binding(null),V(x,t),t&&(p(n),p(l),p(u)),e.acquicomp_1_binding(null),V(O,t),a(v)}}}function Dn(e){var t,n;function a(n){e.prepcomp_1_errors_binding.call(null,n),t=!0,D(()=>t=!1)}let l={};void 0!==e.errors.sprep&&(l.errors=e.errors.sprep);var s=new qt({props:l});return e.prepcomp_1_binding(s),S.push(()=>G(s,"errors",a)),{c(){s.$$.fragment.c()},m(e,t){J(s,e,t),n=!0},p(e,n){var a={};!t&&e.errors&&(a.errors=n.errors.sprep),s.$set(a)},i(e){n||(Q(s.$$.fragment,e),n=!0)},o(e){B(s.$$.fragment,e),n=!1},d(t){e.prepcomp_1_binding(null),V(s,t)}}}function Tn(e){var t,n;function a(n){e.prepcomp_1_errors_binding_1.call(null,n),t=!0,D(()=>t=!1)}let l={};void 0!==e.errors.lc&&(l.errors=e.errors.lc);var s=new qt({props:l});return e.prepcomp_1_binding_1(s),S.push(()=>G(s,"errors",a)),{c(){s.$$.fragment.c()},m(e,t){J(s,e,t),n=!0},p(e,n){var a={};!t&&e.errors&&(a.errors=n.errors.lc),s.$set(a)},i(e){n||(Q(s.$$.fragment,e),n=!0)},o(e){B(s.$$.fragment,e),n=!1},d(t){e.prepcomp_1_binding_1(null),V(s,t)}}}function Hn(e){var t,n;function a(n){e.lcheck_errors_binding.call(null,n),t=!0,D(()=>t=!1)}let l={};void 0!==e.errors.lc&&(l.errors=e.errors.lc);var s=new nn({props:l});return e.lcheck_binding(s),S.push(()=>G(s,"errors",a)),{c(){s.$$.fragment.c()},m(e,t){J(s,e,t),n=!0},p(e,n){var a={};!t&&e.errors&&(a.errors=n.errors.lc),s.$set(a)},i(e){n||(Q(s.$$.fragment,e),n=!0)},o(e){B(s.$$.fragment,e),n=!1},d(t){e.lcheck_binding(null),V(s,t)}}}function Rn(e){var t,n,l,s,i,r,c,_,v,y,j,w,k,O,q,N,C,F,E,L,M,P,T,H,R,A,K,W,X,Y,Z,ee,te,ne,ae,le,se,ie,re,ce,oe,de,pe,ue,fe,me,he,_e,ge,ve,be,ye,je,we,$e,ke,Oe,qe=e.components.indexOf("sampleprep")>-1,Ne=new xe({props:{cssclass:"sticky",errors:e.Object.values(e.saveerrors).flat().concat(e.Object.values(e.errors).flat())}}),Ce=e.$dataset_id&&vn(e),Fe=e.dsinfo.storage_location&&bn(e),Se={c(){b(Oe=f("i"),"class","icon fas fa-check-circle")},m(e,t){d(e,Oe,t)},d(e){e&&p(Oe)}},Ee=e.isNewProject&&yn(e);function Le(t){e.dynamicselect_intext_binding.call(null,t),X=!0,D(()=>X=!1)}function Me(t){e.dynamicselect_unknowninput_binding.call(null,t),Y=!0,D(()=>Y=!1)}function Pe(t){e.dynamicselect_selectval_binding.call(null,t),Z=!0,D(()=>Z=!1)}let ze={fixedoptions:e.pdata.projects,niceName:An};void 0!==e.dsinfo.project_name&&(ze.intext=e.dsinfo.project_name),void 0!==e.dsinfo.newprojectname&&(ze.unknowninput=e.dsinfo.newprojectname),void 0!==e.dsinfo.project_id&&(ze.selectval=e.dsinfo.project_id);var De=new Ie({props:ze});S.push(()=>G(De,"intext",Le)),S.push(()=>G(De,"unknowninput",Me)),S.push(()=>G(De,"selectval",Pe)),De.$on("selectedvalue",e.selectedvalue_handler),De.$on("newvalue",e.setNewProj);var Te=e.isNewProject&&wn(e),He=e.isExternal&&$n(e),Re=e.isExternal&&kn(e);let Ae=e.pdata.datasettypes,Ue=[];for(let t=0;t<Ae.length;t+=1)Ue[t]=Nn(_n(e,Ae,t));var Qe=!e.isLabelcheck&&Cn(e),Be=[zn,Pn],Ke=[];function Ge(e,t){return t.showMsdata?0:t.dsinfo.datatype_id?1:-1}~(fe=Ge(0,e))&&(me=Ke[fe]=Be[fe](e));var Je=qe&&Dn(e),Ve=[Hn,Tn],We=[];function Xe(e,t){return(null==ge||e.$datasetFiles||e.components)&&(ge=!!(t.Object.keys(t.$datasetFiles).length&&t.components.indexOf("labelchecksamples")>-1)),ge?0:((null==ve||e.$datasetFiles||e.components)&&(ve=!!(t.Object.keys(t.$datasetFiles).length&&t.components.indexOf("pooledlabelchecksamples")>-1)),ve?1:-1)}~(be=Xe(null,e))&&(ye=We[be]=Ve[be](e));var Ye=new fn({props:{}});return e.files_binding(Ye),{c(){Ne.$$.fragment.c(),t=h(),n=f("div"),l=f("ul"),s=f("li"),(i=f("a")).innerHTML="<span>Metadata</span>",c=h(),Ce&&Ce.c(),_=h(),(v=f("h4")).textContent="Dataset",y=h(),j=f("div"),w=f("div"),Fe&&Fe.c(),k=h(),O=f("h5"),Se&&Se.c(),q=m("\n        Basics\n        "),N=f("button"),C=m("Save"),E=h(),L=f("button"),M=m("Revert"),T=h(),H=f("div"),R=f("label"),A=m("Project\n        "),Ee&&Ee.c(),K=h(),W=f("div"),De.$$.fragment.c(),ee=h(),Te&&Te.c(),te=h(),He&&He.c(),ne=h(),Re&&Re.c(),ae=h(),le=f("div"),(se=f("label")).textContent="Dataset type",ie=h(),re=f("div"),ce=f("div"),oe=f("select"),(de=f("option")).textContent="Please select one";for(let e=0;e<Ue.length;e+=1)Ue[e].c();pe=h(),Qe&&Qe.c(),ue=h(),me&&me.c(),he=h(),Je&&Je.c(),_e=h(),ye&&ye.c(),je=h(),we=f("div"),Ye.$$.fragment.c(),b(s,"class",r="meta"===e.tabshow?"is-active":""),b(n,"class","tabs is-toggle is-centered is-small"),b(v,"class","title is-4"),b(N,"class","button is-small is-danger has-text-weight-bold"),N.disabled=F=!e.edited,b(L,"class","button is-small is-info has-text-weight-bold"),L.disabled=P=!e.edited||!e.dsinfo.datatype_id,b(O,"class","has-text-primary title is-5"),b(R,"class","label"),b(W,"class","control"),b(H,"class","field"),b(se,"class","label"),de.disabled=!0,de.__value="",de.value=de.__value,void 0===e.dsinfo.datatype_id&&z(()=>e.select_change_handler_1.call(oe)),b(ce,"class","select"),b(re,"class","control"),b(le,"class","field"),b(w,"class","box"),b(w,"id","project"),x(j,"display","meta"!==e.tabshow?"none":""),x(we,"display","files"!==e.tabshow?"none":""),ke=[g(i,"click",e.showMetadata),g(N,"click",e.save),g(L,"click",e.fetchDataset),g(oe,"change",e.select_change_handler_1),g(oe,"change",e.switchDatatype)]},m(a,r){J(Ne,a,r),d(a,t,r),d(a,n,r),o(n,l),o(l,s),o(s,i),o(l,c),Ce&&Ce.m(l,null),d(a,_,r),d(a,v,r),d(a,y,r),d(a,j,r),o(j,w),Fe&&Fe.m(w,null),o(w,k),o(w,O),Se&&Se.m(O,null),o(O,q),o(O,N),o(N,C),o(O,E),o(O,L),o(L,M),o(w,T),o(w,H),o(H,R),o(R,A),Ee&&Ee.m(R,null),o(H,K),o(H,W),J(De,W,null),o(W,ee),Te&&Te.m(W,null),o(W,te),He&&He.m(W,null),o(w,ne),Re&&Re.m(w,null),o(w,ae),o(w,le),o(le,se),o(le,ie),o(le,re),o(re,ce),o(ce,oe),o(oe,de);for(let e=0;e<Ue.length;e+=1)Ue[e].m(oe,null);$(oe,e.dsinfo.datatype_id),o(w,pe),Qe&&Qe.m(w,null),o(w,ue),~fe&&Ke[fe].m(w,null),o(w,he),Je&&Je.m(w,null),o(w,_e),~be&&We[be].m(w,null),d(a,je,r),d(a,we,r),J(Ye,we,null),$e=!0},p(e,t){var n={};(e.saveerrors||e.errors)&&(n.errors=t.Object.values(t.saveerrors).flat().concat(t.Object.values(t.errors).flat())),Ne.$set(n),$e&&!e.tabshow||r===(r="meta"===t.tabshow?"is-active":"")||b(s,"class",r),t.$dataset_id?Ce?Ce.p(e,t):((Ce=vn(t)).c(),Ce.m(l,null)):Ce&&(Ce.d(1),Ce=null),t.dsinfo.storage_location?Fe?Fe.p(e,t):((Fe=bn(t)).c(),Fe.m(w,k)):Fe&&(Fe.d(1),Fe=null),$e&&!e.edited||F===(F=!t.edited)||(N.disabled=F),$e&&!e.edited&&!e.dsinfo||P===(P=!t.edited||!t.dsinfo.datatype_id)||(L.disabled=P),t.isNewProject?Ee?Ee.p(e,t):((Ee=yn(t)).c(),Ee.m(R,null)):Ee&&(Ee.d(1),Ee=null);var a={};if(e.pdata&&(a.fixedoptions=t.pdata.projects),!X&&e.dsinfo&&(a.intext=t.dsinfo.project_name),!Y&&e.dsinfo&&(a.unknowninput=t.dsinfo.newprojectname),!Z&&e.dsinfo&&(a.selectval=t.dsinfo.project_id),De.$set(a),t.isNewProject?Te?Te.p(e,t):((Te=wn(t)).c(),Te.m(W,te)):Te&&(Te.d(1),Te=null),t.isExternal?He?He.p(e,t):((He=$n(t)).c(),He.m(W,null)):He&&(He.d(1),He=null),t.isExternal?Re?(Re.p(e,t),Q(Re,1)):((Re=kn(t)).c(),Q(Re,1),Re.m(w,ae)):Re&&(I(),B(Re,1,1,()=>{Re=null}),U()),e.pdata){let n;for(Ae=t.pdata.datasettypes,n=0;n<Ae.length;n+=1){const a=_n(t,Ae,n);Ue[n]?Ue[n].p(e,a):(Ue[n]=Nn(a),Ue[n].c(),Ue[n].m(oe,null))}for(;n<Ue.length;n+=1)Ue[n].d(1);Ue.length=Ae.length}e.dsinfo&&$(oe,t.dsinfo.datatype_id),t.isLabelcheck?Qe&&(Qe.d(1),Qe=null):Qe?Qe.p(e,t):((Qe=Cn(t)).c(),Qe.m(w,ue));var i=fe;(fe=Ge(0,t))===i?~fe&&Ke[fe].p(e,t):(me&&(I(),B(Ke[i],1,1,()=>{Ke[i]=null}),U()),~fe?((me=Ke[fe])||(me=Ke[fe]=Be[fe](t)).c(),Q(me,1),me.m(w,he)):me=null),e.components&&(qe=t.components.indexOf("sampleprep")>-1),qe?Je?(Je.p(e,t),Q(Je,1)):((Je=Dn(t)).c(),Q(Je,1),Je.m(w,_e)):Je&&(I(),B(Je,1,1,()=>{Je=null}),U());var c=be;(be=Xe(e,t))===c?~be&&We[be].p(e,t):(ye&&(I(),B(We[c],1,1,()=>{We[c]=null}),U()),~be?((ye=We[be])||(ye=We[be]=Ve[be](t)).c(),Q(ye,1),ye.m(w,null)):ye=null),$e&&!e.tabshow||x(j,"display","meta"!==t.tabshow?"none":"");Ye.$set({}),$e&&!e.tabshow||x(we,"display","files"!==t.tabshow?"none":"")},i(e){$e||(Q(Ne.$$.fragment,e),Q(De.$$.fragment,e),Q(Re),Q(me),Q(Je),Q(ye),Q(Ye.$$.fragment,e),$e=!0)},o(e){B(Ne.$$.fragment,e),B(De.$$.fragment,e),B(Re),B(me),B(Je),B(ye),B(Ye.$$.fragment,e),$e=!1},d(l){V(Ne,l),l&&(p(t),p(n)),Ce&&Ce.d(),l&&(p(_),p(v),p(y),p(j)),Fe&&Fe.d(),Se&&Se.d(),Ee&&Ee.d(),V(De),Te&&Te.d(),He&&He.d(),Re&&Re.d(),u(Ue,l),Qe&&Qe.d(),~fe&&Ke[fe].d(),Je&&Je.d(),~be&&We[be].d(),l&&(p(je),p(we)),e.files_binding(null),V(Ye),a(ke)}}}const An=e=>e.name,In=e=>e.name;function Un(e,t,n){let a,l,s,r,c,o,d;i(e,le,e=>{n("$dataset_id",a=e)}),i(e,se,e=>{n("$datasetFiles",l=e)}),init_dataset_id&&le.set(init_dataset_id);let p=!1,u={basics:[],sprep:[],acqui:[],lc:[]},f=Object.assign({},u),m=[],h={datatype_id:"",old_project_id:"",project_id:"",project_name:"",ptype_id:"",storage_location:"",oldnewprojectname:"",newprojectname:"",experiment_id:"",runname:"",pi_id:"",newpiname:"",pi_name:"",externalcontactmail:"",prefrac_id:"",prefrac_length:"",prefrac_amount:"",hiriefrange:""},_={datasettypes:[],ptypes:[],projects:{},local_ptype_id:"",external_pis:[],prefracs:[],hirief_ranges:[]},g=[],v=!1,b=!1,y=[],j="meta";async function w(){const e=await ee(`/datasets/show/components/${h.datatype_id}`);n("components",g=e.components)}async function x(e=!1){if(h.project_id){const e=await ee(`/datasets/show/project/${h.project_id}`);n("dsinfo",h.pi_name=_.external_pis[e.pi_id].name,h),n("dsinfo",h.ptype_id=e.ptype_id,h),n("experiments",y=e.experiments);for(let e in ie)delete ie[e];for(let[t,n]of Object.entries(e.projsamples))ie[t]=n;n("isNewProject",v=!1)}e||n("dsinfo",h.experiment_id="",h),$()}function $(){n("edited",p=!0),n("errors",u.basics=u.basics.length?q():[],u)}async function O(){let e="/datasets/show/info/";e=a?e+a:e;const t=await ee(e);for(let[e,a]of Object.entries(t.projdata))n("pdata",_[e]=a,_);for(let[e,a]of Object.entries(t.dsinfo))n("dsinfo",h[e]=a,h);a&&(w(),await x(!0),n("isNewExperiment",b=!1)),n("edited",p=!1)}function q(){m=[];const e=RegExp("^[a-z0-9-_]+$","i");return v&&!h.newprojectname||!v&&!h.project_id?m.push("Project needs to be selected or created"):v&&h.newprojectname&&!e.test(h.newprojectname)&&m.push("Project name may only contain a-z 0-9 - _"),h.ptype_id||m.push("Project type selection is required"),h.runname?e.test(h.runname)||m.push("Run name may only contain a-z 0-9 - _"):m.push("Run name is required"),C&&(b&&!h.newexperimentname||!b&&!h.experiment_id)?m.push("Experiment is required"):C&&b&&h.newexperimentname&&!e.test(h.newexperimentname)&&m.push("Experiment name may only contain a-z 0-9 - _"),F&&(!v||h.newpiname||h.pi_id&&h.pi_id!==_.internal_pi_id||m.push("Need to select or create a PI"),h.externalcontactmail||m.push("External contact is required")),h.datatype_id||m.push("Datatype is required"),m}N(async()=>{await O()});let C,F,E;return e.$$.update=((e={components:1,dsinfo:1,pdata:1})=>{e.components&&n("showMsdata",C=g.indexOf("acquisition")>-1),(e.dsinfo||e.pdata)&&n("isExternal",F=h.ptype_id&&h.ptype_id!==_.local_ptype_id),e.components&&n("isLabelcheck",E=g.indexOf("labelchecksamples")>-1||g.indexOf("pooledlabelchecksamples")>-1)}),{mssubcomp:s,acquicomp:r,prepcomp:c,lccomp:o,filescomp:d,edited:p,errors:u,saveerrors:f,dsinfo:h,pdata:_,components:g,isNewProject:v,isNewExperiment:b,experiments:y,tabshow:j,switchDatatype:function(){w(),$()},project_selected:x,setNewProj:function(){n("isNewProject",v=!0),n("dsinfo",h.ptype_id="",h),n("dsinfo",h.externalcontactmail="",h),n("experiments",y=[]);for(let e in ie)delete ie[e];$()},editMade:$,fetchDataset:O,save:async function(){if(n("errors",u.basics=q(),u),C){let e=s.validate();n("errors",u.basics=[...u.basics,...e],u)}if(0===u.basics.length){let e={dataset_id:a,ptype_id:h.ptype_id,datatype_id:h.datatype_id,runname:h.runname,prefrac_id:h.prefrac_id,prefrac_length:h.prefrac_length,prefrac_amount:h.prefrac_amount,hiriefrange:h.hiriefrange};v?e.newprojectname=h.newprojectname:e.project_id=h.project_id,b?e.newexperimentname=h.newexperimentname:e.experiment_id=h.experiment_id,h.newpiname?e.newpiname=h.newpiname:e.pi_id=F?h.pi_id:_.internal_pi_id,h.ptype_id!==_.local_ptype_id&&(e.externalcontact=h.externalcontactmail);const t=await te("/datasets/save/project/",e);"error"in t?n("saveerrors",f.basics=[t.error,...f.basics],f):(le.set(t.dataset_id),console.log(a),O())}},showMetadata:function(){n("tabshow",j="meta")},showFiles:function(){n("tabshow",j=a?"files":j)},Object:Object,showMsdata:C,isExternal:F,isLabelcheck:E,$dataset_id:a,$datasetFiles:l,dynamicselect_intext_binding:function(e){h.project_name=e,n("dsinfo",h)},dynamicselect_unknowninput_binding:function(e){h.newprojectname=e,n("dsinfo",h)},dynamicselect_selectval_binding:function(e){h.project_id=e,n("dsinfo",h)},selectedvalue_handler:e=>x(),select_change_handler:function(){h.ptype_id=k(this),n("dsinfo",h),n("pdata",_)},dynamicselect_intext_binding_1:function(e){h.pi_name=e,n("dsinfo",h)},dynamicselect_unknowninput_binding_1:function(e){h.newpiname=e,n("dsinfo",h)},dynamicselect_selectval_binding_1:function(e){h.pi_id=e,n("dsinfo",h)},input_input_handler:function(){h.externalcontactmail=this.value,n("dsinfo",h),n("pdata",_)},select_change_handler_1:function(){h.datatype_id=k(this),n("dsinfo",h),n("pdata",_)},click_handler:e=>n("isNewExperiment",b=!1===b),input_input_handler_1:function(){h.newexperimentname=this.value,n("dsinfo",h),n("pdata",_)},select_change_handler_2:function(){h.experiment_id=k(this),n("dsinfo",h),n("pdata",_)},msdata_binding:function(e){S[e?"unshift":"push"](()=>{n("mssubcomp",s=e)})},msdata_dsinfo_binding:function(e){n("dsinfo",h=e)},input_input_handler_2:function(){h.runname=this.value,n("dsinfo",h),n("pdata",_)},acquicomp_1_binding:function(e){S[e?"unshift":"push"](()=>{n("acquicomp",r=e)})},acquicomp_1_errors_binding:function(e){u.acqui=e,n("errors",u)},input_input_handler_3:function(){h.runname=this.value,n("dsinfo",h),n("pdata",_)},prepcomp_1_binding:function(e){S[e?"unshift":"push"](()=>{n("prepcomp",c=e)})},prepcomp_1_errors_binding:function(e){u.sprep=e,n("errors",u)},lcheck_binding:function(e){S[e?"unshift":"push"](()=>{n("lccomp",o=e)})},lcheck_errors_binding:function(e){u.lc=e,n("errors",u)},prepcomp_1_binding_1:function(e){S[e?"unshift":"push"](()=>{n("prepcomp",c=e)})},prepcomp_1_errors_binding_1:function(e){u.lc=e,n("errors",u)},files_binding:function(e){S[e?"unshift":"push"](()=>{n("filescomp",d=e)})}}}return new class extends Y{constructor(e){super(),X(this,e,Un,Rn,s,[])}}({target:document.querySelector("#appbox")})}();
//# sourceMappingURL=bundle.js.map
