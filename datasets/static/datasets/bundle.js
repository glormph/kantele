var app=function(){"use strict";function e(){}function t(e){return e()}function n(){return Object.create(null)}function a(e){e.forEach(t)}function l(e){return"function"==typeof e}function s(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function i(e,t,n){e.$$.on_destroy.push(function(e,t){const n=e.subscribe(t);return n.unsubscribe?()=>n.unsubscribe():n}(t,n))}function r(e){return null==e?"":e}function c(e,t,n=t){return e.set(n),t}function o(e,t){e.appendChild(t)}function d(e,t,n){e.insertBefore(t,n||null)}function p(e){e.parentNode.removeChild(e)}function u(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function f(e){return document.createElement(e)}function m(e){return document.createTextNode(e)}function h(){return m(" ")}function _(){return m("")}function g(e,t,n,a){return e.addEventListener(t,n,a),()=>e.removeEventListener(t,n,a)}function v(e,t,n){null==n?e.removeAttribute(t):e.setAttribute(t,n)}function b(e){return""===e?void 0:+e}function j(e,t){t=""+t,e.data!==t&&(e.data=t)}function y(e,t){(null!=t||e.value)&&(e.value=t)}function x(e,t,n,a){e.style.setProperty(t,n,a?"important":"")}function w(e,t){for(let n=0;n<e.options.length;n+=1){const a=e.options[n];if(a.__value===t)return void(a.selected=!0)}}function $(e){const t=e.querySelector(":checked")||e.options[0];return t&&t.__value}let O;function k(e){O=e}function q(e){(function(){if(!O)throw new Error("Function called outside component initialization");return O})().$$.on_mount.push(e)}function N(){const e=O;return(t,n)=>{const a=e.$$.callbacks[t];if(a){const l=function(e,t){const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!1,!1,t),n}(t,n);a.slice().forEach(t=>{t.call(e,l)})}}}const F=[],C=[],E=[],S=[],P=Promise.resolve();let M=!1;function z(e){E.push(e)}function L(e){S.push(e)}function I(){const e=new Set;do{for(;F.length;){const e=F.shift();k(e),T(e.$$)}for(;C.length;)C.pop()();for(let t=0;t<E.length;t+=1){const n=E[t];e.has(n)||(n(),e.add(n))}E.length=0}while(F.length);for(;S.length;)S.pop()();M=!1}function T(e){e.fragment&&(e.update(e.dirty),a(e.before_update),e.fragment.p(e.dirty,e.ctx),e.dirty=null,e.after_update.forEach(z))}const D=new Set;let R;function U(){R={r:0,c:[],p:R}}function H(){R.r||a(R.c),R=R.p}function A(e,t){e&&e.i&&(D.delete(e),e.i(t))}function Q(e,t,n,a){if(e&&e.o){if(D.has(e))return;D.add(e),R.c.push(()=>{D.delete(e),a&&(n&&e.d(1),a())}),e.o(t)}}const B="undefined"!=typeof window?window:global;function K(e,t,n){-1!==e.$$.props.indexOf(t)&&(e.$$.bound[t]=n,n(e.$$.ctx[t]))}function J(e,n,s){const{fragment:i,on_mount:r,on_destroy:c,after_update:o}=e.$$;i.m(n,s),z(()=>{const n=r.map(t).filter(l);c?c.push(...n):a(n),e.$$.on_mount=[]}),o.forEach(z)}function G(e,t){e.$$.fragment&&(a(e.$$.on_destroy),e.$$.fragment.d(t),e.$$.on_destroy=e.$$.fragment=null,e.$$.ctx={})}function V(e,t){e.$$.dirty||(F.push(e),M||(M=!0,P.then(I)),e.$$.dirty=n()),e.$$.dirty[t]=!0}function W(t,l,s,i,r,c){const o=O;k(t);const d=l.props||{},p=t.$$={fragment:null,ctx:null,props:c,update:e,not_equal:r,bound:n(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(o?o.$$.context:[]),callbacks:n(),dirty:null};let u=!1;var f;p.ctx=s?s(t,d,(e,n,a=n)=>(p.ctx&&r(p.ctx[e],p.ctx[e]=a)&&(p.bound[e]&&p.bound[e](a),u&&V(t,e)),n)):d,p.update(),u=!0,a(p.before_update),p.fragment=i(p.ctx),l.target&&(l.hydrate?p.fragment.l((f=l.target,Array.from(f.childNodes))):p.fragment.c(),l.intro&&A(t.$$.fragment),J(t,l.target,l.anchor),I()),k(o)}class X{$destroy(){G(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(){}}async function Y(e){let t;try{t=await e.json()}catch(t){return{ok:!1,error:"Server error encountered",status:e.status}}return t.ok=e.ok,t}async function Z(e){let t;try{t=await fetch(e)}catch{return{ok:!1,error:"Kantele encountered a network error",status:!1}}return await Y(t)}async function ee(e,t){let n;try{n=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}catch{return{ok:!1,error:"Kantele encountered a network error",status:!1}}return await Y(n)}const te=[];function ne(t,n=e){let a;const l=[];function i(e){if(s(t,e)&&(t=e,a)){const e=!te.length;for(let e=0;e<l.length;e+=1){const n=l[e];n[1](),te.push(n,t)}if(e){for(let e=0;e<te.length;e+=2)te[e][0](te[e+1]);te.length=0}}}return{set:i,update:function(e){i(e(t))},subscribe:function(s,r=e){const c=[s,r];return l.push(c),1===l.length&&(a=n(i)||e),s(t),()=>{const e=l.indexOf(c);-1!==e&&l.splice(e,1),0===l.length&&(a(),a=null)}}}}const ae=ne(!1),le=ne({}),se=ne({});function ie(e,t,n){const a=Object.create(e);return a.option=t[n],a.each_value_1=t,a.option_index_1=n,a}function re(e,t,n){const a=Object.create(e);return a.option=t[n],a}function ce(e){var t;let n=e.param.fields,a=[];for(let t=0;t<n.length;t+=1)a[t]=ue(ie(e,n,t));return{c(){for(let e=0;e<a.length;e+=1)a[e].c();t=_()},m(e,n){for(let t=0;t<a.length;t+=1)a[t].m(e,n);d(e,t,n)},p(e,l){if(e.param){let s;for(n=l.param.fields,s=0;s<n.length;s+=1){const i=ie(l,n,s);a[s]?a[s].p(e,i):(a[s]=ue(i),a[s].c(),a[s].m(t.parentNode,t))}for(;s<a.length;s+=1)a[s].d(1);a.length=n.length}},d(e){u(a,e),e&&p(t)}}}function oe(e){var t,n,l,s=!1;function i(){s=!0,e.input_input_handler_1.call(t)}return{c(){v(t=f("input"),"type","number"),v(t,"class","input"),v(t,"placeholder",n=e.param.placeholder),l=[g(t,"input",i),g(t,"change",e.edited)]},m(n,a){d(n,t,a),y(t,e.param.model)},p(e,a){!s&&e.param&&y(t,a.param.model),s=!1,e.param&&n!==(n=a.param.placeholder)&&v(t,"placeholder",n)},d(e){e&&p(t),a(l)}}}function de(e){var t,n,l;return{c(){v(t=f("input"),"type","text"),v(t,"class","input"),v(t,"placeholder",n=e.param.placeholder),l=[g(t,"input",e.input_input_handler),g(t,"change",e.edited)]},m(n,a){d(n,t,a),y(t,e.param.model)},p(e,a){e.param&&t.value!==a.param.model&&y(t,a.param.model),e.param&&n!==(n=a.param.placeholder)&&v(t,"placeholder",n)},d(e){e&&p(t),a(l)}}}function pe(e){var t,n,l,s;let i=e.param.fields,r=[];for(let t=0;t<i.length;t+=1)r[t]=fe(re(e,i,t));return{c(){t=f("div"),n=f("select"),(l=f("option")).textContent="Please select one";for(let e=0;e<r.length;e+=1)r[e].c();l.disabled=!0,l.__value="",l.value=l.__value,void 0===e.param.model&&z(()=>e.select_change_handler.call(n)),v(t,"class","select"),s=[g(n,"change",e.select_change_handler),g(n,"change",e.edited)]},m(a,s){d(a,t,s),o(t,n),o(n,l);for(let e=0;e<r.length;e+=1)r[e].m(n,null);w(n,e.param.model)},p(e,t){if(e.param){let a;for(i=t.param.fields,a=0;a<i.length;a+=1){const l=re(t,i,a);r[a]?r[a].p(e,l):(r[a]=fe(l),r[a].c(),r[a].m(n,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=i.length}e.param&&w(n,t.param.model)},d(e){e&&p(t),u(r,e),a(s)}}}function ue(e){var t,n,l,s,i,r=e.option.text+"";function c(){e.input_change_handler.call(n,e)}return{c(){t=f("div"),n=f("input"),l=m(r),s=h(),v(n,"type","checkbox"),v(t,"class","control"),i=[g(n,"change",c),g(n,"change",e.edited)]},m(a,i){d(a,t,i),o(t,n),n.checked=e.option.checked,o(t,l),o(t,s)},p(t,a){e=a,t.param&&(n.checked=e.option.checked),t.param&&r!==(r=e.option.text+"")&&j(l,r)},d(e){e&&p(t),a(i)}}}function fe(e){var t,n,a,l=e.option.text+"";return{c(){t=f("option"),n=m(l),t.__value=a=e.option.value,t.value=t.__value},m(e,a){d(e,t,a),o(t,n)},p(e,s){e.param&&l!==(l=s.option.text+"")&&j(n,l),e.param&&a!==(a=s.option.value)&&(t.__value=a),t.value=t.__value},d(e){e&&p(t)}}}function me(t){var n,a,l,s,i,r=t.param.title+"";function c(e,t){return"select"===t.param.inputtype?pe:"text"===t.param.inputtype?de:"number"===t.param.inputtype?oe:"checkbox"===t.param.inputtype?ce:void 0}var u=c(0,t),_=u&&u(t);return{c(){n=f("div"),a=f("label"),l=m(r),s=h(),i=f("div"),_&&_.c(),v(a,"class","label"),v(i,"class","control"),v(n,"class","field")},m(e,t){d(e,n,t),o(n,a),o(a,l),o(n,s),o(n,i),_&&_.m(i,null)},p(e,t){e.param&&r!==(r=t.param.title+"")&&j(l,r),u===(u=c(0,t))&&_?_.p(e,t):(_&&_.d(1),(_=u&&u(t))&&(_.c(),_.m(i,null)))},i:e,o:e,d(e){e&&p(n),_&&_.d()}}}function he(e,t,n){const a=N();let{param:l}=t;return e.$set=(e=>{"param"in e&&n("param",l=e.param)}),{param:l,edited:function(){a("edited")},select_change_handler:function(){l.model=$(this),n("param",l)},input_input_handler:function(){l.model=this.value,n("param",l)},input_input_handler_1:function(){l.model=b(this.value),n("param",l)},input_change_handler:function({option:e,each_value_1:t,option_index_1:a}){t[a].checked=this.checked,n("param",l)}}}class _e extends X{constructor(e){super(),W(this,e,he,me,s,["param"])}}function ge(e,t,n){const a=Object.create(e);return a.error=t[n],a}function ve(e){var t,n,a;let l=e.errors,s=[];for(let t=0;t<l.length;t+=1)s[t]=be(ge(e,l,t));return{c(){t=f("div"),n=f("ul");for(let e=0;e<s.length;e+=1)s[e].c();v(t,"class",a=r(`notification is-danger ${e.cssclass}`)+" svelte-16a6jab")},m(e,a){d(e,t,a),o(t,n);for(let e=0;e<s.length;e+=1)s[e].m(n,null)},p(e,i){if(e.errors){let t;for(l=i.errors,t=0;t<l.length;t+=1){const a=ge(i,l,t);s[t]?s[t].p(e,a):(s[t]=be(a),s[t].c(),s[t].m(n,null))}for(;t<s.length;t+=1)s[t].d(1);s.length=l.length}e.cssclass&&a!==(a=r(`notification is-danger ${i.cssclass}`)+" svelte-16a6jab")&&v(t,"class",a)},d(e){e&&p(t),u(s,e)}}}function be(e){var t,n,a,l=e.error+"";return{c(){t=f("li"),n=m("â€¢ "),a=m(l)},m(e,l){d(e,t,l),o(t,n),o(t,a)},p(e,t){e.errors&&l!==(l=t.error+"")&&j(a,l)},d(e){e&&p(t)}}}function je(t){var n,a=t.errors.length&&ve(t);return{c(){a&&a.c(),n=_()},m(e,t){a&&a.m(e,t),d(e,n,t)},p(e,t){t.errors.length?a?a.p(e,t):((a=ve(t)).c(),a.m(n.parentNode,n)):a&&(a.d(1),a=null)},i:e,o:e,d(e){a&&a.d(e),e&&p(n)}}}function ye(e,t,n){let{errors:a,cssclass:l=""}=t;return e.$set=(e=>{"errors"in e&&n("errors",a=e.errors),"cssclass"in e&&n("cssclass",l=e.cssclass)}),{errors:a,cssclass:l}}class xe extends X{constructor(e){super(),W(this,e,ye,je,s,["errors","cssclass"])}}const{Object:we}=B;function $e(e,t,n){const a=we.create(e);return a.param_id=t[n][0],a.param=t[n][1],a.each_value=t,a.each_index=n,a}function Oe(e,t,n){const a=we.create(e);return a.operator=t[n],a}function ke(e){var t;return{c(){v(t=f("i"),"class","icon fas fa-edit")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function qe(e){var t;return{c(){v(t=f("i"),"class","icon fas fa-check-circle")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function Ne(e){var t,n,a,l=e.operator.name+"";return{c(){t=f("option"),n=m(l),t.__value=a=e.operator.id,t.value=t.__value},m(e,a){d(e,t,a),o(t,n)},p(e,s){e.acqdata&&l!==(l=s.operator.name+"")&&j(n,l),e.acqdata&&a!==(a=s.operator.id)&&(t.__value=a),t.value=t.__value},d(e){e&&p(t)}}}function Fe(e){var t,n,l=!1;function s(){l=!0,e.input_input_handler.call(t)}return{c(){v(t=f("input"),"type","number"),v(t,"class","input"),v(t,"placeholder","in minutes"),n=[g(t,"input",s),g(t,"change",e.editMade)]},m(n,a){d(n,t,a),y(t,e.dsinfo.rp_length)},p(e,n){!l&&e.dsinfo&&y(t,n.dsinfo.rp_length),l=!1},d(e){e&&p(t),a(n)}}}function Ce(e){var t,n;function a(n){e.param_param_binding.call(null,n,e),t=!0,L(()=>t=!1)}let l={};void 0!==e.param&&(l.param=e.param);var s=new _e({props:l});return C.push(()=>K(s,"param",a)),s.$on("edited",e.editMade),{c(){s.$$.fragment.c()},m(e,t){J(s,e,t),n=!0},p(n,a){e=a;var l={};(!t&&n.Object||n.dsinfo)&&(l.param=e.param),s.$set(l)},i(e){n||(A(s.$$.fragment,e),n=!0)},o(e){Q(s.$$.fragment,e),n=!1},d(e){G(s,e)}}}function Ee(e){var t,n,l,s,i,r,c,b,j,y,x,$,O,k,q,N,F,C,E,S,P,M,L,I,T,D,R,B,K;function V(e,t){return t.stored?qe:t.edited?ke:void 0}var W=V(0,e),X=W&&W(e),Y=new xe({props:{errors:e.acquierrors}});let Z=e.acqdata.operators,ee=[];for(let t=0;t<Z.length;t+=1)ee[t]=Ne(Oe(e,Z,t));var te=!e.dsinfo.dynamic_rp&&Fe(e);let ne=e.Object.entries(e.dsinfo.params),ae=[];for(let t=0;t<ne.length;t+=1)ae[t]=Ce($e(e,ne,t));const le=e=>Q(ae[e],1,1,()=>{ae[e]=null});return{c(){t=f("h5"),X&&X.c(),n=m("\n  Acquisition\n  "),l=f("button"),s=m("Save"),r=h(),c=f("button"),b=m("Revert"),y=h(),Y.$$.fragment.c(),x=h(),$=f("div"),(O=f("label")).textContent="Operator",k=h(),q=f("div"),N=f("div"),F=f("select"),(C=f("option")).textContent="Please select one";for(let e=0;e<ee.length;e+=1)ee[e].c();E=h(),S=f("div"),(P=f("label")).textContent="Reverse phase length",M=h(),L=f("div"),I=f("input"),T=m("Dynamic\n    "),te&&te.c(),D=h();for(let e=0;e<ae.length;e+=1)ae[e].c();R=_(),v(l,"class","button is-small is-danger has-text-weight-bold"),l.disabled=i=!e.edited,v(c,"class","button is-small is-info has-text-weight-bold"),c.disabled=j=!e.edited,v(t,"class","has-text-primary title is-5"),v(O,"class","label"),C.disabled=!0,C.__value="",C.value=C.__value,void 0===e.dsinfo.operator_id&&z(()=>e.select_change_handler.call(F)),v(N,"class","select"),v(q,"class","control"),v($,"class","field"),v(P,"class","label"),v(I,"type","checkbox"),v(L,"class","control"),v(S,"class","field"),K=[g(l,"click",e.save),g(c,"click",e.fetchData),g(F,"change",e.select_change_handler),g(F,"change",e.editMade),g(I,"change",e.input_change_handler),g(I,"change",e.editMade)]},m(a,i){d(a,t,i),X&&X.m(t,null),o(t,n),o(t,l),o(l,s),o(t,r),o(t,c),o(c,b),d(a,y,i),J(Y,a,i),d(a,x,i),d(a,$,i),o($,O),o($,k),o($,q),o(q,N),o(N,F),o(F,C);for(let e=0;e<ee.length;e+=1)ee[e].m(F,null);w(F,e.dsinfo.operator_id),d(a,E,i),d(a,S,i),o(S,P),o(S,M),o(S,L),o(L,I),I.checked=e.dsinfo.dynamic_rp,o(L,T),te&&te.m(L,null),d(a,D,i);for(let e=0;e<ae.length;e+=1)ae[e].m(a,i);d(a,R,i),B=!0},p(e,a){W!==(W=V(0,a))&&(X&&X.d(1),(X=W&&W(a))&&(X.c(),X.m(t,n))),B&&!e.edited||i===(i=!a.edited)||(l.disabled=i),B&&!e.edited||j===(j=!a.edited)||(c.disabled=j);var s={};if(e.acquierrors&&(s.errors=a.acquierrors),Y.$set(s),e.acqdata){let t;for(Z=a.acqdata.operators,t=0;t<Z.length;t+=1){const n=Oe(a,Z,t);ee[t]?ee[t].p(e,n):(ee[t]=Ne(n),ee[t].c(),ee[t].m(F,null))}for(;t<ee.length;t+=1)ee[t].d(1);ee.length=Z.length}if(e.dsinfo&&w(F,a.dsinfo.operator_id),e.dsinfo&&(I.checked=a.dsinfo.dynamic_rp),a.dsinfo.dynamic_rp?te&&(te.d(1),te=null):te?te.p(e,a):((te=Fe(a)).c(),te.m(L,null)),e.Object||e.dsinfo){let t;for(ne=a.Object.entries(a.dsinfo.params),t=0;t<ne.length;t+=1){const n=$e(a,ne,t);ae[t]?(ae[t].p(e,n),A(ae[t],1)):(ae[t]=Ce(n),ae[t].c(),A(ae[t],1),ae[t].m(R.parentNode,R))}for(U(),t=ne.length;t<ae.length;t+=1)le(t);H()}},i(e){if(!B){A(Y.$$.fragment,e);for(let e=0;e<ne.length;e+=1)A(ae[e]);B=!0}},o(e){Q(Y.$$.fragment,e),ae=ae.filter(Boolean);for(let e=0;e<ae.length;e+=1)Q(ae[e]);B=!1},d(e){e&&p(t),X&&X.d(),e&&p(y),G(Y,e),e&&(p(x),p($)),u(ee,e),e&&(p(E),p(S)),te&&te.d(),e&&p(D),u(ae,e),e&&p(R),a(K)}}}function Se(e,t,n){let a;i(e,ae,e=>{n("$dataset_id",a=e)});let l,{errors:s}=t,r=[],c={operator_id:"",dynamic_rp:!1,rp_length:"",params:[]},o={operators:[]},d=!1;function p(){let e=[];c.operator_id||e.push("Operator is required"),c.dynamic_rp||c.rp_length||e.push("Reverse phase is required");for(let t in c.params)c.params[t].model||e.push(c.params[t].title+" is required");return e}async function u(){let e="/datasets/show/acquisition/";e=a?e+a:e;const t=await Z(e);for(let[e,a]of Object.entries(t.acqdata))n("acqdata",o[e]=a,o);for(let[e,a]of Object.entries(t.dsinfo))n("dsinfo",c[e]=a,c);n("edited",d=!1)}return q(async()=>{u()}),e.$set=(e=>{"errors"in e&&n("errors",s=e.errors)}),e.$$.update=((e={$dataset_id:1,edited:1})=>{(e.$dataset_id||e.edited)&&n("stored",l=a&&!d)}),{errors:s,acquierrors:r,dsinfo:c,acqdata:o,edited:d,editMade:function(){n("errors",s=s.length?p():[]),n("edited",d=!0)},validate:p,save:async function(){if(n("acquierrors",r=[]),n("errors",s=p()),0===s.length){let e={dataset_id:a,operator_id:c.operator_id,params:c.params,rp_length:c.dynamic_rp?"":c.rp_length},t="/datasets/save/acquisition/";try{await ee(t,e),u()}catch(e){"404"===e.message&&n("acquierrors",r=[...r,"Save dataset before saving acquisition"])}}},fetchData:u,stored:l,Object:Object,select_change_handler:function(){c.operator_id=$(this),n("dsinfo",c),n("acqdata",o)},input_change_handler:function(){c.dynamic_rp=this.checked,n("dsinfo",c),n("acqdata",o)},input_input_handler:function(){c.rp_length=b(this.value),n("dsinfo",c),n("acqdata",o)},param_param_binding:function(e,{param:t,each_value:a,each_index:l}){a[l][1]=e,n("Object",Object)}}}class Pe extends X{constructor(e){super(),W(this,e,Se,Ee,s,["errors","validate","save"])}get validate(){return this.$$.ctx.validate}get save(){return this.$$.ctx.save}}const{Object:Me}=B;function ze(e,t,n){const a=Me.create(e);return a.optid=t[n],a}function Le(e){var t,n,a,l=!e.Object.keys(e.options).length,s=l&&Ie();let i=e.optorder,r=[];for(let t=0;t<i.length;t+=1)r[t]=Te(ze(e,i,t));return{c(){t=f("div"),n=f("select"),s&&s.c(),a=_();for(let e=0;e<r.length;e+=1)r[e].c();n.multiple=!0,v(t,"class","select is-multiple")},m(e,l){d(e,t,l),o(t,n),s&&s.m(n,null),o(n,a);for(let e=0;e<r.length;e+=1)r[e].m(n,null)},p(e,t){if(e.options&&(l=!t.Object.keys(t.options).length),l?s||((s=Ie()).c(),s.m(n,a)):s&&(s.d(1),s=null),e.optorder||e.niceName||e.options){let a;for(i=t.optorder,a=0;a<i.length;a+=1){const l=ze(t,i,a);r[a]?r[a].p(e,l):(r[a]=Te(l),r[a].c(),r[a].m(n,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=i.length}},d(e){e&&p(t),s&&s.d(),u(r,e)}}}function Ie(e){var t;return{c(){(t=f("option")).textContent="Type more or type less...",t.disabled=!0,t.__value="Type more or type less...",t.value=t.__value},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function Te(e){var t,n,l,s,i=e.niceName(e.options[e.optid])+"";return{c(){t=f("option"),n=m(i),t.__value=l=e.optid,t.value=t.__value,s=[g(t,"mousedown",e.mousedown_handler),g(t,"mouseout",e.mouseout_handler),g(t,"mouseover",e.mouseover_handler)]},m(e,a){d(e,t,a),o(t,n)},p(e,a){(e.niceName||e.options||e.optorder)&&i!==(i=a.niceName(a.options[a.optid])+"")&&j(n,i),e.optorder&&l!==(l=a.optid)&&(t.__value=l),t.value=t.__value},d(e){e&&p(t),a(s)}}}function De(t){var n,l,s,i,r,c,u=t.typing&&Le(t);return{c(){n=f("div"),l=f("input"),s=h(),(i=f("span")).innerHTML='<i class="fas fa-chevron-down"></i>',r=h(),u&&u.c(),v(l,"type","text"),v(l,"class","input is-narrow"),v(l,"placeholder",t.placeholder),v(i,"class","icon is-right"),v(n,"class","control has-icons-right"),c=[g(l,"input",t.input_input_handler),g(l,"keyup",t.fetchOptions),g(l,"focus",t.starttyping),g(l,"blur",t.inputdone)]},m(e,a){d(e,n,a),o(n,l),y(l,t.intext),o(n,s),o(n,i),o(n,r),u&&u.m(n,null)},p(e,t){e.intext&&l.value!==t.intext&&y(l,t.intext),e.placeholder&&v(l,"placeholder",t.placeholder),t.typing?u?u.p(e,t):((u=Le(t)).c(),u.m(n,null)):u&&(u.d(1),u=null)},i:e,o:e,d(e){e&&p(n),u&&u.d(),a(c)}}}function Re(e,t,n){const a=N();let{selectval:l="",fixedoptions:s={},fixedorder:i=[],options:r=Object.fromEntries(Object.entries(s)),intext:c,fetchUrl:o=!1,niceName:d=function(e){return e}}=t,{unknowninput:p="__PLACEHOLDER__",optorder:u=(i.length?i:Object.keys(r))}=t,f="Filter by typing",m=!1;function h(e){e.target.selected=!1,n("intext",c=""),n("placeholder",f=l?d(l):"")}function _(e){n("selectval",l=r[e.target.value].id),n("unknowninput",p=""),a("selectedvalue")}function g(e){e.target.selected=!0;const t=r[e.target.value];n("intext",c=d(t))}return e.$set=(e=>{"selectval"in e&&n("selectval",l=e.selectval),"fixedoptions"in e&&n("fixedoptions",s=e.fixedoptions),"fixedorder"in e&&n("fixedorder",i=e.fixedorder),"options"in e&&n("options",r=e.options),"intext"in e&&n("intext",c=e.intext),"fetchUrl"in e&&n("fetchUrl",o=e.fetchUrl),"niceName"in e&&n("niceName",d=e.niceName),"unknowninput"in e&&n("unknowninput",p=e.unknowninput),"optorder"in e&&n("optorder",u=e.optorder)}),{selectval:l,fixedoptions:s,fixedorder:i,options:r,intext:c,fetchUrl:o,niceName:d,unknowninput:p,optorder:u,placeholder:f,typing:m,inputdone:function(){n("typing",m=!1),l&&l in r?n("intext",c=d(r[l])):"__PLACEHOLDER__"===p?(console.log("illegal value"),a("illegalvalue")):(console.log("new value"),n("unknowninput",p=c),a("newvalue"))},deselect:h,selectvalue:_,hovervalue:g,fetchOptions:async function(){if(c.length>2&&o)n("options",r=await Z(`${o}?q=${c}`)),n("optorder",u=Object.keys(r));else if(!o&&s){n("options",r=Object.fromEntries(Object.entries(s).filter(e=>e[1].name.toLowerCase().indexOf(c.toLowerCase())>-1)));const e=Object.keys(r);n("optorder",u=i.length?i.filter(t=>e.indexOf(t.toString())>-1):e)}},starttyping:function(){const e=Object.keys(r);n("optorder",u=i.length?i:e),n("options",r=i.length?s:r),n("typing",m=!0),n("placeholder",f=l?d(l):""),n("selectval",l=""),n("intext",c="")},Object:Object,input_input_handler:function(){c=this.value,n("intext",c)},mousedown_handler:e=>_(e),mouseout_handler:e=>h(e),mouseover_handler:e=>g(e)}}class Ue extends X{constructor(e){super(),W(this,e,Re,De,s,["selectval","fixedoptions","fixedorder","options","intext","fetchUrl","niceName","unknowninput","optorder"])}}const{Object:He}=B;function Ae(e,t,n){const a=He.create(e);return a.s_id=t[n][0],a.sample=t[n][1],a}function Qe(e,t,n){const a=He.create(e);return a.s_id=t[n][0],a.sample=t[n][1],a}function Be(e,t,n){const a=He.create(e);return a.file=t[n],a}function Ke(e,t,n){const a=He.create(e);return a.s_id=t[n][0],a.sample=t[n][1],a}function Je(e,t,n){const a=He.create(e);return a.channel=t[n],a.each_value=t,a.chix=n,a}function Ge(e,t,n){const a=He.create(e);return a.quant=t[n],a}function Ve(e,t,n){const a=He.create(e);return a.param_id=t[n][0],a.param=t[n][1],a.each_value_6=t,a.each_index_3=n,a}function We(e,t,n){const a=He.create(e);return a.enzyme=t[n],a.each_value_7=t,a.enzyme_index=n,a}function Xe(e,t,n){const a=He.create(e);return a.spec=t[n],a}function Ye(e){var t;return{c(){v(t=f("i"),"class","icon fas fa-edit")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function Ze(e){var t;return{c(){v(t=f("i"),"class","icon fas fa-check-circle")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function et(e){var t,n,a,l,s,i,r=xt(e.spec)+"";function c(...t){return e.click_handler(e,...t)}return{c(){t=f("span"),n=m(r),a=h(),l=f("button"),s=h(),v(l,"class","delete is-small"),v(t,"class","tag is-medium is-info"),i=g(l,"click",c)},m(e,i){d(e,t,i),o(t,n),o(t,a),o(t,l),o(t,s)},p(t,a){e=a,t.prepdata&&r!==(r=xt(e.spec)+"")&&j(n,r)},d(e){e&&p(t),i()}}}function tt(e){var t;let n=e.prepdata.enzymes,a=[];for(let t=0;t<n.length;t+=1)a[t]=nt(We(e,n,t));return{c(){for(let e=0;e<a.length;e+=1)a[e].c();t=_()},m(e,n){for(let t=0;t<a.length;t+=1)a[t].m(e,n);d(e,t,n)},p(e,l){if(e.prepdata){let s;for(n=l.prepdata.enzymes,s=0;s<n.length;s+=1){const i=We(l,n,s);a[s]?a[s].p(e,i):(a[s]=nt(i),a[s].c(),a[s].m(t.parentNode,t))}for(;s<a.length;s+=1)a[s].d(1);a.length=n.length}},d(e){u(a,e),e&&p(t)}}}function nt(e){var t,n,l,s,i,r=e.enzyme.name+"";function c(){e.input_change_handler_1.call(n,e)}return{c(){t=f("div"),n=f("input"),l=m(r),s=h(),v(n,"type","checkbox"),v(t,"class","control"),i=[g(n,"change",c),g(n,"change",e.editMade)]},m(a,i){d(a,t,i),o(t,n),n.checked=e.enzyme.checked,o(t,l),o(t,s)},p(t,a){e=a,t.prepdata&&(n.checked=e.enzyme.checked),t.prepdata&&r!==(r=e.enzyme.name+"")&&j(l,r)},d(e){e&&p(t),a(i)}}}function at(e){var t,n;function a(n){e.param_param_binding.call(null,n,e),t=!0,L(()=>t=!1)}let l={};void 0!==e.param&&(l.param=e.param);var s=new _e({props:l});return C.push(()=>K(s,"param",a)),s.$on("edited",e.editMade),{c(){s.$$.fragment.c()},m(e,t){J(s,e,t),n=!0},p(n,a){e=a;var l={};(!t&&n.Object||n.prepdata)&&(l.param=e.param),s.$set(l)},i(e){n||(A(s.$$.fragment,e),n=!0)},o(e){Q(s.$$.fragment,e),n=!1},d(e){G(s,e)}}}function lt(e){var t,n,a,l=e.quant.name+"";return{c(){t=f("option"),n=m(l),t.__value=a=e.quant.id,t.value=t.__value},m(e,a){d(e,t,a),o(t,n)},p(e,s){(e.Object||e.prepdata)&&l!==(l=s.quant.name+"")&&j(n,l),(e.Object||e.prepdata)&&a!==(a=s.quant.id)&&(t.__value=a),t.value=t.__value},d(e){e&&p(t)}}}function st(e){var t,n,l,s,i,r,c,u,_,b,j,x,w,$,O,k,q,N,F,C=e.isLabelfree&&it(e);function E(e,t){return t.isLabelfree&&t.prepdata.labelfree_multisample?ct:t.isLabelfree?void 0:rt}var S=E(0,e),P=S&&S(e);function M(e,t){return t.foundNewSamples?dt:ot}var z=M(0,e),L=z(e);function I(e,t){return t.isLabelfree?t.isLabelfree&&t.prepdata.labelfree_multisample?ut:((null==N||e.isLabelfree||e.Object||e.$datasetFiles)&&(N=!(!t.isLabelfree||!t.Object.keys(t.$datasetFiles).length)),N?pt:void 0):ft}var T=I(null,e),D=T&&T(e);return{c(){t=f("div"),(n=f("label")).textContent="Samples",l=h(),s=f("textarea"),i=h(),(r=f("a")).textContent="Parse sample names",c=h(),u=f("div"),C&&C.c(),_=h(),b=f("table"),j=f("thead"),x=f("tr"),P&&P.c(),w=h(),$=f("th"),O=m("Sample name \n        "),L.c(),k=h(),q=f("tbody"),D&&D.c(),v(n,"class","label"),v(s,"class","textarea"),v(s,"placeholder","Try this: paste your sample names here (one line per sample, tab separated sample/file or channel)"),v(r,"class","button is-primary"),v(u,"class","control"),v(t,"class","field"),v($,"colspan","2"),v(b,"class","table is-fullwidth"),F=[g(s,"input",e.textarea_input_handler),g(r,"click",e.parseSampleNames)]},m(a,p){d(a,t,p),o(t,n),o(t,l),o(t,s),y(s,e.trysamplenames),o(t,i),o(t,r),o(t,c),o(t,u),C&&C.m(u,null),d(a,_,p),d(a,b,p),o(b,j),o(j,x),P&&P.m(x,null),o(x,w),o(x,$),o($,O),L.m($,null),o(b,k),o(b,q),D&&D.m(q,null)},p(e,t){e.trysamplenames&&y(s,t.trysamplenames),t.isLabelfree?C?C.p(e,t):((C=it(t)).c(),C.m(u,null)):C&&(C.d(1),C=null),S!==(S=E(0,t))&&(P&&P.d(1),(P=S&&S(t))&&(P.c(),P.m(x,w))),z!==(z=M(0,t))&&(L.d(1),(L=z(t))&&(L.c(),L.m($,null))),T===(T=I(e,t))&&D?D.p(e,t):(D&&D.d(1),(D=T&&T(t))&&(D.c(),D.m(q,null)))},d(e){e&&p(t),C&&C.d(),e&&(p(_),p(b)),P&&P.d(),L.d(),D&&D.d(),a(F)}}}function it(e){var t,n,l,s;return{c(){t=f("div"),n=f("input"),l=m("One sample per file?"),v(n,"type","checkbox"),v(t,"id","labelfree_samples"),s=[g(n,"change",e.input_change_handler_2),g(n,"change",e.checkIfNewSamples)]},m(a,s){d(a,t,s),o(t,n),n.checked=e.prepdata.labelfree_multisample,o(t,l)},p(e,t){e.prepdata&&(n.checked=t.prepdata.labelfree_multisample)},d(e){e&&p(t),a(s)}}}function rt(e){var t;return{c(){(t=f("th")).textContent="Channel"},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function ct(e){var t;return{c(){(t=f("th")).textContent="Filename"},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function ot(e){var t;return{c(){(t=f("a")).textContent="Save new samples",v(t,"class","button is-danger is-small is-pulled-right"),v(t,"disabled","")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function dt(e){var t,n;return{c(){(t=f("a")).textContent="Save new samples",v(t,"class","button is-danger is-small is-pulled-right"),n=g(t,"click",e.saveNewSamples)},m(e,n){d(e,t,n)},d(e){e&&p(t),n()}}}function pt(e){var t,n,l,s,i,r,c,m,_;let b=e.Object.entries(se),j=[];for(let t=0;t<b.length;t+=1)j[t]=mt(Ae(e,b,t));return{c(){t=f("tr"),n=f("td"),l=f("div"),s=f("select"),(i=f("option")).textContent="Pick a project-sample";for(let e=0;e<j.length;e+=1)j[e].c();r=h(),c=f("td"),m=f("input"),i.disabled=!0,i.__value="",i.value=i.__value,void 0===e.prepdata.labelfree_singlesample.model&&z(()=>e.select_change_handler_3.call(s)),v(l,"class","select"),v(m,"placeholder","or define a new sample"),v(m,"class","input is-normal"),_=[g(s,"change",e.select_change_handler_3),g(s,"change",e.change_handler_4),g(m,"input",e.input_input_handler_2),g(m,"change",e.change_handler_5)]},m(a,p){d(a,t,p),o(t,n),o(n,l),o(l,s),o(s,i);for(let e=0;e<j.length;e+=1)j[e].m(s,null);w(s,e.prepdata.labelfree_singlesample.model),o(t,r),o(t,c),o(c,m),y(m,e.prepdata.labelfree_singlesample.newprojsample)},p(e,t){if(e.Object||e.projsamples){let n;for(b=t.Object.entries(se),n=0;n<b.length;n+=1){const a=Ae(t,b,n);j[n]?j[n].p(e,a):(j[n]=mt(a),j[n].c(),j[n].m(s,null))}for(;n<j.length;n+=1)j[n].d(1);j.length=b.length}e.prepdata&&w(s,t.prepdata.labelfree_singlesample.model),e.prepdata&&m.value!==t.prepdata.labelfree_singlesample.newprojsample&&y(m,t.prepdata.labelfree_singlesample.newprojsample)},d(e){e&&p(t),u(j,e),a(_)}}}function ut(e){var t;let n=e.Object.values(e.$datasetFiles),a=[];for(let t=0;t<n.length;t+=1)a[t]=gt(Be(e,n,t));return{c(){for(let e=0;e<a.length;e+=1)a[e].c();t=_()},m(e,n){for(let t=0;t<a.length;t+=1)a[t].m(e,n);d(e,t,n)},p(e,l){if(e.Object||e.$datasetFiles||e.prepdata||e.projsamples){let s;for(n=l.Object.values(l.$datasetFiles),s=0;s<n.length;s+=1){const i=Be(l,n,s);a[s]?a[s].p(e,i):(a[s]=gt(i),a[s].c(),a[s].m(t.parentNode,t))}for(;s<a.length;s+=1)a[s].d(1);a.length=n.length}},d(e){u(a,e),e&&p(t)}}}function ft(e){var t;let n=e.prepdata.quants[e.prepdata.quanttype].chans,a=[];for(let t=0;t<n.length;t+=1)a[t]=jt(Je(e,n,t));return{c(){for(let e=0;e<a.length;e+=1)a[e].c();t=_()},m(e,n){for(let t=0;t<a.length;t+=1)a[t].m(e,n);d(e,t,n)},p(e,l){if(e.prepdata||e.foundNewSamples||e.Object||e.projsamples){let s;for(n=l.prepdata.quants[l.prepdata.quanttype].chans,s=0;s<n.length;s+=1){const i=Je(l,n,s);a[s]?a[s].p(e,i):(a[s]=jt(i),a[s].c(),a[s].m(t.parentNode,t))}for(;s<a.length;s+=1)a[s].d(1);a.length=n.length}},d(e){u(a,e),e&&p(t)}}}function mt(e){var t,n,a,l=e.sample.name+"";return{c(){t=f("option"),n=m(l),t.__value=a=e.s_id,t.value=t.__value},m(e,a){d(e,t,a),o(t,n)},p(e,s){(e.Object||e.projsamples)&&l!==(l=s.sample.name+"")&&j(n,l),(e.Object||e.projsamples)&&a!==(a=s.s_id)&&(t.__value=a),t.value=t.__value},d(e){e&&p(t)}}}function ht(e){var t,n,l,s,i,r,c,_,b,x,$,O,k,q=e.file.name+"";let N=e.Object.entries(se),F=[];for(let t=0;t<N.length;t+=1)F[t]=_t(Qe(e,N,t));function C(){e.select_change_handler_2.call(c,e)}function E(...t){return e.change_handler_2(e,...t)}function S(){e.input_input_handler_1.call($,e)}function P(...t){return e.change_handler_3(e,...t)}return{c(){t=f("tr"),n=f("td"),l=m(q),s=h(),i=f("td"),r=f("div"),c=f("select"),(_=f("option")).textContent="Pick a project-sample";for(let e=0;e<F.length;e+=1)F[e].c();b=h(),x=f("td"),$=f("input"),O=h(),_.disabled=!0,_.__value="",_.value=_.__value,void 0===e.prepdata.samples[e.file.associd].model&&z(C),v(r,"class","select"),v($,"placeholder","or define a new sample"),v($,"class","input is-normal"),k=[g(c,"change",C),g(c,"change",E),g($,"input",S),g($,"change",P)]},m(a,p){d(a,t,p),o(t,n),o(n,l),o(t,s),o(t,i),o(i,r),o(r,c),o(c,_);for(let e=0;e<F.length;e+=1)F[e].m(c,null);w(c,e.prepdata.samples[e.file.associd].model),o(t,b),o(t,x),o(x,$),y($,e.prepdata.samples[e.file.associd].newprojsample),o(t,O)},p(t,n){if(e=n,(t.Object||t.$datasetFiles)&&q!==(q=e.file.name+"")&&j(l,q),t.Object||t.projsamples){let n;for(N=e.Object.entries(se),n=0;n<N.length;n+=1){const a=Qe(e,N,n);F[n]?F[n].p(t,a):(F[n]=_t(a),F[n].c(),F[n].m(c,null))}for(;n<F.length;n+=1)F[n].d(1);F.length=N.length}(t.prepdata||t.Object||t.$datasetFiles)&&w(c,e.prepdata.samples[e.file.associd].model),(t.prepdata||t.Object||t.$datasetFiles)&&$.value!==e.prepdata.samples[e.file.associd].newprojsample&&y($,e.prepdata.samples[e.file.associd].newprojsample)},d(e){e&&p(t),u(F,e),a(k)}}}function _t(e){var t,n,a,l=e.sample.name+"";return{c(){t=f("option"),n=m(l),t.__value=a=e.s_id,t.value=t.__value},m(e,a){d(e,t,a),o(t,n)},p(e,s){(e.Object||e.projsamples)&&l!==(l=s.sample.name+"")&&j(n,l),(e.Object||e.projsamples)&&a!==(a=s.s_id)&&(t.__value=a),t.value=t.__value},d(e){e&&p(t)}}}function gt(e){var t,n=e.file.associd in e.prepdata.samples&&ht(e);return{c(){n&&n.c(),t=_()},m(e,a){n&&n.m(e,a),d(e,t,a)},p(e,a){a.file.associd in a.prepdata.samples?n?n.p(e,a):((n=ht(a)).c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},d(e){n&&n.d(e),e&&p(t)}}}function vt(e){var t,n,a,l=e.sample.name+"";return{c(){t=f("option"),n=m(l),t.__value=a=e.s_id,t.value=t.__value},m(e,a){d(e,t,a),o(t,n)},p(e,s){(e.Object||e.projsamples)&&l!==(l=s.sample.name+"")&&j(n,l),(e.Object||e.projsamples)&&a!==(a=s.s_id)&&(t.__value=a),t.value=t.__value},d(e){e&&p(t)}}}function bt(e){var t;return{c(){(t=f("span")).innerHTML='<i class="fas fa-asterisk"></i>',v(t,"class","icon is-left has-text-danger")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function jt(e){var t,n,l,s,i,r,c,_,b,x,$,O,k,q,N,F,C=e.channel.name+"";let E=e.Object.entries(se),S=[];for(let t=0;t<E.length;t+=1)S[t]=vt(Ke(e,E,t));function P(){e.select_change_handler_1.call(c,e)}function M(...t){return e.change_handler(e,...t)}function L(){e.input_input_handler.call(O,e)}function I(...t){return e.change_handler_1(e,...t)}var T=e.foundNewSamples&&e.channel.newprojsample&&bt();return{c(){t=f("tr"),n=f("td"),l=m(C),s=h(),i=f("td"),r=f("div"),c=f("select"),(_=f("option")).textContent="Pick a project-sample";for(let e=0;e<S.length;e+=1)S[e].c();b=h(),x=f("td"),$=f("p"),O=f("input"),k=h(),T&&T.c(),N=h(),_.disabled=!0,_.__value="",_.value=_.__value,void 0===e.channel.model&&z(P),v(r,"class","select"),v(O,"class","input is-normal"),v(O,"placeholder","or define a new sample"),v($,"class",q=e.channel.newprojsample&&e.foundNewSamples?"control has-icons-left":"control"),F=[g(c,"change",P),g(c,"change",M),g(O,"input",L),g(O,"change",I)]},m(a,p){d(a,t,p),o(t,n),o(n,l),o(t,s),o(t,i),o(i,r),o(r,c),o(c,_);for(let e=0;e<S.length;e+=1)S[e].m(c,null);w(c,e.channel.model),o(t,b),o(t,x),o(x,$),o($,O),y(O,e.channel.newprojsample),o($,k),T&&T.m($,null),o(t,N)},p(t,n){if(e=n,t.prepdata&&C!==(C=e.channel.name+"")&&j(l,C),t.Object||t.projsamples){let n;for(E=e.Object.entries(se),n=0;n<E.length;n+=1){const a=Ke(e,E,n);S[n]?S[n].p(t,a):(S[n]=vt(a),S[n].c(),S[n].m(c,null))}for(;n<S.length;n+=1)S[n].d(1);S.length=E.length}t.prepdata&&w(c,e.channel.model),t.prepdata&&O.value!==e.channel.newprojsample&&y(O,e.channel.newprojsample),e.foundNewSamples&&e.channel.newprojsample?T||((T=bt()).c(),T.m($,null)):T&&(T.d(1),T=null),(t.prepdata||t.foundNewSamples)&&q!==(q=e.channel.newprojsample&&e.foundNewSamples?"control has-icons-left":"control")&&v($,"class",q)},d(e){e&&p(t),u(S,e),T&&T.d(),a(F)}}}function yt(e){var t,n,l,s,i,r,c,b,j,y,x,$,O,k,q,N,F,E,S,P,M,I,T,D,R,B,V,W,X,Y,Z,ee,te,ne,ae,le,se;function ie(e,t){return t.stored?Ze:t.edited?Ye:void 0}var re=ie(0,e),ce=re&&re(e),oe=new xe({props:{errors:e.preperrors}});function de(t){e.dynamicselect_options_binding.call(null,t),q=!0,L(()=>q=!1)}function pe(t){e.dynamicselect_selectval_binding.call(null,t),N=!0,L(()=>N=!1)}let ue={intext:"Type to get more organisms",optorder:e.Object.keys(e.prepdata.allspecies),fetchUrl:"/datasets/show/species/",niceName:xt};void 0!==e.prepdata.allspecies&&(ue.options=e.prepdata.allspecies),void 0!==e.selectedspecies&&(ue.selectval=e.selectedspecies);var fe=new Ue({props:ue});C.push(()=>K(fe,"options",de)),C.push(()=>K(fe,"selectval",pe)),fe.$on("selectedvalue",e.addOrganism);let me=e.prepdata.species,he=[];for(let t=0;t<me.length;t+=1)he[t]=et(Xe(e,me,t));var _e=!e.prepdata.no_enzyme&&tt(e);let ge=e.Object.entries(e.prepdata.params),ve=[];for(let t=0;t<ge.length;t+=1)ve[t]=at(Ve(e,ge,t));const be=e=>Q(ve[e],1,1,()=>{ve[e]=null});let je=e.Object.values(e.prepdata.quants),ye=[];for(let t=0;t<je.length;t+=1)ye[t]=lt(Ge(e,je,t));var we=e.prepdata.quanttype&&st(e);return{c(){t=f("h5"),ce&&ce.c(),n=m("\n  Sample prep\n  "),l=f("button"),s=m("Save"),r=h(),c=f("button"),b=m("Revert"),y=h(),oe.$$.fragment.c(),x=h(),$=f("div"),(O=f("label")).textContent="Organism",k=h(),fe.$$.fragment.c(),F=h(),E=f("div");for(let e=0;e<he.length;e+=1)he[e].c();S=h(),P=f("div"),(M=f("label")).textContent="Enzymes",I=h(),T=f("input"),D=m("No enzyme\n  "),_e&&_e.c(),R=h();for(let e=0;e<ve.length;e+=1)ve[e].c();B=h(),V=f("div"),(W=f("label")).textContent="Quant type",X=h(),Y=f("div"),Z=f("div"),ee=f("select"),(te=f("option")).textContent="Please select one";for(let e=0;e<ye.length;e+=1)ye[e].c();ne=h(),we&&we.c(),ae=_(),v(l,"class","button is-small is-danger has-text-weight-bold"),l.disabled=i=!e.edited,v(c,"class","button is-small is-info has-text-weight-bold"),c.disabled=j=!e.edited,v(t,"id","sampleprep"),v(t,"class","has-text-primary title is-5"),v(O,"class","label"),v($,"class","field"),v(E,"class","tags"),v(M,"class","label"),v(T,"type","checkbox"),v(P,"class","field"),v(W,"class","label"),te.disabled=!0,te.__value="",te.value=te.__value,void 0===e.prepdata.quanttype&&z(()=>e.select_change_handler.call(ee)),v(Z,"class","select"),v(Y,"class","control"),v(V,"class","field"),se=[g(l,"click",e.save),g(c,"click",e.fetchData),g(T,"change",e.input_change_handler),g(T,"change",e.editMade),g(ee,"change",e.select_change_handler),g(ee,"change",e.checkIfNewSamples)]},m(a,i){d(a,t,i),ce&&ce.m(t,null),o(t,n),o(t,l),o(l,s),o(t,r),o(t,c),o(c,b),d(a,y,i),J(oe,a,i),d(a,x,i),d(a,$,i),o($,O),o($,k),J(fe,$,null),d(a,F,i),d(a,E,i);for(let e=0;e<he.length;e+=1)he[e].m(E,null);d(a,S,i),d(a,P,i),o(P,M),o(P,I),o(P,T),T.checked=e.prepdata.no_enzyme,o(P,D),_e&&_e.m(P,null),d(a,R,i);for(let e=0;e<ve.length;e+=1)ve[e].m(a,i);d(a,B,i),d(a,V,i),o(V,W),o(V,X),o(V,Y),o(Y,Z),o(Z,ee),o(ee,te);for(let e=0;e<ye.length;e+=1)ye[e].m(ee,null);w(ee,e.prepdata.quanttype),d(a,ne,i),we&&we.m(a,i),d(a,ae,i),le=!0},p(e,a){re!==(re=ie(0,a))&&(ce&&ce.d(1),(ce=re&&re(a))&&(ce.c(),ce.m(t,n))),le&&!e.edited||i===(i=!a.edited)||(l.disabled=i),le&&!e.edited||j===(j=!a.edited)||(c.disabled=j);var s={};e.preperrors&&(s.errors=a.preperrors),oe.$set(s);var r={};if((e.Object||e.prepdata)&&(r.optorder=a.Object.keys(a.prepdata.allspecies)),!q&&e.prepdata&&(r.options=a.prepdata.allspecies),!N&&e.selectedspecies&&(r.selectval=a.selectedspecies),fe.$set(r),e.niceSpecies||e.prepdata){let t;for(me=a.prepdata.species,t=0;t<me.length;t+=1){const n=Xe(a,me,t);he[t]?he[t].p(e,n):(he[t]=et(n),he[t].c(),he[t].m(E,null))}for(;t<he.length;t+=1)he[t].d(1);he.length=me.length}if(e.prepdata&&(T.checked=a.prepdata.no_enzyme),a.prepdata.no_enzyme?_e&&(_e.d(1),_e=null):_e?_e.p(e,a):((_e=tt(a)).c(),_e.m(P,null)),e.Object||e.prepdata){let t;for(ge=a.Object.entries(a.prepdata.params),t=0;t<ge.length;t+=1){const n=Ve(a,ge,t);ve[t]?(ve[t].p(e,n),A(ve[t],1)):(ve[t]=at(n),ve[t].c(),A(ve[t],1),ve[t].m(B.parentNode,B))}for(U(),t=ge.length;t<ve.length;t+=1)be(t);H()}if(e.Object||e.prepdata){let t;for(je=a.Object.values(a.prepdata.quants),t=0;t<je.length;t+=1){const n=Ge(a,je,t);ye[t]?ye[t].p(e,n):(ye[t]=lt(n),ye[t].c(),ye[t].m(ee,null))}for(;t<ye.length;t+=1)ye[t].d(1);ye.length=je.length}e.prepdata&&w(ee,a.prepdata.quanttype),a.prepdata.quanttype?we?we.p(e,a):((we=st(a)).c(),we.m(ae.parentNode,ae)):we&&(we.d(1),we=null)},i(e){if(!le){A(oe.$$.fragment,e),A(fe.$$.fragment,e);for(let e=0;e<ge.length;e+=1)A(ve[e]);le=!0}},o(e){Q(oe.$$.fragment,e),Q(fe.$$.fragment,e),ve=ve.filter(Boolean);for(let e=0;e<ve.length;e+=1)Q(ve[e]);le=!1},d(e){e&&p(t),ce&&ce.d(),e&&p(y),G(oe,e),e&&(p(x),p($)),G(fe),e&&(p(F),p(E)),u(he,e),e&&(p(S),p(P)),_e&&_e.d(),e&&p(R),u(ve,e),e&&(p(B),p(V)),u(ye,e),e&&p(ne),we&&we.d(e),e&&p(ae),a(se)}}}function xt(e){let t;return t=e.name?`${e.name}, ${e.linnean}`:`${e.linnean}`}function wt(e,t,n){let a,l;i(e,ae,e=>{n("$dataset_id",a=e)}),i(e,le,e=>{n("$datasetFiles",l=e)});let{errors:s}=t,r=[],c=!1;function o(){n("errors",s=s.length?y():[]),n("edited",c=!0)}let d,p,u={params:[],enzymes:[],no_enzyme:!1,quanttype:"",quants:{},labelfree_multisample:!0,labelfree_singlesample:{},allspecies:[],species:[],samples:{}},f="",m=!1;function h(e){n("prepdata",u.species=u.species.filter(t=>t.id!==e),u),o()}function _(){u.quanttype!==p?n("foundNewSamples",m=u.quants[u.quanttype].chans.some(e=>""!==e.newprojsample)):u.labelfree_multisample?n("foundNewSamples",m=Object.values(u.samples).some(e=>""!==e.newprojsample)):n("foundNewSamples",m=""!==u.labelfree_singlesample.newprojsample)}function g(e=!1){let t;if(""!=(t=u.labelfree_multisample?u.samples[e].newprojsample:u.labelfree_singlesample.newprojsample)){let a=t.trim().toUpperCase(),l=Object.entries(se).filter(e=>e[1].name.toUpperCase()==a).map(e=>e[0])[0];l&&!u.labelfree_multisample?(n("prepdata",u.labelfree_singlesample.model=l,u),n("prepdata",u.labelfree_singlesample.newprojsample="",u)):l&&(n("prepdata",u.samples[e].model=l,u),n("prepdata",u.samples[e].newprojsample="",u)),_()}}function v(e){if(""!=u.quants[u.quanttype].chans[e].newprojsample){let t=u.quants[u.quanttype].chans[e].newprojsample.trim().toUpperCase(),a=Object.entries(se).filter(e=>e[1].name.toUpperCase()==t).map(e=>e[0])[0];a&&(n("prepdata",u.quants[u.quanttype].chans[e].model=a,u),n("prepdata",u.quants[u.quanttype].chans[e].newprojsample="",u)),_()}}function b(e){e.newprojsample="",_(),o()}async function j(e,t){let l,s={dataset_id:a,samplename:e.newprojsample};try{l=await ee("/datasets/save/projsample/",s)}catch(e){return void("404"===e.message&&n("preperrors",r=[r,"Save dataset before saving new samples"]))}return se[l.psid]={name:l.psname,id:l.psid},[l.psid,t]}function y(){let e=[];if(u.no_enzyme||u.enzymes.filter.length||e.push("Enzyme selection is required"),u.quanttype||e.push("Quant type selection is required"),O&&u.labelfree_multisample){for(let t of Object.values(l))if(!u.samples[t.associd].model&&!u.samples[t.associd].newprojsample){e.push("Labelfree requires sample name for each file");break}}else if(O)""===u.labelfree_singlesample.model&&e.push("Labelfree singlesample requires a sample name");else if(u.quanttype in u.quants)for(let t of u.quants[u.quanttype].chans)if(""===t.model){e.push("Sample name for each channel is required");break}for(let t of Object.values(u.params).filter(e=>"checkbox"!==e.inputtype))t.model||e.push(t.title+" is required");for(let t of Object.values(u.params).filter(e=>"checkbox"===e.inputtype))t.fields.some(e=>e.checked)||e.push(t.title+" is required");return Object.keys(u.species).length||e.push("Organism(s) is/are required"),e}async function x(){let e="/datasets/show/sampleprep/";e=a?e+a:e;const t=await Z(e);for(let[e,a]of Object.entries(t))n("prepdata",u[e]=a,u);n("labelfree_quant_id",p=Object.entries(u.quants).filter(e=>"labelfree"===e[1].name).map(e=>Number(e[0])).pop()),n("edited",c=!1)}q(async()=>{await x()});let w,O;return e.$set=(e=>{"errors"in e&&n("errors",s=e.errors)}),e.$$.update=((e={$dataset_id:1,edited:1,prepdata:1,labelfree_quant_id:1,$datasetFiles:1})=>{(e.$dataset_id||e.edited)&&n("stored",w=a&&!c),(e.prepdata||e.labelfree_quant_id)&&n("isLabelfree",O=u.quanttype===p),e.$datasetFiles&&l&&function(){const e=Object.values(l).map(e=>e.associd);n("prepdata",u.samples=Object.fromEntries(Object.entries(u.samples).filter(t=>e.indexOf(Number(t[0]))>-1)),u);for(let t of e.filter(e=>!(e in u.samples)))n("prepdata",u.samples[t]={model:"",newprojsample:""},u)}()}),{errors:s,preperrors:r,edited:c,editMade:o,prepdata:u,selectedspecies:d,trysamplenames:f,foundNewSamples:m,removeOrganism:h,addOrganism:function(){n("prepdata",u.species=[...u.species,u.allspecies[d]],u),o()},checkIfNewSamples:_,checkNewSampleLabelfree:g,checkNewSampleIso:v,parseSampleNames:function(){let e={},t={};if(O&&!u.labelfree_multisample)return 0;if(O)for(let e of Object.values(l))t[e.name]=e;else u.quants[u.quanttype].chans.forEach(function(t,n){e[t.name]=n});for(let a of f.trim().split("\n")){let l,s,i;a.indexOf("\t")>-1?a=a.trim().split("\t").map(e=>e.trim()):a.indexOf("    ")>-1&&(a=a.trim().split("    ").map(e=>e.trim())),O?(a[0]in t&&(i=t[a[0]],l=a[1]),a[1]in t&&(i=t[a[1]],l=a[0]),i&&(n("prepdata",u.samples[i.associd].newprojsample=l,u),g(i.associd))):(a[0]in e&&(s=e[a[0]],l=a[1]),a[1]in e&&(s=e[a[1]],l=a[0]),s>-1&&(n("prepdata",u.quants[u.quanttype].chans[s].newprojsample=l,u),v(s)))}o()},resetNewSampleName:b,saveNewSamples:async function(){let e=[];if(O)if(!u.labelfree_multisample&&m){const e=await j(u.labelfree_singlesample);n("prepdata",u.labelfree_singlesample.model=e[0],u),n("prepdata",u.labelfree_singlesample.newprojsample="",u)}else{Object.entries(u.samples).filter(e=>e[1].newprojsample).forEach(function(t){e.push(j(t[1],t[0]))});for(let t of e){let[e,a]=await t;n("prepdata",u.samples[a].newprojsample="",u),n("prepdata",u.samples[a].model=e,u)}}else{u.quants[u.quanttype].chans.map(function(e,t){return[t,e]}).filter(e=>e[1].newprojsample).forEach(function(t){e.push(j(t[1],t[0]))});for(let t of e){let[e,a]=await t;n("prepdata",u.quants[u.quanttype].chans[a].newprojsample="",u),n("prepdata",u.quants[u.quanttype].chans[a].model=e,u)}}_()},validate:y,save:async function(){if(n("errors",s=y()),!Object.keys(l).length&&O&&n("preperrors",r=[...r,"Add files before saving data"]),a||n("preperrors",r=[...r,"Save dataset before saving sample prep"]),0===s.length&&0===r.length){let e={dataset_id:a,enzymes:u.no_enzyme?[]:u.enzymes,params:u.params,quanttype:u.quanttype,labelfree:O,species:u.species};O?u.labelfree_multisample?(e.filenames=Object.values(l),e.samples=u.samples):(e.filenames=Object.values(l),e.samples=Object.fromEntries(e.filenames.map(e=>[e.associd,u.labelfree_singlesample]))):e.samples=u.quants[u.quanttype].chans;let t="/datasets/save/sampleprep/";await ee(t,e),x()}},fetchData:x,stored:w,isLabelfree:O,Object:Object,$datasetFiles:l,dynamicselect_options_binding:function(e){u.allspecies=e,n("prepdata",u)},dynamicselect_selectval_binding:function(e){n("selectedspecies",d=e)},click_handler:({spec:e},t)=>h(e.id),input_change_handler:function(){u.no_enzyme=this.checked,n("prepdata",u),n("Object",Object)},input_change_handler_1:function({enzyme:e,each_value_7:t,enzyme_index:a}){t[a].checked=this.checked,n("prepdata",u),n("Object",Object)},param_param_binding:function(e,{param:t,each_value_6:a,each_index_3:l}){a[l][1]=e,n("Object",Object)},select_change_handler:function(){u.quanttype=$(this),n("prepdata",u),n("Object",Object)},textarea_input_handler:function(){f=this.value,n("trysamplenames",f)},input_change_handler_2:function(){u.labelfree_multisample=this.checked,n("prepdata",u),n("Object",Object)},select_change_handler_1:function({channel:e,each_value:t,chix:a}){t[a].model=$(this),n("prepdata",u),n("Object",Object)},change_handler:({channel:e},t)=>b(e),input_input_handler:function({channel:e,each_value:t,chix:a}){t[a].newprojsample=this.value,n("prepdata",u),n("Object",Object)},change_handler_1:({chix:e},t)=>v(e),select_change_handler_2:function({file:e}){u.samples[e.associd].model=$(this),n("prepdata",u),n("Object",Object),n("projsamples",se)},change_handler_2:({file:e},t)=>b(u.samples[e.associd]),input_input_handler_1:function({file:e}){u.samples[e.associd].newprojsample=this.value,n("prepdata",u),n("Object",Object),n("projsamples",se)},change_handler_3:({file:e},t)=>g(e.associd),select_change_handler_3:function(){u.labelfree_singlesample.model=$(this),n("prepdata",u),n("Object",Object)},change_handler_4:e=>b(u.labelfree_singlesample),input_input_handler_2:function(){u.labelfree_singlesample.newprojsample=this.value,n("prepdata",u),n("Object",Object)},change_handler_5:e=>g(u.labelfree_singlesample)}}class $t extends X{constructor(e){super(),W(this,e,wt,yt,s,["errors","validate","save"])}get validate(){return this.$$.ctx.validate}get save(){return this.$$.ctx.save}}function Ot(e,t,n){const a=Object.create(e);return a.range=t[n],a}function kt(e,t,n){const a=Object.create(e);return a.prefrac=t[n],a}function qt(e,t,n){const a=Object.create(e);return a.exp=t[n],a}function Nt(e){var t;return{c(){t=m("Create new experiment")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function Ft(e){var t;return{c(){t=m("Existing experiment")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function Ct(e){var t,n,l,s;let i=e.experiments,r=[];for(let t=0;t<i.length;t+=1)r[t]=St(qt(e,i,t));return{c(){t=f("div"),n=f("select"),(l=f("option")).textContent="Please select one";for(let e=0;e<r.length;e+=1)r[e].c();l.disabled=!0,l.__value="",l.value=l.__value,void 0===e.dsinfo.experiment_id&&z(()=>e.select_change_handler.call(n)),v(t,"class","select"),s=[g(n,"change",e.select_change_handler),g(n,"change",e.editMade)]},m(a,s){d(a,t,s),o(t,n),o(n,l);for(let e=0;e<r.length;e+=1)r[e].m(n,null);w(n,e.dsinfo.experiment_id)},p(e,t){if(e.experiments){let a;for(i=t.experiments,a=0;a<i.length;a+=1){const l=qt(t,i,a);r[a]?r[a].p(e,l):(r[a]=St(l),r[a].c(),r[a].m(n,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=i.length}e.dsinfo&&w(n,t.dsinfo.experiment_id)},d(e){e&&p(t),u(r,e),a(s)}}}function Et(e){var t,n;return{c(){v(t=f("input"),"class","input"),v(t,"type","text"),v(t,"placeholder","Experiment name"),n=[g(t,"input",e.input_input_handler),g(t,"change",e.editMade)]},m(n,a){d(n,t,a),y(t,e.dsinfo.newexperimentname)},p(e,n){e.dsinfo&&t.value!==n.dsinfo.newexperimentname&&y(t,n.dsinfo.newexperimentname)},d(e){e&&p(t),a(n)}}}function St(e){var t,n,a,l=e.exp.name+"";return{c(){t=f("option"),n=m(l),t.__value=a=e.exp.id,t.value=t.__value},m(e,a){d(e,t,a),o(t,n)},p(e,s){e.experiments&&l!==(l=s.exp.name+"")&&j(n,l),e.experiments&&a!==(a=s.exp.id)&&(t.__value=a),t.value=t.__value},d(e){e&&p(t)}}}function Pt(e){var t,n,a,l=e.prefrac.name+"";return{c(){t=f("option"),n=m(l),t.__value=a=e.prefrac.id,t.value=t.__value},m(e,a){d(e,t,a),o(t,n)},p(e,s){e.prefracs&&l!==(l=s.prefrac.name+"")&&j(n,l),e.prefracs&&a!==(a=s.prefrac.id)&&(t.__value=a),t.value=t.__value},d(e){e&&p(t)}}}function Mt(e){var t,n,l,s,i,r,c=!1;function u(){c=!0,e.input_input_handler_1.call(i)}return{c(){t=f("div"),(n=f("label")).textContent="Prefractionation length",l=h(),s=f("div"),i=f("input"),v(n,"class","label"),v(i,"type","number"),v(i,"class","input"),v(i,"placeholder","in minutes"),v(s,"class","control"),v(t,"class","field"),r=[g(i,"input",u),g(i,"change",e.editMade)]},m(a,r){d(a,t,r),o(t,n),o(t,l),o(t,s),o(s,i),y(i,e.dsinfo.prefrac_length)},p(e,t){!c&&e.dsinfo&&y(i,t.dsinfo.prefrac_length),c=!1},d(e){e&&p(t),a(r)}}}function zt(e){var t,n,l,s,i,r,c,m;let _=e.hirief_ranges,b=[];for(let t=0;t<_.length;t+=1)b[t]=Lt(Ot(e,_,t));return{c(){t=f("div"),(n=f("label")).textContent="HiRIEF range",l=h(),s=f("div"),i=f("div"),r=f("select"),(c=f("option")).textContent="Please select one";for(let e=0;e<b.length;e+=1)b[e].c();v(n,"class","label"),c.disabled=!0,c.__value="",c.value=c.__value,void 0===e.dsinfo.hiriefrange&&z(()=>e.select_change_handler_2.call(r)),v(i,"class","select"),v(s,"class","control"),v(t,"class","field"),m=[g(r,"change",e.select_change_handler_2),g(r,"change",e.editMade)]},m(a,p){d(a,t,p),o(t,n),o(t,l),o(t,s),o(s,i),o(i,r),o(r,c);for(let e=0;e<b.length;e+=1)b[e].m(r,null);w(r,e.dsinfo.hiriefrange)},p(e,t){if(e.hirief_ranges){let n;for(_=t.hirief_ranges,n=0;n<_.length;n+=1){const a=Ot(t,_,n);b[n]?b[n].p(e,a):(b[n]=Lt(a),b[n].c(),b[n].m(r,null))}for(;n<b.length;n+=1)b[n].d(1);b.length=_.length}e.dsinfo&&w(r,t.dsinfo.hiriefrange)},d(e){e&&p(t),u(b,e),a(m)}}}function Lt(e){var t,n,a,l=e.range.name+"";return{c(){t=f("option"),n=m(l),t.__value=a=e.range.id,t.value=t.__value},m(e,a){d(e,t,a),o(t,n)},p(e,s){e.hirief_ranges&&l!==(l=s.range.name+"")&&j(n,l),e.hirief_ranges&&a!==(a=s.range.id)&&(t.__value=a),t.value=t.__value},d(e){e&&p(t)}}}function It(e){var t,n,l,s,i,r,c=!1;function u(){c=!0,e.input_input_handler_2.call(i)}return{c(){t=f("div"),(n=f("label")).textContent="Number of fractions",l=h(),s=f("div"),i=f("input"),v(n,"class","label"),v(i,"type","number"),v(i,"class","input"),v(i,"placeholder","How many fractions of prefractionation"),v(s,"class","control"),v(t,"class","field"),r=[g(i,"input",u),g(i,"change",e.editMade)]},m(a,r){d(a,t,r),o(t,n),o(t,l),o(t,s),o(s,i),y(i,e.dsinfo.prefrac_amount)},p(e,t){!c&&e.dsinfo&&y(i,t.dsinfo.prefrac_amount),c=!1},d(e){e&&p(t),a(r)}}}function Tt(t){var n,l,s,i,r,c,b,j,y,x,$,O,k,q,N,F,C,E;function S(e,t){return t.isNewExperiment?Ft:Nt}var P=S(0,t),M=P(t);function L(e,t){return t.isNewExperiment?Et:Ct}var I=L(0,t),T=I(t);let D=t.prefracs,R=[];for(let e=0;e<D.length;e+=1)R[e]=Pt(kt(t,D,e));function U(e,t){return t.hiriefselected?zt:t.dsinfo.prefrac_id?Mt:void 0}var H=U(0,t),A=H&&H(t),Q=t.dsinfo.prefrac_id&&It(t);return{c(){n=f("div"),l=f("label"),s=m("Experiment name\n    "),i=f("a"),M.c(),r=h(),c=f("div"),T.c(),b=h(),j=f("div"),(y=f("label")).textContent="Prefractionation",x=h(),$=f("div"),O=f("div"),k=f("select"),(q=f("option")).textContent="None";for(let e=0;e<R.length;e+=1)R[e].c();N=h(),A&&A.c(),F=h(),Q&&Q.c(),C=_(),v(i,"class","button is-danger is-outlined is-small"),v(l,"class","label"),v(c,"class","control"),v(n,"class","field"),v(y,"class","label"),q.__value="",q.value=q.__value,void 0===t.dsinfo.prefrac_id&&z(()=>t.select_change_handler_1.call(k)),v(O,"class","select"),v($,"class","control"),v(j,"class","field"),E=[g(i,"click",t.toggle_experiment),g(k,"change",t.select_change_handler_1),g(k,"change",t.editMade)]},m(e,a){d(e,n,a),o(n,l),o(l,s),o(l,i),M.m(i,null),o(n,r),o(n,c),T.m(c,null),d(e,b,a),d(e,j,a),o(j,y),o(j,x),o(j,$),o($,O),o(O,k),o(k,q);for(let e=0;e<R.length;e+=1)R[e].m(k,null);w(k,t.dsinfo.prefrac_id),d(e,N,a),A&&A.m(e,a),d(e,F,a),Q&&Q.m(e,a),d(e,C,a)},p(e,t){if(P!==(P=S(0,t))&&(M.d(1),(M=P(t))&&(M.c(),M.m(i,null))),I===(I=L(0,t))&&T?T.p(e,t):(T.d(1),(T=I(t))&&(T.c(),T.m(c,null))),e.prefracs){let n;for(D=t.prefracs,n=0;n<D.length;n+=1){const a=kt(t,D,n);R[n]?R[n].p(e,a):(R[n]=Pt(a),R[n].c(),R[n].m(k,null))}for(;n<R.length;n+=1)R[n].d(1);R.length=D.length}e.dsinfo&&w(k,t.dsinfo.prefrac_id),H===(H=U(0,t))&&A?A.p(e,t):(A&&A.d(1),(A=H&&H(t))&&(A.c(),A.m(F.parentNode,F))),t.dsinfo.prefrac_id?Q?Q.p(e,t):((Q=It(t)).c(),Q.m(C.parentNode,C)):Q&&(Q.d(1),Q=null)},i:e,o:e,d(e){e&&p(n),M.d(),T.d(),e&&(p(b),p(j)),u(R,e),e&&p(N),A&&A.d(e),e&&p(F),Q&&Q.d(e),e&&p(C),a(E)}}}function Dt(e,t,n){const a=N();let l,{dsinfo:s,experiments:i,hirief_ranges:r,prefracs:c,isNewExperiment:o}=t,d=[];return e.$set=(e=>{"dsinfo"in e&&n("dsinfo",s=e.dsinfo),"experiments"in e&&n("experiments",i=e.experiments),"hirief_ranges"in e&&n("hirief_ranges",r=e.hirief_ranges),"prefracs"in e&&n("prefracs",c=e.prefracs),"isNewExperiment"in e&&n("isNewExperiment",o=e.isNewExperiment)}),e.$$.update=((e={prefracs:1,dsinfo:1})=>{(e.prefracs||e.dsinfo)&&n("hiriefselected",l=c.some(e=>e.id==s.prefrac_id&&e.name.toLowerCase().indexOf("hirief")>-1))}),{dsinfo:s,experiments:i,hirief_ranges:r,prefracs:c,isNewExperiment:o,toggle_experiment:function(){n("isNewExperiment",o=!1===o)},editMade:function(){a("edited")},validate:function(){return d=[],l&&!s.hiriefrange?d.push("HiRIEF range is required"):l||!s.prefrac_id||s.prefrac_length||d.push("Prefractionation length is required"),s.prefrac_id&&!s.prefrac_amount&&d.push("Prefractionation fraction amount is required"),d},hiriefselected:l,input_input_handler:function(){s.newexperimentname=this.value,n("dsinfo",s),n("experiments",i)},select_change_handler:function(){s.experiment_id=$(this),n("dsinfo",s),n("experiments",i)},select_change_handler_1:function(){s.prefrac_id=$(this),n("dsinfo",s),n("experiments",i)},select_change_handler_2:function(){s.hiriefrange=$(this),n("dsinfo",s),n("experiments",i)},input_input_handler_1:function(){s.prefrac_length=b(this.value),n("dsinfo",s),n("experiments",i)},input_input_handler_2:function(){s.prefrac_amount=b(this.value),n("dsinfo",s),n("experiments",i)}}}class Rt extends X{constructor(e){super(),W(this,e,Dt,Tt,s,["dsinfo","experiments","hirief_ranges","prefracs","isNewExperiment","validate"])}get validate(){return this.$$.ctx.validate}}const{Object:Ut}=B;function Ht(e,t,n){const a=Ut.create(e);return a.file=t[n],a}function At(e,t,n){const a=Ut.create(e);return a.quant=t[n],a}function Qt(e){var t;return{c(){v(t=f("i"),"class","icon fas fa-edit")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function Bt(e){var t;return{c(){v(t=f("i"),"class","icon fas fa-check-circle")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function Kt(e){var t,n,a,l=e.quant.name+"";return{c(){t=f("option"),n=m(l),t.__value=a=e.quant.id,t.value=t.__value},m(e,a){d(e,t,a),o(t,n)},p(e,s){e.lcdata&&l!==(l=s.quant.name+"")&&j(n,l),e.lcdata&&a!==(a=s.quant.id)&&(t.__value=a),t.value=t.__value},d(e){e&&p(t)}}}function Jt(e){var t;return{c(){(t=f("a")).textContent="Save new samples",v(t,"class","button is-danger is-small is-pulled-right"),v(t,"disabled","")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function Gt(e){var t,n;return{c(){(t=f("a")).textContent="Save new samples",v(t,"class","button is-danger is-small is-pulled-right"),n=g(t,"click",e.saveNewSamples)},m(e,n){d(e,t,n)},d(e){e&&p(t),n()}}}function Vt(e){var t,n;let a=e.Object.values(e.$datasetFiles),l=[];for(let t=0;t<a.length;t+=1)l[t]=en(Ht(e,a,t));const s=e=>Q(l[e],1,1,()=>{l[e]=null});return{c(){t=f("tbody");for(let e=0;e<l.length;e+=1)l[e].c()},m(e,a){d(e,t,a);for(let e=0;e<l.length;e+=1)l[e].m(t,null);n=!0},p(e,n){if(e.Object||e.$datasetFiles||e.lcdata||e.projsamples){let i;for(a=n.Object.values(n.$datasetFiles),i=0;i<a.length;i+=1){const s=Ht(n,a,i);l[i]?(l[i].p(e,s),A(l[i],1)):(l[i]=en(s),l[i].c(),A(l[i],1),l[i].m(t,null))}for(U(),i=a.length;i<l.length;i+=1)s(i);H()}},i(e){if(!n){for(let e=0;e<a.length;e+=1)A(l[e]);n=!0}},o(e){l=l.filter(Boolean);for(let e=0;e<l.length;e+=1)Q(l[e]);n=!1},d(e){e&&p(t),u(l,e)}}}function Wt(e){var t,n,a,l,s,i,r,c,u,_,g,b,y,x,w,$,O,k,q=e.file.name+"",N=e.lcdata.samples[e.file.associd].newprojsample&&Xt();function F(t){e.dynamicselect_intext_binding.call(null,t,e),c=!0,L(()=>c=!1)}function E(t){e.dynamicselect_unknowninput_binding.call(null,t,e),u=!0,L(()=>u=!1)}function S(t){e.dynamicselect_selectval_binding.call(null,t,e),_=!0,L(()=>_=!1)}let P={fixedoptions:se,niceName:nn};void 0!==e.lcdata.samples[e.file.associd].samplename&&(P.intext=e.lcdata.samples[e.file.associd].samplename),void 0!==e.lcdata.samples[e.file.associd].newprojsample&&(P.unknowninput=e.lcdata.samples[e.file.associd].newprojsample),void 0!==e.lcdata.samples[e.file.associd].sample&&(P.selectval=e.lcdata.samples[e.file.associd].sample);var M=new Ue({props:P});C.push(()=>K(M,"intext",F)),C.push(()=>K(M,"unknowninput",E)),C.push(()=>K(M,"selectval",S)),M.$on("selectedvalue",e.editMade),M.$on("newvalue",function(...t){return e.newvalue_handler(e,...t)});var z=e.lcdata.quanttype&&Yt(e);return{c(){t=f("tr"),n=f("td"),a=f("label"),N&&N.c(),l=h(),s=m(q),i=h(),r=f("div"),M.$$.fragment.c(),g=h(),b=f("td"),y=f("div"),x=f("div"),w=f("p"),z&&z.c(),O=h(),v(a,"class","label"),v(r,"class","field"),v(w,"class",$=e.lcdata.samples[e.file.associd].badChannel?"control has-icons-left":""),v(x,"class","control"),v(y,"class","field")},m(e,c){d(e,t,c),o(t,n),o(n,a),N&&N.m(a,null),o(a,l),o(a,s),o(n,i),o(n,r),J(M,r,null),o(t,g),o(t,b),o(b,y),o(y,x),o(x,w),z&&z.m(w,null),o(t,O),k=!0},p(t,n){(e=n).lcdata.samples[e.file.associd].newprojsample?N||((N=Xt()).c(),N.m(a,l)):N&&(N.d(1),N=null),k&&!t.$datasetFiles||q===(q=e.file.name+"")||j(s,q);var i={};t.projsamples&&(i.fixedoptions=se),(!c&&t.lcdata||t.Object||t.$datasetFiles)&&(i.intext=e.lcdata.samples[e.file.associd].samplename),(!u&&t.lcdata||t.Object||t.$datasetFiles)&&(i.unknowninput=e.lcdata.samples[e.file.associd].newprojsample),(!_&&t.lcdata||t.Object||t.$datasetFiles)&&(i.selectval=e.lcdata.samples[e.file.associd].sample),M.$set(i),e.lcdata.quanttype?z?(z.p(t,e),A(z,1)):((z=Yt(e)).c(),A(z,1),z.m(w,null)):z&&(U(),Q(z,1,1,()=>{z=null}),H()),k&&!t.lcdata&&!t.$datasetFiles||$===($=e.lcdata.samples[e.file.associd].badChannel?"control has-icons-left":"")||v(w,"class",$)},i(e){k||(A(M.$$.fragment,e),A(z),k=!0)},o(e){Q(M.$$.fragment,e),Q(z),k=!1},d(e){e&&p(t),N&&N.d(),G(M),z&&z.d()}}}function Xt(e){var t;return{c(){(t=f("span")).innerHTML='<i class="fas fa-asterisk"></i>',v(t,"class","icon has-text-danger")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function Yt(e){var t,n,a,l,s,i,r;function c(n){e.dynamicselect_intext_binding_1.call(null,n,e),t=!0,L(()=>t=!1)}function o(t){e.dynamicselect_fixedoptions_binding.call(null,t),n=!0,L(()=>n=!1)}function u(t){e.dynamicselect_fixedorder_binding.call(null,t),a=!0,L(()=>a=!1)}function f(t){e.dynamicselect_selectval_binding_1.call(null,t,e),l=!0,L(()=>l=!1)}let m={niceName:an};void 0!==e.lcdata.samples[e.file.associd].channelname&&(m.intext=e.lcdata.samples[e.file.associd].channelname),void 0!==e.lcdata.quants[e.lcdata.quanttype].chans&&(m.fixedoptions=e.lcdata.quants[e.lcdata.quanttype].chans),void 0!==e.lcdata.quants[e.lcdata.quanttype].chanorder&&(m.fixedorder=e.lcdata.quants[e.lcdata.quanttype].chanorder),void 0!==e.lcdata.samples[e.file.associd].channel&&(m.selectval=e.lcdata.samples[e.file.associd].channel);var g=new Ue({props:m});C.push(()=>K(g,"intext",c)),C.push(()=>K(g,"fixedoptions",o)),C.push(()=>K(g,"fixedorder",u)),C.push(()=>K(g,"selectval",f)),g.$on("selectedvalue",function(...t){return e.selectedvalue_handler(e,...t)}),g.$on("illegalvalue",function(...t){return e.illegalvalue_handler(e,...t)});var v=e.lcdata.samples[e.file.associd].badChannel&&Zt();return{c(){g.$$.fragment.c(),s=h(),v&&v.c(),i=_()},m(e,t){J(g,e,t),d(e,s,t),v&&v.m(e,t),d(e,i,t),r=!0},p(s,r){e=r;var c={};(!t&&s.lcdata||s.Object||s.$datasetFiles)&&(c.intext=e.lcdata.samples[e.file.associd].channelname),!n&&s.lcdata&&(c.fixedoptions=e.lcdata.quants[e.lcdata.quanttype].chans),!a&&s.lcdata&&(c.fixedorder=e.lcdata.quants[e.lcdata.quanttype].chanorder),(!l&&s.lcdata||s.Object||s.$datasetFiles)&&(c.selectval=e.lcdata.samples[e.file.associd].channel),g.$set(c),e.lcdata.samples[e.file.associd].badChannel?v||((v=Zt()).c(),v.m(i.parentNode,i)):v&&(v.d(1),v=null)},i(e){r||(A(g.$$.fragment,e),r=!0)},o(e){Q(g.$$.fragment,e),r=!1},d(e){G(g,e),e&&p(s),v&&v.d(e),e&&p(i)}}}function Zt(e){var t;return{c(){(t=f("span")).innerHTML='<i class="fas fa-asterisk"></i>',v(t,"class","icon is-left has-text-danger")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function en(e){var t,n,a=e.file.associd in e.lcdata.samples&&Wt(e);return{c(){a&&a.c(),t=_()},m(e,l){a&&a.m(e,l),d(e,t,l),n=!0},p(e,n){n.file.associd in n.lcdata.samples?a?(a.p(e,n),A(a,1)):((a=Wt(n)).c(),A(a,1),a.m(t.parentNode,t)):a&&(U(),Q(a,1,1,()=>{a=null}),H())},i(e){n||(A(a),n=!0)},o(e){Q(a),n=!1},d(e){a&&a.d(e),e&&p(t)}}}function tn(e){var t,n,l,s,i,r,c,_,b,j,y,x,$,O,k,q,N,F,C,E,S,P,M,L,I,T=e.Object.keys(e.lcdata.samples).length;function D(e,t){return t.stored?Bt:t.edited?Qt:void 0}var R=D(0,e),B=R&&R(e),K=new xe({props:{errors:e.lcerrors}});let V=e.Object.values(e.lcdata.quants),W=[];for(let t=0;t<V.length;t+=1)W[t]=Kt(At(e,V,t));function X(e,t){return t.foundNewSamples?Gt:Jt}var Y=X(0,e),Z=Y(e),ee=T&&Vt(e);return{c(){t=f("h5"),B&&B.c(),n=m("\n  Label check\n  "),l=f("button"),s=m("Save"),r=h(),c=f("button"),_=m("Revert"),j=h(),K.$$.fragment.c(),y=h(),x=f("div"),($=f("label")).textContent="Quant type",O=h(),k=f("div"),q=f("div"),N=f("select"),(F=f("option")).textContent="Please select one";for(let e=0;e<W.length;e+=1)W[e].c();C=h(),Z.c(),E=h(),S=f("table"),(P=f("thead")).innerHTML="<tr><th>Sample</th> <th>Channel</th></tr>",M=h(),ee&&ee.c(),v(l,"class","button is-small is-danger has-text-weight-bold"),l.disabled=i=!e.edited,v(c,"class","button is-small is-info has-text-weight-bold"),c.disabled=b=!e.edited,v(t,"id","labelcheck"),v(t,"class","has-text-primary title is-5"),v($,"class","label"),F.disabled=!0,F.__value="",F.value=F.__value,void 0===e.lcdata.quanttype&&z(()=>e.select_change_handler.call(N)),v(q,"class","select"),v(k,"class","control"),v(x,"class","field"),v(S,"class","table is-fullwidth"),I=[g(l,"click",e.save),g(c,"click",e.fetchData),g(N,"change",e.select_change_handler),g(N,"change",e.editMade)]},m(a,i){d(a,t,i),B&&B.m(t,null),o(t,n),o(t,l),o(l,s),o(t,r),o(t,c),o(c,_),d(a,j,i),J(K,a,i),d(a,y,i),d(a,x,i),o(x,$),o(x,O),o(x,k),o(k,q),o(q,N),o(N,F);for(let e=0;e<W.length;e+=1)W[e].m(N,null);w(N,e.lcdata.quanttype),d(a,C,i),Z.m(a,i),d(a,E,i),d(a,S,i),o(S,P),o(S,M),ee&&ee.m(S,null),L=!0},p(e,a){R!==(R=D(0,a))&&(B&&B.d(1),(B=R&&R(a))&&(B.c(),B.m(t,n))),L&&!e.edited||i===(i=!a.edited)||(l.disabled=i),L&&!e.edited||b===(b=!a.edited)||(c.disabled=b);var s={};if(e.lcerrors&&(s.errors=a.lcerrors),K.$set(s),e.Object||e.lcdata){let t;for(V=a.Object.values(a.lcdata.quants),t=0;t<V.length;t+=1){const n=At(a,V,t);W[t]?W[t].p(e,n):(W[t]=Kt(n),W[t].c(),W[t].m(N,null))}for(;t<W.length;t+=1)W[t].d(1);W.length=V.length}e.lcdata&&w(N,a.lcdata.quanttype),Y!==(Y=X(0,a))&&(Z.d(1),(Z=Y(a))&&(Z.c(),Z.m(E.parentNode,E))),e.lcdata&&(T=a.Object.keys(a.lcdata.samples).length),T?ee?(ee.p(e,a),A(ee,1)):((ee=Vt(a)).c(),A(ee,1),ee.m(S,null)):ee&&(U(),Q(ee,1,1,()=>{ee=null}),H())},i(e){L||(A(K.$$.fragment,e),A(ee),L=!0)},o(e){Q(K.$$.fragment,e),Q(ee),L=!1},d(e){e&&p(t),B&&B.d(),e&&p(j),G(K,e),e&&(p(y),p(x)),u(W,e),e&&p(C),Z.d(e),e&&(p(E),p(S)),ee&&ee.d(),a(I)}}}const nn=e=>e.name,an=e=>e.name;function ln(e,t,n){let a,l;i(e,le,e=>{n("$datasetFiles",a=e)}),i(e,ae,e=>{n("$dataset_id",l=e)});let{errors:s}=t,r=[],c={quants:{},quanttype:"",samples:{}},o=!1;function d(){n("edited",o=!0)}function p(e){n("lcdata",c.samples[e].badChannel=!1,c),d()}function u(e){console.log("bad ch"),console.log(e),n("lcdata",c.samples[e].badChannel=!0,c)}function f(e){let t=c.samples[e.associd].newprojsample.trim().toUpperCase(),a=Object.entries(se).filter(e=>e[1].name.toUpperCase()==t).map(e=>e[0])[0];a&&(n("lcdata",c.samples[e.associd].sample=parseInt(a),c),n("lcdata",c.samples[e.associd].newprojsample="",c)),d()}async function m(){let e="/datasets/show/labelcheck/";e=l?e+l:e;const t=await Z(e);for(let[e,a]of Object.entries(t))n("lcdata",c[e]=a,c);n("edited",o=!1)}q(async()=>{await m()});let h,_;return e.$set=(e=>{"errors"in e&&n("errors",s=e.errors)}),e.$$.update=((e={$datasetFiles:1,lcdata:1,$dataset_id:1,edited:1})=>{e.$datasetFiles&&Object.keys(a).length&&m(),e.lcdata&&n("foundNewSamples",h=Object.values(c.samples).some(e=>""!==e.newprojsample)),(e.$dataset_id||e.edited)&&n("stored",_=l&&!o)}),{errors:s,lcerrors:r,lcdata:c,edited:o,editMade:d,okChannel:p,badChannel:u,saveNewSamples:async function(){let e=[];Object.entries(c.samples).filter(e=>e[1].newprojsample).forEach(function(t){e.push(async function(e,t){let n={dataset_id:l,samplename:e.newprojsample};const a=await ee("/datasets/save/projsample/",n);return se[a.psid]=a.psname,[a.psid,t]}(t[1],t[0]))});for(let t of e){let[e,a]=await t;n("lcdata",c.samples[a].newprojsample="",c),n("lcdata",c.samples[a].sample=e,c)}},checkNewSample:f,save:async function(){if(n("errors",s=function(){let e=[];c.quanttype||e.push("Quant type selection is required");for(let t of Object.values(a))c.samples[t.associd].sample||e.push("Sample name for each file/channel is required"),c.samples[t.associd].channel||e.push("Channel for each file/sample is required");return e}()),Object.keys(a).length||n("lcerrors",r=[...r,"Add files before saving data"]),0===s.length){let e={dataset_id:l,quanttype:c.quanttype,samples:c.samples,filenames:Object.values(a)};console.log(e);const t="/datasets/save/labelcheck/";await ee(t,e),m()}},fetchData:m,Object:Object,$datasetFiles:a,foundNewSamples:h,stored:_,select_change_handler:function(){c.quanttype=$(this),n("lcdata",c),n("Object",Object)},dynamicselect_intext_binding:function(e,{file:t}){c.samples[t.associd].samplename=e,n("lcdata",c)},dynamicselect_unknowninput_binding:function(e,{file:t}){c.samples[t.associd].newprojsample=e,n("lcdata",c)},dynamicselect_selectval_binding:function(e,{file:t}){c.samples[t.associd].sample=e,n("lcdata",c)},newvalue_handler:({file:e},t)=>f(e),dynamicselect_intext_binding_1:function(e,{file:t}){c.samples[t.associd].channelname=e,n("lcdata",c)},dynamicselect_fixedoptions_binding:function(e){c.quants[c.quanttype].chans=e,n("lcdata",c)},dynamicselect_fixedorder_binding:function(e){c.quants[c.quanttype].chanorder=e,n("lcdata",c)},dynamicselect_selectval_binding_1:function(e,{file:t}){c.samples[t.associd].channel=e,n("lcdata",c)},selectedvalue_handler:({file:e},t)=>p(e.associd),illegalvalue_handler:({file:e},t)=>u(e.associd)}}class sn extends X{constructor(e){super(),W(this,e,ln,tn,s,["errors"])}}const{Object:rn}=B;function cn(e,t,n){const a=rn.create(e);return a.fn=t[n],a.each_value=t,a.fn_index=n,a}function on(e,t,n){const a=rn.create(e);return a.fn=t[n],a}function dn(e){var t;return{c(){(t=f("span")).innerHTML='<i class="fas fa-database"></i>',v(t,"class","icon is-small has-text-primary")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function pn(e){var t,n,a,l,s,i,r,c,u,_,b,y,x,w,$,O,k,q,N,F=e.fn.name+"",C=mn(e.fn.date)+"",E=e.fn.size+"",S=e.fn.instrument+"";function P(...t){return e.click_handler(e,...t)}var M=e.fn.id in e.$datasetFiles&&dn();return{c(){t=f("tr"),n=f("td"),(a=f("span")).innerHTML='<i class="fas fa-times"></i>',l=h(),s=f("td"),M&&M.c(),i=h(),r=f("td"),c=m(F),u=h(),_=f("td"),b=m(C),y=h(),x=f("td"),w=m(E),$=m("MB"),O=h(),k=f("td"),q=m(S),v(a,"class","icon is-small has-text-danger"),N=g(a,"click",P)},m(e,p){d(e,t,p),o(t,n),o(n,a),o(t,l),o(t,s),M&&M.m(s,null),o(t,i),o(t,r),o(r,c),o(t,u),o(t,_),o(_,b),o(t,y),o(t,x),o(x,w),o(x,$),o(t,O),o(t,k),o(k,q)},p(t,n){(e=n).fn.id in e.$datasetFiles?M||((M=dn()).c(),M.m(s,null)):M&&(M.d(1),M=null),(t.Object||t.addedFiles||t.files||t.$datasetFiles)&&F!==(F=e.fn.name+"")&&j(c,F),(t.Object||t.addedFiles||t.files||t.$datasetFiles)&&C!==(C=mn(e.fn.date)+"")&&j(b,C),(t.Object||t.addedFiles||t.files||t.$datasetFiles)&&E!==(E=e.fn.size+"")&&j(w,E),(t.Object||t.addedFiles||t.files||t.$datasetFiles)&&S!==(S=e.fn.instrument+"")&&j(q,S)},d(e){e&&p(t),M&&M.d(),N()}}}function un(e){var t,n,a,l,s,i,r,c,u,_,b,y,x,w,$,O,k,q,N,F,C=e.fn.name+"",E=mn(e.fn.date)+"",S=e.fn.size+"",P=e.fn.instrument+"";function M(){e.input_change_handler.call(a,e)}return{c(){t=f("tr"),n=f("td"),a=f("input"),l=h(),s=f("td"),i=h(),r=f("td"),c=m(C),u=h(),_=f("td"),b=m(E),y=h(),x=f("td"),w=m(S),$=m("MB"),O=h(),k=f("td"),q=m(P),N=h(),v(a,"type","checkbox"),F=g(a,"change",M)},m(p,f){d(p,t,f),o(t,n),o(n,a),a.checked=e.fn.checked,o(t,l),o(t,s),o(t,i),o(t,r),o(r,c),o(t,u),o(t,_),o(_,b),o(t,y),o(t,x),o(x,w),o(x,$),o(t,O),o(t,k),o(k,q),o(t,N)},p(t,n){e=n,(t.Object||t.removed_files||t.files)&&(a.checked=e.fn.checked),(t.Object||t.removed_files||t.files)&&C!==(C=e.fn.name+"")&&j(c,C),(t.Object||t.removed_files||t.files)&&E!==(E=mn(e.fn.date)+"")&&j(b,E),(t.Object||t.removed_files||t.files)&&S!==(S=e.fn.size+"")&&j(w,S),(t.Object||t.removed_files||t.files)&&P!==(P=e.fn.instrument+"")&&j(q,P)},d(e){e&&p(t),F()}}}function fn(t){var n,l,s,i,r,c,_,b,x,w,$,O,k,q,N,F,C,E,S,P,M,z,L,I,T,D,R,U,H,A,Q,B,K,J,G,V,W,X,Y,Z,ee,te,ne,ae,le,se,ie=t.files.newfn_order.length+"",re=t.selectedFiles.length+"",ce=t.files.dsfn_order.length+"",oe=t.Object.keys(t.removed_files).length+"",de=t.Object.keys(t.addedFiles).length+"";let pe=t.Object.values(t.addedFiles).concat(t.files.dsfn_order.map(t.func)),ue=[];for(let e=0;e<pe.length;e+=1)ue[e]=pn(on(t,pe,e));let fe=t.Object.values(t.removed_files).concat(t.files.newfn_order.map(t.func_1)),me=[];for(let e=0;e<fe.length;e+=1)me[e]=un(cn(t,fe,e));return{c(){n=f("div"),l=f("input"),s=h(),i=f("div"),r=m("Showing "),c=m(ie),_=m(" new files ("),b=m(re),x=m(" selected), "),w=m(ce),$=m(" files in dataset (incl. "),O=m(oe),k=m(", excl. "),q=m(de),N=m(" added files)"),F=h(),C=f("div"),E=f("button"),S=m("Save"),M=h(),(z=f("button")).textContent="Revert",L=h(),I=f("button"),T=m("Add selected files"),R=h(),U=f("table"),H=f("thead"),A=f("tr"),Q=f("th"),B=f("input"),K=h(),J=f("th"),G=h(),(V=f("th")).textContent="File",W=h(),(X=f("th")).textContent="Date",Y=h(),(Z=f("th")).textContent="Size",ee=h(),(te=f("th")).textContent="Instrument",ne=h(),ae=f("tbody");for(let e=0;e<ue.length;e+=1)ue[e].c();le=h();for(let e=0;e<me.length;e+=1)me[e].c();v(l,"class","input is-small"),v(l,"type","text"),v(l,"placeholder","Type a query and press enter to find analyses"),v(E,"class","button is-danger is-small"),E.disabled=P=!t.changed,v(z,"class","button is-info is-small"),v(I,"class","button is-small"),I.disabled=D=!t.selectedFiles.length,v(B,"type","checkbox"),v(U,"class","table"),v(n,"class","content is-small"),se=[g(l,"input",t.input0_input_handler),g(l,"keyup",t.findFiles),g(E,"click",t.save),g(z,"click",t.fetchFiles),g(I,"click",t.addFiles),g(B,"change",t.input1_change_handler),g(B,"click",t.selectAllNew)]},m(e,a){d(e,n,a),o(n,l),y(l,t.findQuery),o(n,s),o(n,i),o(i,r),o(i,c),o(i,_),o(i,b),o(i,x),o(i,w),o(i,$),o(i,O),o(i,k),o(i,q),o(i,N),o(n,F),o(n,C),o(C,E),o(E,S),o(C,M),o(C,z),o(C,L),o(C,I),o(I,T),o(n,R),o(n,U),o(U,H),o(H,A),o(A,Q),o(Q,B),B.checked=t.allNewSelector,o(A,K),o(A,J),o(A,G),o(A,V),o(A,W),o(A,X),o(A,Y),o(A,Z),o(A,ee),o(A,te),o(U,ne),o(U,ae);for(let e=0;e<ue.length;e+=1)ue[e].m(ae,null);o(ae,le);for(let e=0;e<me.length;e+=1)me[e].m(ae,null)},p(e,t){if(e.findQuery&&l.value!==t.findQuery&&y(l,t.findQuery),e.files&&ie!==(ie=t.files.newfn_order.length+"")&&j(c,ie),e.selectedFiles&&re!==(re=t.selectedFiles.length+"")&&j(b,re),e.files&&ce!==(ce=t.files.dsfn_order.length+"")&&j(w,ce),(e.Object||e.removed_files)&&oe!==(oe=t.Object.keys(t.removed_files).length+"")&&j(O,oe),(e.Object||e.addedFiles)&&de!==(de=t.Object.keys(t.addedFiles).length+"")&&j(q,de),e.changed&&P!==(P=!t.changed)&&(E.disabled=P),e.selectedFiles&&D!==(D=!t.selectedFiles.length)&&(I.disabled=D),e.allNewSelector&&(B.checked=t.allNewSelector),e.Object||e.addedFiles||e.files||e.$datasetFiles||e.isoTime){let n;for(pe=t.Object.values(t.addedFiles).concat(t.files.dsfn_order.map(t.func)),n=0;n<pe.length;n+=1){const a=on(t,pe,n);ue[n]?ue[n].p(e,a):(ue[n]=pn(a),ue[n].c(),ue[n].m(ae,le))}for(;n<ue.length;n+=1)ue[n].d(1);ue.length=pe.length}if(e.Object||e.removed_files||e.files||e.isoTime){let n;for(fe=t.Object.values(t.removed_files).concat(t.files.newfn_order.map(t.func_1)),n=0;n<fe.length;n+=1){const a=cn(t,fe,n);me[n]?me[n].p(e,a):(me[n]=un(a),me[n].c(),me[n].m(ae,null))}for(;n<me.length;n+=1)me[n].d(1);me.length=fe.length}},i:e,o:e,d(e){e&&p(n),u(ue,e),u(me,e),a(se)}}}function mn(e){return new Date(e).toISOString()}function hn(e,t,n){let a,l;i(e,le,e=>{n("$datasetFiles",a=e)}),i(e,ae,e=>{n("$dataset_id",l=e)});let s={newFiles:{},dsfn_order:[],newfn_order:[]},r={},o={},d="",p=!1;function u(e){e in a?(n("removed_files",o[e]=a[e],o),n("files",s.dsfn_order=s.dsfn_order.filter(t=>t!==e),s)):e in r&&n("addedFiles",r=Object.fromEntries(Object.entries(r).filter(t=>t[1].id!==e)))}async function f(){let e="/datasets/show/files/";e=l?e+l:e;const t=await Z(e);for(let[e,a]of Object.entries(t))n("files",s[e]=a,s);for(let e in a)delete a[e];for(let[e,n]of Object.entries(t.datasetFiles))c(le,a[e]=n,a);n("addedFiles",r={}),n("removed_files",o={})}q(async()=>{f()});let m,h;return e.$$.update=((e={Object:1,addedFiles:1,removed_files:1,files:1})=>{(e.Object||e.addedFiles||e.removed_files)&&n("changed",m=Object.keys(r).length||Object.keys(o).length),(e.Object||e.files||e.removed_files)&&n("selectedFiles",h=Object.values(s.newFiles).concat(Object.values(o)).filter(e=>e.checked))}),{files:s,addedFiles:r,removed_files:o,findQuery:d,allNewSelector:p,findFiles:async function(e){if(13===e.keyCode){const e=await Z(`/datasets/find/files?q=${d.split(" ").join(",")}`);for(let[t,a]of Object.entries(e))n("files",s[t]=a,s)}},selectAllNew:function(){let e=!1===p;for(let t in s.newFiles)n("files",s.newFiles[t].checked=e,s)},deleteFile:u,addFiles:function(){for(let e of Object.values(o).filter(e=>e.checked))e.checked=!1,delete o[e.id],n("files",s.dsfn_order=[e.id].concat(s.dsfn_order),s);for(let e of Object.values(s.newFiles).filter(e=>e.checked))e.checked=!1,n("addedFiles",r[e.id]=e,r),n("files",s.newfn_order=s.newfn_order.filter(t=>t!==e.id),s)},save:async function(){let e={dataset_id:l,added_files:r,removed_files:o};await ee("/datasets/save/files/",e),f()},fetchFiles:f,Object:Object,changed:m,selectedFiles:h,$datasetFiles:a,input0_input_handler:function(){d=this.value,n("findQuery",d)},input1_change_handler:function(){p=this.checked,n("allNewSelector",p)},func:e=>a[e],click_handler:({fn:e},t)=>u(e.id),func_1:e=>s.newFiles[e],input_change_handler:function({fn:e,each_value:t,fn_index:a}){t[a].checked=this.checked,n("Object",Object),n("removed_files",o),n("files",s)}}}class _n extends X{constructor(e){super(),W(this,e,hn,fn,s,[])}}const{Object:gn}=B;function vn(e,t,n){const a=gn.create(e);return a.dstype=t[n],a}function bn(e,t,n){const a=gn.create(e);return a.expi=t[n],a}function jn(e,t,n){const a=gn.create(e);return a.ptype=t[n],a}function yn(e,t,n){const a=gn.create(e);return a.project=t[n],a}function xn(e){var t,n,a,l;return{c(){t=f("li"),(n=f("a")).innerHTML="<span>Files</span>",v(t,"class",a="files"===e.tabshow?"is-active":""),l=g(n,"click",e.showFiles)},m(e,a){d(e,t,a),o(t,n)},p(e,n){e.tabshow&&a!==(a="files"===n.tabshow?"is-active":"")&&v(t,"class",a)},d(e){e&&p(t),l()}}}function wn(e){var t,n,a,l,s,i=e.dsinfo.storage_location+"";return{c(){t=f("article"),(n=f("div")).textContent="Storage location",a=h(),l=f("div"),s=m(i),v(n,"class","message-header"),v(l,"class","message-body"),v(t,"class","message is-info")},m(e,i){d(e,t,i),o(t,n),o(t,a),o(t,l),o(l,s)},p(e,t){e.dsinfo&&i!==(i=t.dsinfo.storage_location+"")&&j(s,i)},d(e){e&&p(t)}}}function $n(e){var t;return{c(){t=m("Create new project")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function On(e){var t;return{c(){t=m("Use existing project")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function kn(e){var t,n,l,s,i,r,c,m;let _=e.pdata.ptypes,b=[];for(let t=0;t<_.length;t+=1)b[t]=Nn(jn(e,_,t));return{c(){t=f("input"),n=h(),(l=f("label")).textContent="Project type",s=h(),i=f("div"),r=f("select"),(c=f("option")).textContent="Please select one";for(let e=0;e<b.length;e+=1)b[e].c();v(t,"class","input"),v(t,"type","text"),v(t,"placeholder","Project name"),v(l,"class","label"),c.disabled=!0,c.__value="",c.value=c.__value,void 0===e.dsinfo.ptype_id&&z(()=>e.select_change_handler_1.call(r)),v(i,"class","select"),m=[g(t,"input",e.input_input_handler),g(t,"change",e.editMade),g(r,"change",e.select_change_handler_1)]},m(a,p){d(a,t,p),y(t,e.dsinfo.newprojectname),d(a,n,p),d(a,l,p),d(a,s,p),d(a,i,p),o(i,r),o(r,c);for(let e=0;e<b.length;e+=1)b[e].m(r,null);w(r,e.dsinfo.ptype_id)},p(e,n){if(e.dsinfo&&t.value!==n.dsinfo.newprojectname&&y(t,n.dsinfo.newprojectname),e.pdata){let t;for(_=n.pdata.ptypes,t=0;t<_.length;t+=1){const a=jn(n,_,t);b[t]?b[t].p(e,a):(b[t]=Nn(a),b[t].c(),b[t].m(r,null))}for(;t<b.length;t+=1)b[t].d(1);b.length=_.length}e.dsinfo&&w(r,n.dsinfo.ptype_id)},d(e){e&&(p(t),p(n),p(l),p(s),p(i)),u(b,e),a(m)}}}function qn(e){var t,n,l,s;let i=e.pdata.projects,r=[];for(let t=0;t<i.length;t+=1)r[t]=Fn(yn(e,i,t));return{c(){t=f("div"),n=f("select"),(l=f("option")).textContent="Please select one";for(let e=0;e<r.length;e+=1)r[e].c();l.disabled=!0,l.__value="",l.value=l.__value,void 0===e.dsinfo.project_id&&z(()=>e.select_change_handler.call(n)),v(t,"class","select"),s=[g(n,"change",e.select_change_handler),g(n,"change",e.project_selected)]},m(a,s){d(a,t,s),o(t,n),o(n,l);for(let e=0;e<r.length;e+=1)r[e].m(n,null);w(n,e.dsinfo.project_id)},p(e,t){if(e.pdata){let a;for(i=t.pdata.projects,a=0;a<i.length;a+=1){const l=yn(t,i,a);r[a]?r[a].p(e,l):(r[a]=Fn(l),r[a].c(),r[a].m(n,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=i.length}e.dsinfo&&w(n,t.dsinfo.project_id)},d(e){e&&p(t),u(r,e),a(s)}}}function Nn(e){var t,n,a,l=e.ptype.name+"";return{c(){t=f("option"),n=m(l),t.__value=a=e.ptype.id,t.value=t.__value},m(e,a){d(e,t,a),o(t,n)},p(e,s){e.pdata&&l!==(l=s.ptype.name+"")&&j(n,l),e.pdata&&a!==(a=s.ptype.id)&&(t.__value=a),t.value=t.__value},d(e){e&&p(t)}}}function Fn(e){var t,n,a,l=e.project.name+"";return{c(){t=f("option"),n=m(l),t.__value=a=e.project.id,t.value=t.__value},m(e,a){d(e,t,a),o(t,n)},p(e,s){e.pdata&&l!==(l=s.project.name+"")&&j(n,l),e.pdata&&a!==(a=s.project.id)&&(t.__value=a),t.value=t.__value},d(e){e&&p(t)}}}function Cn(e){var t,n,a,l=e.dsinfo.pi.name+"";return{c(){t=f("span"),n=m("External project: "),a=m(l),v(t,"class","tag is-success is-medium")},m(e,l){d(e,t,l),o(t,n),o(t,a)},p(e,t){e.dsinfo&&l!==(l=t.dsinfo.pi.name+"")&&j(a,l)},d(e){e&&p(t)}}}function En(e){var t,n,l,s,i,r,c,u;function _(e,t){return t.isNewProject&&t.isNewPI?Pn:t.isNewProject?Sn:void 0}var b=_(0,e),j=b&&b(e);function x(e,t){return t.isNewProject&&!t.isNewPI?zn:t.isNewProject?Mn:void 0}var w=x(0,e),$=w&&w(e);return{c(){t=f("div"),n=f("label"),l=m("contact(s)\n          "),j&&j.c(),s=h(),$&&$.c(),i=h(),r=f("div"),c=f("input"),v(n,"class","label"),v(c,"class","input"),v(c,"type","text"),v(c,"placeholder","operational contact email (e.g. postdoc)"),v(r,"class","control"),v(t,"class","field"),u=[g(c,"input",e.input_input_handler_2),g(c,"change",e.editMade)]},m(a,p){d(a,t,p),o(t,n),o(n,l),j&&j.m(n,null),o(t,s),$&&$.m(t,null),o(t,i),o(t,r),o(r,c),y(c,e.dsinfo.externalcontactmail)},p(e,a){b!==(b=_(0,a))&&(j&&j.d(1),(j=b&&b(a))&&(j.c(),j.m(n,null))),w===(w=x(0,a))&&$?$.p(e,a):($&&$.d(1),($=w&&w(a))&&($.c(),$.m(t,i))),e.dsinfo&&c.value!==a.dsinfo.externalcontactmail&&y(c,a.dsinfo.externalcontactmail)},d(e){e&&p(t),j&&j.d(),$&&$.d(),a(u)}}}function Sn(e){var t,n;return{c(){(t=f("a")).textContent="Create new PI",v(t,"class","button is-danger is-outlined is-small"),n=g(t,"click",e.click_handler_1)},m(e,n){d(e,t,n)},d(e){e&&p(t),n()}}}function Pn(e){var t,n;return{c(){(t=f("a")).textContent="Use existing PI",v(t,"class","button is-danger is-outlined is-small"),n=g(t,"click",e.click_handler)},m(e,n){d(e,t,n)},d(e){e&&p(t),n()}}}function Mn(e){var t,n,l;return{c(){t=f("div"),v(n=f("input"),"class","input"),v(n,"type","text"),v(n,"placeholder","PI name"),v(t,"class","control"),l=[g(n,"input",e.input_input_handler_1),g(n,"input",e.editMade)]},m(a,l){d(a,t,l),o(t,n),y(n,e.dsinfo.newpiname)},p(e,t){e.dsinfo&&n.value!==t.dsinfo.newpiname&&y(n,t.dsinfo.newpiname)},d(e){e&&p(t),a(l)}}}function zn(e){var t,n,l,s,i;let r=e.pdata.external_pis,c=[];for(let t=0;t<r.length;t+=1)c[t]=Ln(bn(e,r,t));return{c(){t=f("div"),n=f("div"),l=f("select"),(s=f("option")).textContent="Please select one";for(let e=0;e<c.length;e+=1)c[e].c();s.disabled=!0,s.__value="",s.value=s.__value,void 0===e.dsinfo.pi&&z(()=>e.select_change_handler_2.call(l)),v(n,"class","select"),v(t,"class","control"),i=[g(l,"change",e.select_change_handler_2),g(l,"change",e.editMade)]},m(a,i){d(a,t,i),o(t,n),o(n,l),o(l,s);for(let e=0;e<c.length;e+=1)c[e].m(l,null);w(l,e.dsinfo.pi)},p(e,t){if(e.pdata){let n;for(r=t.pdata.external_pis,n=0;n<r.length;n+=1){const a=bn(t,r,n);c[n]?c[n].p(e,a):(c[n]=Ln(a),c[n].c(),c[n].m(l,null))}for(;n<c.length;n+=1)c[n].d(1);c.length=r.length}e.dsinfo&&w(l,t.dsinfo.pi)},d(e){e&&p(t),u(c,e),a(i)}}}function Ln(e){var t,n,a,l=e.expi.name+"";return{c(){t=f("option"),n=m(l),t.__value=a=e.expi,t.value=t.__value},m(e,a){d(e,t,a),o(t,n)},p(e,s){e.pdata&&l!==(l=s.expi.name+"")&&j(n,l),e.pdata&&a!==(a=s.expi)&&(t.__value=a),t.value=t.__value},d(e){e&&p(t)}}}function In(e){var t,n,a,l=e.dstype.name+"";return{c(){t=f("option"),n=m(l),t.__value=a=e.dstype.id,t.value=t.__value},m(e,a){d(e,t,a),o(t,n)},p(e,s){e.pdata&&l!==(l=s.dstype.name+"")&&j(n,l),e.pdata&&a!==(a=s.dstype.id)&&(t.__value=a),t.value=t.__value},d(e){e&&p(t)}}}function Tn(t){var n,l,s,i,r,c;return{c(){n=f("div"),(l=f("label")).textContent="Run name",s=h(),i=f("div"),r=f("input"),v(l,"class","label"),v(r,"class","input"),v(r,"type","text"),v(r,"placeholder","E.g set1, lc3, rerun5b, etc"),v(i,"class","control"),v(n,"class","field"),c=[g(r,"input",t.input_input_handler_4),g(r,"change",t.editMade)]},m(e,a){d(e,n,a),o(n,l),o(n,s),o(n,i),o(i,r),y(r,t.dsinfo.runname)},p(e,t){e.dsinfo&&r.value!==t.dsinfo.runname&&y(r,t.dsinfo.runname)},i:e,o:e,d(e){e&&p(n),a(c)}}}function Dn(e){var t,n,l,s,i,r,c,u,m,_,b,j;function x(n){e.msdata_dsinfo_binding.call(null,n),t=!0,L(()=>t=!1)}function w(t){e.msdata_isNewExperiment_binding.call(null,t),n=!0,L(()=>n=!1)}let $={experiments:e.experiments,prefracs:e.pdata.prefracs,hirief_ranges:e.pdata.hirief_ranges};void 0!==e.dsinfo&&($.dsinfo=e.dsinfo),void 0!==e.isNewExperiment&&($.isNewExperiment=e.isNewExperiment);var O=new Rt({props:$});function k(t){e.acquicomp_1_errors_binding.call(null,t),_=!0,L(()=>_=!1)}e.msdata_binding(O),C.push(()=>K(O,"dsinfo",x)),C.push(()=>K(O,"isNewExperiment",w)),O.$on("edited",e.editMade);let q={};void 0!==e.errors.acqui&&(q.errors=e.errors.acqui);var N=new Pe({props:q});return e.acquicomp_1_binding(N),C.push(()=>K(N,"errors",k)),{c(){O.$$.fragment.c(),l=h(),s=f("div"),(i=f("label")).textContent="Run name",r=h(),c=f("div"),u=f("input"),m=h(),N.$$.fragment.c(),v(i,"class","label"),v(u,"class","input"),v(u,"type","text"),v(u,"placeholder","E.g set1, lc3, rerun5b, etc"),v(c,"class","control"),v(s,"class","field"),j=[g(u,"input",e.input_input_handler_3),g(u,"change",e.editMade)]},m(t,n){J(O,t,n),d(t,l,n),d(t,s,n),o(s,i),o(s,r),o(s,c),o(c,u),y(u,e.dsinfo.runname),d(t,m,n),J(N,t,n),b=!0},p(e,a){var l={};e.experiments&&(l.experiments=a.experiments),e.pdata&&(l.prefracs=a.pdata.prefracs),e.pdata&&(l.hirief_ranges=a.pdata.hirief_ranges),!t&&e.dsinfo&&(l.dsinfo=a.dsinfo),!n&&e.isNewExperiment&&(l.isNewExperiment=a.isNewExperiment),O.$set(l),e.dsinfo&&u.value!==a.dsinfo.runname&&y(u,a.dsinfo.runname);var s={};!_&&e.errors&&(s.errors=a.errors.acqui),N.$set(s)},i(e){b||(A(O.$$.fragment,e),A(N.$$.fragment,e),b=!0)},o(e){Q(O.$$.fragment,e),Q(N.$$.fragment,e),b=!1},d(t){e.msdata_binding(null),G(O,t),t&&(p(l),p(s),p(m)),e.acquicomp_1_binding(null),G(N,t),a(j)}}}function Rn(e){var t,n;function a(n){e.prepcomp_1_errors_binding.call(null,n),t=!0,L(()=>t=!1)}let l={};void 0!==e.errors.sprep&&(l.errors=e.errors.sprep);var s=new $t({props:l});return e.prepcomp_1_binding(s),C.push(()=>K(s,"errors",a)),{c(){s.$$.fragment.c()},m(e,t){J(s,e,t),n=!0},p(e,n){var a={};!t&&e.errors&&(a.errors=n.errors.sprep),s.$set(a)},i(e){n||(A(s.$$.fragment,e),n=!0)},o(e){Q(s.$$.fragment,e),n=!1},d(t){e.prepcomp_1_binding(null),G(s,t)}}}function Un(e){var t,n;function a(n){e.lcheck_errors_binding.call(null,n),t=!0,L(()=>t=!1)}let l={};void 0!==e.errors.lc&&(l.errors=e.errors.lc);var s=new sn({props:l});return e.lcheck_binding(s),C.push(()=>K(s,"errors",a)),{c(){s.$$.fragment.c()},m(e,t){J(s,e,t),n=!0},p(e,n){var a={};!t&&e.errors&&(a.errors=n.errors.lc),s.$set(a)},i(e){n||(A(s.$$.fragment,e),n=!0)},o(e){Q(s.$$.fragment,e),n=!1},d(t){e.lcheck_binding(null),G(s,t)}}}function Hn(e){var t,n,l,s,i,r,c,_,b,j,y,$,O,k,q,N,F,C,E,S,P,M,L,I,T,D,R,B,K,V,W,X,Y,Z,ee,te,ne,ae,le,se,ie,re,ce,oe,de,pe,ue,fe,me,he=e.components.indexOf("sampleprep")>-1,_e=e.Object.keys(e.$datasetFiles).length&&e.components.indexOf("labelchecksamples")>-1,ge=new xe({props:{cssclass:"sticky",errors:e.Object.values(e.saveerrors).flat().concat(e.Object.values(e.errors).flat())}}),ve=e.$dataset_id&&xn(e),be=e.dsinfo.storage_location&&wn(e),je={c(){v(me=f("i"),"class","icon fas fa-check-circle")},m(e,t){d(e,me,t)},d(e){e&&p(me)}};function ye(e,t){return t.isNewProject?On:$n}var we=ye(0,e),$e=we(e);function Oe(e,t){return t.isNewProject?kn:qn}var ke=Oe(0,e),qe=ke(e),Ne=e.isExternal&&Cn(e),Fe=e.isExternal&&En(e);let Ce=e.pdata.datasettypes,Ee=[];for(let t=0;t<Ce.length;t+=1)Ee[t]=In(vn(e,Ce,t));var Se=[Dn,Tn],Pe=[];function Me(e,t){return t.showMsdata?0:t.dsinfo.datatype_id?1:-1}~(ie=Me(0,e))&&(re=Pe[ie]=Se[ie](e));var ze=he&&Rn(e),Le=_e&&Un(e);var Ie=new _n({props:{}});return e.files_binding(Ie),{c(){ge.$$.fragment.c(),t=h(),n=f("div"),l=f("ul"),s=f("li"),(i=f("a")).innerHTML="<span>Metadata</span>",c=h(),ve&&ve.c(),_=h(),(b=f("h4")).textContent="Dataset",j=h(),y=f("div"),$=f("div"),be&&be.c(),O=h(),k=f("h5"),je&&je.c(),q=m("\n        Basics\n        "),N=f("button"),F=m("Save"),E=h(),S=f("button"),P=m("Revert"),L=h(),I=f("div"),T=f("label"),D=m("Project\n          "),R=f("a"),$e.c(),B=h(),K=f("div"),qe.c(),V=h(),Ne&&Ne.c(),W=h(),Fe&&Fe.c(),X=h(),Y=f("div"),(Z=f("label")).textContent="Dataset type",ee=h(),te=f("div"),ne=f("div"),ae=f("select"),(le=f("option")).textContent="Please select one";for(let e=0;e<Ee.length;e+=1)Ee[e].c();se=h(),re&&re.c(),ce=h(),ze&&ze.c(),oe=h(),Le&&Le.c(),de=h(),pe=f("div"),Ie.$$.fragment.c(),v(s,"class",r="meta"===e.tabshow?"is-active":""),v(n,"class","tabs is-toggle is-centered is-small"),v(b,"class","title is-4"),v(N,"class","button is-small is-danger has-text-weight-bold"),N.disabled=C=!e.edited,v(S,"class","button is-small is-info has-text-weight-bold"),S.disabled=M=!e.edited||!e.dsinfo.datatype_id,v(k,"class","has-text-primary title is-5"),v(R,"class","button is-danger is-outlined is-small"),v(T,"class","label"),v(K,"class","control"),v(I,"class","field"),v(Z,"class","label"),le.disabled=!0,le.__value="",le.value=le.__value,void 0===e.dsinfo.datatype_id&&z(()=>e.select_change_handler_3.call(ae)),v(ne,"class","select"),v(te,"class","control"),v(Y,"class","field"),v($,"class","box"),v($,"id","project"),x(y,"display","meta"!==e.tabshow?"none":""),x(pe,"display","files"!==e.tabshow?"none":""),fe=[g(i,"click",e.showMetadata),g(N,"click",e.save),g(S,"click",e.fetchDataset),g(R,"click",e.toggle_project),g(ae,"change",e.select_change_handler_3),g(ae,"change",e.getcomponents)]},m(a,r){J(ge,a,r),d(a,t,r),d(a,n,r),o(n,l),o(l,s),o(s,i),o(l,c),ve&&ve.m(l,null),d(a,_,r),d(a,b,r),d(a,j,r),d(a,y,r),o(y,$),be&&be.m($,null),o($,O),o($,k),je&&je.m(k,null),o(k,q),o(k,N),o(N,F),o(k,E),o(k,S),o(S,P),o($,L),o($,I),o(I,T),o(T,D),o(T,R),$e.m(R,null),o(I,B),o(I,K),qe.m(K,null),o(K,V),Ne&&Ne.m(K,null),o($,W),Fe&&Fe.m($,null),o($,X),o($,Y),o(Y,Z),o(Y,ee),o(Y,te),o(te,ne),o(ne,ae),o(ae,le);for(let e=0;e<Ee.length;e+=1)Ee[e].m(ae,null);w(ae,e.dsinfo.datatype_id),o($,se),~ie&&Pe[ie].m($,null),o($,ce),ze&&ze.m($,null),o($,oe),Le&&Le.m($,null),d(a,de,r),d(a,pe,r),J(Ie,pe,null),ue=!0},p(e,t){var n={};if((e.saveerrors||e.errors)&&(n.errors=t.Object.values(t.saveerrors).flat().concat(t.Object.values(t.errors).flat())),ge.$set(n),ue&&!e.tabshow||r===(r="meta"===t.tabshow?"is-active":"")||v(s,"class",r),t.$dataset_id?ve?ve.p(e,t):((ve=xn(t)).c(),ve.m(l,null)):ve&&(ve.d(1),ve=null),t.dsinfo.storage_location?be?be.p(e,t):((be=wn(t)).c(),be.m($,O)):be&&(be.d(1),be=null),ue&&!e.edited||C===(C=!t.edited)||(N.disabled=C),ue&&!e.edited&&!e.dsinfo||M===(M=!t.edited||!t.dsinfo.datatype_id)||(S.disabled=M),we!==(we=ye(0,t))&&($e.d(1),($e=we(t))&&($e.c(),$e.m(R,null))),ke===(ke=Oe(0,t))&&qe?qe.p(e,t):(qe.d(1),(qe=ke(t))&&(qe.c(),qe.m(K,V))),t.isExternal?Ne?Ne.p(e,t):((Ne=Cn(t)).c(),Ne.m(K,null)):Ne&&(Ne.d(1),Ne=null),t.isExternal?Fe?Fe.p(e,t):((Fe=En(t)).c(),Fe.m($,X)):Fe&&(Fe.d(1),Fe=null),e.pdata){let n;for(Ce=t.pdata.datasettypes,n=0;n<Ce.length;n+=1){const a=vn(t,Ce,n);Ee[n]?Ee[n].p(e,a):(Ee[n]=In(a),Ee[n].c(),Ee[n].m(ae,null))}for(;n<Ee.length;n+=1)Ee[n].d(1);Ee.length=Ce.length}e.dsinfo&&w(ae,t.dsinfo.datatype_id);var a=ie;(ie=Me(0,t))===a?~ie&&Pe[ie].p(e,t):(re&&(U(),Q(Pe[a],1,1,()=>{Pe[a]=null}),H()),~ie?((re=Pe[ie])||(re=Pe[ie]=Se[ie](t)).c(),A(re,1),re.m($,ce)):re=null),e.components&&(he=t.components.indexOf("sampleprep")>-1),he?ze?(ze.p(e,t),A(ze,1)):((ze=Rn(t)).c(),A(ze,1),ze.m($,oe)):ze&&(U(),Q(ze,1,1,()=>{ze=null}),H()),(e.$datasetFiles||e.components)&&(_e=t.Object.keys(t.$datasetFiles).length&&t.components.indexOf("labelchecksamples")>-1),_e?Le?(Le.p(e,t),A(Le,1)):((Le=Un(t)).c(),A(Le,1),Le.m($,null)):Le&&(U(),Q(Le,1,1,()=>{Le=null}),H()),ue&&!e.tabshow||x(y,"display","meta"!==t.tabshow?"none":"");Ie.$set({}),ue&&!e.tabshow||x(pe,"display","files"!==t.tabshow?"none":"")},i(e){ue||(A(ge.$$.fragment,e),A(re),A(ze),A(Le),A(Ie.$$.fragment,e),ue=!0)},o(e){Q(ge.$$.fragment,e),Q(re),Q(ze),Q(Le),Q(Ie.$$.fragment,e),ue=!1},d(l){G(ge,l),l&&(p(t),p(n)),ve&&ve.d(),l&&(p(_),p(b),p(j),p(y)),be&&be.d(),je&&je.d(),$e.d(),qe.d(),Ne&&Ne.d(),Fe&&Fe.d(),u(Ee,l),~ie&&Pe[ie].d(),ze&&ze.d(),Le&&Le.d(),l&&(p(de),p(pe)),e.files_binding(null),G(Ie),a(fe)}}}function An(e,t,n){let a,l,s,r,c,o,d;i(e,ae,e=>{n("$dataset_id",a=e)}),i(e,le,e=>{n("$datasetFiles",l=e)}),init_dataset_id&&ae.set(init_dataset_id);let p=!1,u={basics:[],sprep:[],acqui:[],lc:[]},f=Object.assign({},u),m=[],h={datatype_id:"",project_id:"",ptype_id:"",storage_location:"",newprojectname:"",experiment_id:"",runname:"",pi:"",externalcontactmail:"",prefrac_id:"",prefrac_length:"",prefrac_amount:"",hiriefrange:""},_={datasettypes:[],ptypes:[],projects:[],local_ptype_id:"",external_pis:[],prefracs:[],hirief_ranges:[]},g=[],v=!1,b=!1,j=!1,y=[],x="meta";async function w(){const e=await Z(`/datasets/show/components/${h.datatype_id}`);n("components",g=e.components)}async function O(e=!1,t=!1){if(h.project_id){const e=await Z(`/datasets/show/project/${h.project_id}`);n("dsinfo",h.pi=_.external_pis.filter(t=>t.id===e.pi_id)[0],h),n("dsinfo",h.ptype_id=e.ptype_id,h),n("experiments",y=e.experiments);for(let e in se)delete se[e];for(let[t,n]of Object.entries(e.projsamples))se[t]=n;n("isNewProject",v=!1)}t||n("dsinfo",h.experiment_id="",h),k()}function k(){n("edited",p=!0),n("errors",u.basics=u.basics.length?F():[],u)}async function N(){let e="/datasets/show/info/";e=a?e+a:e;const t=await Z(e);for(let[e,a]of Object.entries(t.projdata))n("pdata",_[e]=a,_);for(let[e,a]of Object.entries(t.dsinfo))n("dsinfo",h[e]=a,h);a&&(w(),await O(!1,!0),n("isNewExperiment",b=!1),n("isNewPI",j=!1)),n("edited",p=!1)}function F(){m=[];const e=RegExp("^[a-z0-9-_]+$","i");return v&&!h.newprojectname||!v&&!h.project_id?m.push("Project needs to be selected or created"):v&&h.newprojectname&&!e.test(h.newprojectname)&&m.push("Project name may only contain a-z 0-9 - _"),h.runname?e.test(h.runname)||m.push("Run name may only contain a-z 0-9 - _"):m.push("Run name is required"),E&&(b&&!h.newexperimentname||!b&&!h.experiment_id)?m.push("Experiment is required"):E&&b&&h.newexperimentname&&!e.test(h.newexperimentname)&&m.push("Experiment name may only contain a-z 0-9 - _"),S&&(h.newpiname||h.pi.id||m.push("Need to select or create a PI"),h.externalcontactmail||m.push("External contact is required")),h.datatype_id||m.push("Datatype is required"),m}q(async()=>{await N()});let E,S;return e.$$.update=((e={components:1,dsinfo:1,pdata:1})=>{e.components&&n("showMsdata",E=g.indexOf("acquisition")>-1),(e.dsinfo||e.pdata)&&n("isExternal",S=h.ptype_id&&h.ptype_id!==_.local_ptype_id)}),{mssubcomp:s,acquicomp:r,prepcomp:c,lccomp:o,filescomp:d,edited:p,errors:u,saveerrors:f,dsinfo:h,pdata:_,components:g,isNewProject:v,isNewExperiment:b,isNewPI:j,experiments:y,tabshow:x,getcomponents:w,project_selected:O,toggle_project:function(){n("isNewProject",v=!1===v)},editMade:k,fetchDataset:N,save:async function(){if(n("errors",u.basics=F(),u),E){let e=s.validate();n("errors",u.basics=[...u.basics,...e],u)}if(0===u.basics.length){let e={dataset_id:a,ptype_id:h.ptype_id,datatype_id:h.datatype_id,runname:h.runname,prefrac_id:h.prefrac_id,prefrac_length:h.prefrac_length,prefrac_amount:h.prefrac_amount,hiriefrange:h.hiriefrange};v?e.newprojectname=h.newprojectname:e.project_id=h.project_id,b?e.newexperimentname=h.newexperimentname:e.experiment_id=h.experiment_id,j?e.newpiname=h.newpiname:e.pi_id=S?h.pi.id:_.internal_pi_id,h.ptype_id!==_.local_ptype_id&&(e.externalcontact=h.externalcontactmail);const t=await ee("/datasets/save/project/",e);"error"in t?n("saveerrors",f.basics=[t.error,...f.basics],f):(ae.set(t.dataset_id),console.log(a),N())}},showMetadata:function(){n("tabshow",x="meta")},showFiles:function(){n("tabshow",x=a?"files":x)},Object:Object,showMsdata:E,isExternal:S,$dataset_id:a,$datasetFiles:l,select_change_handler:function(){h.project_id=$(this),n("dsinfo",h),n("pdata",_)},input_input_handler:function(){h.newprojectname=this.value,n("dsinfo",h),n("pdata",_)},select_change_handler_1:function(){h.ptype_id=$(this),n("dsinfo",h),n("pdata",_)},click_handler:e=>n("isNewPI",j=!j),click_handler_1:e=>n("isNewPI",j=!j),select_change_handler_2:function(){h.pi=$(this),n("dsinfo",h),n("pdata",_)},input_input_handler_1:function(){h.newpiname=this.value,n("dsinfo",h),n("pdata",_)},input_input_handler_2:function(){h.externalcontactmail=this.value,n("dsinfo",h),n("pdata",_)},select_change_handler_3:function(){h.datatype_id=$(this),n("dsinfo",h),n("pdata",_)},msdata_binding:function(e){C[e?"unshift":"push"](()=>{n("mssubcomp",s=e)})},msdata_dsinfo_binding:function(e){n("dsinfo",h=e)},msdata_isNewExperiment_binding:function(e){n("isNewExperiment",b=e)},input_input_handler_3:function(){h.runname=this.value,n("dsinfo",h),n("pdata",_)},acquicomp_1_binding:function(e){C[e?"unshift":"push"](()=>{n("acquicomp",r=e)})},acquicomp_1_errors_binding:function(e){u.acqui=e,n("errors",u)},input_input_handler_4:function(){h.runname=this.value,n("dsinfo",h),n("pdata",_)},prepcomp_1_binding:function(e){C[e?"unshift":"push"](()=>{n("prepcomp",c=e)})},prepcomp_1_errors_binding:function(e){u.sprep=e,n("errors",u)},lcheck_binding:function(e){C[e?"unshift":"push"](()=>{n("lccomp",o=e)})},lcheck_errors_binding:function(e){u.lc=e,n("errors",u)},files_binding:function(e){C[e?"unshift":"push"](()=>{n("filescomp",d=e)})}}}return new class extends X{constructor(e){super(),W(this,e,An,Hn,s,[])}}({target:document.querySelector("#appbox")})}();
//# sourceMappingURL=bundle.js.map
