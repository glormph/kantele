var app=function(){"use strict";function e(){}function t(e){return e()}function n(){return Object.create(null)}function a(e){e.forEach(t)}function l(e){return"function"==typeof e}function s(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function i(e,t,n){e.$$.on_destroy.push(function(e,t){const n=e.subscribe(t);return n.unsubscribe?()=>n.unsubscribe():n}(t,n))}function r(e){return null==e?"":e}function c(e,t,n=t){return e.set(n),t}function o(e,t){e.appendChild(t)}function d(e,t,n){e.insertBefore(t,n||null)}function p(e){e.parentNode.removeChild(e)}function u(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function f(e){return document.createElement(e)}function m(e){return document.createTextNode(e)}function h(){return m(" ")}function _(){return m("")}function g(e,t,n,a){return e.addEventListener(t,n,a),()=>e.removeEventListener(t,n,a)}function v(e,t,n){null==n?e.removeAttribute(t):e.setAttribute(t,n)}function b(e){return""===e?void 0:+e}function j(e,t){t=""+t,e.data!==t&&(e.data=t)}function y(e,t){(null!=t||e.value)&&(e.value=t)}function x(e,t,n,a){e.style.setProperty(t,n,a?"important":"")}function w(e,t){for(let n=0;n<e.options.length;n+=1){const a=e.options[n];if(a.__value===t)return void(a.selected=!0)}}function $(e){const t=e.querySelector(":checked")||e.options[0];return t&&t.__value}let O;function k(e){O=e}function q(e){(function(){if(!O)throw new Error("Function called outside component initialization");return O})().$$.on_mount.push(e)}function N(){const e=O;return(t,n)=>{const a=e.$$.callbacks[t];if(a){const l=function(e,t){const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!1,!1,t),n}(t,n);a.slice().forEach(t=>{t.call(e,l)})}}}const F=[],C=[],E=[],S=[],P=Promise.resolve();let M=!1;function z(e){E.push(e)}function L(e){S.push(e)}function T(){const e=new Set;do{for(;F.length;){const e=F.shift();k(e),I(e.$$)}for(;C.length;)C.pop()();for(let t=0;t<E.length;t+=1){const n=E[t];e.has(n)||(n(),e.add(n))}E.length=0}while(F.length);for(;S.length;)S.pop()();M=!1}function I(e){e.fragment&&(e.update(e.dirty),a(e.before_update),e.fragment.p(e.dirty,e.ctx),e.dirty=null,e.after_update.forEach(z))}const D=new Set;let R;function U(){R={r:0,c:[],p:R}}function H(){R.r||a(R.c),R=R.p}function A(e,t){e&&e.i&&(D.delete(e),e.i(t))}function Q(e,t,n,a){if(e&&e.o){if(D.has(e))return;D.add(e),R.c.push(()=>{D.delete(e),a&&(n&&e.d(1),a())}),e.o(t)}}const B="undefined"!=typeof window?window:global;function J(e,t,n){-1!==e.$$.props.indexOf(t)&&(e.$$.bound[t]=n,n(e.$$.ctx[t]))}function G(e,n,s){const{fragment:i,on_mount:r,on_destroy:c,after_update:o}=e.$$;i.m(n,s),z(()=>{const n=r.map(t).filter(l);c?c.push(...n):a(n),e.$$.on_mount=[]}),o.forEach(z)}function K(e,t){e.$$.fragment&&(a(e.$$.on_destroy),e.$$.fragment.d(t),e.$$.on_destroy=e.$$.fragment=null,e.$$.ctx={})}function V(e,t){e.$$.dirty||(F.push(e),M||(M=!0,P.then(T)),e.$$.dirty=n()),e.$$.dirty[t]=!0}function W(t,l,s,i,r,c){const o=O;k(t);const d=l.props||{},p=t.$$={fragment:null,ctx:null,props:c,update:e,not_equal:r,bound:n(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(o?o.$$.context:[]),callbacks:n(),dirty:null};let u=!1;var f;p.ctx=s?s(t,d,(e,n,a=n)=>(p.ctx&&r(p.ctx[e],p.ctx[e]=a)&&(p.bound[e]&&p.bound[e](a),u&&V(t,e)),n)):d,p.update(),u=!0,a(p.before_update),p.fragment=i(p.ctx),l.target&&(l.hydrate?p.fragment.l((f=l.target,Array.from(f.childNodes))):p.fragment.c(),l.intro&&A(t.$$.fragment),G(t,l.target,l.anchor),T()),k(o)}class X{$destroy(){K(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(){}}async function Y(e){const t=await fetch(e);return await t.json()}async function Z(e,t){const n=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});try{return await n.json()}catch(e){throw new Error(n.status)}}const ee=[];function te(t,n=e){let a;const l=[];function i(e){if(s(t,e)&&(t=e,a)){const e=!ee.length;for(let e=0;e<l.length;e+=1){const n=l[e];n[1](),ee.push(n,t)}if(e){for(let e=0;e<ee.length;e+=2)ee[e][0](ee[e+1]);ee.length=0}}}return{set:i,update:function(e){i(e(t))},subscribe:function(s,r=e){const c=[s,r];return l.push(c),1===l.length&&(a=n(i)||e),s(t),()=>{const e=l.indexOf(c);-1!==e&&l.splice(e,1),0===l.length&&(a(),a=null)}}}}const ne=te(!1),ae=te({}),le=te({});function se(e,t,n){const a=Object.create(e);return a.option=t[n],a.each_value_1=t,a.option_index_1=n,a}function ie(e,t,n){const a=Object.create(e);return a.option=t[n],a}function re(e){var t;let n=e.param.fields,a=[];for(let t=0;t<n.length;t+=1)a[t]=pe(se(e,n,t));return{c(){for(let e=0;e<a.length;e+=1)a[e].c();t=_()},m(e,n){for(let t=0;t<a.length;t+=1)a[t].m(e,n);d(e,t,n)},p(e,l){if(e.param){let s;for(n=l.param.fields,s=0;s<n.length;s+=1){const i=se(l,n,s);a[s]?a[s].p(e,i):(a[s]=pe(i),a[s].c(),a[s].m(t.parentNode,t))}for(;s<a.length;s+=1)a[s].d(1);a.length=n.length}},d(e){u(a,e),e&&p(t)}}}function ce(e){var t,n,l,s=!1;function i(){s=!0,e.input_input_handler_1.call(t)}return{c(){v(t=f("input"),"type","number"),v(t,"class","input"),v(t,"placeholder",n=e.param.placeholder),l=[g(t,"input",i),g(t,"change",e.edited)]},m(n,a){d(n,t,a),y(t,e.param.model)},p(e,a){!s&&e.param&&y(t,a.param.model),s=!1,e.param&&n!==(n=a.param.placeholder)&&v(t,"placeholder",n)},d(e){e&&p(t),a(l)}}}function oe(e){var t,n,l;return{c(){v(t=f("input"),"type","text"),v(t,"class","input"),v(t,"placeholder",n=e.param.placeholder),l=[g(t,"input",e.input_input_handler),g(t,"change",e.edited)]},m(n,a){d(n,t,a),y(t,e.param.model)},p(e,a){e.param&&t.value!==a.param.model&&y(t,a.param.model),e.param&&n!==(n=a.param.placeholder)&&v(t,"placeholder",n)},d(e){e&&p(t),a(l)}}}function de(e){var t,n,l,s;let i=e.param.fields,r=[];for(let t=0;t<i.length;t+=1)r[t]=ue(ie(e,i,t));return{c(){t=f("div"),n=f("select"),(l=f("option")).textContent="Please select one";for(let e=0;e<r.length;e+=1)r[e].c();l.disabled=!0,l.__value="",l.value=l.__value,void 0===e.param.model&&z(()=>e.select_change_handler.call(n)),v(t,"class","select"),s=[g(n,"change",e.select_change_handler),g(n,"change",e.edited)]},m(a,s){d(a,t,s),o(t,n),o(n,l);for(let e=0;e<r.length;e+=1)r[e].m(n,null);w(n,e.param.model)},p(e,t){if(e.param){let a;for(i=t.param.fields,a=0;a<i.length;a+=1){const l=ie(t,i,a);r[a]?r[a].p(e,l):(r[a]=ue(l),r[a].c(),r[a].m(n,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=i.length}e.param&&w(n,t.param.model)},d(e){e&&p(t),u(r,e),a(s)}}}function pe(e){var t,n,l,s,i,r=e.option.text+"";function c(){e.input_change_handler.call(n,e)}return{c(){t=f("div"),n=f("input"),l=m(r),s=h(),v(n,"type","checkbox"),v(t,"class","control"),i=[g(n,"change",c),g(n,"change",e.edited)]},m(a,i){d(a,t,i),o(t,n),n.checked=e.option.checked,o(t,l),o(t,s)},p(t,a){e=a,t.param&&(n.checked=e.option.checked),t.param&&r!==(r=e.option.text+"")&&j(l,r)},d(e){e&&p(t),a(i)}}}function ue(e){var t,n,a,l=e.option.text+"";return{c(){t=f("option"),n=m(l),t.__value=a=e.option.value,t.value=t.__value},m(e,a){d(e,t,a),o(t,n)},p(e,s){e.param&&l!==(l=s.option.text+"")&&j(n,l),e.param&&a!==(a=s.option.value)&&(t.__value=a),t.value=t.__value},d(e){e&&p(t)}}}function fe(t){var n,a,l,s,i,r=t.param.title+"";function c(e,t){return"select"===t.param.inputtype?de:"text"===t.param.inputtype?oe:"number"===t.param.inputtype?ce:"checkbox"===t.param.inputtype?re:void 0}var u=c(0,t),_=u&&u(t);return{c(){n=f("div"),a=f("label"),l=m(r),s=h(),i=f("div"),_&&_.c(),v(a,"class","label"),v(i,"class","control"),v(n,"class","field")},m(e,t){d(e,n,t),o(n,a),o(a,l),o(n,s),o(n,i),_&&_.m(i,null)},p(e,t){e.param&&r!==(r=t.param.title+"")&&j(l,r),u===(u=c(0,t))&&_?_.p(e,t):(_&&_.d(1),(_=u&&u(t))&&(_.c(),_.m(i,null)))},i:e,o:e,d(e){e&&p(n),_&&_.d()}}}function me(e,t,n){const a=N();let{param:l}=t;return e.$set=(e=>{"param"in e&&n("param",l=e.param)}),{param:l,edited:function(){a("edited")},select_change_handler:function(){l.model=$(this),n("param",l)},input_input_handler:function(){l.model=this.value,n("param",l)},input_input_handler_1:function(){l.model=b(this.value),n("param",l)},input_change_handler:function({option:e,each_value_1:t,option_index_1:a}){t[a].checked=this.checked,n("param",l)}}}class he extends X{constructor(e){super(),W(this,e,me,fe,s,["param"])}}function _e(e,t,n){const a=Object.create(e);return a.error=t[n],a}function ge(e){var t,n,a;let l=e.errors,s=[];for(let t=0;t<l.length;t+=1)s[t]=ve(_e(e,l,t));return{c(){t=f("div"),n=f("ul");for(let e=0;e<s.length;e+=1)s[e].c();v(t,"class",a=r(`notification is-danger ${e.cssclass}`)+" svelte-16a6jab")},m(e,a){d(e,t,a),o(t,n);for(let e=0;e<s.length;e+=1)s[e].m(n,null)},p(e,i){if(e.errors){let t;for(l=i.errors,t=0;t<l.length;t+=1){const a=_e(i,l,t);s[t]?s[t].p(e,a):(s[t]=ve(a),s[t].c(),s[t].m(n,null))}for(;t<s.length;t+=1)s[t].d(1);s.length=l.length}e.cssclass&&a!==(a=r(`notification is-danger ${i.cssclass}`)+" svelte-16a6jab")&&v(t,"class",a)},d(e){e&&p(t),u(s,e)}}}function ve(e){var t,n,a,l=e.error+"";return{c(){t=f("li"),n=m("â€¢ "),a=m(l)},m(e,l){d(e,t,l),o(t,n),o(t,a)},p(e,t){e.errors&&l!==(l=t.error+"")&&j(a,l)},d(e){e&&p(t)}}}function be(t){var n,a=t.errors.length&&ge(t);return{c(){a&&a.c(),n=_()},m(e,t){a&&a.m(e,t),d(e,n,t)},p(e,t){t.errors.length?a?a.p(e,t):((a=ge(t)).c(),a.m(n.parentNode,n)):a&&(a.d(1),a=null)},i:e,o:e,d(e){a&&a.d(e),e&&p(n)}}}function je(e,t,n){let{errors:a,cssclass:l=""}=t;return e.$set=(e=>{"errors"in e&&n("errors",a=e.errors),"cssclass"in e&&n("cssclass",l=e.cssclass)}),{errors:a,cssclass:l}}class ye extends X{constructor(e){super(),W(this,e,je,be,s,["errors","cssclass"])}}const{Object:xe}=B;function we(e,t,n){const a=xe.create(e);return a.param_id=t[n][0],a.param=t[n][1],a.each_value=t,a.each_index=n,a}function $e(e,t,n){const a=xe.create(e);return a.operator=t[n],a}function Oe(e){var t;return{c(){v(t=f("i"),"class","icon fas fa-edit")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function ke(e){var t;return{c(){v(t=f("i"),"class","icon fas fa-check-circle")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function qe(e){var t,n,a,l=e.operator.name+"";return{c(){t=f("option"),n=m(l),t.__value=a=e.operator.id,t.value=t.__value},m(e,a){d(e,t,a),o(t,n)},p(e,s){e.acqdata&&l!==(l=s.operator.name+"")&&j(n,l),e.acqdata&&a!==(a=s.operator.id)&&(t.__value=a),t.value=t.__value},d(e){e&&p(t)}}}function Ne(e){var t,n,l=!1;function s(){l=!0,e.input_input_handler.call(t)}return{c(){v(t=f("input"),"type","number"),v(t,"class","input"),v(t,"placeholder","in minutes"),n=[g(t,"input",s),g(t,"change",e.editMade)]},m(n,a){d(n,t,a),y(t,e.dsinfo.rp_length)},p(e,n){!l&&e.dsinfo&&y(t,n.dsinfo.rp_length),l=!1},d(e){e&&p(t),a(n)}}}function Fe(e){var t,n;function a(n){e.param_param_binding.call(null,n,e),t=!0,L(()=>t=!1)}let l={};void 0!==e.param&&(l.param=e.param);var s=new he({props:l});return C.push(()=>J(s,"param",a)),s.$on("edited",e.editMade),{c(){s.$$.fragment.c()},m(e,t){G(s,e,t),n=!0},p(n,a){e=a;var l={};(!t&&n.Object||n.dsinfo)&&(l.param=e.param),s.$set(l)},i(e){n||(A(s.$$.fragment,e),n=!0)},o(e){Q(s.$$.fragment,e),n=!1},d(e){K(s,e)}}}function Ce(e){var t,n,l,s,i,r,c,b,j,y,x,$,O,k,q,N,F,C,E,S,P,M,L,T,I,D,R,B,J;function V(e,t){return t.stored?ke:t.edited?Oe:void 0}var W=V(0,e),X=W&&W(e),Y=new ye({props:{errors:e.acquierrors}});let Z=e.acqdata.operators,ee=[];for(let t=0;t<Z.length;t+=1)ee[t]=qe($e(e,Z,t));var te=!e.dsinfo.dynamic_rp&&Ne(e);let ae=e.Object.entries(e.dsinfo.params),le=[];for(let t=0;t<ae.length;t+=1)le[t]=Fe(we(e,ae,t));const se=e=>Q(le[e],1,1,()=>{le[e]=null});return{c(){t=f("h5"),X&&X.c(),n=m("\n  Acquisition\n  "),l=f("button"),s=m("Save"),r=h(),c=f("button"),b=m("Revert"),y=h(),Y.$$.fragment.c(),x=h(),$=f("div"),(O=f("label")).textContent="Operator",k=h(),q=f("div"),N=f("div"),F=f("select"),(C=f("option")).textContent="Please select one";for(let e=0;e<ee.length;e+=1)ee[e].c();E=h(),S=f("div"),(P=f("label")).textContent="Reverse phase length",M=h(),L=f("div"),T=f("input"),I=m("Dynamic\n    "),te&&te.c(),D=h();for(let e=0;e<le.length;e+=1)le[e].c();R=_(),v(l,"class","button is-small is-danger has-text-weight-bold"),l.disabled=i=!e.edited||ne,v(c,"class","button is-small is-info has-text-weight-bold"),c.disabled=j=!e.edited,v(t,"class","has-text-primary title is-5"),v(O,"class","label"),C.disabled=!0,C.__value="",C.value=C.__value,void 0===e.dsinfo.operator_id&&z(()=>e.select_change_handler.call(F)),v(N,"class","select"),v(q,"class","control"),v($,"class","field"),v(P,"class","label"),v(T,"type","checkbox"),v(L,"class","control"),v(S,"class","field"),J=[g(l,"click",e.save),g(c,"click",e.fetchData),g(F,"change",e.select_change_handler),g(F,"change",e.editMade),g(T,"change",e.input_change_handler),g(T,"change",e.editMade)]},m(a,i){d(a,t,i),X&&X.m(t,null),o(t,n),o(t,l),o(l,s),o(t,r),o(t,c),o(c,b),d(a,y,i),G(Y,a,i),d(a,x,i),d(a,$,i),o($,O),o($,k),o($,q),o(q,N),o(N,F),o(F,C);for(let e=0;e<ee.length;e+=1)ee[e].m(F,null);w(F,e.dsinfo.operator_id),d(a,E,i),d(a,S,i),o(S,P),o(S,M),o(S,L),o(L,T),T.checked=e.dsinfo.dynamic_rp,o(L,I),te&&te.m(L,null),d(a,D,i);for(let e=0;e<le.length;e+=1)le[e].m(a,i);d(a,R,i),B=!0},p(e,a){W!==(W=V(0,a))&&(X&&X.d(1),(X=W&&W(a))&&(X.c(),X.m(t,n))),B&&!e.edited||i===(i=!a.edited||ne)||(l.disabled=i),B&&!e.edited||j===(j=!a.edited)||(c.disabled=j);var s={};if(e.acquierrors&&(s.errors=a.acquierrors),Y.$set(s),e.acqdata){let t;for(Z=a.acqdata.operators,t=0;t<Z.length;t+=1){const n=$e(a,Z,t);ee[t]?ee[t].p(e,n):(ee[t]=qe(n),ee[t].c(),ee[t].m(F,null))}for(;t<ee.length;t+=1)ee[t].d(1);ee.length=Z.length}if(e.dsinfo&&w(F,a.dsinfo.operator_id),e.dsinfo&&(T.checked=a.dsinfo.dynamic_rp),a.dsinfo.dynamic_rp?te&&(te.d(1),te=null):te?te.p(e,a):((te=Ne(a)).c(),te.m(L,null)),e.Object||e.dsinfo){let t;for(ae=a.Object.entries(a.dsinfo.params),t=0;t<ae.length;t+=1){const n=we(a,ae,t);le[t]?(le[t].p(e,n),A(le[t],1)):(le[t]=Fe(n),le[t].c(),A(le[t],1),le[t].m(R.parentNode,R))}for(U(),t=ae.length;t<le.length;t+=1)se(t);H()}},i(e){if(!B){A(Y.$$.fragment,e);for(let e=0;e<ae.length;e+=1)A(le[e]);B=!0}},o(e){Q(Y.$$.fragment,e),le=le.filter(Boolean);for(let e=0;e<le.length;e+=1)Q(le[e]);B=!1},d(e){e&&p(t),X&&X.d(),e&&p(y),K(Y,e),e&&(p(x),p($)),u(ee,e),e&&(p(E),p(S)),te&&te.d(),e&&p(D),u(le,e),e&&p(R),a(J)}}}function Ee(e,t,n){let a,{errors:l}=t,s=[],i={operator_id:"",dynamic_rp:!1,rp_length:"",params:[]},r={operators:[]},c=!1;function o(){let e=[];i.operator_id||e.push("Operator is required"),i.dynamic_rp||i.rp_length||e.push("Reverse phase is required");for(let t in i.params)i.params[t].model||e.push(i.params[t].title+" is required");return e}async function d(){let e="/datasets/show/acquisition/";e=ne?e+ne:e;const t=await Y(e);for(let[e,a]of Object.entries(t.acqdata))n("acqdata",r[e]=a,r);for(let[e,a]of Object.entries(t.dsinfo))n("dsinfo",i[e]=a,i);n("edited",c=!1)}return q(async()=>{d()}),e.$set=(e=>{"errors"in e&&n("errors",l=e.errors)}),e.$$.update=((e={edited:1})=>{e.edited&&n("stored",a=ne&&!c)}),{errors:l,acquierrors:s,dsinfo:i,acqdata:r,edited:c,editMade:function(){n("errors",l=l.length?o():[]),n("edited",c=!0)},validate:o,save:async function(){if(n("errors",l=o()),0===l.length){let e={dataset_id:ne,operator_id:i.operator_id,params:i.params,rp_length:i.dynamic_rp?"":i.rp_length},t="/datasets/save/acquisition/";try{await Z(t,e),d()}catch(e){"404"===e.message&&n("acquierrors",s=[...s,"Save dataset before saving acquisition"])}}},fetchData:d,stored:a,Object:Object,select_change_handler:function(){i.operator_id=$(this),n("dsinfo",i),n("acqdata",r)},input_change_handler:function(){i.dynamic_rp=this.checked,n("dsinfo",i),n("acqdata",r)},input_input_handler:function(){i.rp_length=b(this.value),n("dsinfo",i),n("acqdata",r)},param_param_binding:function(e,{param:t,each_value:a,each_index:l}){a[l][1]=e,n("Object",Object)}}}class Se extends X{constructor(e){super(),W(this,e,Ee,Ce,s,["errors","validate","save"])}get validate(){return this.$$.ctx.validate}get save(){return this.$$.ctx.save}}const{Object:Pe}=B;function Me(e,t,n){const a=Pe.create(e);return a.optid=t[n],a}function ze(e){var t,n,a,l=!e.Object.keys(e.options).length,s=l&&Le();let i=e.optorder,r=[];for(let t=0;t<i.length;t+=1)r[t]=Te(Me(e,i,t));return{c(){t=f("div"),n=f("select"),s&&s.c(),a=_();for(let e=0;e<r.length;e+=1)r[e].c();n.multiple=!0,v(t,"class","select is-multiple")},m(e,l){d(e,t,l),o(t,n),s&&s.m(n,null),o(n,a);for(let e=0;e<r.length;e+=1)r[e].m(n,null)},p(e,t){if(e.options&&(l=!t.Object.keys(t.options).length),l?s||((s=Le()).c(),s.m(n,a)):s&&(s.d(1),s=null),e.optorder||e.niceName||e.options){let a;for(i=t.optorder,a=0;a<i.length;a+=1){const l=Me(t,i,a);r[a]?r[a].p(e,l):(r[a]=Te(l),r[a].c(),r[a].m(n,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=i.length}},d(e){e&&p(t),s&&s.d(),u(r,e)}}}function Le(e){var t;return{c(){(t=f("option")).textContent="Type more or type less...",t.disabled=!0,t.__value="Type more or type less...",t.value=t.__value},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function Te(e){var t,n,l,s,i=e.niceName(e.options[e.optid])+"";return{c(){t=f("option"),n=m(i),t.__value=l=e.optid,t.value=t.__value,s=[g(t,"mousedown",e.mousedown_handler),g(t,"mouseout",e.mouseout_handler),g(t,"mouseover",e.mouseover_handler)]},m(e,a){d(e,t,a),o(t,n)},p(e,a){(e.niceName||e.options||e.optorder)&&i!==(i=a.niceName(a.options[a.optid])+"")&&j(n,i),e.optorder&&l!==(l=a.optid)&&(t.__value=l),t.value=t.__value},d(e){e&&p(t),a(s)}}}function Ie(t){var n,l,s,i,r,c,u=t.typing&&ze(t);return{c(){n=f("div"),l=f("input"),s=h(),(i=f("span")).innerHTML='<i class="fas fa-chevron-down"></i>',r=h(),u&&u.c(),v(l,"type","text"),v(l,"class","input is-narrow"),v(l,"placeholder",t.placeholder),v(i,"class","icon is-right"),v(n,"class","control has-icons-right"),c=[g(l,"input",t.input_input_handler),g(l,"keyup",t.fetchOptions),g(l,"focus",t.starttyping),g(l,"blur",t.inputdone)]},m(e,a){d(e,n,a),o(n,l),y(l,t.intext),o(n,s),o(n,i),o(n,r),u&&u.m(n,null)},p(e,t){e.intext&&l.value!==t.intext&&y(l,t.intext),e.placeholder&&v(l,"placeholder",t.placeholder),t.typing?u?u.p(e,t):((u=ze(t)).c(),u.m(n,null)):u&&(u.d(1),u=null)},i:e,o:e,d(e){e&&p(n),u&&u.d(),a(c)}}}function De(e,t,n){const a=N();let{selectval:l="",fixedoptions:s={},fixedorder:i=[],options:r=Object.fromEntries(Object.entries(s)),intext:c,fetchUrl:o=!1,niceName:d=function(e){return e}}=t,{unknowninput:p="__PLACEHOLDER__",optorder:u=(i.length?i:Object.keys(r))}=t,f="Filter by typing",m=!1;function h(e){e.target.selected=!1,n("intext",c=""),n("placeholder",f=l?d(l):"")}function _(e){n("selectval",l=r[e.target.value].id),n("unknowninput",p=""),a("selectedvalue")}function g(e){e.target.selected=!0;const t=r[e.target.value];n("intext",c=d(t))}return e.$set=(e=>{"selectval"in e&&n("selectval",l=e.selectval),"fixedoptions"in e&&n("fixedoptions",s=e.fixedoptions),"fixedorder"in e&&n("fixedorder",i=e.fixedorder),"options"in e&&n("options",r=e.options),"intext"in e&&n("intext",c=e.intext),"fetchUrl"in e&&n("fetchUrl",o=e.fetchUrl),"niceName"in e&&n("niceName",d=e.niceName),"unknowninput"in e&&n("unknowninput",p=e.unknowninput),"optorder"in e&&n("optorder",u=e.optorder)}),{selectval:l,fixedoptions:s,fixedorder:i,options:r,intext:c,fetchUrl:o,niceName:d,unknowninput:p,optorder:u,placeholder:f,typing:m,inputdone:function(){n("typing",m=!1),l&&l in r?n("intext",c=d(r[l])):"__PLACEHOLDER__"===p?(console.log("illegal value"),a("illegalvalue")):(console.log("new value"),n("unknowninput",p=c),a("newvalue"))},deselect:h,selectvalue:_,hovervalue:g,fetchOptions:async function(){if(c.length>2&&o)n("options",r=await Y(`${o}?q=${c}`)),n("optorder",u=Object.keys(r));else if(!o&&s){n("options",r=Object.fromEntries(Object.entries(s).filter(e=>e[1].name.toLowerCase().indexOf(c.toLowerCase())>-1)));const e=Object.keys(r);n("optorder",u=i.length?i.filter(t=>e.indexOf(t.toString())>-1):e)}},starttyping:function(){const e=Object.keys(r);n("optorder",u=i.length?i:e),n("options",r=i.length?s:r),n("typing",m=!0),n("placeholder",f=l?d(l):""),n("selectval",l=""),n("intext",c="")},Object:Object,input_input_handler:function(){c=this.value,n("intext",c)},mousedown_handler:e=>_(e),mouseout_handler:e=>h(e),mouseover_handler:e=>g(e)}}class Re extends X{constructor(e){super(),W(this,e,De,Ie,s,["selectval","fixedoptions","fixedorder","options","intext","fetchUrl","niceName","unknowninput","optorder"])}}const{Object:Ue}=B;function He(e,t,n){const a=Ue.create(e);return a.s_id=t[n][0],a.sample=t[n][1],a}function Ae(e,t,n){const a=Ue.create(e);return a.s_id=t[n][0],a.sample=t[n][1],a}function Qe(e,t,n){const a=Ue.create(e);return a.file=t[n],a}function Be(e,t,n){const a=Ue.create(e);return a.s_id=t[n][0],a.sample=t[n][1],a}function Je(e,t,n){const a=Ue.create(e);return a.channel=t[n],a.each_value=t,a.chix=n,a}function Ge(e,t,n){const a=Ue.create(e);return a.quant=t[n],a}function Ke(e,t,n){const a=Ue.create(e);return a.param_id=t[n][0],a.param=t[n][1],a.each_value_6=t,a.each_index_3=n,a}function Ve(e,t,n){const a=Ue.create(e);return a.enzyme=t[n],a.each_value_7=t,a.enzyme_index=n,a}function We(e,t,n){const a=Ue.create(e);return a.spec=t[n],a}function Xe(e){var t;return{c(){v(t=f("i"),"class","icon fas fa-edit")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function Ye(e){var t;return{c(){v(t=f("i"),"class","icon fas fa-check-circle")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function Ze(e){var t,n,a,l,s,i,r=jt(e.spec)+"";function c(...t){return e.click_handler(e,...t)}return{c(){t=f("span"),n=m(r),a=h(),l=f("button"),s=h(),v(l,"class","delete is-small"),v(t,"class","tag is-medium is-info"),i=g(l,"click",c)},m(e,i){d(e,t,i),o(t,n),o(t,a),o(t,l),o(t,s)},p(t,a){e=a,t.prepdata&&r!==(r=jt(e.spec)+"")&&j(n,r)},d(e){e&&p(t),i()}}}function et(e){var t;let n=e.prepdata.enzymes,a=[];for(let t=0;t<n.length;t+=1)a[t]=tt(Ve(e,n,t));return{c(){for(let e=0;e<a.length;e+=1)a[e].c();t=_()},m(e,n){for(let t=0;t<a.length;t+=1)a[t].m(e,n);d(e,t,n)},p(e,l){if(e.prepdata){let s;for(n=l.prepdata.enzymes,s=0;s<n.length;s+=1){const i=Ve(l,n,s);a[s]?a[s].p(e,i):(a[s]=tt(i),a[s].c(),a[s].m(t.parentNode,t))}for(;s<a.length;s+=1)a[s].d(1);a.length=n.length}},d(e){u(a,e),e&&p(t)}}}function tt(e){var t,n,l,s,i,r=e.enzyme.name+"";function c(){e.input_change_handler_1.call(n,e)}return{c(){t=f("div"),n=f("input"),l=m(r),s=h(),v(n,"type","checkbox"),v(t,"class","control"),i=[g(n,"change",c),g(n,"change",e.editMade)]},m(a,i){d(a,t,i),o(t,n),n.checked=e.enzyme.checked,o(t,l),o(t,s)},p(t,a){e=a,t.prepdata&&(n.checked=e.enzyme.checked),t.prepdata&&r!==(r=e.enzyme.name+"")&&j(l,r)},d(e){e&&p(t),a(i)}}}function nt(e){var t,n;function a(n){e.param_param_binding.call(null,n,e),t=!0,L(()=>t=!1)}let l={};void 0!==e.param&&(l.param=e.param);var s=new he({props:l});return C.push(()=>J(s,"param",a)),s.$on("edited",e.editMade),{c(){s.$$.fragment.c()},m(e,t){G(s,e,t),n=!0},p(n,a){e=a;var l={};(!t&&n.Object||n.prepdata)&&(l.param=e.param),s.$set(l)},i(e){n||(A(s.$$.fragment,e),n=!0)},o(e){Q(s.$$.fragment,e),n=!1},d(e){K(s,e)}}}function at(e){var t,n,a,l=e.quant.name+"";return{c(){t=f("option"),n=m(l),t.__value=a=e.quant.id,t.value=t.__value},m(e,a){d(e,t,a),o(t,n)},p(e,s){(e.Object||e.prepdata)&&l!==(l=s.quant.name+"")&&j(n,l),(e.Object||e.prepdata)&&a!==(a=s.quant.id)&&(t.__value=a),t.value=t.__value},d(e){e&&p(t)}}}function lt(e){var t,n,l,s,i,r,c,u,_,b,j,x,w,$,O,k,q,N,F,C=e.isLabelfree&&st(e);function E(e,t){return t.isLabelfree&&t.prepdata.labelfree_multisample?rt:t.isLabelfree?void 0:it}var S=E(0,e),P=S&&S(e);function M(e,t){return t.foundNewSamples?ot:ct}var z=M(0,e),L=z(e);function T(e,t){return t.isLabelfree?t.isLabelfree&&t.prepdata.labelfree_multisample?pt:((null==N||e.isLabelfree||e.Object)&&(N=!(!t.isLabelfree||!t.Object.keys(ae).length)),N?dt:void 0):ut}var I=T(null,e),D=I&&I(e);return{c(){t=f("div"),(n=f("label")).textContent="Samples",l=h(),s=f("textarea"),i=h(),(r=f("a")).textContent="Parse sample names",c=h(),u=f("div"),C&&C.c(),_=h(),b=f("table"),j=f("thead"),x=f("tr"),P&&P.c(),w=h(),$=f("th"),O=m("Sample name \n        "),L.c(),k=h(),q=f("tbody"),D&&D.c(),v(n,"class","label"),v(s,"class","textarea"),v(s,"placeholder","Try this: paste your sample names here (one line per sample, tab separated sample/file or channel)"),v(r,"class","button is-primary"),v(u,"class","control"),v(t,"class","field"),v($,"colspan","2"),v(b,"class","table is-fullwidth"),F=[g(s,"input",e.textarea_input_handler),g(r,"click",e.parseSampleNames)]},m(a,p){d(a,t,p),o(t,n),o(t,l),o(t,s),y(s,e.trysamplenames),o(t,i),o(t,r),o(t,c),o(t,u),C&&C.m(u,null),d(a,_,p),d(a,b,p),o(b,j),o(j,x),P&&P.m(x,null),o(x,w),o(x,$),o($,O),L.m($,null),o(b,k),o(b,q),D&&D.m(q,null)},p(e,t){e.trysamplenames&&y(s,t.trysamplenames),t.isLabelfree?C?C.p(e,t):((C=st(t)).c(),C.m(u,null)):C&&(C.d(1),C=null),S!==(S=E(0,t))&&(P&&P.d(1),(P=S&&S(t))&&(P.c(),P.m(x,w))),z!==(z=M(0,t))&&(L.d(1),(L=z(t))&&(L.c(),L.m($,null))),I===(I=T(e,t))&&D?D.p(e,t):(D&&D.d(1),(D=I&&I(t))&&(D.c(),D.m(q,null)))},d(e){e&&p(t),C&&C.d(),e&&(p(_),p(b)),P&&P.d(),L.d(),D&&D.d(),a(F)}}}function st(e){var t,n,l,s;return{c(){t=f("div"),n=f("input"),l=m("One sample per file?"),v(n,"type","checkbox"),v(t,"id","labelfree_samples"),s=[g(n,"change",e.input_change_handler_2),g(n,"change",e.checkIfNewSamples)]},m(a,s){d(a,t,s),o(t,n),n.checked=e.prepdata.labelfree_multisample,o(t,l)},p(e,t){e.prepdata&&(n.checked=t.prepdata.labelfree_multisample)},d(e){e&&p(t),a(s)}}}function it(e){var t;return{c(){(t=f("th")).textContent="Channel"},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function rt(e){var t;return{c(){(t=f("th")).textContent="Filename"},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function ct(e){var t;return{c(){(t=f("a")).textContent="Save new samples",v(t,"class","button is-danger is-small is-pulled-right"),v(t,"disabled","")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function ot(e){var t,n;return{c(){(t=f("a")).textContent="Save new samples",v(t,"class","button is-danger is-small is-pulled-right"),n=g(t,"click",e.saveNewSamples)},m(e,n){d(e,t,n)},d(e){e&&p(t),n()}}}function dt(e){var t,n,l,s,i,r,c,m,_;let b=e.Object.entries(le),j=[];for(let t=0;t<b.length;t+=1)j[t]=ft(He(e,b,t));return{c(){t=f("tr"),n=f("td"),l=f("div"),s=f("select"),(i=f("option")).textContent="Pick a project-sample";for(let e=0;e<j.length;e+=1)j[e].c();r=h(),c=f("td"),m=f("input"),i.disabled=!0,i.__value="",i.value=i.__value,void 0===e.prepdata.labelfree_singlesample.model&&z(()=>e.select_change_handler_3.call(s)),v(l,"class","select"),v(m,"placeholder","or define a new sample"),v(m,"class","input is-normal"),_=[g(s,"change",e.select_change_handler_3),g(s,"change",e.change_handler_4),g(m,"input",e.input_input_handler_2),g(m,"change",e.change_handler_5)]},m(a,p){d(a,t,p),o(t,n),o(n,l),o(l,s),o(s,i);for(let e=0;e<j.length;e+=1)j[e].m(s,null);w(s,e.prepdata.labelfree_singlesample.model),o(t,r),o(t,c),o(c,m),y(m,e.prepdata.labelfree_singlesample.newprojsample)},p(e,t){if(e.Object||e.projsamples){let n;for(b=t.Object.entries(le),n=0;n<b.length;n+=1){const a=He(t,b,n);j[n]?j[n].p(e,a):(j[n]=ft(a),j[n].c(),j[n].m(s,null))}for(;n<j.length;n+=1)j[n].d(1);j.length=b.length}e.prepdata&&w(s,t.prepdata.labelfree_singlesample.model),e.prepdata&&m.value!==t.prepdata.labelfree_singlesample.newprojsample&&y(m,t.prepdata.labelfree_singlesample.newprojsample)},d(e){e&&p(t),u(j,e),a(_)}}}function pt(e){var t;let n=e.Object.values(ae),a=[];for(let t=0;t<n.length;t+=1)a[t]=ht(Qe(e,n,t));return{c(){for(let e=0;e<a.length;e+=1)a[e].c();t=_()},m(e,n){for(let t=0;t<a.length;t+=1)a[t].m(e,n);d(e,t,n)},p(e,l){if(e.prepdata||e.Object||e.datasetFiles||e.projsamples){let s;for(n=l.Object.values(ae),s=0;s<n.length;s+=1){const i=Qe(l,n,s);a[s]?a[s].p(e,i):(a[s]=ht(i),a[s].c(),a[s].m(t.parentNode,t))}for(;s<a.length;s+=1)a[s].d(1);a.length=n.length}},d(e){u(a,e),e&&p(t)}}}function ut(e){var t;let n=e.prepdata.quants[e.prepdata.quanttype].chans,a=[];for(let t=0;t<n.length;t+=1)a[t]=vt(Je(e,n,t));return{c(){for(let e=0;e<a.length;e+=1)a[e].c();t=_()},m(e,n){for(let t=0;t<a.length;t+=1)a[t].m(e,n);d(e,t,n)},p(e,l){if(e.prepdata||e.foundNewSamples||e.Object||e.projsamples){let s;for(n=l.prepdata.quants[l.prepdata.quanttype].chans,s=0;s<n.length;s+=1){const i=Je(l,n,s);a[s]?a[s].p(e,i):(a[s]=vt(i),a[s].c(),a[s].m(t.parentNode,t))}for(;s<a.length;s+=1)a[s].d(1);a.length=n.length}},d(e){u(a,e),e&&p(t)}}}function ft(e){var t,n,a,l=e.sample.name+"";return{c(){t=f("option"),n=m(l),t.__value=a=e.s_id,t.value=t.__value},m(e,a){d(e,t,a),o(t,n)},p(e,s){(e.Object||e.projsamples)&&l!==(l=s.sample.name+"")&&j(n,l),(e.Object||e.projsamples)&&a!==(a=s.s_id)&&(t.__value=a),t.value=t.__value},d(e){e&&p(t)}}}function mt(e){var t,n,a,l=e.sample.name+"";return{c(){t=f("option"),n=m(l),t.__value=a=e.s_id,t.value=t.__value},m(e,a){d(e,t,a),o(t,n)},p(e,s){(e.Object||e.projsamples)&&l!==(l=s.sample.name+"")&&j(n,l),(e.Object||e.projsamples)&&a!==(a=s.s_id)&&(t.__value=a),t.value=t.__value},d(e){e&&p(t)}}}function ht(e){var t,n,l,s,i,r,c,_,b,x,$,O,k,q=e.file.name+"";let N=e.Object.entries(le),F=[];for(let t=0;t<N.length;t+=1)F[t]=mt(Ae(e,N,t));function C(){e.select_change_handler_2.call(c,e)}function E(...t){return e.change_handler_2(e,...t)}function S(){e.input_input_handler_1.call($,e)}function P(...t){return e.change_handler_3(e,...t)}return{c(){t=f("tr"),n=f("td"),l=m(q),s=h(),i=f("td"),r=f("div"),c=f("select"),(_=f("option")).textContent="Pick a project-sample";for(let e=0;e<F.length;e+=1)F[e].c();b=h(),x=f("td"),$=f("input"),O=h(),_.disabled=!0,_.__value="",_.value=_.__value,void 0===e.prepdata.samples[e.file.associd].model&&z(C),v(r,"class","select"),v($,"placeholder","or define a new sample"),v($,"class","input is-normal"),k=[g(c,"change",C),g(c,"change",E),g($,"input",S),g($,"change",P)]},m(a,p){d(a,t,p),o(t,n),o(n,l),o(t,s),o(t,i),o(i,r),o(r,c),o(c,_);for(let e=0;e<F.length;e+=1)F[e].m(c,null);w(c,e.prepdata.samples[e.file.associd].model),o(t,b),o(t,x),o(x,$),y($,e.prepdata.samples[e.file.associd].newprojsample),o(t,O)},p(t,n){if(e=n,t.Object&&q!==(q=e.file.name+"")&&j(l,q),t.Object||t.projsamples){let n;for(N=e.Object.entries(le),n=0;n<N.length;n+=1){const a=Ae(e,N,n);F[n]?F[n].p(t,a):(F[n]=mt(a),F[n].c(),F[n].m(c,null))}for(;n<F.length;n+=1)F[n].d(1);F.length=N.length}(t.prepdata||t.Object||t.datasetFiles)&&w(c,e.prepdata.samples[e.file.associd].model),(t.prepdata||t.Object||t.datasetFiles)&&$.value!==e.prepdata.samples[e.file.associd].newprojsample&&y($,e.prepdata.samples[e.file.associd].newprojsample)},d(e){e&&p(t),u(F,e),a(k)}}}function _t(e){var t,n,a,l=e.sample.name+"";return{c(){t=f("option"),n=m(l),t.__value=a=e.s_id,t.value=t.__value},m(e,a){d(e,t,a),o(t,n)},p(e,s){(e.Object||e.projsamples)&&l!==(l=s.sample.name+"")&&j(n,l),(e.Object||e.projsamples)&&a!==(a=s.s_id)&&(t.__value=a),t.value=t.__value},d(e){e&&p(t)}}}function gt(e){var t;return{c(){(t=f("span")).innerHTML='<i class="fas fa-asterisk"></i>',v(t,"class","icon is-left has-text-danger")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function vt(e){var t,n,l,s,i,r,c,_,b,x,$,O,k,q,N,F,C=e.channel.name+"";let E=e.Object.entries(le),S=[];for(let t=0;t<E.length;t+=1)S[t]=_t(Be(e,E,t));function P(){e.select_change_handler_1.call(c,e)}function M(...t){return e.change_handler(e,...t)}function L(){e.input_input_handler.call(O,e)}function T(...t){return e.change_handler_1(e,...t)}var I=e.foundNewSamples&&e.channel.newprojsample&&gt();return{c(){t=f("tr"),n=f("td"),l=m(C),s=h(),i=f("td"),r=f("div"),c=f("select"),(_=f("option")).textContent="Pick a project-sample";for(let e=0;e<S.length;e+=1)S[e].c();b=h(),x=f("td"),$=f("p"),O=f("input"),k=h(),I&&I.c(),N=h(),_.disabled=!0,_.__value="",_.value=_.__value,void 0===e.channel.model&&z(P),v(r,"class","select"),v(O,"class","input is-normal"),v(O,"placeholder","or define a new sample"),v($,"class",q=e.channel.newprojsample&&e.foundNewSamples?"control has-icons-left":"control"),F=[g(c,"change",P),g(c,"change",M),g(O,"input",L),g(O,"change",T)]},m(a,p){d(a,t,p),o(t,n),o(n,l),o(t,s),o(t,i),o(i,r),o(r,c),o(c,_);for(let e=0;e<S.length;e+=1)S[e].m(c,null);w(c,e.channel.model),o(t,b),o(t,x),o(x,$),o($,O),y(O,e.channel.newprojsample),o($,k),I&&I.m($,null),o(t,N)},p(t,n){if(e=n,t.prepdata&&C!==(C=e.channel.name+"")&&j(l,C),t.Object||t.projsamples){let n;for(E=e.Object.entries(le),n=0;n<E.length;n+=1){const a=Be(e,E,n);S[n]?S[n].p(t,a):(S[n]=_t(a),S[n].c(),S[n].m(c,null))}for(;n<S.length;n+=1)S[n].d(1);S.length=E.length}t.prepdata&&w(c,e.channel.model),t.prepdata&&O.value!==e.channel.newprojsample&&y(O,e.channel.newprojsample),e.foundNewSamples&&e.channel.newprojsample?I||((I=gt()).c(),I.m($,null)):I&&(I.d(1),I=null),(t.prepdata||t.foundNewSamples)&&q!==(q=e.channel.newprojsample&&e.foundNewSamples?"control has-icons-left":"control")&&v($,"class",q)},d(e){e&&p(t),u(S,e),I&&I.d(),a(F)}}}function bt(e){var t,n,l,s,i,r,c,b,j,y,x,$,O,k,q,N,F,E,S,P,M,T,I,D,R,B,V,W,X,Y,Z,ee,te,ne,ae,le,se;function ie(e,t){return t.stored?Ye:t.edited?Xe:void 0}var re=ie(0,e),ce=re&&re(e),oe=new ye({props:{errors:e.preperrors}});function de(t){e.dynamicselect_options_binding.call(null,t),q=!0,L(()=>q=!1)}function pe(t){e.dynamicselect_selectval_binding.call(null,t),N=!0,L(()=>N=!1)}let ue={intext:"Type to get more organisms",optorder:e.Object.keys(e.prepdata.allspecies),fetchUrl:"/datasets/show/species/",niceName:jt};void 0!==e.prepdata.allspecies&&(ue.options=e.prepdata.allspecies),void 0!==e.selectedspecies&&(ue.selectval=e.selectedspecies);var fe=new Re({props:ue});C.push(()=>J(fe,"options",de)),C.push(()=>J(fe,"selectval",pe)),fe.$on("selectedvalue",e.addOrganism);let me=e.prepdata.species,he=[];for(let t=0;t<me.length;t+=1)he[t]=Ze(We(e,me,t));var _e=!e.prepdata.no_enzyme&&et(e);let ge=e.Object.entries(e.prepdata.params),ve=[];for(let t=0;t<ge.length;t+=1)ve[t]=nt(Ke(e,ge,t));const be=e=>Q(ve[e],1,1,()=>{ve[e]=null});let je=e.Object.values(e.prepdata.quants),xe=[];for(let t=0;t<je.length;t+=1)xe[t]=at(Ge(e,je,t));var we=e.prepdata.quanttype&&lt(e);return{c(){t=f("h5"),ce&&ce.c(),n=m("\n  Sample prep\n  "),l=f("button"),s=m("Save"),r=h(),c=f("button"),b=m("Revert"),y=h(),oe.$$.fragment.c(),x=h(),$=f("div"),(O=f("label")).textContent="Organism",k=h(),fe.$$.fragment.c(),F=h(),E=f("div");for(let e=0;e<he.length;e+=1)he[e].c();S=h(),P=f("div"),(M=f("label")).textContent="Enzymes",T=h(),I=f("input"),D=m("No enzyme\n  "),_e&&_e.c(),R=h();for(let e=0;e<ve.length;e+=1)ve[e].c();B=h(),V=f("div"),(W=f("label")).textContent="Quant type",X=h(),Y=f("div"),Z=f("div"),ee=f("select"),(te=f("option")).textContent="Please select one";for(let e=0;e<xe.length;e+=1)xe[e].c();ne=h(),we&&we.c(),ae=_(),v(l,"class","button is-small is-danger has-text-weight-bold"),l.disabled=i=!e.edited,v(c,"class","button is-small is-info has-text-weight-bold"),c.disabled=j=!e.edited,v(t,"id","sampleprep"),v(t,"class","has-text-primary title is-5"),v(O,"class","label"),v($,"class","field"),v(E,"class","tags"),v(M,"class","label"),v(I,"type","checkbox"),v(P,"class","field"),v(W,"class","label"),te.disabled=!0,te.__value="",te.value=te.__value,void 0===e.prepdata.quanttype&&z(()=>e.select_change_handler.call(ee)),v(Z,"class","select"),v(Y,"class","control"),v(V,"class","field"),se=[g(l,"click",e.save),g(c,"click",e.fetchData),g(I,"change",e.input_change_handler),g(I,"change",e.editMade),g(ee,"change",e.select_change_handler),g(ee,"change",e.checkIfNewSamples)]},m(a,i){d(a,t,i),ce&&ce.m(t,null),o(t,n),o(t,l),o(l,s),o(t,r),o(t,c),o(c,b),d(a,y,i),G(oe,a,i),d(a,x,i),d(a,$,i),o($,O),o($,k),G(fe,$,null),d(a,F,i),d(a,E,i);for(let e=0;e<he.length;e+=1)he[e].m(E,null);d(a,S,i),d(a,P,i),o(P,M),o(P,T),o(P,I),I.checked=e.prepdata.no_enzyme,o(P,D),_e&&_e.m(P,null),d(a,R,i);for(let e=0;e<ve.length;e+=1)ve[e].m(a,i);d(a,B,i),d(a,V,i),o(V,W),o(V,X),o(V,Y),o(Y,Z),o(Z,ee),o(ee,te);for(let e=0;e<xe.length;e+=1)xe[e].m(ee,null);w(ee,e.prepdata.quanttype),d(a,ne,i),we&&we.m(a,i),d(a,ae,i),le=!0},p(e,a){re!==(re=ie(0,a))&&(ce&&ce.d(1),(ce=re&&re(a))&&(ce.c(),ce.m(t,n))),le&&!e.edited||i===(i=!a.edited)||(l.disabled=i),le&&!e.edited||j===(j=!a.edited)||(c.disabled=j);var s={};e.preperrors&&(s.errors=a.preperrors),oe.$set(s);var r={};if((e.Object||e.prepdata)&&(r.optorder=a.Object.keys(a.prepdata.allspecies)),!q&&e.prepdata&&(r.options=a.prepdata.allspecies),!N&&e.selectedspecies&&(r.selectval=a.selectedspecies),fe.$set(r),e.niceSpecies||e.prepdata){let t;for(me=a.prepdata.species,t=0;t<me.length;t+=1){const n=We(a,me,t);he[t]?he[t].p(e,n):(he[t]=Ze(n),he[t].c(),he[t].m(E,null))}for(;t<he.length;t+=1)he[t].d(1);he.length=me.length}if(e.prepdata&&(I.checked=a.prepdata.no_enzyme),a.prepdata.no_enzyme?_e&&(_e.d(1),_e=null):_e?_e.p(e,a):((_e=et(a)).c(),_e.m(P,null)),e.Object||e.prepdata){let t;for(ge=a.Object.entries(a.prepdata.params),t=0;t<ge.length;t+=1){const n=Ke(a,ge,t);ve[t]?(ve[t].p(e,n),A(ve[t],1)):(ve[t]=nt(n),ve[t].c(),A(ve[t],1),ve[t].m(B.parentNode,B))}for(U(),t=ge.length;t<ve.length;t+=1)be(t);H()}if(e.Object||e.prepdata){let t;for(je=a.Object.values(a.prepdata.quants),t=0;t<je.length;t+=1){const n=Ge(a,je,t);xe[t]?xe[t].p(e,n):(xe[t]=at(n),xe[t].c(),xe[t].m(ee,null))}for(;t<xe.length;t+=1)xe[t].d(1);xe.length=je.length}e.prepdata&&w(ee,a.prepdata.quanttype),a.prepdata.quanttype?we?we.p(e,a):((we=lt(a)).c(),we.m(ae.parentNode,ae)):we&&(we.d(1),we=null)},i(e){if(!le){A(oe.$$.fragment,e),A(fe.$$.fragment,e);for(let e=0;e<ge.length;e+=1)A(ve[e]);le=!0}},o(e){Q(oe.$$.fragment,e),Q(fe.$$.fragment,e),ve=ve.filter(Boolean);for(let e=0;e<ve.length;e+=1)Q(ve[e]);le=!1},d(e){e&&p(t),ce&&ce.d(),e&&p(y),K(oe,e),e&&(p(x),p($)),K(fe),e&&(p(F),p(E)),u(he,e),e&&(p(S),p(P)),_e&&_e.d(),e&&p(R),u(ve,e),e&&(p(B),p(V)),u(xe,e),e&&p(ne),we&&we.d(e),e&&p(ae),a(se)}}}function jt(e){let t;return t=e.name?`${e.name}, ${e.linnean}`:`${e.linnean}`}function yt(e,t,n){let{errors:a}=t,l=[],s=!1;function i(){n("errors",a=a.length?v():[]),n("edited",s=!0)}let r,c,o={params:[],enzymes:[],no_enzyme:!1,quanttype:"",quants:{},labelfree_multisample:!0,labelfree_singlesample:{},allspecies:[],species:[],samples:{}},d="",p=!1;function u(e){n("prepdata",o.species=o.species.filter(t=>t.id!==e),o),i()}function f(){o.quanttype!==c?n("foundNewSamples",p=o.quants[o.quanttype].chans.some(e=>""!==e.newprojsample)):o.labelfree_multisample?n("foundNewSamples",p=Object.values(o.samples).some(e=>""!==e.newprojsample)):n("foundNewSamples",p=""!==o.labelfree_singlesample.newprojsample)}function m(e=!1){let t;if(""!=(t=o.labelfree_multisample?o.samples[e].newprojsample:o.labelfree_singlesample.newprojsample)){let a=t.trim().toUpperCase(),l=Object.entries(le).filter(e=>e[1].toUpperCase()==a).map(e=>e[0])[0];l&&!o.labelfree_multisample?(n("prepdata",o.labelfree_singlesample.model=l,o),n("prepdata",o.labelfree_singlesample.newprojsample="",o)):l&&(n("prepdata",o.samples[e].model=l,o),n("prepdata",o.samples[e].newprojsample="",o)),f()}}function h(e){if(""!=o.quants[o.quanttype].chans[e].newprojsample){let t=o.quants[o.quanttype].chans[e].newprojsample.trim().toUpperCase(),a=Object.entries(le).filter(e=>e[1].toUpperCase()==t).map(e=>e[0])[0];a&&(n("prepdata",o.quants[o.quanttype].chans[e].model=a,o),n("prepdata",o.quants[o.quanttype].chans[e].newprojsample="",o)),f()}}function _(e){e.newprojsample="",f(),i()}async function g(e,t){let a={dataset_id:ne,samplename:e.newprojsample};try{await Z("/datasets/save/projsample/",a)}catch(e){return void("404"===e.message&&n("preperrors",l=[l,"Save dataset before saving new samples"]))}return le[response.psid]=response.psname,[response.psid,t]}function v(){let e=[];if(o.no_enzyme||o.enzymes.filter.length||e.push("Enzyme selection is required"),o.quanttype||e.push("Quant type selection is required"),y){for(let t of Object.values(ae))if(!o.samples[t.associd].model&&!o.samples[t.associd].newprojsample){e.push("Labelfree requires sample name for each file");break}}else if(o.quanttype in o.quants)for(let t of o.quants[o.quanttype].chans)if(""===t.model){e.push("Sample name for each channel is required");break}for(let t of Object.values(o.params).filter(e=>"checkbox"!==e.inputtype))t.model||e.push(t.title+" is required");for(let t of Object.values(o.params).filter(e=>"checkbox"===e.inputtype))t.fields.some(e=>e.checked)||e.push(t.title+" is required");return Object.keys(o.species).length||e.push("Organism(s) is/are required"),e}async function b(){let e="/datasets/show/sampleprep/";e=ne?e+ne:e;const t=await Y(e);for(let[e,a]of Object.entries(t))n("prepdata",o[e]=a,o);n("labelfree_quant_id",c=Object.entries(o.quants).filter(e=>"labelfree"===e[1].name).map(e=>Number(e[0])).pop()),n("edited",s=!1)}q(async()=>{await b()});let j,y;return e.$set=(e=>{"errors"in e&&n("errors",a=e.errors)}),e.$$.update=((e={edited:1,prepdata:1,labelfree_quant_id:1})=>{e.edited&&n("stored",j=ne&&!s),(e.prepdata||e.labelfree_quant_id)&&n("isLabelfree",y=o.quanttype===c)}),{errors:a,preperrors:l,edited:s,editMade:i,prepdata:o,selectedspecies:r,trysamplenames:d,foundNewSamples:p,removeOrganism:u,addOrganism:function(){n("prepdata",o.species=[...o.species,o.allspecies[r]],o),i()},checkIfNewSamples:f,checkNewSampleLabelfree:m,checkNewSample:h,parseSampleNames:function(){let e={},t={};if(y&&!o.labelfree_multisample)return 0;if(y)for(let e of Object.values(ae))t[e.name]=e;else o.quants[o.quanttype].chans.forEach(function(t,n){e[t.name]=n});for(let a of d.trim().split("\n")){let l,s,i;a.indexOf("\t")>-1?a=a.trim().split("\t").map(e=>e.trim()):a.indexOf("    ")>-1&&(a=a.trim().split("    ").map(e=>e.trim())),y?(a[0]in t&&(i=t[a[0]],l=a[1]),a[1]in t&&(i=t[a[1]],l=a[0]),i&&n("prepdata",o.samples[i.associd].newprojsample=l,o)):(a[0]in e&&(s=e[a[0]],l=a[1]),a[1]in e&&(s=e[a[1]],l=a[0]),s&&n("prepdata",o.quants[o.quanttype].chans[s].newprojsample=l,o))}i()},resetNewSampleName:_,saveNewSamples:async function(){let e=[];if(y)if(!o.labelfree_multisample&&p){const e=await g(o.labelfree_singlesample);n("prepdata",o.labelfree_singlesample.model=e[0],o),n("prepdata",o.labelfree_singlesample.newprojsample="",o)}else{Object.entries(o.samples).filter(e=>e[1].newprojsample).forEach(function(t){e.push(g(t[1],t[0]))});for(let t of e){let[e,a]=await t;n("prepdata",o.samples[a].newprojsample="",o),n("prepdata",o.samples[a].model=e,o)}}else{o.quants[o.quanttype].chans.map(function(e,t){return[t,e]}).filter(e=>e[1].newprojsample).forEach(function(t){e.push(g(t[1],t[0]))}),console.log(e);for(let t of e){let[e,a]=await t;n("prepdata",o.quants[o.quanttype].chans[a].newprojsample="",o),n("prepdata",o.quants[o.quanttype].chans[a].model=e,o)}}f()},validate:v,save:async function(){if(n("errors",a=v()),!ae.length&&y&&n("preperrors",l=[...l,"Add files before saving data"]),ne||n("preperrors",l=[...l,"Save dataset before saving sample prep"]),0===a.length&&0===l.length){let e={dataset_id:ne,enzymes:o.no_enzyme?[]:o.enzymes,params:o.params,quanttype:o.quanttype,labelfree:y,species:o.species};y?o.labelfree_multisample?(e.filenames=Object.values(ae),e.samples=o.samples):(e.filenames=Object.values(ae),e.samples=Object.fromEntries(e.filenames.map(e=>[e.associd,o.labelfree_singlesample]))):e.samples=o.quants[o.quanttype].chans;let t="/datasets/save/sampleprep/";await Z(t,e),b()}},fetchData:b,stored:j,isLabelfree:y,Object:Object,dynamicselect_options_binding:function(e){o.allspecies=e,n("prepdata",o)},dynamicselect_selectval_binding:function(e){n("selectedspecies",r=e)},click_handler:({spec:e},t)=>u(e.id),input_change_handler:function(){o.no_enzyme=this.checked,n("prepdata",o),n("Object",Object)},input_change_handler_1:function({enzyme:e,each_value_7:t,enzyme_index:a}){t[a].checked=this.checked,n("prepdata",o),n("Object",Object)},param_param_binding:function(e,{param:t,each_value_6:a,each_index_3:l}){a[l][1]=e,n("Object",Object)},select_change_handler:function(){o.quanttype=$(this),n("prepdata",o),n("Object",Object)},textarea_input_handler:function(){d=this.value,n("trysamplenames",d)},input_change_handler_2:function(){o.labelfree_multisample=this.checked,n("prepdata",o),n("Object",Object)},select_change_handler_1:function({channel:e,each_value:t,chix:a}){t[a].model=$(this),n("prepdata",o),n("Object",Object)},change_handler:({channel:e},t)=>_(e),input_input_handler:function({channel:e,each_value:t,chix:a}){t[a].newprojsample=this.value,n("prepdata",o),n("Object",Object)},change_handler_1:({chix:e},t)=>h(e),select_change_handler_2:function({file:e}){o.samples[e.associd].model=$(this),n("prepdata",o),n("Object",Object),n("datasetFiles",ae),n("projsamples",le)},change_handler_2:({file:e},t)=>_(o.samples[e.associd]),input_input_handler_1:function({file:e}){o.samples[e.associd].newprojsample=this.value,n("prepdata",o),n("Object",Object),n("datasetFiles",ae),n("projsamples",le)},change_handler_3:({file:e},t)=>m(e.associd),select_change_handler_3:function(){o.labelfree_singlesample.model=$(this),n("prepdata",o),n("Object",Object)},change_handler_4:e=>_(o.labelfree_singlesample),input_input_handler_2:function(){o.labelfree_singlesample.newprojsample=this.value,n("prepdata",o),n("Object",Object)},change_handler_5:e=>m(o.labelfree_singlesample)}}class xt extends X{constructor(e){super(),W(this,e,yt,bt,s,["errors","validate","save"])}get validate(){return this.$$.ctx.validate}get save(){return this.$$.ctx.save}}function wt(e,t,n){const a=Object.create(e);return a.range=t[n],a}function $t(e,t,n){const a=Object.create(e);return a.prefrac=t[n],a}function Ot(e,t,n){const a=Object.create(e);return a.exp=t[n],a}function kt(e){var t;return{c(){t=m("Create new experiment")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function qt(e){var t;return{c(){t=m("Existing experiment")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function Nt(e){var t,n,l,s;let i=e.experiments,r=[];for(let t=0;t<i.length;t+=1)r[t]=Ct(Ot(e,i,t));return{c(){t=f("div"),n=f("select"),(l=f("option")).textContent="Please select one";for(let e=0;e<r.length;e+=1)r[e].c();l.disabled=!0,l.__value="",l.value=l.__value,void 0===e.dsinfo.experiment_id&&z(()=>e.select_change_handler.call(n)),v(t,"class","select"),s=[g(n,"change",e.select_change_handler),g(n,"change",e.editMade)]},m(a,s){d(a,t,s),o(t,n),o(n,l);for(let e=0;e<r.length;e+=1)r[e].m(n,null);w(n,e.dsinfo.experiment_id)},p(e,t){if(e.experiments){let a;for(i=t.experiments,a=0;a<i.length;a+=1){const l=Ot(t,i,a);r[a]?r[a].p(e,l):(r[a]=Ct(l),r[a].c(),r[a].m(n,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=i.length}e.dsinfo&&w(n,t.dsinfo.experiment_id)},d(e){e&&p(t),u(r,e),a(s)}}}function Ft(e){var t,n;return{c(){v(t=f("input"),"class","input"),v(t,"type","text"),v(t,"placeholder","Experiment name"),n=[g(t,"input",e.input_input_handler),g(t,"change",e.editMade)]},m(n,a){d(n,t,a),y(t,e.dsinfo.newexperimentname)},p(e,n){e.dsinfo&&t.value!==n.dsinfo.newexperimentname&&y(t,n.dsinfo.newexperimentname)},d(e){e&&p(t),a(n)}}}function Ct(e){var t,n,a,l=e.exp.name+"";return{c(){t=f("option"),n=m(l),t.__value=a=e.exp.id,t.value=t.__value},m(e,a){d(e,t,a),o(t,n)},p(e,s){e.experiments&&l!==(l=s.exp.name+"")&&j(n,l),e.experiments&&a!==(a=s.exp.id)&&(t.__value=a),t.value=t.__value},d(e){e&&p(t)}}}function Et(e){var t,n,a,l=e.prefrac.name+"";return{c(){t=f("option"),n=m(l),t.__value=a=e.prefrac.id,t.value=t.__value},m(e,a){d(e,t,a),o(t,n)},p(e,s){e.prefracs&&l!==(l=s.prefrac.name+"")&&j(n,l),e.prefracs&&a!==(a=s.prefrac.id)&&(t.__value=a),t.value=t.__value},d(e){e&&p(t)}}}function St(e){var t,n,l,s,i,r,c=!1;function u(){c=!0,e.input_input_handler_1.call(i)}return{c(){t=f("div"),(n=f("label")).textContent="Prefractionation length",l=h(),s=f("div"),i=f("input"),v(n,"class","label"),v(i,"type","number"),v(i,"class","input"),v(i,"placeholder","in minutes"),v(s,"class","control"),v(t,"class","field"),r=[g(i,"input",u),g(i,"change",e.editMade)]},m(a,r){d(a,t,r),o(t,n),o(t,l),o(t,s),o(s,i),y(i,e.dsinfo.prefrac_length)},p(e,t){!c&&e.dsinfo&&y(i,t.dsinfo.prefrac_length),c=!1},d(e){e&&p(t),a(r)}}}function Pt(e){var t,n,l,s,i,r,c,m;let _=e.hirief_ranges,b=[];for(let t=0;t<_.length;t+=1)b[t]=Mt(wt(e,_,t));return{c(){t=f("div"),(n=f("label")).textContent="HiRIEF range",l=h(),s=f("div"),i=f("div"),r=f("select"),(c=f("option")).textContent="Please select one";for(let e=0;e<b.length;e+=1)b[e].c();v(n,"class","label"),c.disabled=!0,c.__value="",c.value=c.__value,void 0===e.dsinfo.hiriefrange&&z(()=>e.select_change_handler_2.call(r)),v(i,"class","select"),v(s,"class","control"),v(t,"class","field"),m=[g(r,"change",e.select_change_handler_2),g(r,"change",e.editMade)]},m(a,p){d(a,t,p),o(t,n),o(t,l),o(t,s),o(s,i),o(i,r),o(r,c);for(let e=0;e<b.length;e+=1)b[e].m(r,null);w(r,e.dsinfo.hiriefrange)},p(e,t){if(e.hirief_ranges){let n;for(_=t.hirief_ranges,n=0;n<_.length;n+=1){const a=wt(t,_,n);b[n]?b[n].p(e,a):(b[n]=Mt(a),b[n].c(),b[n].m(r,null))}for(;n<b.length;n+=1)b[n].d(1);b.length=_.length}e.dsinfo&&w(r,t.dsinfo.hiriefrange)},d(e){e&&p(t),u(b,e),a(m)}}}function Mt(e){var t,n,a,l=e.range.name+"";return{c(){t=f("option"),n=m(l),t.__value=a=e.range.id,t.value=t.__value},m(e,a){d(e,t,a),o(t,n)},p(e,s){e.hirief_ranges&&l!==(l=s.range.name+"")&&j(n,l),e.hirief_ranges&&a!==(a=s.range.id)&&(t.__value=a),t.value=t.__value},d(e){e&&p(t)}}}function zt(e){var t,n,l,s,i,r,c=!1;function u(){c=!0,e.input_input_handler_2.call(i)}return{c(){t=f("div"),(n=f("label")).textContent="Fraction amount",l=h(),s=f("div"),i=f("input"),v(n,"class","label"),v(i,"type","number"),v(i,"class","input"),v(i,"placeholder","How many fractions of prefractionation"),v(s,"class","control"),v(t,"class","field"),r=[g(i,"input",u),g(i,"change",e.editMade)]},m(a,r){d(a,t,r),o(t,n),o(t,l),o(t,s),o(s,i),y(i,e.dsinfo.prefrac_amount)},p(e,t){!c&&e.dsinfo&&y(i,t.dsinfo.prefrac_amount),c=!1},d(e){e&&p(t),a(r)}}}function Lt(t){var n,l,s,i,r,c,b,j,y,x,$,O,k,q,N,F,C,E;function S(e,t){return t.isNewExperiment?qt:kt}var P=S(0,t),M=P(t);function L(e,t){return t.isNewExperiment?Ft:Nt}var T=L(0,t),I=T(t);let D=t.prefracs,R=[];for(let e=0;e<D.length;e+=1)R[e]=Et($t(t,D,e));function U(e,t){return t.hiriefselected?Pt:t.dsinfo.prefrac_id?St:void 0}var H=U(0,t),A=H&&H(t),Q=t.dsinfo.prefrac_id&&zt(t);return{c(){n=f("div"),l=f("label"),s=m("Experiment name\n    "),i=f("a"),M.c(),r=h(),c=f("div"),I.c(),b=h(),j=f("div"),(y=f("label")).textContent="Prefractionation",x=h(),$=f("div"),O=f("div"),k=f("select"),(q=f("option")).textContent="None";for(let e=0;e<R.length;e+=1)R[e].c();N=h(),A&&A.c(),F=h(),Q&&Q.c(),C=_(),v(i,"class","button is-danger is-outlined is-small"),v(l,"class","label"),v(c,"class","control"),v(n,"class","field"),v(y,"class","label"),q.__value="",q.value=q.__value,void 0===t.dsinfo.prefrac_id&&z(()=>t.select_change_handler_1.call(k)),v(O,"class","select"),v($,"class","control"),v(j,"class","field"),E=[g(i,"click",t.toggle_experiment),g(k,"change",t.select_change_handler_1),g(k,"change",t.editMade)]},m(e,a){d(e,n,a),o(n,l),o(l,s),o(l,i),M.m(i,null),o(n,r),o(n,c),I.m(c,null),d(e,b,a),d(e,j,a),o(j,y),o(j,x),o(j,$),o($,O),o(O,k),o(k,q);for(let e=0;e<R.length;e+=1)R[e].m(k,null);w(k,t.dsinfo.prefrac_id),d(e,N,a),A&&A.m(e,a),d(e,F,a),Q&&Q.m(e,a),d(e,C,a)},p(e,t){if(P!==(P=S(0,t))&&(M.d(1),(M=P(t))&&(M.c(),M.m(i,null))),T===(T=L(0,t))&&I?I.p(e,t):(I.d(1),(I=T(t))&&(I.c(),I.m(c,null))),e.prefracs){let n;for(D=t.prefracs,n=0;n<D.length;n+=1){const a=$t(t,D,n);R[n]?R[n].p(e,a):(R[n]=Et(a),R[n].c(),R[n].m(k,null))}for(;n<R.length;n+=1)R[n].d(1);R.length=D.length}e.dsinfo&&w(k,t.dsinfo.prefrac_id),H===(H=U(0,t))&&A?A.p(e,t):(A&&A.d(1),(A=H&&H(t))&&(A.c(),A.m(F.parentNode,F))),t.dsinfo.prefrac_id?Q?Q.p(e,t):((Q=zt(t)).c(),Q.m(C.parentNode,C)):Q&&(Q.d(1),Q=null)},i:e,o:e,d(e){e&&p(n),M.d(),I.d(),e&&(p(b),p(j)),u(R,e),e&&p(N),A&&A.d(e),e&&p(F),Q&&Q.d(e),e&&p(C),a(E)}}}function Tt(e,t,n){const a=N();let l,{dsinfo:s,experiments:i,hirief_ranges:r,prefracs:c,isNewExperiment:o}=t,d=[];return e.$set=(e=>{"dsinfo"in e&&n("dsinfo",s=e.dsinfo),"experiments"in e&&n("experiments",i=e.experiments),"hirief_ranges"in e&&n("hirief_ranges",r=e.hirief_ranges),"prefracs"in e&&n("prefracs",c=e.prefracs),"isNewExperiment"in e&&n("isNewExperiment",o=e.isNewExperiment)}),e.$$.update=((e={prefracs:1,dsinfo:1})=>{(e.prefracs||e.dsinfo)&&n("hiriefselected",l=c.some(e=>e.id==s.prefrac_id&&e.name.toLowerCase().indexOf("hirief")>-1))}),{dsinfo:s,experiments:i,hirief_ranges:r,prefracs:c,isNewExperiment:o,toggle_experiment:function(){n("isNewExperiment",o=!1===o)},editMade:function(){a("edited")},validate:function(){return d=[],l&&!s.hiriefrange?d.push("HiRIEF range is required"):l||!s.prefrac_id||s.prefrac_length||d.push("Prefractionation length is required"),s.prefrac_id&&!s.prefrac_amount&&d.push("Prefractionation fraction amount is required"),d},hiriefselected:l,input_input_handler:function(){s.newexperimentname=this.value,n("dsinfo",s),n("experiments",i)},select_change_handler:function(){s.experiment_id=$(this),n("dsinfo",s),n("experiments",i)},select_change_handler_1:function(){s.prefrac_id=$(this),n("dsinfo",s),n("experiments",i)},select_change_handler_2:function(){s.hiriefrange=$(this),n("dsinfo",s),n("experiments",i)},input_input_handler_1:function(){s.prefrac_length=b(this.value),n("dsinfo",s),n("experiments",i)},input_input_handler_2:function(){s.prefrac_amount=b(this.value),n("dsinfo",s),n("experiments",i)}}}class It extends X{constructor(e){super(),W(this,e,Tt,Lt,s,["dsinfo","experiments","hirief_ranges","prefracs","isNewExperiment","validate"])}get validate(){return this.$$.ctx.validate}}const{Object:Dt}=B;function Rt(e,t,n){const a=Dt.create(e);return a.file=t[n],a}function Ut(e,t,n){const a=Dt.create(e);return a.quant=t[n],a}function Ht(e){var t;return{c(){v(t=f("i"),"class","icon fas fa-edit")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function At(e){var t;return{c(){v(t=f("i"),"class","icon fas fa-check-circle")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function Qt(e){var t,n,a,l=e.quant.name+"";return{c(){t=f("option"),n=m(l),t.__value=a=e.quant.id,t.value=t.__value},m(e,a){d(e,t,a),o(t,n)},p(e,s){e.lcdata&&l!==(l=s.quant.name+"")&&j(n,l),e.lcdata&&a!==(a=s.quant.id)&&(t.__value=a),t.value=t.__value},d(e){e&&p(t)}}}function Bt(e){var t;return{c(){(t=f("a")).textContent="Save new samples",v(t,"class","button is-danger is-small is-pulled-right"),v(t,"disabled","")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function Jt(e){var t,n;return{c(){(t=f("a")).textContent="Save new samples",v(t,"class","button is-danger is-small is-pulled-right"),n=g(t,"click",e.saveNewSamples)},m(e,n){d(e,t,n)},d(e){e&&p(t),n()}}}function Gt(e){var t,n;let a=e.Object.values(e.$datasetFiles),l=[];for(let t=0;t<a.length;t+=1)l[t]=Xt(Rt(e,a,t));const s=e=>Q(l[e],1,1,()=>{l[e]=null});return{c(){t=f("tbody");for(let e=0;e<l.length;e+=1)l[e].c()},m(e,a){d(e,t,a);for(let e=0;e<l.length;e+=1)l[e].m(t,null);n=!0},p(e,n){if(e.lcdata||e.Object||e.$datasetFiles||e.projsamples){let i;for(a=n.Object.values(n.$datasetFiles),i=0;i<a.length;i+=1){const s=Rt(n,a,i);l[i]?(l[i].p(e,s),A(l[i],1)):(l[i]=Xt(s),l[i].c(),A(l[i],1),l[i].m(t,null))}for(U(),i=a.length;i<l.length;i+=1)s(i);H()}},i(e){if(!n){for(let e=0;e<a.length;e+=1)A(l[e]);n=!0}},o(e){l=l.filter(Boolean);for(let e=0;e<l.length;e+=1)Q(l[e]);n=!1},d(e){e&&p(t),u(l,e)}}}function Kt(e){var t;return{c(){(t=f("span")).innerHTML='<i class="fas fa-asterisk"></i>',v(t,"class","icon has-text-danger")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function Vt(e){var t,n,a,l,s,i,r;function c(n){e.dynamicselect_intext_binding_1.call(null,n,e),t=!0,L(()=>t=!1)}function o(t){e.dynamicselect_fixedoptions_binding.call(null,t),n=!0,L(()=>n=!1)}function u(t){e.dynamicselect_fixedorder_binding.call(null,t),a=!0,L(()=>a=!1)}function f(t){e.dynamicselect_selectval_binding_1.call(null,t,e),l=!0,L(()=>l=!1)}let m={niceName:en};void 0!==e.lcdata.samples[e.file.associd].channelname&&(m.intext=e.lcdata.samples[e.file.associd].channelname),void 0!==e.lcdata.quants[e.lcdata.quanttype].chans&&(m.fixedoptions=e.lcdata.quants[e.lcdata.quanttype].chans),void 0!==e.lcdata.quants[e.lcdata.quanttype].chanorder&&(m.fixedorder=e.lcdata.quants[e.lcdata.quanttype].chanorder),void 0!==e.lcdata.samples[e.file.associd].channel&&(m.selectval=e.lcdata.samples[e.file.associd].channel);var g=new Re({props:m});C.push(()=>J(g,"intext",c)),C.push(()=>J(g,"fixedoptions",o)),C.push(()=>J(g,"fixedorder",u)),C.push(()=>J(g,"selectval",f)),g.$on("selectedvalue",function(...t){return e.selectedvalue_handler(e,...t)}),g.$on("illegalvalue",function(...t){return e.illegalvalue_handler(e,...t)});var v=e.lcdata.samples[e.file.associd].badChannel&&Wt();return{c(){g.$$.fragment.c(),s=h(),v&&v.c(),i=_()},m(e,t){G(g,e,t),d(e,s,t),v&&v.m(e,t),d(e,i,t),r=!0},p(s,r){e=r;var c={};(!t&&s.lcdata||s.Object||s.$datasetFiles)&&(c.intext=e.lcdata.samples[e.file.associd].channelname),!n&&s.lcdata&&(c.fixedoptions=e.lcdata.quants[e.lcdata.quanttype].chans),!a&&s.lcdata&&(c.fixedorder=e.lcdata.quants[e.lcdata.quanttype].chanorder),(!l&&s.lcdata||s.Object||s.$datasetFiles)&&(c.selectval=e.lcdata.samples[e.file.associd].channel),g.$set(c),e.lcdata.samples[e.file.associd].badChannel?v||((v=Wt()).c(),v.m(i.parentNode,i)):v&&(v.d(1),v=null)},i(e){r||(A(g.$$.fragment,e),r=!0)},o(e){Q(g.$$.fragment,e),r=!1},d(e){K(g,e),e&&p(s),v&&v.d(e),e&&p(i)}}}function Wt(e){var t;return{c(){(t=f("span")).innerHTML='<i class="fas fa-asterisk"></i>',v(t,"class","icon is-left has-text-danger")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function Xt(e){var t,n,a,l,s,i,r,c,u,_,g,b,y,x,w,$,O,k,q=e.file.name+"",N=e.lcdata.samples[e.file.associd].newprojsample&&Kt();function F(t){e.dynamicselect_intext_binding.call(null,t,e),c=!0,L(()=>c=!1)}function E(t){e.dynamicselect_unknowninput_binding.call(null,t,e),u=!0,L(()=>u=!1)}function S(t){e.dynamicselect_selectval_binding.call(null,t,e),_=!0,L(()=>_=!1)}let P={fixedoptions:le,niceName:Zt};void 0!==e.lcdata.samples[e.file.associd].samplename&&(P.intext=e.lcdata.samples[e.file.associd].samplename),void 0!==e.lcdata.samples[e.file.associd].newprojsample&&(P.unknowninput=e.lcdata.samples[e.file.associd].newprojsample),void 0!==e.lcdata.samples[e.file.associd].sample&&(P.selectval=e.lcdata.samples[e.file.associd].sample);var M=new Re({props:P});C.push(()=>J(M,"intext",F)),C.push(()=>J(M,"unknowninput",E)),C.push(()=>J(M,"selectval",S)),M.$on("selectedvalue",e.editMade),M.$on("newvalue",function(...t){return e.newvalue_handler(e,...t)});var z=e.lcdata.quanttype&&Vt(e);return{c(){t=f("tr"),n=f("td"),a=f("label"),N&&N.c(),l=h(),s=m(q),i=h(),r=f("div"),M.$$.fragment.c(),g=h(),b=f("td"),y=f("div"),x=f("div"),w=f("p"),z&&z.c(),O=h(),v(a,"class","label"),v(r,"class","field"),v(w,"class",$=e.lcdata.samples[e.file.associd].badChannel?"control has-icons-left":""),v(x,"class","control"),v(y,"class","field")},m(e,c){d(e,t,c),o(t,n),o(n,a),N&&N.m(a,null),o(a,l),o(a,s),o(n,i),o(n,r),G(M,r,null),o(t,g),o(t,b),o(b,y),o(y,x),o(x,w),z&&z.m(w,null),o(t,O),k=!0},p(t,n){(e=n).lcdata.samples[e.file.associd].newprojsample?N||((N=Kt()).c(),N.m(a,l)):N&&(N.d(1),N=null),k&&!t.$datasetFiles||q===(q=e.file.name+"")||j(s,q);var i={};t.projsamples&&(i.fixedoptions=le),(!c&&t.lcdata||t.Object||t.$datasetFiles)&&(i.intext=e.lcdata.samples[e.file.associd].samplename),(!u&&t.lcdata||t.Object||t.$datasetFiles)&&(i.unknowninput=e.lcdata.samples[e.file.associd].newprojsample),(!_&&t.lcdata||t.Object||t.$datasetFiles)&&(i.selectval=e.lcdata.samples[e.file.associd].sample),M.$set(i),e.lcdata.quanttype?z?(z.p(t,e),A(z,1)):((z=Vt(e)).c(),A(z,1),z.m(w,null)):z&&(U(),Q(z,1,1,()=>{z=null}),H()),k&&!t.lcdata&&!t.$datasetFiles||$===($=e.lcdata.samples[e.file.associd].badChannel?"control has-icons-left":"")||v(w,"class",$)},i(e){k||(A(M.$$.fragment,e),A(z),k=!0)},o(e){Q(M.$$.fragment,e),Q(z),k=!1},d(e){e&&p(t),N&&N.d(),K(M),z&&z.d()}}}function Yt(e){var t,n,l,s,i,r,c,_,b,j,y,x,$,O,k,q,N,F,C,E,S,P,M,L,T,I=e.Object.keys(e.lcdata.samples).length;function D(e,t){return t.stored?At:t.edited?Ht:void 0}var R=D(0,e),B=R&&R(e),J=new ye({props:{errors:e.lcerrors}});let V=e.Object.values(e.lcdata.quants),W=[];for(let t=0;t<V.length;t+=1)W[t]=Qt(Ut(e,V,t));function X(e,t){return t.foundNewSamples?Jt:Bt}var Y=X(0,e),Z=Y(e),ee=I&&Gt(e);return{c(){t=f("h5"),B&&B.c(),n=m("\n  Label check\n  "),l=f("button"),s=m("Save"),r=h(),c=f("button"),_=m("Revert"),j=h(),J.$$.fragment.c(),y=h(),x=f("div"),($=f("label")).textContent="Quant type",O=h(),k=f("div"),q=f("div"),N=f("select"),(F=f("option")).textContent="Please select one";for(let e=0;e<W.length;e+=1)W[e].c();C=h(),Z.c(),E=h(),S=f("table"),(P=f("thead")).innerHTML="<tr><th>Sample</th> <th>Channel</th></tr>",M=h(),ee&&ee.c(),v(l,"class","button is-small is-danger has-text-weight-bold"),l.disabled=i=!e.edited,v(c,"class","button is-small is-info has-text-weight-bold"),c.disabled=b=!e.edited,v(t,"id","labelcheck"),v(t,"class","has-text-primary title is-5"),v($,"class","label"),F.disabled=!0,F.__value="",F.value=F.__value,void 0===e.lcdata.quanttype&&z(()=>e.select_change_handler.call(N)),v(q,"class","select"),v(k,"class","control"),v(x,"class","field"),v(S,"class","table is-fullwidth"),T=[g(l,"click",e.save),g(c,"click",e.fetchData),g(N,"change",e.select_change_handler),g(N,"change",e.editMade)]},m(a,i){d(a,t,i),B&&B.m(t,null),o(t,n),o(t,l),o(l,s),o(t,r),o(t,c),o(c,_),d(a,j,i),G(J,a,i),d(a,y,i),d(a,x,i),o(x,$),o(x,O),o(x,k),o(k,q),o(q,N),o(N,F);for(let e=0;e<W.length;e+=1)W[e].m(N,null);w(N,e.lcdata.quanttype),d(a,C,i),Z.m(a,i),d(a,E,i),d(a,S,i),o(S,P),o(S,M),ee&&ee.m(S,null),L=!0},p(e,a){R!==(R=D(0,a))&&(B&&B.d(1),(B=R&&R(a))&&(B.c(),B.m(t,n))),L&&!e.edited||i===(i=!a.edited)||(l.disabled=i),L&&!e.edited||b===(b=!a.edited)||(c.disabled=b);var s={};if(e.lcerrors&&(s.errors=a.lcerrors),J.$set(s),e.Object||e.lcdata){let t;for(V=a.Object.values(a.lcdata.quants),t=0;t<V.length;t+=1){const n=Ut(a,V,t);W[t]?W[t].p(e,n):(W[t]=Qt(n),W[t].c(),W[t].m(N,null))}for(;t<W.length;t+=1)W[t].d(1);W.length=V.length}e.lcdata&&w(N,a.lcdata.quanttype),Y!==(Y=X(0,a))&&(Z.d(1),(Z=Y(a))&&(Z.c(),Z.m(E.parentNode,E))),e.lcdata&&(I=a.Object.keys(a.lcdata.samples).length),I?ee?(ee.p(e,a),A(ee,1)):((ee=Gt(a)).c(),A(ee,1),ee.m(S,null)):ee&&(U(),Q(ee,1,1,()=>{ee=null}),H())},i(e){L||(A(J.$$.fragment,e),A(ee),L=!0)},o(e){Q(J.$$.fragment,e),Q(ee),L=!1},d(e){e&&p(t),B&&B.d(),e&&p(j),K(J,e),e&&(p(y),p(x)),u(W,e),e&&p(C),Z.d(e),e&&(p(E),p(S)),ee&&ee.d(),a(T)}}}const Zt=e=>e.name,en=e=>e.name;function tn(e,t,n){let a,l;i(e,ne,e=>{n("$dataset_id",a=e)}),i(e,ae,e=>{n("$datasetFiles",l=e)});let{errors:s}=t,r=[],c={quants:{},quanttype:"",samples:{}},o=!1;function d(){n("edited",o=!0)}function p(e){n("lcdata",c.samples[e].badChannel=!1,c),d()}function u(e){console.log("bad ch"),console.log(e),n("lcdata",c.samples[e].badChannel=!0,c)}function f(e){let t=c.samples[e.associd].newprojsample.trim().toUpperCase(),a=Object.entries(le).filter(e=>e[1].name.toUpperCase()==t).map(e=>e[0])[0];a&&(n("lcdata",c.samples[e.associd].sample=parseInt(a),c),n("lcdata",c.samples[e.associd].newprojsample="",c)),d()}async function m(){let e="/datasets/show/labelcheck/";e=a?e+a:e;const t=await Y(e);for(let[e,a]of Object.entries(t))n("lcdata",c[e]=a,c);n("edited",o=!1)}q(async()=>{await m()});let h,_;return e.$set=(e=>{"errors"in e&&n("errors",s=e.errors)}),e.$$.update=((e={lcdata:1,$dataset_id:1,edited:1})=>{e.lcdata&&n("foundNewSamples",h=Object.values(c.samples).some(e=>""!==e.newprojsample)),(e.$dataset_id||e.edited)&&n("stored",_=a&&!o)}),{errors:s,lcerrors:r,lcdata:c,edited:o,editMade:d,okChannel:p,badChannel:u,saveNewSamples:async function(){let e=[];Object.entries(c.samples).filter(e=>e[1].newprojsample).forEach(function(t){e.push(async function(e,t){let n={dataset_id:a,samplename:e.newprojsample};const l=await Z("/datasets/save/projsample/",n);return le[l.psid]=l.psname,[l.psid,t]}(t[1],t[0]))});for(let t of e){let[e,a]=await t;n("lcdata",c.samples[a].newprojsample="",c),n("lcdata",c.samples[a].sample=e,c)}},checkNewSample:f,save:async function(){if(n("errors",s=function(){let e=[];c.quanttype||e.push("Quant type selection is required");for(let t of Object.values(l))c.samples[t.associd].sample||e.push("Sample name for each file/channel is required"),c.samples[t.associd].channel||e.push("Channel for each file/sample is required");return e}()),Object.keys(l).length||n("lcerrors",r=[...r,"Add files before saving data"]),0===s.length){let e={dataset_id:a,quanttype:c.quanttype,samples:c.samples,filenames:Object.values(l)};console.log(e);const t="/datasets/save/labelcheck/";await Z(t,e),m()}},fetchData:m,foundNewSamples:h,Object:Object,stored:_,$datasetFiles:l,select_change_handler:function(){c.quanttype=$(this),n("lcdata",c),n("Object",Object)},dynamicselect_intext_binding:function(e,{file:t}){c.samples[t.associd].samplename=e,n("lcdata",c)},dynamicselect_unknowninput_binding:function(e,{file:t}){c.samples[t.associd].newprojsample=e,n("lcdata",c)},dynamicselect_selectval_binding:function(e,{file:t}){c.samples[t.associd].sample=e,n("lcdata",c)},newvalue_handler:({file:e},t)=>f(e),dynamicselect_intext_binding_1:function(e,{file:t}){c.samples[t.associd].channelname=e,n("lcdata",c)},dynamicselect_fixedoptions_binding:function(e){c.quants[c.quanttype].chans=e,n("lcdata",c)},dynamicselect_fixedorder_binding:function(e){c.quants[c.quanttype].chanorder=e,n("lcdata",c)},dynamicselect_selectval_binding_1:function(e,{file:t}){c.samples[t.associd].channel=e,n("lcdata",c)},selectedvalue_handler:({file:e},t)=>p(e.associd),illegalvalue_handler:({file:e},t)=>u(e.associd)}}class nn extends X{constructor(e){super(),W(this,e,tn,Yt,s,["errors"])}}const{Object:an}=B;function ln(e,t,n){const a=an.create(e);return a.fn=t[n],a.each_value=t,a.fn_index=n,a}function sn(e,t,n){const a=an.create(e);return a.fn=t[n],a}function rn(e){var t;return{c(){(t=f("span")).innerHTML='<i class="fas fa-database"></i>',v(t,"class","icon is-small has-text-primary")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function cn(e){var t,n,a,l,s,i,r,c,u,_,b,y,x,w,$,O,k,q,N,F=e.fn.name+"",C=pn(e.fn.date)+"",E=e.fn.size+"",S=e.fn.instrument+"";function P(...t){return e.click_handler(e,...t)}var M=e.fn.id in e.$datasetFiles&&rn();return{c(){t=f("tr"),n=f("td"),(a=f("span")).innerHTML='<i class="fas fa-times"></i>',l=h(),s=f("td"),M&&M.c(),i=h(),r=f("td"),c=m(F),u=h(),_=f("td"),b=m(C),y=h(),x=f("td"),w=m(E),$=m("MB"),O=h(),k=f("td"),q=m(S),v(a,"class","icon is-small has-text-danger"),N=g(a,"click",P)},m(e,p){d(e,t,p),o(t,n),o(n,a),o(t,l),o(t,s),M&&M.m(s,null),o(t,i),o(t,r),o(r,c),o(t,u),o(t,_),o(_,b),o(t,y),o(t,x),o(x,w),o(x,$),o(t,O),o(t,k),o(k,q)},p(t,n){(e=n).fn.id in e.$datasetFiles?M||((M=rn()).c(),M.m(s,null)):M&&(M.d(1),M=null),(t.Object||t.addedFiles||t.files||t.$datasetFiles)&&F!==(F=e.fn.name+"")&&j(c,F),(t.Object||t.addedFiles||t.files||t.$datasetFiles)&&C!==(C=pn(e.fn.date)+"")&&j(b,C),(t.Object||t.addedFiles||t.files||t.$datasetFiles)&&E!==(E=e.fn.size+"")&&j(w,E),(t.Object||t.addedFiles||t.files||t.$datasetFiles)&&S!==(S=e.fn.instrument+"")&&j(q,S)},d(e){e&&p(t),M&&M.d(),N()}}}function on(e){var t,n,a,l,s,i,r,c,u,_,b,y,x,w,$,O,k,q,N,F,C=e.fn.name+"",E=pn(e.fn.date)+"",S=e.fn.size+"",P=e.fn.instrument+"";function M(){e.input_change_handler.call(a,e)}return{c(){t=f("tr"),n=f("td"),a=f("input"),l=h(),s=f("td"),i=h(),r=f("td"),c=m(C),u=h(),_=f("td"),b=m(E),y=h(),x=f("td"),w=m(S),$=m("MB"),O=h(),k=f("td"),q=m(P),N=h(),v(a,"type","checkbox"),F=g(a,"change",M)},m(p,f){d(p,t,f),o(t,n),o(n,a),a.checked=e.fn.checked,o(t,l),o(t,s),o(t,i),o(t,r),o(r,c),o(t,u),o(t,_),o(_,b),o(t,y),o(t,x),o(x,w),o(x,$),o(t,O),o(t,k),o(k,q),o(t,N)},p(t,n){e=n,(t.Object||t.removed_files||t.files)&&(a.checked=e.fn.checked),(t.Object||t.removed_files||t.files)&&C!==(C=e.fn.name+"")&&j(c,C),(t.Object||t.removed_files||t.files)&&E!==(E=pn(e.fn.date)+"")&&j(b,E),(t.Object||t.removed_files||t.files)&&S!==(S=e.fn.size+"")&&j(w,S),(t.Object||t.removed_files||t.files)&&P!==(P=e.fn.instrument+"")&&j(q,P)},d(e){e&&p(t),F()}}}function dn(t){var n,l,s,i,r,c,_,b,x,w,$,O,k,q,N,F,C,E,S,P,M,z,L,T,I,D,R,U,H,A,Q,B,J,G,K,V,W,X,Y,Z,ee,te,ne,ae,le,se,ie=t.files.newfn_order.length+"",re=t.selectedFiles.length+"",ce=t.files.dsfn_order.length+"",oe=t.Object.keys(t.removed_files).length+"",de=t.Object.keys(t.addedFiles).length+"";let pe=t.Object.values(t.addedFiles).concat(t.files.dsfn_order.map(t.func)),ue=[];for(let e=0;e<pe.length;e+=1)ue[e]=cn(sn(t,pe,e));let fe=t.Object.values(t.removed_files).concat(t.files.newfn_order.map(t.func_1)),me=[];for(let e=0;e<fe.length;e+=1)me[e]=on(ln(t,fe,e));return{c(){n=f("div"),l=f("input"),s=h(),i=f("div"),r=m("Showing "),c=m(ie),_=m(" new files ("),b=m(re),x=m(" selected), "),w=m(ce),$=m(" files in dataset (incl. "),O=m(oe),k=m(", excl. "),q=m(de),N=m(" added files)"),F=h(),C=f("div"),E=f("button"),S=m("Save"),M=h(),(z=f("button")).textContent="Revert",L=h(),T=f("button"),I=m("Add selected files"),R=h(),U=f("table"),H=f("thead"),A=f("tr"),Q=f("th"),B=f("input"),J=h(),G=f("th"),K=h(),(V=f("th")).textContent="File",W=h(),(X=f("th")).textContent="Date",Y=h(),(Z=f("th")).textContent="Size",ee=h(),(te=f("th")).textContent="Instrument",ne=h(),ae=f("tbody");for(let e=0;e<ue.length;e+=1)ue[e].c();le=h();for(let e=0;e<me.length;e+=1)me[e].c();v(l,"class","input is-small"),v(l,"type","text"),v(l,"placeholder","Type a query and press enter to find analyses"),v(E,"class","button is-danger is-small"),E.disabled=P=!t.changed,v(z,"class","button is-info is-small"),v(T,"class","button is-small"),T.disabled=D=!t.selectedFiles.length,v(B,"type","checkbox"),v(U,"class","table"),v(n,"class","content is-small"),se=[g(l,"input",t.input0_input_handler),g(l,"keyup",t.findFiles),g(E,"click",t.save),g(z,"click",t.fetchFiles),g(T,"click",t.addFiles),g(B,"change",t.input1_change_handler),g(B,"click",t.selectAllNew)]},m(e,a){d(e,n,a),o(n,l),y(l,t.findQuery),o(n,s),o(n,i),o(i,r),o(i,c),o(i,_),o(i,b),o(i,x),o(i,w),o(i,$),o(i,O),o(i,k),o(i,q),o(i,N),o(n,F),o(n,C),o(C,E),o(E,S),o(C,M),o(C,z),o(C,L),o(C,T),o(T,I),o(n,R),o(n,U),o(U,H),o(H,A),o(A,Q),o(Q,B),B.checked=t.allNewSelector,o(A,J),o(A,G),o(A,K),o(A,V),o(A,W),o(A,X),o(A,Y),o(A,Z),o(A,ee),o(A,te),o(U,ne),o(U,ae);for(let e=0;e<ue.length;e+=1)ue[e].m(ae,null);o(ae,le);for(let e=0;e<me.length;e+=1)me[e].m(ae,null)},p(e,t){if(e.findQuery&&l.value!==t.findQuery&&y(l,t.findQuery),e.files&&ie!==(ie=t.files.newfn_order.length+"")&&j(c,ie),e.selectedFiles&&re!==(re=t.selectedFiles.length+"")&&j(b,re),e.files&&ce!==(ce=t.files.dsfn_order.length+"")&&j(w,ce),(e.Object||e.removed_files)&&oe!==(oe=t.Object.keys(t.removed_files).length+"")&&j(O,oe),(e.Object||e.addedFiles)&&de!==(de=t.Object.keys(t.addedFiles).length+"")&&j(q,de),e.changed&&P!==(P=!t.changed)&&(E.disabled=P),e.selectedFiles&&D!==(D=!t.selectedFiles.length)&&(T.disabled=D),e.allNewSelector&&(B.checked=t.allNewSelector),e.Object||e.addedFiles||e.files||e.$datasetFiles||e.isoTime){let n;for(pe=t.Object.values(t.addedFiles).concat(t.files.dsfn_order.map(t.func)),n=0;n<pe.length;n+=1){const a=sn(t,pe,n);ue[n]?ue[n].p(e,a):(ue[n]=cn(a),ue[n].c(),ue[n].m(ae,le))}for(;n<ue.length;n+=1)ue[n].d(1);ue.length=pe.length}if(e.Object||e.removed_files||e.files||e.isoTime){let n;for(fe=t.Object.values(t.removed_files).concat(t.files.newfn_order.map(t.func_1)),n=0;n<fe.length;n+=1){const a=ln(t,fe,n);me[n]?me[n].p(e,a):(me[n]=on(a),me[n].c(),me[n].m(ae,null))}for(;n<me.length;n+=1)me[n].d(1);me.length=fe.length}},i:e,o:e,d(e){e&&p(n),u(ue,e),u(me,e),a(se)}}}function pn(e){return new Date(e).toISOString()}function un(e,t,n){let a,l;i(e,ae,e=>{n("$datasetFiles",a=e)}),i(e,ne,e=>{n("$dataset_id",l=e)});let s={newFiles:{},dsfn_order:[],newfn_order:[]},r={},o={},d="",p=!1;function u(e){e in a?(n("removed_files",o[e]=a[e],o),n("files",s.dsfn_order=s.dsfn_order.filter(t=>t!==e),s)):e in r&&n("addedFiles",r=Object.fromEntries(Object.entries(r).filter(t=>t[1].id!==e)))}async function f(){let e="/datasets/show/files/";e=l?e+l:e;const t=await Y(e);for(let[e,a]of Object.entries(t))n("files",s[e]=a,s);for(let e in a)delete a[e];for(let[e,n]of Object.entries(t.datasetFiles))c(ae,a[e]=n,a);n("addedFiles",r={}),n("removed_files",o={})}q(async()=>{f()});let m,h;return e.$$.update=((e={Object:1,addedFiles:1,removed_files:1,files:1})=>{(e.Object||e.addedFiles||e.removed_files)&&n("changed",m=Object.keys(r).length||Object.keys(o).length),(e.Object||e.files||e.removed_files)&&n("selectedFiles",h=Object.values(s.newFiles).concat(Object.values(o)).filter(e=>e.checked))}),{files:s,addedFiles:r,removed_files:o,findQuery:d,allNewSelector:p,findFiles:async function(e){if(13===e.keyCode){console.log("finding");const e=await Y(`/datasets/find/files?q=${d.split(" ").join(",")}`);for(let[t,a]of Object.entries(e))n("files",s[t]=a,s)}},selectAllNew:function(){let e=!1===p;for(let t in s.newFiles)n("files",s.newFiles[t].checked=e,s)},deleteFile:u,addFiles:function(){for(let e of Object.values(o).filter(e=>e.checked))e.checked=!1,delete o[e.id],n("files",s.dsfn_order=[e.id].concat(s.dsfn_order),s);for(let e of Object.values(s.newFiles).filter(e=>e.checked))e.checked=!1,n("addedFiles",r[e.id]=e,r),n("files",s.newfn_order=s.newfn_order.filter(t=>t!==e.id),s)},save:async function(){let e={dataset_id:l,added_files:r,removed_files:o};await Z("/datasets/save/files/",e),f()},fetchFiles:f,Object:Object,changed:m,selectedFiles:h,$datasetFiles:a,input0_input_handler:function(){d=this.value,n("findQuery",d)},input1_change_handler:function(){p=this.checked,n("allNewSelector",p)},func:e=>a[e],click_handler:({fn:e},t)=>u(e.id),func_1:e=>s.newFiles[e],input_change_handler:function({fn:e,each_value:t,fn_index:a}){t[a].checked=this.checked,n("Object",Object),n("removed_files",o),n("files",s)}}}class fn extends X{constructor(e){super(),W(this,e,un,dn,s,[])}}const{Object:mn}=B;function hn(e,t,n){const a=mn.create(e);return a.dstype=t[n],a}function _n(e,t,n){const a=mn.create(e);return a.expi=t[n],a}function gn(e,t,n){const a=mn.create(e);return a.ptype=t[n],a}function vn(e,t,n){const a=mn.create(e);return a.project=t[n],a}function bn(e){var t,n,a,l;return{c(){t=f("li"),(n=f("a")).innerHTML="<span>Files</span>",v(t,"class",a="files"===e.tabshow?"is-active":""),l=g(n,"click",e.showFiles)},m(e,a){d(e,t,a),o(t,n)},p(e,n){e.tabshow&&a!==(a="files"===n.tabshow?"is-active":"")&&v(t,"class",a)},d(e){e&&p(t),l()}}}function jn(e){var t,n,a,l,s,i=e.dsinfo.storage_location+"";return{c(){t=f("article"),(n=f("div")).textContent="Storage location",a=h(),l=f("div"),s=m(i),v(n,"class","message-header"),v(l,"class","message-body"),v(t,"class","message is-info")},m(e,i){d(e,t,i),o(t,n),o(t,a),o(t,l),o(l,s)},p(e,t){e.dsinfo&&i!==(i=t.dsinfo.storage_location+"")&&j(s,i)},d(e){e&&p(t)}}}function yn(e){var t;return{c(){t=m("Create new project")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function xn(e){var t;return{c(){t=m("Use existing project")},m(e,n){d(e,t,n)},d(e){e&&p(t)}}}function wn(e){var t,n,l,s,i,r,c,m;let _=e.pdata.ptypes,b=[];for(let t=0;t<_.length;t+=1)b[t]=On(gn(e,_,t));return{c(){t=f("input"),n=h(),(l=f("label")).textContent="Project type",s=h(),i=f("div"),r=f("select"),(c=f("option")).textContent="Please select one";for(let e=0;e<b.length;e+=1)b[e].c();v(t,"class","input"),v(t,"type","text"),v(t,"placeholder","Project name"),v(l,"class","label"),c.disabled=!0,c.__value="",c.value=c.__value,void 0===e.dsinfo.ptype_id&&z(()=>e.select_change_handler_1.call(r)),v(i,"class","select"),m=[g(t,"input",e.input_input_handler),g(t,"change",e.editMade),g(r,"change",e.select_change_handler_1)]},m(a,p){d(a,t,p),y(t,e.dsinfo.newprojectname),d(a,n,p),d(a,l,p),d(a,s,p),d(a,i,p),o(i,r),o(r,c);for(let e=0;e<b.length;e+=1)b[e].m(r,null);w(r,e.dsinfo.ptype_id)},p(e,n){if(e.dsinfo&&t.value!==n.dsinfo.newprojectname&&y(t,n.dsinfo.newprojectname),e.pdata){let t;for(_=n.pdata.ptypes,t=0;t<_.length;t+=1){const a=gn(n,_,t);b[t]?b[t].p(e,a):(b[t]=On(a),b[t].c(),b[t].m(r,null))}for(;t<b.length;t+=1)b[t].d(1);b.length=_.length}e.dsinfo&&w(r,n.dsinfo.ptype_id)},d(e){e&&(p(t),p(n),p(l),p(s),p(i)),u(b,e),a(m)}}}function $n(e){var t,n,l,s;let i=e.pdata.projects,r=[];for(let t=0;t<i.length;t+=1)r[t]=kn(vn(e,i,t));return{c(){t=f("div"),n=f("select"),(l=f("option")).textContent="Please select one";for(let e=0;e<r.length;e+=1)r[e].c();l.disabled=!0,l.__value="",l.value=l.__value,void 0===e.dsinfo.project_id&&z(()=>e.select_change_handler.call(n)),v(t,"class","select"),s=[g(n,"change",e.select_change_handler),g(n,"change",e.project_selected)]},m(a,s){d(a,t,s),o(t,n),o(n,l);for(let e=0;e<r.length;e+=1)r[e].m(n,null);w(n,e.dsinfo.project_id)},p(e,t){if(e.pdata){let a;for(i=t.pdata.projects,a=0;a<i.length;a+=1){const l=vn(t,i,a);r[a]?r[a].p(e,l):(r[a]=kn(l),r[a].c(),r[a].m(n,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=i.length}e.dsinfo&&w(n,t.dsinfo.project_id)},d(e){e&&p(t),u(r,e),a(s)}}}function On(e){var t,n,a,l=e.ptype.name+"";return{c(){t=f("option"),n=m(l),t.__value=a=e.ptype.id,t.value=t.__value},m(e,a){d(e,t,a),o(t,n)},p(e,s){e.pdata&&l!==(l=s.ptype.name+"")&&j(n,l),e.pdata&&a!==(a=s.ptype.id)&&(t.__value=a),t.value=t.__value},d(e){e&&p(t)}}}function kn(e){var t,n,a,l=e.project.name+"";return{c(){t=f("option"),n=m(l),t.__value=a=e.project.id,t.value=t.__value},m(e,a){d(e,t,a),o(t,n)},p(e,s){e.pdata&&l!==(l=s.project.name+"")&&j(n,l),e.pdata&&a!==(a=s.project.id)&&(t.__value=a),t.value=t.__value},d(e){e&&p(t)}}}function qn(e){var t,n,a,l=e.dsinfo.pi.name+"";return{c(){t=f("span"),n=m("External project: "),a=m(l),v(t,"class","tag is-success is-medium")},m(e,l){d(e,t,l),o(t,n),o(t,a)},p(e,t){e.dsinfo&&l!==(l=t.dsinfo.pi.name+"")&&j(a,l)},d(e){e&&p(t)}}}function Nn(e){var t,n,l,s,i,r,c,u;function _(e,t){return t.isNewProject&&t.isNewPI?Cn:t.isNewProject?Fn:void 0}var b=_(0,e),j=b&&b(e);function x(e,t){return t.isNewProject&&!t.isNewPI?Sn:t.isNewProject?En:void 0}var w=x(0,e),$=w&&w(e);return{c(){t=f("div"),n=f("label"),l=m("contact(s)\n          "),j&&j.c(),s=h(),$&&$.c(),i=h(),r=f("div"),c=f("input"),v(n,"class","label"),v(c,"class","input"),v(c,"type","text"),v(c,"placeholder","operational contact email (e.g. postdoc)"),v(r,"class","control"),v(t,"class","field"),u=[g(c,"input",e.input_input_handler_2),g(c,"change",e.editMade)]},m(a,p){d(a,t,p),o(t,n),o(n,l),j&&j.m(n,null),o(t,s),$&&$.m(t,null),o(t,i),o(t,r),o(r,c),y(c,e.dsinfo.externalcontactmail)},p(e,a){b!==(b=_(0,a))&&(j&&j.d(1),(j=b&&b(a))&&(j.c(),j.m(n,null))),w===(w=x(0,a))&&$?$.p(e,a):($&&$.d(1),($=w&&w(a))&&($.c(),$.m(t,i))),e.dsinfo&&c.value!==a.dsinfo.externalcontactmail&&y(c,a.dsinfo.externalcontactmail)},d(e){e&&p(t),j&&j.d(),$&&$.d(),a(u)}}}function Fn(e){var t,n;return{c(){(t=f("a")).textContent="Create new PI",v(t,"class","button is-danger is-outlined is-small"),n=g(t,"click",e.click_handler_1)},m(e,n){d(e,t,n)},d(e){e&&p(t),n()}}}function Cn(e){var t,n;return{c(){(t=f("a")).textContent="Use existing PI",v(t,"class","button is-danger is-outlined is-small"),n=g(t,"click",e.click_handler)},m(e,n){d(e,t,n)},d(e){e&&p(t),n()}}}function En(e){var t,n,l;return{c(){t=f("div"),v(n=f("input"),"class","input"),v(n,"type","text"),v(n,"placeholder","PI name"),v(t,"class","control"),l=[g(n,"input",e.input_input_handler_1),g(n,"input",e.editMade)]},m(a,l){d(a,t,l),o(t,n),y(n,e.dsinfo.newpiname)},p(e,t){e.dsinfo&&n.value!==t.dsinfo.newpiname&&y(n,t.dsinfo.newpiname)},d(e){e&&p(t),a(l)}}}function Sn(e){var t,n,l,s,i;let r=e.pdata.external_pis,c=[];for(let t=0;t<r.length;t+=1)c[t]=Pn(_n(e,r,t));return{c(){t=f("div"),n=f("div"),l=f("select"),(s=f("option")).textContent="Please select one";for(let e=0;e<c.length;e+=1)c[e].c();s.disabled=!0,s.__value="",s.value=s.__value,void 0===e.dsinfo.pi&&z(()=>e.select_change_handler_2.call(l)),v(n,"class","select"),v(t,"class","control"),i=[g(l,"change",e.select_change_handler_2),g(l,"change",e.editMade)]},m(a,i){d(a,t,i),o(t,n),o(n,l),o(l,s);for(let e=0;e<c.length;e+=1)c[e].m(l,null);w(l,e.dsinfo.pi)},p(e,t){if(e.pdata){let n;for(r=t.pdata.external_pis,n=0;n<r.length;n+=1){const a=_n(t,r,n);c[n]?c[n].p(e,a):(c[n]=Pn(a),c[n].c(),c[n].m(l,null))}for(;n<c.length;n+=1)c[n].d(1);c.length=r.length}e.dsinfo&&w(l,t.dsinfo.pi)},d(e){e&&p(t),u(c,e),a(i)}}}function Pn(e){var t,n,a,l=e.expi.name+"";return{c(){t=f("option"),n=m(l),t.__value=a=e.expi,t.value=t.__value},m(e,a){d(e,t,a),o(t,n)},p(e,s){e.pdata&&l!==(l=s.expi.name+"")&&j(n,l),e.pdata&&a!==(a=s.expi)&&(t.__value=a),t.value=t.__value},d(e){e&&p(t)}}}function Mn(e){var t,n,a,l=e.dstype.name+"";return{c(){t=f("option"),n=m(l),t.__value=a=e.dstype.id,t.value=t.__value},m(e,a){d(e,t,a),o(t,n)},p(e,s){e.pdata&&l!==(l=s.dstype.name+"")&&j(n,l),e.pdata&&a!==(a=s.dstype.id)&&(t.__value=a),t.value=t.__value},d(e){e&&p(t)}}}function zn(e){var t,n,a,l,s;function i(n){e.msdata_dsinfo_binding.call(null,n),t=!0,L(()=>t=!1)}function r(t){e.msdata_isNewExperiment_binding.call(null,t),n=!0,L(()=>n=!1)}let c={experiments:e.experiments,prefracs:e.pdata.prefracs,hirief_ranges:e.pdata.hirief_ranges};void 0!==e.dsinfo&&(c.dsinfo=e.dsinfo),void 0!==e.isNewExperiment&&(c.isNewExperiment=e.isNewExperiment);var o=new It({props:c});function u(t){e.acquicomp_1_errors_binding.call(null,t),l=!0,L(()=>l=!1)}e.msdata_binding(o),C.push(()=>J(o,"dsinfo",i)),C.push(()=>J(o,"isNewExperiment",r)),o.$on("edited",e.editMade);let f={};void 0!==e.errors.acqui&&(f.errors=e.errors.acqui);var m=new Se({props:f});return e.acquicomp_1_binding(m),C.push(()=>J(m,"errors",u)),{c(){o.$$.fragment.c(),a=h(),m.$$.fragment.c()},m(e,t){G(o,e,t),d(e,a,t),G(m,e,t),s=!0},p(e,a){var s={};e.experiments&&(s.experiments=a.experiments),e.pdata&&(s.prefracs=a.pdata.prefracs),e.pdata&&(s.hirief_ranges=a.pdata.hirief_ranges),!t&&e.dsinfo&&(s.dsinfo=a.dsinfo),!n&&e.isNewExperiment&&(s.isNewExperiment=a.isNewExperiment),o.$set(s);var i={};!l&&e.errors&&(i.errors=a.errors.acqui),m.$set(i)},i(e){s||(A(o.$$.fragment,e),A(m.$$.fragment,e),s=!0)},o(e){Q(o.$$.fragment,e),Q(m.$$.fragment,e),s=!1},d(t){e.msdata_binding(null),K(o,t),t&&p(a),e.acquicomp_1_binding(null),K(m,t)}}}function Ln(e){var t,n;function a(n){e.prepcomp_1_errors_binding.call(null,n),t=!0,L(()=>t=!1)}let l={};void 0!==e.errors.sprep&&(l.errors=e.errors.sprep);var s=new xt({props:l});return e.prepcomp_1_binding(s),C.push(()=>J(s,"errors",a)),{c(){s.$$.fragment.c()},m(e,t){G(s,e,t),n=!0},p(e,n){var a={};!t&&e.errors&&(a.errors=n.errors.sprep),s.$set(a)},i(e){n||(A(s.$$.fragment,e),n=!0)},o(e){Q(s.$$.fragment,e),n=!1},d(t){e.prepcomp_1_binding(null),K(s,t)}}}function Tn(e){var t,n;function a(n){e.lcheck_errors_binding.call(null,n),t=!0,L(()=>t=!1)}let l={};void 0!==e.errors.lc&&(l.errors=e.errors.lc);var s=new nn({props:l});return e.lcheck_binding(s),C.push(()=>J(s,"errors",a)),{c(){s.$$.fragment.c()},m(e,t){G(s,e,t),n=!0},p(e,n){var a={};!t&&e.errors&&(a.errors=n.errors.lc),s.$set(a)},i(e){n||(A(s.$$.fragment,e),n=!0)},o(e){Q(s.$$.fragment,e),n=!1},d(t){e.lcheck_binding(null),K(s,t)}}}function In(e){var t,n,l,s,i,r,c,_,b,j,$,O,k,q,N,F,C,E,S,P,M,L,T,I,D,R,B,J,V,W,X,Y,Z,ee,te,ne,ae,le,se,ie,re,ce,oe,de,pe,ue,fe,me,he,_e,ge,ve,be,je=e.components.indexOf("sampleprep")>-1,xe=e.Object.keys(e.$datasetFiles).length&&e.components.indexOf("labelchecksamples")>-1,we=new ye({props:{cssclass:"sticky",errors:e.Object.values(e.saveerrors).flat().concat(e.Object.values(e.errors).flat())}}),$e=e.$dataset_id&&bn(e),Oe=e.dsinfo.storage_location&&jn(e),ke={c(){v(be=f("i"),"class","icon fas fa-check-circle")},m(e,t){d(e,be,t)},d(e){e&&p(be)}};function qe(e,t){return t.isNewProject?xn:yn}var Ne=qe(0,e),Fe=Ne(e);function Ce(e,t){return t.isNewProject?wn:$n}var Ee=Ce(0,e),Se=Ee(e),Pe=e.isExternal&&qn(e),Me=e.isExternal&&Nn(e);let ze=e.pdata.datasettypes,Le=[];for(let t=0;t<ze.length;t+=1)Le[t]=Mn(hn(e,ze,t));var Te=e.showMsdata&&zn(e),Ie=je&&Ln(e),De=xe&&Tn(e);var Re=new fn({props:{}});return e.files_binding(Re),{c(){we.$$.fragment.c(),t=h(),n=f("div"),l=f("ul"),s=f("li"),(i=f("a")).innerHTML="<span>Metadata</span>",c=h(),$e&&$e.c(),_=h(),(b=f("h4")).textContent="Dataset",j=h(),$=f("div"),O=f("div"),Oe&&Oe.c(),k=h(),q=f("h5"),ke&&ke.c(),N=m("\n        Basics\n        "),F=f("button"),C=m("Save"),S=h(),P=f("button"),M=m("Revert"),T=h(),I=f("div"),D=f("label"),R=m("Project\n          "),B=f("a"),Fe.c(),J=h(),V=f("div"),Se.c(),W=h(),Pe&&Pe.c(),X=h(),Me&&Me.c(),Y=h(),Z=f("div"),(ee=f("label")).textContent="Dataset type",te=h(),ne=f("div"),ae=f("div"),le=f("select"),(se=f("option")).textContent="Please select one";for(let e=0;e<Le.length;e+=1)Le[e].c();ie=h(),re=f("div"),(ce=f("label")).textContent="Run name",oe=h(),de=f("div"),pe=f("input"),ue=h(),Te&&Te.c(),fe=h(),Ie&&Ie.c(),me=h(),De&&De.c(),he=h(),_e=f("div"),Re.$$.fragment.c(),v(s,"class",r="meta"===e.tabshow?"is-active":""),v(n,"class","tabs is-toggle is-centered is-small"),v(b,"class","title is-4"),v(F,"class","button is-small is-danger has-text-weight-bold"),F.disabled=E=!e.edited,v(P,"class","button is-small is-info has-text-weight-bold"),P.disabled=L=!e.edited||!e.dsinfo.datatype_id,v(q,"class","has-text-primary title is-5"),v(B,"class","button is-danger is-outlined is-small"),v(D,"class","label"),v(V,"class","control"),v(I,"class","field"),v(ee,"class","label"),se.disabled=!0,se.__value="",se.value=se.__value,void 0===e.dsinfo.datatype_id&&z(()=>e.select_change_handler_3.call(le)),v(ae,"class","select"),v(ne,"class","control"),v(Z,"class","field"),v(ce,"class","label"),v(pe,"class","input"),v(pe,"type","text"),v(pe,"placeholder","E.g set1, lc3, rerun5b, etc"),v(de,"class","control"),v(re,"class","field"),v(O,"class","box"),v(O,"id","project"),x($,"display","meta"!==e.tabshow?"none":""),x(_e,"display","files"!==e.tabshow?"none":""),ve=[g(i,"click",e.showMetadata),g(F,"click",e.save),g(P,"click",e.fetchDataset),g(B,"click",e.toggle_project),g(le,"change",e.select_change_handler_3),g(le,"change",e.getcomponents),g(pe,"input",e.input_input_handler_3),g(pe,"change",e.editMade)]},m(a,r){G(we,a,r),d(a,t,r),d(a,n,r),o(n,l),o(l,s),o(s,i),o(l,c),$e&&$e.m(l,null),d(a,_,r),d(a,b,r),d(a,j,r),d(a,$,r),o($,O),Oe&&Oe.m(O,null),o(O,k),o(O,q),ke&&ke.m(q,null),o(q,N),o(q,F),o(F,C),o(q,S),o(q,P),o(P,M),o(O,T),o(O,I),o(I,D),o(D,R),o(D,B),Fe.m(B,null),o(I,J),o(I,V),Se.m(V,null),o(V,W),Pe&&Pe.m(V,null),o(O,X),Me&&Me.m(O,null),o(O,Y),o(O,Z),o(Z,ee),o(Z,te),o(Z,ne),o(ne,ae),o(ae,le),o(le,se);for(let e=0;e<Le.length;e+=1)Le[e].m(le,null);w(le,e.dsinfo.datatype_id),o(O,ie),o(O,re),o(re,ce),o(re,oe),o(re,de),o(de,pe),y(pe,e.dsinfo.runname),o(O,ue),Te&&Te.m(O,null),o(O,fe),Ie&&Ie.m(O,null),o(O,me),De&&De.m(O,null),d(a,he,r),d(a,_e,r),G(Re,_e,null),ge=!0},p(e,t){var n={};if((e.saveerrors||e.errors)&&(n.errors=t.Object.values(t.saveerrors).flat().concat(t.Object.values(t.errors).flat())),we.$set(n),ge&&!e.tabshow||r===(r="meta"===t.tabshow?"is-active":"")||v(s,"class",r),t.$dataset_id?$e?$e.p(e,t):(($e=bn(t)).c(),$e.m(l,null)):$e&&($e.d(1),$e=null),t.dsinfo.storage_location?Oe?Oe.p(e,t):((Oe=jn(t)).c(),Oe.m(O,k)):Oe&&(Oe.d(1),Oe=null),ge&&!e.edited||E===(E=!t.edited)||(F.disabled=E),ge&&!e.edited&&!e.dsinfo||L===(L=!t.edited||!t.dsinfo.datatype_id)||(P.disabled=L),Ne!==(Ne=qe(0,t))&&(Fe.d(1),(Fe=Ne(t))&&(Fe.c(),Fe.m(B,null))),Ee===(Ee=Ce(0,t))&&Se?Se.p(e,t):(Se.d(1),(Se=Ee(t))&&(Se.c(),Se.m(V,W))),t.isExternal?Pe?Pe.p(e,t):((Pe=qn(t)).c(),Pe.m(V,null)):Pe&&(Pe.d(1),Pe=null),t.isExternal?Me?Me.p(e,t):((Me=Nn(t)).c(),Me.m(O,Y)):Me&&(Me.d(1),Me=null),e.pdata){let n;for(ze=t.pdata.datasettypes,n=0;n<ze.length;n+=1){const a=hn(t,ze,n);Le[n]?Le[n].p(e,a):(Le[n]=Mn(a),Le[n].c(),Le[n].m(le,null))}for(;n<Le.length;n+=1)Le[n].d(1);Le.length=ze.length}e.dsinfo&&w(le,t.dsinfo.datatype_id),e.dsinfo&&pe.value!==t.dsinfo.runname&&y(pe,t.dsinfo.runname),t.showMsdata?Te?(Te.p(e,t),A(Te,1)):((Te=zn(t)).c(),A(Te,1),Te.m(O,fe)):Te&&(U(),Q(Te,1,1,()=>{Te=null}),H()),e.components&&(je=t.components.indexOf("sampleprep")>-1),je?Ie?(Ie.p(e,t),A(Ie,1)):((Ie=Ln(t)).c(),A(Ie,1),Ie.m(O,me)):Ie&&(U(),Q(Ie,1,1,()=>{Ie=null}),H()),(e.$datasetFiles||e.components)&&(xe=t.Object.keys(t.$datasetFiles).length&&t.components.indexOf("labelchecksamples")>-1),xe?De?(De.p(e,t),A(De,1)):((De=Tn(t)).c(),A(De,1),De.m(O,null)):De&&(U(),Q(De,1,1,()=>{De=null}),H()),ge&&!e.tabshow||x($,"display","meta"!==t.tabshow?"none":"");Re.$set({}),ge&&!e.tabshow||x(_e,"display","files"!==t.tabshow?"none":"")},i(e){ge||(A(we.$$.fragment,e),A(Te),A(Ie),A(De),A(Re.$$.fragment,e),ge=!0)},o(e){Q(we.$$.fragment,e),Q(Te),Q(Ie),Q(De),Q(Re.$$.fragment,e),ge=!1},d(l){K(we,l),l&&(p(t),p(n)),$e&&$e.d(),l&&(p(_),p(b),p(j),p($)),Oe&&Oe.d(),ke&&ke.d(),Fe.d(),Se.d(),Pe&&Pe.d(),Me&&Me.d(),u(Le,l),Te&&Te.d(),Ie&&Ie.d(),De&&De.d(),l&&(p(he),p(_e)),e.files_binding(null),K(Re),a(ve)}}}function Dn(e,t,n){let a,l,s,r,c,o,d;i(e,ne,e=>{n("$dataset_id",a=e)}),i(e,ae,e=>{n("$datasetFiles",l=e)}),init_dataset_id&&ne.set(init_dataset_id);let p=!1,u={basics:[],sprep:[],acqui:[],lc:[]},f=Object.assign({},u),m=[],h={datatype_id:"",project_id:"",ptype_id:"",storage_location:"",newprojectname:"",experiment_id:"",runname:"",pi:"",externalcontactmail:"",prefrac_id:"",prefrac_length:"",prefrac_amount:"",hiriefrange:""},_={datasettypes:[],ptypes:[],projects:[],local_ptype_id:"",external_pis:[],prefracs:[],hirief_ranges:[]},g=[],v=!1,b=!1,j=!1,y=[],x="meta";async function w(){const e=await Y(`/datasets/show/components/${h.datatype_id}`);n("components",g=e.components)}async function O(e=!1,t=!1){if(h.project_id){const e=await Y(`/datasets/show/project/${h.project_id}`);n("dsinfo",h.pi=_.external_pis.filter(t=>t.id===e.pi_id)[0],h),n("dsinfo",h.ptype_id=e.ptype_id,h),n("experiments",y=e.experiments);for(let e in le)delete le[e];for(let[t,n]of Object.entries(e.projsamples))le[t]=n;n("isNewProject",v=!1)}t||n("dsinfo",h.experiment_id="",h),k()}function k(){n("edited",p=!0),n("errors",u.basics=u.basics.length?F():[],u)}async function N(){let e="/datasets/show/info/";e=a?e+a:e;const t=await Y(e);for(let[e,a]of Object.entries(t.projdata))n("pdata",_[e]=a,_);for(let[e,a]of Object.entries(t.dsinfo))n("dsinfo",h[e]=a,h);a&&(w(),await O(!1,!0),n("isNewExperiment",b=!1),n("isNewPI",j=!1)),n("edited",p=!1)}function F(){m=[];const e=RegExp("^[a-z0-9-_]+$","i");return v&&!h.newprojectname||!v&&!h.project_id?m.push("Project needs to be selected or created"):v&&h.newprojectname&&!e.test(h.newprojectname)&&m.push("Project name may only contain a-z 0-9 - _"),h.runname?e.test(h.runname)||m.push("Run name may only contain a-z 0-9 - _"):m.push("Run name is required"),E&&(b&&!h.newexperimentname||!b&&!h.experiment_id)?m.push("Experiment is required"):E&&b&&h.newexperimentname&&!e.test(h.newexperimentname)&&m.push("Experiment name may only contain a-z 0-9 - _"),S&&(h.newpiname||h.pi.id||m.push("Need to select or create a PI"),h.externalcontactmail||m.push("External contact is required")),h.datatype_id||m.push("Datatype is required"),m}q(async()=>{await N()});let E,S;return e.$$.update=((e={components:1,dsinfo:1,pdata:1})=>{e.components&&n("showMsdata",E=g.indexOf("acquisition")>-1),(e.dsinfo||e.pdata)&&n("isExternal",S=h.ptype_id&&h.ptype_id!==_.local_ptype_id)}),{mssubcomp:s,acquicomp:r,prepcomp:c,lccomp:o,filescomp:d,edited:p,errors:u,saveerrors:f,dsinfo:h,pdata:_,components:g,isNewProject:v,isNewExperiment:b,isNewPI:j,experiments:y,tabshow:x,getcomponents:w,project_selected:O,toggle_project:function(){n("isNewProject",v=!1===v)},editMade:k,fetchDataset:N,save:async function(){if(n("errors",u.basics=F(),u),E){let e=s.validate();n("errors",u.basics=[...u.basics,...e],u)}if(0===u.basics.length){let e={dataset_id:a,ptype_id:h.ptype_id,datatype_id:h.datatype_id,runname:h.runname,prefrac_id:h.prefrac_id,prefrac_length:h.prefrac_length,prefrac_amount:h.prefrac_amount,hiriefrange:h.hiriefrange};v?e.newprojectname=h.newprojectname:e.project_id=h.project_id,b?e.newexperimentname=h.newexperimentname:e.experiment_id=h.experiment_id,j?e.newpiname=h.newpiname:e.pi_id=S?h.pi.id:_.internal_pi_id,h.ptype_id!==_.local_ptype_id&&(e.externalcontact=h.externalcontactmail);const t=await Z("/datasets/save/project/",e);"error"in t?n("saveerrors",f.basics=[t.error,...f.basics],f):(ne.set(t.dataset_id),console.log(a),N())}},showMetadata:function(){n("tabshow",x="meta")},showFiles:function(){n("tabshow",x=a?"files":x)},Object:Object,showMsdata:E,isExternal:S,$dataset_id:a,$datasetFiles:l,select_change_handler:function(){h.project_id=$(this),n("dsinfo",h),n("pdata",_)},input_input_handler:function(){h.newprojectname=this.value,n("dsinfo",h),n("pdata",_)},select_change_handler_1:function(){h.ptype_id=$(this),n("dsinfo",h),n("pdata",_)},click_handler:e=>n("isNewPI",j=!j),click_handler_1:e=>n("isNewPI",j=!j),select_change_handler_2:function(){h.pi=$(this),n("dsinfo",h),n("pdata",_)},input_input_handler_1:function(){h.newpiname=this.value,n("dsinfo",h),n("pdata",_)},input_input_handler_2:function(){h.externalcontactmail=this.value,n("dsinfo",h),n("pdata",_)},select_change_handler_3:function(){h.datatype_id=$(this),n("dsinfo",h),n("pdata",_)},input_input_handler_3:function(){h.runname=this.value,n("dsinfo",h),n("pdata",_)},msdata_binding:function(e){C[e?"unshift":"push"](()=>{n("mssubcomp",s=e)})},msdata_dsinfo_binding:function(e){n("dsinfo",h=e)},msdata_isNewExperiment_binding:function(e){n("isNewExperiment",b=e)},acquicomp_1_binding:function(e){C[e?"unshift":"push"](()=>{n("acquicomp",r=e)})},acquicomp_1_errors_binding:function(e){u.acqui=e,n("errors",u)},prepcomp_1_binding:function(e){C[e?"unshift":"push"](()=>{n("prepcomp",c=e)})},prepcomp_1_errors_binding:function(e){u.sprep=e,n("errors",u)},lcheck_binding:function(e){C[e?"unshift":"push"](()=>{n("lccomp",o=e)})},lcheck_errors_binding:function(e){u.lc=e,n("errors",u)},files_binding:function(e){C[e?"unshift":"push"](()=>{n("filescomp",d=e)})}}}return new class extends X{constructor(e){super(),W(this,e,Dn,In,s,[])}}({target:document.querySelector("#appbox")})}();
//# sourceMappingURL=bundle.js.map
