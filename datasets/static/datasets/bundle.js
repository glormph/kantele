var app=function(){"use strict";function e(){}function t(e){return e()}function n(){return Object.create(null)}function a(e){e.forEach(t)}function l(e){return"function"==typeof e}function i(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function r(e,t){e.appendChild(t)}function s(e,t,n){e.insertBefore(t,n||null)}function c(e){e.parentNode.removeChild(e)}function o(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function d(e){return document.createElement(e)}function p(e){return document.createTextNode(e)}function u(){return p(" ")}function f(){return p("")}function m(e,t,n,a){return e.addEventListener(t,n,a),()=>e.removeEventListener(t,n,a)}function h(e,t,n){null==n?e.removeAttribute(t):e.setAttribute(t,n)}function _(e){return""===e?void 0:+e}function g(e,t){t=""+t,e.data!==t&&(e.data=t)}function v(e,t){(null!=t||e.value)&&(e.value=t)}function b(e,t,n,a){e.style.setProperty(t,n,a?"important":"")}function x(e,t){for(let n=0;n<e.options.length;n+=1){const a=e.options[n];if(a.__value===t)return void(a.selected=!0)}}function j(e){const t=e.querySelector(":checked")||e.options[0];return t&&t.__value}let y;function w(e){y=e}function O(e){(function(){if(!y)throw new Error("Function called outside component initialization");return y})().$$.on_mount.push(e)}function $(){const e=y;return(t,n)=>{const a=e.$$.callbacks[t];if(a){const l=function(e,t){const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!1,!1,t),n}(t,n);a.slice().forEach(t=>{t.call(e,l)})}}}const k=[],q=[],N=[],F=[],C=Promise.resolve();let E=!1;function P(e){N.push(e)}function S(e){F.push(e)}function M(){const e=new Set;do{for(;k.length;){const e=k.shift();w(e),z(e.$$)}for(;q.length;)q.pop()();for(let t=0;t<N.length;t+=1){const n=N[t];e.has(n)||(n(),e.add(n))}N.length=0}while(k.length);for(;F.length;)F.pop()();E=!1}function z(e){e.fragment&&(e.update(e.dirty),a(e.before_update),e.fragment.p(e.dirty,e.ctx),e.dirty=null,e.after_update.forEach(P))}const L=new Set;let I;function T(){I={r:0,c:[],p:I}}function U(){I.r||a(I.c),I=I.p}function D(e,t){e&&e.i&&(L.delete(e),e.i(t))}function R(e,t,n,a){if(e&&e.o){if(L.has(e))return;L.add(e),I.c.push(()=>{L.delete(e),a&&(n&&e.d(1),a())}),e.o(t)}}const H="undefined"!=typeof window?window:global;function Q(e,t,n){-1!==e.$$.props.indexOf(t)&&(e.$$.bound[t]=n,n(e.$$.ctx[t]))}function A(e,n,i){const{fragment:r,on_mount:s,on_destroy:c,after_update:o}=e.$$;r.m(n,i),P(()=>{const n=s.map(t).filter(l);c?c.push(...n):a(n),e.$$.on_mount=[]}),o.forEach(P)}function B(e,t){e.$$.fragment&&(a(e.$$.on_destroy),e.$$.fragment.d(t),e.$$.on_destroy=e.$$.fragment=null,e.$$.ctx={})}function J(e,t){e.$$.dirty||(k.push(e),E||(E=!0,C.then(M)),e.$$.dirty=n()),e.$$.dirty[t]=!0}function G(t,l,i,r,s,c){const o=y;w(t);const d=l.props||{},p=t.$$={fragment:null,ctx:null,props:c,update:e,not_equal:s,bound:n(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(o?o.$$.context:[]),callbacks:n(),dirty:null};let u=!1;var f;p.ctx=i?i(t,d,(e,n,a=n)=>(p.ctx&&s(p.ctx[e],p.ctx[e]=a)&&(p.bound[e]&&p.bound[e](a),u&&J(t,e)),n)):d,p.update(),u=!0,a(p.before_update),p.fragment=r(p.ctx),l.target&&(l.hydrate?p.fragment.l((f=l.target,Array.from(f.childNodes))):p.fragment.c(),l.intro&&D(t.$$.fragment),A(t,l.target,l.anchor),M()),w(o)}class K{$destroy(){B(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(){}}async function V(e){const t=await fetch(e);return await t.json()}async function W(e,t){const n=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return await n.json()}const X=[];const Y=function(t,n=e){let a;const l=[];function r(e){if(i(t,e)&&(t=e,a)){const e=!X.length;for(let e=0;e<l.length;e+=1){const n=l[e];n[1](),X.push(n,t)}if(e){for(let e=0;e<X.length;e+=2)X[e][0](X[e+1]);X.length=0}}}return{set:r,update:function(e){r(e(t))},subscribe:function(i,s=e){const c=[i,s];return l.push(c),1===l.length&&(a=n(r)||e),i(t),()=>{const e=l.indexOf(c);-1!==e&&l.splice(e,1),0===l.length&&(a(),a=null)}}}}({});function Z(e,t,n){const a=Object.create(e);return a.option=t[n],a.each_value_1=t,a.option_index_1=n,a}function ee(e,t,n){const a=Object.create(e);return a.option=t[n],a}function te(e){var t;let n=e.param.fields,a=[];for(let t=0;t<n.length;t+=1)a[t]=ie(Z(e,n,t));return{c(){for(let e=0;e<a.length;e+=1)a[e].c();t=f()},m(e,n){for(let t=0;t<a.length;t+=1)a[t].m(e,n);s(e,t,n)},p(e,l){if(e.param){let i;for(n=l.param.fields,i=0;i<n.length;i+=1){const r=Z(l,n,i);a[i]?a[i].p(e,r):(a[i]=ie(r),a[i].c(),a[i].m(t.parentNode,t))}for(;i<a.length;i+=1)a[i].d(1);a.length=n.length}},d(e){o(a,e),e&&c(t)}}}function ne(e){var t,n,l,i=!1;function r(){i=!0,e.input_input_handler_1.call(t)}return{c(){h(t=d("input"),"type","number"),h(t,"class","input"),h(t,"placeholder",n=e.param.placeholder),l=[m(t,"input",r),m(t,"change",e.edited)]},m(n,a){s(n,t,a),v(t,e.param.model)},p(e,a){!i&&e.param&&v(t,a.param.model),i=!1,e.param&&n!==(n=a.param.placeholder)&&h(t,"placeholder",n)},d(e){e&&c(t),a(l)}}}function ae(e){var t,n,l;return{c(){h(t=d("input"),"type","text"),h(t,"class","input"),h(t,"placeholder",n=e.param.placeholder),l=[m(t,"input",e.input_input_handler),m(t,"change",e.edited)]},m(n,a){s(n,t,a),v(t,e.param.model)},p(e,a){e.param&&t.value!==a.param.model&&v(t,a.param.model),e.param&&n!==(n=a.param.placeholder)&&h(t,"placeholder",n)},d(e){e&&c(t),a(l)}}}function le(e){var t,n,l,i;let p=e.param.fields,u=[];for(let t=0;t<p.length;t+=1)u[t]=re(ee(e,p,t));return{c(){t=d("div"),n=d("select"),(l=d("option")).textContent="Please select one";for(let e=0;e<u.length;e+=1)u[e].c();l.disabled=!0,l.__value="",l.value=l.__value,void 0===e.param.model&&P(()=>e.select_change_handler.call(n)),h(t,"class","select"),i=[m(n,"change",e.select_change_handler),m(n,"change",e.edited)]},m(a,i){s(a,t,i),r(t,n),r(n,l);for(let e=0;e<u.length;e+=1)u[e].m(n,null);x(n,e.param.model)},p(e,t){if(e.param){let a;for(p=t.param.fields,a=0;a<p.length;a+=1){const l=ee(t,p,a);u[a]?u[a].p(e,l):(u[a]=re(l),u[a].c(),u[a].m(n,null))}for(;a<u.length;a+=1)u[a].d(1);u.length=p.length}e.param&&x(n,t.param.model)},d(e){e&&c(t),o(u,e),a(i)}}}function ie(e){var t,n,l,i,o,f=e.option.text+"";function _(){e.input_change_handler.call(n,e)}return{c(){t=d("div"),n=d("input"),l=p(f),i=u(),h(n,"type","checkbox"),h(t,"class","control"),o=[m(n,"change",_),m(n,"change",e.edited)]},m(a,c){s(a,t,c),r(t,n),n.checked=e.option.checked,r(t,l),r(t,i)},p(t,a){e=a,t.param&&(n.checked=e.option.checked),t.param&&f!==(f=e.option.text+"")&&g(l,f)},d(e){e&&c(t),a(o)}}}function re(e){var t,n,a,l=e.option.text+"";return{c(){t=d("option"),n=p(l),t.__value=a=e.option.value,t.value=t.__value},m(e,a){s(e,t,a),r(t,n)},p(e,i){e.param&&l!==(l=i.option.text+"")&&g(n,l),e.param&&a!==(a=i.option.value)&&(t.__value=a),t.value=t.__value},d(e){e&&c(t)}}}function se(t){var n,a,l,i,o,f=t.param.title+"";function m(e,t){return"select"===t.param.inputtype?le:"text"===t.param.inputtype?ae:"number"===t.param.inputtype?ne:"checkbox"===t.param.inputtype?te:void 0}var _=m(0,t),v=_&&_(t);return{c(){n=d("div"),a=d("label"),l=p(f),i=u(),o=d("div"),v&&v.c(),h(a,"class","label"),h(o,"class","control"),h(n,"class","field")},m(e,t){s(e,n,t),r(n,a),r(a,l),r(n,i),r(n,o),v&&v.m(o,null)},p(e,t){e.param&&f!==(f=t.param.title+"")&&g(l,f),_===(_=m(0,t))&&v?v.p(e,t):(v&&v.d(1),(v=_&&_(t))&&(v.c(),v.m(o,null)))},i:e,o:e,d(e){e&&c(n),v&&v.d()}}}function ce(e,t,n){const a=$();let{param:l}=t;return e.$set=(e=>{"param"in e&&n("param",l=e.param)}),{param:l,edited:function(){a("edited")},select_change_handler:function(){l.model=j(this),n("param",l)},input_input_handler:function(){l.model=this.value,n("param",l)},input_input_handler_1:function(){l.model=_(this.value),n("param",l)},input_change_handler:function({option:e,each_value_1:t,option_index_1:a}){t[a].checked=this.checked,n("param",l)}}}class oe extends K{constructor(e){super(),G(this,e,ce,se,i,["param"])}}const{Object:de}=H;function pe(e,t,n){const a=de.create(e);return a.param_id=t[n][0],a.param=t[n][1],a.each_value=t,a.each_index=n,a}function ue(e,t,n){const a=de.create(e);return a.operator=t[n],a}function fe(e){var t;return{c(){h(t=d("i"),"class","icon fas fa-edit")},m(e,n){s(e,t,n)},d(e){e&&c(t)}}}function me(e){var t;return{c(){h(t=d("i"),"class","icon fas fa-check-circle")},m(e,n){s(e,t,n)},d(e){e&&c(t)}}}function he(e){var t,n,a,l=e.operator.name+"";return{c(){t=d("option"),n=p(l),t.__value=a=e.operator.id,t.value=t.__value},m(e,a){s(e,t,a),r(t,n)},p(e,i){e.acqdata&&l!==(l=i.operator.name+"")&&g(n,l),e.acqdata&&a!==(a=i.operator.id)&&(t.__value=a),t.value=t.__value},d(e){e&&c(t)}}}function _e(e){var t,n,l=!1;function i(){l=!0,e.input_input_handler.call(t)}return{c(){h(t=d("input"),"type","number"),h(t,"class","input"),h(t,"placeholder","in minutes"),n=[m(t,"input",i),m(t,"change",e.editMade)]},m(n,a){s(n,t,a),v(t,e.dsinfo.rp_length)},p(e,n){!l&&e.dsinfo&&v(t,n.dsinfo.rp_length),l=!1},d(e){e&&c(t),a(n)}}}function ge(e){var t,n;function a(n){e.param_param_binding.call(null,n,e),t=!0,S(()=>t=!1)}let l={};void 0!==e.param&&(l.param=e.param);var i=new oe({props:l});return q.push(()=>Q(i,"param",a)),i.$on("edited",e.editMade),{c(){i.$$.fragment.c()},m(e,t){A(i,e,t),n=!0},p(n,a){e=a;var l={};(!t&&n.Object||n.dsinfo)&&(l.param=e.param),i.$set(l)},i(e){n||(D(i.$$.fragment,e),n=!0)},o(e){R(i.$$.fragment,e),n=!1},d(e){B(i,e)}}}function ve(e){var t,n,l,i,_,g,v,b,j,y,w,O,$,k,q,N,F,C,E,S,M,z,L,I,H,Q,A,B;function J(e,t){return t.stored?me:t.edited?fe:void 0}var G=J(0,e),K=G&&G(e);let V=e.acqdata.operators,W=[];for(let t=0;t<V.length;t+=1)W[t]=he(ue(e,V,t));var X=!e.dsinfo.dynamic_rp&&_e(e);let Y=e.Object.entries(e.dsinfo.params),Z=[];for(let t=0;t<Y.length;t+=1)Z[t]=ge(pe(e,Y,t));const ee=e=>R(Z[e],1,1,()=>{Z[e]=null});return{c(){t=d("h5"),K&&K.c(),n=p("\n  Acquisition\n  "),l=d("button"),i=p("Save"),g=u(),v=d("button"),b=p("Revert"),y=u(),w=d("div"),(O=d("label")).textContent="Operator",$=u(),k=d("div"),q=d("div"),N=d("select"),(F=d("option")).textContent="Please select one";for(let e=0;e<W.length;e+=1)W[e].c();C=u(),E=d("div"),(S=d("label")).textContent="Reverse phase length",M=u(),z=d("div"),L=d("input"),I=p("Dynamic\n    "),X&&X.c(),H=u();for(let e=0;e<Z.length;e+=1)Z[e].c();Q=f(),h(l,"class","button is-small is-danger has-text-weight-bold"),l.disabled=_=!e.edited,h(v,"class","button is-small is-info has-text-weight-bold"),v.disabled=j=!e.edited,h(t,"class","has-text-primary title is-5"),h(O,"class","label"),F.disabled=!0,F.__value="",F.value=F.__value,void 0===e.dsinfo.operator_id&&P(()=>e.select_change_handler.call(N)),h(q,"class","select"),h(k,"class","control"),h(w,"class","field"),h(S,"class","label"),h(L,"type","checkbox"),h(z,"class","control"),h(E,"class","field"),B=[m(l,"click",e.save),m(v,"click",e.fetchData),m(N,"change",e.select_change_handler),m(N,"change",e.editMade),m(L,"change",e.input_change_handler),m(L,"change",e.editMade)]},m(a,c){s(a,t,c),K&&K.m(t,null),r(t,n),r(t,l),r(l,i),r(t,g),r(t,v),r(v,b),s(a,y,c),s(a,w,c),r(w,O),r(w,$),r(w,k),r(k,q),r(q,N),r(N,F);for(let e=0;e<W.length;e+=1)W[e].m(N,null);x(N,e.dsinfo.operator_id),s(a,C,c),s(a,E,c),r(E,S),r(E,M),r(E,z),r(z,L),L.checked=e.dsinfo.dynamic_rp,r(z,I),X&&X.m(z,null),s(a,H,c);for(let e=0;e<Z.length;e+=1)Z[e].m(a,c);s(a,Q,c),A=!0},p(e,a){if(G!==(G=J(0,a))&&(K&&K.d(1),(K=G&&G(a))&&(K.c(),K.m(t,n))),A&&!e.edited||_===(_=!a.edited)||(l.disabled=_),A&&!e.edited||j===(j=!a.edited)||(v.disabled=j),e.acqdata){let t;for(V=a.acqdata.operators,t=0;t<V.length;t+=1){const n=ue(a,V,t);W[t]?W[t].p(e,n):(W[t]=he(n),W[t].c(),W[t].m(N,null))}for(;t<W.length;t+=1)W[t].d(1);W.length=V.length}if(e.dsinfo&&x(N,a.dsinfo.operator_id),e.dsinfo&&(L.checked=a.dsinfo.dynamic_rp),a.dsinfo.dynamic_rp?X&&(X.d(1),X=null):X?X.p(e,a):((X=_e(a)).c(),X.m(z,null)),e.Object||e.dsinfo){let t;for(Y=a.Object.entries(a.dsinfo.params),t=0;t<Y.length;t+=1){const n=pe(a,Y,t);Z[t]?(Z[t].p(e,n),D(Z[t],1)):(Z[t]=ge(n),Z[t].c(),D(Z[t],1),Z[t].m(Q.parentNode,Q))}for(T(),t=Y.length;t<Z.length;t+=1)ee(t);U()}},i(e){if(!A){for(let e=0;e<Y.length;e+=1)D(Z[e]);A=!0}},o(e){Z=Z.filter(Boolean);for(let e=0;e<Z.length;e+=1)R(Z[e]);A=!1},d(e){e&&c(t),K&&K.d(),e&&(c(y),c(w)),o(W,e),e&&(c(C),c(E)),X&&X.d(),e&&c(H),o(Z,e),e&&c(Q),a(B)}}}function be(e,t,n){let a,{errors:l}=t,i={operator_id:"",dynamic_rp:!1,rp_length:"",params:[]},r={operators:[]},s=!1;function c(){let e=[];i.operator_id||e.push("Operator is required"),i.dynamic_rp||i.rp_length||e.push("Reverse phase is required");for(let t in i.params)i.params[t].model||e.push(i.params[t].title+" is required");return e}async function o(){let e="/datasets/show/acquisition/";e=dataset_id?e+dataset_id:e;const t=await V(e);for(let[e,a]of Object.entries(t.acqdata))n("acqdata",r[e]=a,r);for(let[e,a]of Object.entries(t.dsinfo))n("dsinfo",i[e]=a,i);n("edited",s=!1)}return O(async()=>{o()}),e.$set=(e=>{"errors"in e&&n("errors",l=e.errors)}),e.$$.update=((e={edited:1})=>{e.edited&&n("stored",a=dataset_id&&!s)}),{errors:l,dsinfo:i,acqdata:r,edited:s,editMade:function(){n("errors",l=l.length?c():[]),n("edited",s=!0)},validate:c,save:async function(){if(n("errors",l=c()),0===l.length){let e={dataset_id:dataset_id,operator_id:i.operator_id,params:i.params,rp_length:i.dynamic_rp?"":i.rp_length},t="/datasets/save/acquisition/";await W(t,e),o()}},fetchData:o,stored:a,Object:Object,select_change_handler:function(){i.operator_id=j(this),n("dsinfo",i),n("acqdata",r)},input_change_handler:function(){i.dynamic_rp=this.checked,n("dsinfo",i),n("acqdata",r)},input_input_handler:function(){i.rp_length=_(this.value),n("dsinfo",i),n("acqdata",r)},param_param_binding:function(e,{param:t,each_value:a,each_index:l}){a[l][1]=e,n("Object",Object)}}}class xe extends K{constructor(e){super(),G(this,e,be,ve,i,["errors","validate","save"])}get validate(){return this.$$.ctx.validate}get save(){return this.$$.ctx.save}}function je(e,t,n){const a=Object.create(e);return a.org_id=t[n][0],a.organism=t[n][1],a}function ye(e){var t,n,a,l=!Object.keys(e.options).length,i=l&&we();let p=Object.entries(e.options),u=[];for(let t=0;t<p.length;t+=1)u[t]=Oe(je(e,p,t));return{c(){t=d("div"),n=d("select"),i&&i.c(),a=f();for(let e=0;e<u.length;e+=1)u[e].c();n.multiple=!0,h(t,"class","select is-multiple")},m(e,l){s(e,t,l),r(t,n),i&&i.m(n,null),r(n,a);for(let e=0;e<u.length;e+=1)u[e].m(n,null)},p(e,t){if(e.options&&(l=!Object.keys(t.options).length),l?i||((i=we()).c(),i.m(n,a)):i&&(i.d(1),i=null),e.options||e.niceName){let a;for(p=Object.entries(t.options),a=0;a<p.length;a+=1){const l=je(t,p,a);u[a]?u[a].p(e,l):(u[a]=Oe(l),u[a].c(),u[a].m(n,null))}for(;a<u.length;a+=1)u[a].d(1);u.length=p.length}},d(e){e&&c(t),i&&i.d(),o(u,e)}}}function we(e){var t;return{c(){(t=d("option")).textContent="Type more or type less...",t.disabled=!0,t.__value="Type more or type less...",t.value=t.__value},m(e,n){s(e,t,n)},d(e){e&&c(t)}}}function Oe(e){var t,n,l,i,o=e.niceName(e.organism)+"";return{c(){t=d("option"),n=p(o),t.__value=l=e.org_id,t.value=t.__value,i=[m(t,"mousedown",e.mousedown_handler),m(t,"mouseout",e.mouseout_handler),m(t,"mouseover",e.mouseover_handler)]},m(e,a){s(e,t,a),r(t,n)},p(e,a){(e.niceName||e.options)&&o!==(o=a.niceName(a.organism)+"")&&g(n,o),e.options&&l!==(l=a.org_id)&&(t.__value=l),t.value=t.__value},d(e){e&&c(t),a(i)}}}function $e(t){var n,l,i,o,f,_,b,x,j,y,w=t.typing&&ye(t);return{c(){n=d("div"),l=d("label"),i=p(t.title),o=u(),f=d("div"),_=d("input"),b=u(),(x=d("span")).innerHTML='<i class="fas fa-chevron-down"></i>',j=u(),w&&w.c(),h(l,"class","label"),h(_,"type","text"),h(_,"class","input is-narrow"),h(_,"placeholder",t.placeholder),h(x,"class","icon is-right"),h(f,"class","control has-icons-right"),h(n,"class","field"),y=[m(_,"input",t.input_input_handler),m(_,"keyup",t.fetchOptions),m(_,"focus",t.starttyping),m(_,"blur",t.inputdone)]},m(e,a){s(e,n,a),r(n,l),r(l,i),r(n,o),r(n,f),r(f,_),v(_,t.intext),r(f,b),r(f,x),r(f,j),w&&w.m(f,null)},p(e,t){e.title&&g(i,t.title),e.intext&&_.value!==t.intext&&v(_,t.intext),e.placeholder&&h(_,"placeholder",t.placeholder),t.typing?w?w.p(e,t):((w=ye(t)).c(),w.m(f,null)):w&&(w.d(1),w=null)},i:e,o:e,d(e){e&&c(n),w&&w.d(),a(y)}}}function ke(e,t,n){const a=$();let{title:l,selectval:i="",options:r={},intext:s,fetchUrl:c,niceName:o}=t,d="Filter by typing",p=!1;function u(e){e.target.selected=!1,n("intext",s=""),n("placeholder",d=i?o(i):"")}function f(e){n("selectval",i=r[e.target.value]),a("selectedvalue")}function m(e){e.target.selected=!0;const t=r[e.target.value];n("intext",s=o(t))}return e.$set=(e=>{"title"in e&&n("title",l=e.title),"selectval"in e&&n("selectval",i=e.selectval),"options"in e&&n("options",r=e.options),"intext"in e&&n("intext",s=e.intext),"fetchUrl"in e&&n("fetchUrl",c=e.fetchUrl),"niceName"in e&&n("niceName",o=e.niceName)}),{title:l,selectval:i,options:r,intext:s,fetchUrl:c,niceName:o,placeholder:d,typing:p,inputdone:function(){n("typing",p=!1),n("intext",s=i?o(i):"")},deselect:u,selectvalue:f,hovervalue:m,fetchOptions:async function(){s.length>2&&n("options",r=await V(`${c}?q=${s}`))},starttyping:function(){n("typing",p=!0),n("placeholder",d=i?o(i):""),n("intext",s="")},input_input_handler:function(){s=this.value,n("intext",s)},mousedown_handler:e=>f(e),mouseout_handler:e=>u(e),mouseover_handler:e=>m(e)}}class qe extends K{constructor(e){super(),G(this,e,ke,$e,i,["title","selectval","options","intext","fetchUrl","niceName"])}}const{Object:Ne}=H;function Fe(e,t,n){const a=Ne.create(e);return a.s_id=t[n][0],a.sample=t[n][1],a}function Ce(e,t,n){const a=Ne.create(e);return a.s_id=t[n][0],a.sample=t[n][1],a}function Ee(e,t,n){const a=Ne.create(e);return a.file=t[n],a}function Pe(e,t,n){const a=Ne.create(e);return a.s_id=t[n][0],a.sample=t[n][1],a}function Se(e,t,n){const a=Ne.create(e);return a.channel=t[n],a.each_value=t,a.chix=n,a}function Me(e,t,n){const a=Ne.create(e);return a.quant=t[n],a}function ze(e,t,n){const a=Ne.create(e);return a.param_id=t[n][0],a.param=t[n][1],a.each_value_6=t,a.each_index_3=n,a}function Le(e,t,n){const a=Ne.create(e);return a.enzyme=t[n],a.each_value_7=t,a.enzyme_index=n,a}function Ie(e,t,n){const a=Ne.create(e);return a.spec=t[n],a}function Te(e){var t;return{c(){h(t=d("i"),"class","icon fas fa-edit")},m(e,n){s(e,t,n)},d(e){e&&c(t)}}}function Ue(e){var t;return{c(){h(t=d("i"),"class","icon fas fa-check-circle")},m(e,n){s(e,t,n)},d(e){e&&c(t)}}}function De(e){var t,n,a,l,i,o,f=st(e.spec)+"";function _(...t){return e.click_handler(e,...t)}return{c(){t=d("span"),n=p(f),a=u(),l=d("button"),i=u(),h(l,"class","delete is-small"),h(t,"class","tag is-medium is-info"),o=m(l,"click",_)},m(e,c){s(e,t,c),r(t,n),r(t,a),r(t,l),r(t,i)},p(t,a){e=a,t.prepdata&&f!==(f=st(e.spec)+"")&&g(n,f)},d(e){e&&c(t),o()}}}function Re(e){var t;let n=e.prepdata.enzymes,a=[];for(let t=0;t<n.length;t+=1)a[t]=He(Le(e,n,t));return{c(){for(let e=0;e<a.length;e+=1)a[e].c();t=f()},m(e,n){for(let t=0;t<a.length;t+=1)a[t].m(e,n);s(e,t,n)},p(e,l){if(e.prepdata){let i;for(n=l.prepdata.enzymes,i=0;i<n.length;i+=1){const r=Le(l,n,i);a[i]?a[i].p(e,r):(a[i]=He(r),a[i].c(),a[i].m(t.parentNode,t))}for(;i<a.length;i+=1)a[i].d(1);a.length=n.length}},d(e){o(a,e),e&&c(t)}}}function He(e){var t,n,l,i,o,f=e.enzyme.name+"";function _(){e.input_change_handler_1.call(n,e)}return{c(){t=d("div"),n=d("input"),l=p(f),i=u(),h(n,"type","checkbox"),h(t,"class","control"),o=[m(n,"change",_),m(n,"change",e.editMade)]},m(a,c){s(a,t,c),r(t,n),n.checked=e.enzyme.checked,r(t,l),r(t,i)},p(t,a){e=a,t.prepdata&&(n.checked=e.enzyme.checked),t.prepdata&&f!==(f=e.enzyme.name+"")&&g(l,f)},d(e){e&&c(t),a(o)}}}function Qe(e){var t,n;function a(n){e.param_param_binding.call(null,n,e),t=!0,S(()=>t=!1)}let l={};void 0!==e.param&&(l.param=e.param);var i=new oe({props:l});return q.push(()=>Q(i,"param",a)),i.$on("edited",e.editMade),{c(){i.$$.fragment.c()},m(e,t){A(i,e,t),n=!0},p(n,a){e=a;var l={};(!t&&n.Object||n.prepdata)&&(l.param=e.param),i.$set(l)},i(e){n||(D(i.$$.fragment,e),n=!0)},o(e){R(i.$$.fragment,e),n=!1},d(e){B(i,e)}}}function Ae(e){var t,n,a,l=e.quant.name+"";return{c(){t=d("option"),n=p(l),t.__value=a=e.quant.id,t.value=t.__value},m(e,a){s(e,t,a),r(t,n)},p(e,i){(e.Object||e.prepdata)&&l!==(l=i.quant.name+"")&&g(n,l),(e.Object||e.prepdata)&&a!==(a=i.quant.id)&&(t.__value=a),t.value=t.__value},d(e){e&&c(t)}}}function Be(e){var t,n,l,i,o,f,_,g,b,x,j,y,w,O,$,k,q,N,F,C=e.isLabelfree&&Je(e);function E(e,t){return t.isLabelfree&&t.prepdata.labelfree_multisample?Ke:t.isLabelfree?void 0:Ge}var P=E(0,e),S=P&&P(e);function M(e,t){return t.foundNewSamples?We:Ve}var z=M(0,e),L=z(e);function I(e,t){return t.isLabelfree?t.isLabelfree&&t.prepdata.labelfree_multisample?Ye:((null==N||e.isLabelfree||e.Object)&&(N=!(!t.isLabelfree||!t.Object.keys(Y).length)),N?Xe:void 0):Ze}var T=I(null,e),U=T&&T(e);return{c(){t=d("div"),(n=d("label")).textContent="Samples",l=u(),i=d("textarea"),o=u(),(f=d("a")).textContent="Parse sample names",_=u(),g=d("div"),C&&C.c(),b=u(),x=d("table"),j=d("thead"),y=d("tr"),S&&S.c(),w=u(),O=d("th"),$=p("Sample name \n        "),L.c(),k=u(),q=d("tbody"),U&&U.c(),h(n,"class","label"),h(i,"class","textarea"),h(i,"placeholder","Try this: paste your sample names here (one line per sample, tab separated sample/file or channel)"),h(f,"class","button is-primary"),h(g,"class","control"),h(t,"class","field"),h(O,"colspan","2"),h(x,"class","table is-fullwidth"),F=[m(i,"input",e.textarea_input_handler),m(f,"click",e.parseSampleNames)]},m(a,c){s(a,t,c),r(t,n),r(t,l),r(t,i),v(i,e.trysamplenames),r(t,o),r(t,f),r(t,_),r(t,g),C&&C.m(g,null),s(a,b,c),s(a,x,c),r(x,j),r(j,y),S&&S.m(y,null),r(y,w),r(y,O),r(O,$),L.m(O,null),r(x,k),r(x,q),U&&U.m(q,null)},p(e,t){e.trysamplenames&&v(i,t.trysamplenames),t.isLabelfree?C?C.p(e,t):((C=Je(t)).c(),C.m(g,null)):C&&(C.d(1),C=null),P!==(P=E(0,t))&&(S&&S.d(1),(S=P&&P(t))&&(S.c(),S.m(y,w))),z!==(z=M(0,t))&&(L.d(1),(L=z(t))&&(L.c(),L.m(O,null))),T===(T=I(e,t))&&U?U.p(e,t):(U&&U.d(1),(U=T&&T(t))&&(U.c(),U.m(q,null)))},d(e){e&&c(t),C&&C.d(),e&&(c(b),c(x)),S&&S.d(),L.d(),U&&U.d(),a(F)}}}function Je(e){var t,n,l,i;return{c(){t=d("div"),n=d("input"),l=p("One sample per file?"),h(n,"type","checkbox"),h(t,"id","labelfree_samples"),i=[m(n,"change",e.input_change_handler_2),m(n,"change",e.checkIfNewSamples)]},m(a,i){s(a,t,i),r(t,n),n.checked=e.prepdata.labelfree_multisample,r(t,l)},p(e,t){e.prepdata&&(n.checked=t.prepdata.labelfree_multisample)},d(e){e&&c(t),a(i)}}}function Ge(e){var t;return{c(){(t=d("th")).textContent="Channel"},m(e,n){s(e,t,n)},d(e){e&&c(t)}}}function Ke(e){var t;return{c(){(t=d("th")).textContent="Filename"},m(e,n){s(e,t,n)},d(e){e&&c(t)}}}function Ve(e){var t;return{c(){(t=d("a")).textContent="Save new samples",h(t,"class","button is-danger is-small is-pulled-right"),h(t,"disabled","")},m(e,n){s(e,t,n)},d(e){e&&c(t)}}}function We(e){var t,n;return{c(){(t=d("a")).textContent="Save new samples",h(t,"class","button is-danger is-small is-pulled-right"),n=m(t,"click",e.saveNewSamples)},m(e,n){s(e,t,n)},d(e){e&&c(t),n()}}}function Xe(e){var t,n,l,i,p,f,_,g,b;let j=e.Object.entries(e.prepdata.projsamples),y=[];for(let t=0;t<j.length;t+=1)y[t]=et(Fe(e,j,t));return{c(){t=d("tr"),n=d("td"),l=d("div"),i=d("select"),(p=d("option")).textContent="Pick a project-sample";for(let e=0;e<y.length;e+=1)y[e].c();f=u(),_=d("td"),g=d("input"),p.disabled=!0,p.__value="",p.value=p.__value,void 0===e.prepdata.labelfree_singlesample.model&&P(()=>e.select_change_handler_3.call(i)),h(l,"class","select"),h(g,"placeholder","or define a new sample"),h(g,"class","input is-normal"),b=[m(i,"change",e.select_change_handler_3),m(i,"change",e.change_handler_4),m(g,"input",e.input_input_handler_2),m(g,"change",e.change_handler_5)]},m(a,c){s(a,t,c),r(t,n),r(n,l),r(l,i),r(i,p);for(let e=0;e<y.length;e+=1)y[e].m(i,null);x(i,e.prepdata.labelfree_singlesample.model),r(t,f),r(t,_),r(_,g),v(g,e.prepdata.labelfree_singlesample.newprojsample)},p(e,t){if(e.Object||e.prepdata){let n;for(j=t.Object.entries(t.prepdata.projsamples),n=0;n<j.length;n+=1){const a=Fe(t,j,n);y[n]?y[n].p(e,a):(y[n]=et(a),y[n].c(),y[n].m(i,null))}for(;n<y.length;n+=1)y[n].d(1);y.length=j.length}e.prepdata&&x(i,t.prepdata.labelfree_singlesample.model),e.prepdata&&g.value!==t.prepdata.labelfree_singlesample.newprojsample&&v(g,t.prepdata.labelfree_singlesample.newprojsample)},d(e){e&&c(t),o(y,e),a(b)}}}function Ye(e){var t;let n=e.Object.values(Y),a=[];for(let t=0;t<n.length;t+=1)a[t]=nt(Ee(e,n,t));return{c(){for(let e=0;e<a.length;e+=1)a[e].c();t=f()},m(e,n){for(let t=0;t<a.length;t+=1)a[t].m(e,n);s(e,t,n)},p(e,l){if(e.prepdata||e.Object||e.datasetFiles){let i;for(n=l.Object.values(Y),i=0;i<n.length;i+=1){const r=Ee(l,n,i);a[i]?a[i].p(e,r):(a[i]=nt(r),a[i].c(),a[i].m(t.parentNode,t))}for(;i<a.length;i+=1)a[i].d(1);a.length=n.length}},d(e){o(a,e),e&&c(t)}}}function Ze(e){var t;let n=e.prepdata.quants[e.prepdata.quanttype].chans,a=[];for(let t=0;t<n.length;t+=1)a[t]=it(Se(e,n,t));return{c(){for(let e=0;e<a.length;e+=1)a[e].c();t=f()},m(e,n){for(let t=0;t<a.length;t+=1)a[t].m(e,n);s(e,t,n)},p(e,l){if(e.prepdata||e.Object){let i;for(n=l.prepdata.quants[l.prepdata.quanttype].chans,i=0;i<n.length;i+=1){const r=Se(l,n,i);a[i]?a[i].p(e,r):(a[i]=it(r),a[i].c(),a[i].m(t.parentNode,t))}for(;i<a.length;i+=1)a[i].d(1);a.length=n.length}},d(e){o(a,e),e&&c(t)}}}function et(e){var t,n,a,l=e.sample+"";return{c(){t=d("option"),n=p(l),t.__value=a=e.s_id,t.value=t.__value},m(e,a){s(e,t,a),r(t,n)},p(e,i){(e.Object||e.prepdata)&&l!==(l=i.sample+"")&&g(n,l),(e.Object||e.prepdata)&&a!==(a=i.s_id)&&(t.__value=a),t.value=t.__value},d(e){e&&c(t)}}}function tt(e){var t,n,a,l=e.sample+"";return{c(){t=d("option"),n=p(l),t.__value=a=e.s_id,t.value=t.__value},m(e,a){s(e,t,a),r(t,n)},p(e,i){(e.Object||e.prepdata)&&l!==(l=i.sample+"")&&g(n,l),(e.Object||e.prepdata)&&a!==(a=i.s_id)&&(t.__value=a),t.value=t.__value},d(e){e&&c(t)}}}function nt(e){var t,n,l,i,f,_,b,j,y,w,O,$,k,q=e.file.name+"";let N=e.Object.entries(e.prepdata.projsamples),F=[];for(let t=0;t<N.length;t+=1)F[t]=tt(Ce(e,N,t));function C(){e.select_change_handler_2.call(b,e)}function E(...t){return e.change_handler_2(e,...t)}function S(){e.input_input_handler_1.call(O,e)}function M(...t){return e.change_handler_3(e,...t)}return{c(){t=d("tr"),n=d("td"),l=p(q),i=u(),f=d("td"),_=d("div"),b=d("select"),(j=d("option")).textContent="Pick a project-sample";for(let e=0;e<F.length;e+=1)F[e].c();y=u(),w=d("td"),O=d("input"),$=u(),j.disabled=!0,j.__value="",j.value=j.__value,void 0===e.prepdata.samples[e.file.associd].model&&P(C),h(_,"class","select"),h(O,"placeholder","or define a new sample"),h(O,"class","input is-normal"),k=[m(b,"change",C),m(b,"change",E),m(O,"input",S),m(O,"change",M)]},m(a,c){s(a,t,c),r(t,n),r(n,l),r(t,i),r(t,f),r(f,_),r(_,b),r(b,j);for(let e=0;e<F.length;e+=1)F[e].m(b,null);x(b,e.prepdata.samples[e.file.associd].model),r(t,y),r(t,w),r(w,O),v(O,e.prepdata.samples[e.file.associd].newprojsample),r(t,$)},p(t,n){if(e=n,t.Object&&q!==(q=e.file.name+"")&&g(l,q),t.Object||t.prepdata){let n;for(N=e.Object.entries(e.prepdata.projsamples),n=0;n<N.length;n+=1){const a=Ce(e,N,n);F[n]?F[n].p(t,a):(F[n]=tt(a),F[n].c(),F[n].m(b,null))}for(;n<F.length;n+=1)F[n].d(1);F.length=N.length}(t.prepdata||t.Object||t.datasetFiles)&&x(b,e.prepdata.samples[e.file.associd].model),(t.prepdata||t.Object||t.datasetFiles)&&O.value!==e.prepdata.samples[e.file.associd].newprojsample&&v(O,e.prepdata.samples[e.file.associd].newprojsample)},d(e){e&&c(t),o(F,e),a(k)}}}function at(e){var t,n,a,l=e.sample+"";return{c(){t=d("option"),n=p(l),t.__value=a=e.s_id,t.value=t.__value},m(e,a){s(e,t,a),r(t,n)},p(e,i){(e.Object||e.prepdata)&&l!==(l=i.sample+"")&&g(n,l),(e.Object||e.prepdata)&&a!==(a=i.s_id)&&(t.__value=a),t.value=t.__value},d(e){e&&c(t)}}}function lt(e){var t;return{c(){(t=d("span")).innerHTML='<i class="fas fa-flask fa-spin"></i>',h(t,"class","icon")},m(e,n){s(e,t,n)},d(e){e&&c(t)}}}function it(e){var t,n,l,i,f,_,b,j,y,w,O,$,k,q,N=e.channel.name+"";let F=e.Object.entries(e.prepdata.projsamples),C=[];for(let t=0;t<F.length;t+=1)C[t]=at(Pe(e,F,t));function E(){e.select_change_handler_1.call(b,e)}function S(...t){return e.change_handler(e,...t)}function M(){e.input_input_handler.call(O,e)}function z(...t){return e.change_handler_1(e,...t)}var L=e.channel.loading&&lt();return{c(){t=d("tr"),n=d("td"),l=p(N),i=u(),f=d("td"),_=d("div"),b=d("select"),(j=d("option")).textContent="Pick a project-sample";for(let e=0;e<C.length;e+=1)C[e].c();y=u(),w=d("td"),O=d("input"),$=u(),L&&L.c(),k=u(),j.disabled=!0,j.__value="",j.value=j.__value,void 0===e.channel.model&&P(E),h(_,"class","select"),h(O,"class","input is-normal"),h(O,"placeholder","or define a new sample"),q=[m(b,"change",E),m(b,"change",S),m(O,"input",M),m(O,"change",z)]},m(a,c){s(a,t,c),r(t,n),r(n,l),r(t,i),r(t,f),r(f,_),r(_,b),r(b,j);for(let e=0;e<C.length;e+=1)C[e].m(b,null);x(b,e.channel.model),r(t,y),r(t,w),r(w,O),v(O,e.channel.newprojsample),r(w,$),L&&L.m(w,null),r(t,k)},p(t,n){if(e=n,t.prepdata&&N!==(N=e.channel.name+"")&&g(l,N),t.Object||t.prepdata){let n;for(F=e.Object.entries(e.prepdata.projsamples),n=0;n<F.length;n+=1){const a=Pe(e,F,n);C[n]?C[n].p(t,a):(C[n]=at(a),C[n].c(),C[n].m(b,null))}for(;n<C.length;n+=1)C[n].d(1);C.length=F.length}t.prepdata&&x(b,e.channel.model),t.prepdata&&O.value!==e.channel.newprojsample&&v(O,e.channel.newprojsample),e.channel.loading?L||((L=lt()).c(),L.m(w,null)):L&&(L.d(1),L=null)},d(e){e&&c(t),o(C,e),L&&L.d(),a(q)}}}function rt(e){var t,n,l,i,_,g,v,b,j,y,w,O,$,k,N,F,C,E,M,z,L,I,H,J,G,K,V,W,X,Y,Z,ee,te;function ne(e,t){return t.stored?Ue:t.edited?Te:void 0}var ae=ne(0,e),le=ae&&ae(e);function ie(t){e.dynamicselect_options_binding.call(null,t),w=!0,S(()=>w=!1)}function re(t){e.dynamicselect_selectval_binding.call(null,t),O=!0,S(()=>O=!1)}let se={title:"Organism",intext:"Type to get more organisms",fetchUrl:"/datasets/show/species/",niceName:st};void 0!==e.prepdata.allspecies&&(se.options=e.prepdata.allspecies),void 0!==e.selectedspecies&&(se.selectval=e.selectedspecies);var ce=new qe({props:se});q.push(()=>Q(ce,"options",ie)),q.push(()=>Q(ce,"selectval",re)),ce.$on("selectedvalue",e.addOrganism);let oe=e.prepdata.species,de=[];for(let t=0;t<oe.length;t+=1)de[t]=De(Ie(e,oe,t));var pe=!e.prepdata.no_enzyme&&Re(e);let ue=e.Object.entries(e.prepdata.params),fe=[];for(let t=0;t<ue.length;t+=1)fe[t]=Qe(ze(e,ue,t));const me=e=>R(fe[e],1,1,()=>{fe[e]=null});let he=e.Object.values(e.prepdata.quants),_e=[];for(let t=0;t<he.length;t+=1)_e[t]=Ae(Me(e,he,t));var ge=e.prepdata.quanttype&&Be(e);return{c(){t=d("h5"),le&&le.c(),n=p("\n  Sample prep\n  "),l=d("button"),i=p("Save"),g=u(),v=d("button"),b=p("Revert"),y=u(),ce.$$.fragment.c(),$=u(),k=d("div");for(let e=0;e<de.length;e+=1)de[e].c();N=u(),F=d("div"),(C=d("label")).textContent="Enzymes",E=u(),M=d("input"),z=p("No enzyme\n  "),pe&&pe.c(),L=u();for(let e=0;e<fe.length;e+=1)fe[e].c();I=u(),H=d("div"),(J=d("label")).textContent="Quant type",G=u(),K=d("div"),V=d("div"),W=d("select"),(X=d("option")).textContent="Please select one";for(let e=0;e<_e.length;e+=1)_e[e].c();Y=u(),ge&&ge.c(),Z=f(),h(l,"class","button is-small is-danger has-text-weight-bold"),l.disabled=_=!e.edited,h(v,"class","button is-small is-info has-text-weight-bold"),v.disabled=j=!e.edited,h(t,"id","sampleprep"),h(t,"class","has-text-primary title is-5"),h(k,"class","tags"),h(C,"class","label"),h(M,"type","checkbox"),h(F,"class","field"),h(J,"class","label"),X.disabled=!0,X.__value="",X.value=X.__value,void 0===e.prepdata.quanttype&&P(()=>e.select_change_handler.call(W)),h(V,"class","select"),h(K,"class","control"),h(H,"class","field"),te=[m(l,"click",e.save),m(v,"click",e.fetchData),m(M,"change",e.input_change_handler),m(M,"change",e.editMade),m(W,"change",e.select_change_handler),m(W,"change",e.checkIfNewSamples)]},m(a,c){s(a,t,c),le&&le.m(t,null),r(t,n),r(t,l),r(l,i),r(t,g),r(t,v),r(v,b),s(a,y,c),A(ce,a,c),s(a,$,c),s(a,k,c);for(let e=0;e<de.length;e+=1)de[e].m(k,null);s(a,N,c),s(a,F,c),r(F,C),r(F,E),r(F,M),M.checked=e.prepdata.no_enzyme,r(F,z),pe&&pe.m(F,null),s(a,L,c);for(let e=0;e<fe.length;e+=1)fe[e].m(a,c);s(a,I,c),s(a,H,c),r(H,J),r(H,G),r(H,K),r(K,V),r(V,W),r(W,X);for(let e=0;e<_e.length;e+=1)_e[e].m(W,null);x(W,e.prepdata.quanttype),s(a,Y,c),ge&&ge.m(a,c),s(a,Z,c),ee=!0},p(e,a){ae!==(ae=ne(0,a))&&(le&&le.d(1),(le=ae&&ae(a))&&(le.c(),le.m(t,n))),ee&&!e.edited||_===(_=!a.edited)||(l.disabled=_),ee&&!e.edited||j===(j=!a.edited)||(v.disabled=j);var i={};if(!w&&e.prepdata&&(i.options=a.prepdata.allspecies),!O&&e.selectedspecies&&(i.selectval=a.selectedspecies),ce.$set(i),e.niceSpecies||e.prepdata){let t;for(oe=a.prepdata.species,t=0;t<oe.length;t+=1){const n=Ie(a,oe,t);de[t]?de[t].p(e,n):(de[t]=De(n),de[t].c(),de[t].m(k,null))}for(;t<de.length;t+=1)de[t].d(1);de.length=oe.length}if(e.prepdata&&(M.checked=a.prepdata.no_enzyme),a.prepdata.no_enzyme?pe&&(pe.d(1),pe=null):pe?pe.p(e,a):((pe=Re(a)).c(),pe.m(F,null)),e.Object||e.prepdata){let t;for(ue=a.Object.entries(a.prepdata.params),t=0;t<ue.length;t+=1){const n=ze(a,ue,t);fe[t]?(fe[t].p(e,n),D(fe[t],1)):(fe[t]=Qe(n),fe[t].c(),D(fe[t],1),fe[t].m(I.parentNode,I))}for(T(),t=ue.length;t<fe.length;t+=1)me(t);U()}if(e.Object||e.prepdata){let t;for(he=a.Object.values(a.prepdata.quants),t=0;t<he.length;t+=1){const n=Me(a,he,t);_e[t]?_e[t].p(e,n):(_e[t]=Ae(n),_e[t].c(),_e[t].m(W,null))}for(;t<_e.length;t+=1)_e[t].d(1);_e.length=he.length}e.prepdata&&x(W,a.prepdata.quanttype),a.prepdata.quanttype?ge?ge.p(e,a):((ge=Be(a)).c(),ge.m(Z.parentNode,Z)):ge&&(ge.d(1),ge=null)},i(e){if(!ee){D(ce.$$.fragment,e);for(let e=0;e<ue.length;e+=1)D(fe[e]);ee=!0}},o(e){R(ce.$$.fragment,e),fe=fe.filter(Boolean);for(let e=0;e<fe.length;e+=1)R(fe[e]);ee=!1},d(e){e&&c(t),le&&le.d(),e&&c(y),B(ce,e),e&&(c($),c(k)),o(de,e),e&&(c(N),c(F)),pe&&pe.d(),e&&c(L),o(fe,e),e&&(c(I),c(H)),o(_e,e),e&&c(Y),ge&&ge.d(e),e&&c(Z),a(te)}}}function st(e){let t;return t=e.name?`${e.name}, ${e.linnean}`:`${e.linnean}`}function ct(e,t,n){let{errors:a}=t,l=!1;function i(){n("errors",a=a.length?g():[]),n("edited",l=!0)}let r,s,c={params:[],enzymes:[],no_enzyme:!1,quanttype:"",quants:{},labelfree_multisample:!0,labelfree_singlesample:{},allspecies:[],species:[],projsamples:{},samples:{}},o="",d=!1;function p(e){n("prepdata",c.species=c.species.filter(t=>t.id!==e),c),i()}function u(){c.quanttype!==s?n("foundNewSamples",d=c.quants[c.quanttype].chans.some(e=>""!==e.newprojsample)):c.labelfree_multisample?n("foundNewSamples",d=Object.values(c.samples).some(e=>""!==e.newprojsample)):n("foundNewSamples",d=""!==c.labelfree_singlesample.newprojsample)}function f(e=!1){let t;if(""!=(t=c.labelfree_multisample?c.samples[e].newprojsample:c.labelfree_singlesample.newprojsample)){let a=t.trim().toUpperCase(),l=Object.entries(c.projsamples).filter(e=>e[1].toUpperCase()==a).map(e=>e[0])[0];l&&!c.labelfree_multisample?(n("prepdata",c.labelfree_singlesample.model=l,c),n("prepdata",c.labelfree_singlesample.newprojsample="",c)):l&&(n("prepdata",c.samples[e].model=l,c),n("prepdata",c.samples[e].newprojsample="",c)),u()}}function m(e){if(""!=c.quants[c.quanttype].chans[e].newprojsample){let t=c.quants[c.quanttype].chans[e].newprojsample.trim().toUpperCase(),a=Object.entries(c.projsamples).filter(e=>e[1].toUpperCase()==t).map(e=>e[0])[0];a&&(n("prepdata",c.quants[c.quanttype].chans[e].model=a,c),n("prepdata",c.quants[c.quanttype].chans[e].newprojsample="",c)),u()}}function h(e){e.newprojsample="",u(),i()}async function _(e,t){let a={dataset_id:dataset_id,samplename:e.newprojsample};const l=await W("/datasets/save/projsample/",a);return n("prepdata",c.projsamples[l.psid]=l.psname,c),[l.psid,t]}function g(){let e=[];if(c.no_enzyme||c.enzymes.filter.length||e.push("Enzyme selection is required"),c.quanttype||e.push("Quant type selection is required"),x){for(let t of Object.values(Y))if(!c.samples[t.associd].model&&!c.samples[t.associd].newprojsample){e.push("Labelfree requires sample name for each file");break}}else for(let t of c.quants[c.quanttype].chans)if(""===t.model){e.push("Sample name for each channel is required");break}for(let t of Object.values(c.params).filter(e=>"checkbox"!==e.inputtype))t.model||e.push(t.title+" is required");for(let t of Object.values(c.params).filter(e=>"checkbox"===e.inputtype))t.fields.some(e=>e.checked)||e.push(t.title+" is required");return Object.keys(c.species).length||e.push("Organism(s) is/are required"),e}async function v(){let e="/datasets/show/sampleprep/";e=dataset_id?e+dataset_id:e;const t=await V(e);for(let[e,a]of Object.entries(t))n("prepdata",c[e]=a,c);n("labelfree_quant_id",s=Object.entries(c.quants).filter(e=>"labelfree"===e[1].name).map(e=>Number(e[0])).pop()),n("edited",l=!1)}O(async()=>{await v()});let b,x;return e.$set=(e=>{"errors"in e&&n("errors",a=e.errors)}),e.$$.update=((e={edited:1,prepdata:1,labelfree_quant_id:1})=>{e.edited&&n("stored",b=dataset_id&&!l),(e.prepdata||e.labelfree_quant_id)&&n("isLabelfree",x=c.quanttype===s)}),{errors:a,edited:l,editMade:i,prepdata:c,selectedspecies:r,trysamplenames:o,foundNewSamples:d,removeOrganism:p,addOrganism:function(){n("prepdata",c.species=[...c.species,r],c),i()},checkIfNewSamples:u,checkNewSampleLabelfree:f,checkNewSample:m,parseSampleNames:function(){let e={},t={};if(x&&!c.labelfree_multisample)return 0;if(x)for(let e of Object.values(Y))t[e.name]=e;else c.quants[c.quanttype].chans.forEach(function(t,n){e[t.name]=n});for(let a of o.trim().split("\n")){let l,i,r;a.indexOf("\t")>-1?a=a.trim().split("\t").map(e=>e.trim()):a.indexOf("    ")>-1&&(a=a.trim().split("    ").map(e=>e.trim())),x?(a[0]in t&&(r=t[a[0]],l=a[1]),a[1]in t&&(r=t[a[1]],l=a[0]),r&&n("prepdata",c.samples[r.associd].newprojsample=l,c)):(a[0]in e&&(i=e[a[0]],l=a[1]),a[1]in e&&(i=e[a[1]],l=a[0]),i&&n("prepdata",c.quants[c.quanttype].chans[i].newprojsample=l,c))}i()},resetNewSampleName:h,saveNewSamples:async function(){let e=[];if(x)if(!c.labelfree_multisample&&d){const e=await _(c.labelfree_singlesample);n("prepdata",c.labelfree_singlesample.model=e[0],c),n("prepdata",c.labelfree_singlesample.newprojsample="",c)}else{Object.entries(c.samples).filter(e=>e[1].newprojsample&&!e[1].model).forEach(function(t){e.push(_(t[1],t[0]))});for(let t of e){let[e,a]=await t;n("prepdata",c.samples[a].newprojsample="",c),n("prepdata",c.samples[a].model=e,c)}}else{c.quants[c.quanttype].chans.map(function(e,t){return[t,e]}).filter(e=>e[1].newprojsample&&!e[1].model).forEach(function(t){e.push(_(t[1],t[0]))});for(let t of e){let[e,a]=await t;n("prepdata",c.quants[c.quanttype].chans[a].newprojsample="",c),n("prepdata",c.quants[c.quanttype].chans[a].model=e,c)}}},validate:g,save:async function(){if(n("errors",a=g()),0===a.length){let e={dataset_id:dataset_id,enzymes:c.no_enzyme?[]:c.enzymes,params:c.params,quanttype:c.quanttype,labelfree:x,species:c.species};x?c.labelfree_multisample?(e.filenames=Object.values(Y),e.samples=c.samples):(e.filenames=Object.values(Y),e.samples=Object.fromEntries(e.filenames.map(e=>[e.associd,c.labelfree_singlesample]))):e.samples=c.quants[c.quanttype].chans;let t="/datasets/save/sampleprep/";await W(t,e),v()}},fetchData:v,stored:b,isLabelfree:x,Object:Object,dynamicselect_options_binding:function(e){c.allspecies=e,n("prepdata",c)},dynamicselect_selectval_binding:function(e){n("selectedspecies",r=e)},click_handler:({spec:e},t)=>p(e.id),input_change_handler:function(){c.no_enzyme=this.checked,n("prepdata",c),n("Object",Object)},input_change_handler_1:function({enzyme:e,each_value_7:t,enzyme_index:a}){t[a].checked=this.checked,n("prepdata",c),n("Object",Object)},param_param_binding:function(e,{param:t,each_value_6:a,each_index_3:l}){a[l][1]=e,n("Object",Object)},select_change_handler:function(){c.quanttype=j(this),n("prepdata",c),n("Object",Object)},textarea_input_handler:function(){o=this.value,n("trysamplenames",o)},input_change_handler_2:function(){c.labelfree_multisample=this.checked,n("prepdata",c),n("Object",Object)},select_change_handler_1:function({channel:e,each_value:t,chix:a}){t[a].model=j(this),n("prepdata",c),n("Object",Object)},change_handler:({channel:e},t)=>h(e),input_input_handler:function({channel:e,each_value:t,chix:a}){t[a].newprojsample=this.value,n("prepdata",c),n("Object",Object)},change_handler_1:({chix:e},t)=>m(e),select_change_handler_2:function({file:e}){c.samples[e.associd].model=j(this),n("prepdata",c),n("Object",Object),n("datasetFiles",Y)},change_handler_2:({file:e},t)=>h(c.samples[e.associd]),input_input_handler_1:function({file:e}){c.samples[e.associd].newprojsample=this.value,n("prepdata",c),n("Object",Object),n("datasetFiles",Y)},change_handler_3:({file:e},t)=>f(e.associd),select_change_handler_3:function(){c.labelfree_singlesample.model=j(this),n("prepdata",c),n("Object",Object)},change_handler_4:e=>h(c.labelfree_singlesample),input_input_handler_2:function(){c.labelfree_singlesample.newprojsample=this.value,n("prepdata",c),n("Object",Object)},change_handler_5:e=>f(c.labelfree_singlesample)}}class ot extends K{constructor(e){super(),G(this,e,ct,rt,i,["errors","validate","save"])}get validate(){return this.$$.ctx.validate}get save(){return this.$$.ctx.save}}function dt(e,t,n){const a=Object.create(e);return a.range=t[n],a}function pt(e,t,n){const a=Object.create(e);return a.prefrac=t[n],a}function ut(e,t,n){const a=Object.create(e);return a.exp=t[n],a}function ft(e){var t;return{c(){t=p("Create new experiment")},m(e,n){s(e,t,n)},d(e){e&&c(t)}}}function mt(e){var t;return{c(){t=p("Existing experiment")},m(e,n){s(e,t,n)},d(e){e&&c(t)}}}function ht(e){var t,n,l,i;let p=e.experiments,u=[];for(let t=0;t<p.length;t+=1)u[t]=gt(ut(e,p,t));return{c(){t=d("div"),n=d("select"),(l=d("option")).textContent="Please select one";for(let e=0;e<u.length;e+=1)u[e].c();l.disabled=!0,l.__value="",l.value=l.__value,void 0===e.dsinfo.experiment_id&&P(()=>e.select_change_handler.call(n)),h(t,"class","select"),i=[m(n,"change",e.select_change_handler),m(n,"change",e.editMade)]},m(a,i){s(a,t,i),r(t,n),r(n,l);for(let e=0;e<u.length;e+=1)u[e].m(n,null);x(n,e.dsinfo.experiment_id)},p(e,t){if(e.experiments){let a;for(p=t.experiments,a=0;a<p.length;a+=1){const l=ut(t,p,a);u[a]?u[a].p(e,l):(u[a]=gt(l),u[a].c(),u[a].m(n,null))}for(;a<u.length;a+=1)u[a].d(1);u.length=p.length}e.dsinfo&&x(n,t.dsinfo.experiment_id)},d(e){e&&c(t),o(u,e),a(i)}}}function _t(e){var t,n;return{c(){h(t=d("input"),"class","input"),h(t,"type","text"),h(t,"placeholder","Experiment name"),n=[m(t,"input",e.input_input_handler),m(t,"change",e.editMade)]},m(n,a){s(n,t,a),v(t,e.dsinfo.newexperimentname)},p(e,n){e.dsinfo&&t.value!==n.dsinfo.newexperimentname&&v(t,n.dsinfo.newexperimentname)},d(e){e&&c(t),a(n)}}}function gt(e){var t,n,a,l=e.exp.name+"";return{c(){t=d("option"),n=p(l),t.__value=a=e.exp.id,t.value=t.__value},m(e,a){s(e,t,a),r(t,n)},p(e,i){e.experiments&&l!==(l=i.exp.name+"")&&g(n,l),e.experiments&&a!==(a=i.exp.id)&&(t.__value=a),t.value=t.__value},d(e){e&&c(t)}}}function vt(e){var t,n,a,l=e.prefrac.name+"";return{c(){t=d("option"),n=p(l),t.__value=a=e.prefrac.id,t.value=t.__value},m(e,a){s(e,t,a),r(t,n)},p(e,i){e.prefracs&&l!==(l=i.prefrac.name+"")&&g(n,l),e.prefracs&&a!==(a=i.prefrac.id)&&(t.__value=a),t.value=t.__value},d(e){e&&c(t)}}}function bt(e){var t,n,l,i,o,p,f=!1;function _(){f=!0,e.input_input_handler_2.call(o)}return{c(){t=d("div"),(n=d("label")).textContent="Prefractionation length",l=u(),i=d("div"),o=d("input"),h(n,"class","label"),h(o,"type","number"),h(o,"class","input"),h(o,"placeholder","in minutes"),h(i,"class","control"),h(t,"class","field"),p=[m(o,"input",_),m(o,"change",e.editMade)]},m(a,c){s(a,t,c),r(t,n),r(t,l),r(t,i),r(i,o),v(o,e.dsinfo.prefrac_length)},p(e,t){!f&&e.dsinfo&&v(o,t.dsinfo.prefrac_length),f=!1},d(e){e&&c(t),a(p)}}}function xt(e){var t,n,l,i,p,f,_,g;let v=e.hirief_ranges,b=[];for(let t=0;t<v.length;t+=1)b[t]=jt(dt(e,v,t));return{c(){t=d("div"),(n=d("label")).textContent="HiRIEF range",l=u(),i=d("div"),p=d("div"),f=d("select"),(_=d("option")).textContent="Please select one";for(let e=0;e<b.length;e+=1)b[e].c();h(n,"class","label"),_.disabled=!0,_.__value="",_.value=_.__value,void 0===e.dsinfo.hiriefrange&&P(()=>e.select_change_handler_2.call(f)),h(p,"class","select"),h(i,"class","control"),h(t,"class","field"),g=[m(f,"change",e.select_change_handler_2),m(f,"change",e.editMade)]},m(a,c){s(a,t,c),r(t,n),r(t,l),r(t,i),r(i,p),r(p,f),r(f,_);for(let e=0;e<b.length;e+=1)b[e].m(f,null);x(f,e.dsinfo.hiriefrange)},p(e,t){if(e.hirief_ranges){let n;for(v=t.hirief_ranges,n=0;n<v.length;n+=1){const a=dt(t,v,n);b[n]?b[n].p(e,a):(b[n]=jt(a),b[n].c(),b[n].m(f,null))}for(;n<b.length;n+=1)b[n].d(1);b.length=v.length}e.dsinfo&&x(f,t.dsinfo.hiriefrange)},d(e){e&&c(t),o(b,e),a(g)}}}function jt(e){var t,n,a,l=e.range.name+"";return{c(){t=d("option"),n=p(l),t.__value=a=e.range.id,t.value=t.__value},m(e,a){s(e,t,a),r(t,n)},p(e,i){e.hirief_ranges&&l!==(l=i.range.name+"")&&g(n,l),e.hirief_ranges&&a!==(a=i.range.id)&&(t.__value=a),t.value=t.__value},d(e){e&&c(t)}}}function yt(e){var t,n,l,i,o,p,f=!1;function _(){f=!0,e.input_input_handler_3.call(o)}return{c(){t=d("div"),(n=d("label")).textContent="Fraction amount",l=u(),i=d("div"),o=d("input"),h(n,"class","label"),h(o,"type","number"),h(o,"class","input"),h(o,"placeholder","How many fractions of prefractionation"),h(i,"class","control"),h(t,"class","field"),p=[m(o,"input",_),m(o,"change",e.editMade)]},m(a,c){s(a,t,c),r(t,n),r(t,l),r(t,i),r(i,o),v(o,e.dsinfo.prefrac_amount)},p(e,t){!f&&e.dsinfo&&v(o,t.dsinfo.prefrac_amount),f=!1},d(e){e&&c(t),a(p)}}}function wt(t){var n,l,i,_,g,b,j,y,w,O,$,k,q,N,F,C,E,S,M,z,L,I,T,U;function D(e,t){return t.isNewExperiment?mt:ft}var R=D(0,t),H=R(t);function Q(e,t){return t.isNewExperiment?_t:ht}var A=Q(0,t),B=A(t);let J=t.prefracs,G=[];for(let e=0;e<J.length;e+=1)G[e]=vt(pt(t,J,e));function K(e,t){return t.hiriefselected?xt:t.dsinfo.prefrac_id?bt:void 0}var V=K(0,t),W=V&&V(t),X=t.dsinfo.prefrac_id&&yt(t);return{c(){n=d("div"),l=d("label"),i=p("Experiment name\n    "),_=d("a"),H.c(),g=u(),b=d("div"),B.c(),j=u(),y=d("div"),(w=d("label")).textContent="Run name",O=u(),$=d("div"),k=d("input"),q=u(),N=d("div"),(F=d("label")).textContent="Prefractionation",C=u(),E=d("div"),S=d("div"),M=d("select"),(z=d("option")).textContent="None";for(let e=0;e<G.length;e+=1)G[e].c();L=u(),W&&W.c(),I=u(),X&&X.c(),T=f(),h(_,"class","button is-danger is-outlined is-small"),h(l,"class","label"),h(b,"class","control"),h(n,"class","field"),h(w,"class","label"),h(k,"class","input"),h(k,"type","text"),h(k,"placeholder","E.g set1, run1, etc"),h($,"class","control"),h(y,"class","field"),h(F,"class","label"),z.__value="",z.value=z.__value,void 0===t.dsinfo.prefrac_id&&P(()=>t.select_change_handler_1.call(M)),h(S,"class","select"),h(E,"class","control"),h(N,"class","field"),U=[m(_,"click",t.toggle_experiment),m(k,"input",t.input_input_handler_1),m(k,"change",t.editMade),m(M,"change",t.select_change_handler_1),m(M,"change",t.editMade)]},m(e,a){s(e,n,a),r(n,l),r(l,i),r(l,_),H.m(_,null),r(n,g),r(n,b),B.m(b,null),s(e,j,a),s(e,y,a),r(y,w),r(y,O),r(y,$),r($,k),v(k,t.dsinfo.runname),s(e,q,a),s(e,N,a),r(N,F),r(N,C),r(N,E),r(E,S),r(S,M),r(M,z);for(let e=0;e<G.length;e+=1)G[e].m(M,null);x(M,t.dsinfo.prefrac_id),s(e,L,a),W&&W.m(e,a),s(e,I,a),X&&X.m(e,a),s(e,T,a)},p(e,t){if(R!==(R=D(0,t))&&(H.d(1),(H=R(t))&&(H.c(),H.m(_,null))),A===(A=Q(0,t))&&B?B.p(e,t):(B.d(1),(B=A(t))&&(B.c(),B.m(b,null))),e.dsinfo&&k.value!==t.dsinfo.runname&&v(k,t.dsinfo.runname),e.prefracs){let n;for(J=t.prefracs,n=0;n<J.length;n+=1){const a=pt(t,J,n);G[n]?G[n].p(e,a):(G[n]=vt(a),G[n].c(),G[n].m(M,null))}for(;n<G.length;n+=1)G[n].d(1);G.length=J.length}e.dsinfo&&x(M,t.dsinfo.prefrac_id),V===(V=K(0,t))&&W?W.p(e,t):(W&&W.d(1),(W=V&&V(t))&&(W.c(),W.m(I.parentNode,I))),t.dsinfo.prefrac_id?X?X.p(e,t):((X=yt(t)).c(),X.m(T.parentNode,T)):X&&(X.d(1),X=null)},i:e,o:e,d(e){e&&c(n),H.d(),B.d(),e&&(c(j),c(y),c(q),c(N)),o(G,e),e&&c(L),W&&W.d(e),e&&c(I),X&&X.d(e),e&&c(T),a(U)}}}function Ot(e,t,n){const a=$();let l,{dsinfo:i,experiments:r,hirief_ranges:s,prefracs:c,isNewExperiment:o}=t,d=[];return e.$set=(e=>{"dsinfo"in e&&n("dsinfo",i=e.dsinfo),"experiments"in e&&n("experiments",r=e.experiments),"hirief_ranges"in e&&n("hirief_ranges",s=e.hirief_ranges),"prefracs"in e&&n("prefracs",c=e.prefracs),"isNewExperiment"in e&&n("isNewExperiment",o=e.isNewExperiment)}),e.$$.update=((e={prefracs:1,dsinfo:1})=>{(e.prefracs||e.dsinfo)&&n("hiriefselected",l=c.some(e=>e.id==i.prefrac_id&&e.name.toLowerCase().indexOf("hirief")>-1))}),{dsinfo:i,experiments:r,hirief_ranges:s,prefracs:c,isNewExperiment:o,toggle_experiment:function(){n("isNewExperiment",o=!1===o)},editMade:function(){a("edited")},validate:function(){return d=[],l&&!i.hiriefrange?d.push("HiRIEF range is required"):l||!i.prefrac_id||i.prefrac_length||d.push("Prefractionation length is required"),i.prefrac_id&&!i.prefrac_amount&&d.push("Prefractionation fraction amount is required"),d},hiriefselected:l,input_input_handler:function(){i.newexperimentname=this.value,n("dsinfo",i),n("experiments",r)},select_change_handler:function(){i.experiment_id=j(this),n("dsinfo",i),n("experiments",r)},input_input_handler_1:function(){i.runname=this.value,n("dsinfo",i),n("experiments",r)},select_change_handler_1:function(){i.prefrac_id=j(this),n("dsinfo",i),n("experiments",r)},select_change_handler_2:function(){i.hiriefrange=j(this),n("dsinfo",i),n("experiments",r)},input_input_handler_2:function(){i.prefrac_length=_(this.value),n("dsinfo",i),n("experiments",r)},input_input_handler_3:function(){i.prefrac_amount=_(this.value),n("dsinfo",i),n("experiments",r)}}}class $t extends K{constructor(e){super(),G(this,e,Ot,wt,i,["dsinfo","experiments","hirief_ranges","prefracs","isNewExperiment","validate"])}get validate(){return this.$$.ctx.validate}}function kt(t){var n;return{c(){(n=d("h4")).textContent="Label check",h(n,"class","title is-4")},m(e,t){s(e,n,t)},p:e,i:e,o:e,d(e){e&&c(n)}}}class qt extends K{constructor(e){super(),G(this,e,null,kt,i,[])}}const{Object:Nt}=H;function Ft(e,t,n){const a=Nt.create(e);return a.fn=t[n],a.each_value=t,a.fn_index=n,a}function Ct(e,t,n){const a=Nt.create(e);return a.fn=t[n],a}function Et(e){var t;return{c(){(t=d("span")).innerHTML='<i class="fas fa-database"></i>',h(t,"class","icon is-small has-text-primary")},m(e,n){s(e,t,n)},d(e){e&&c(t)}}}function Pt(e){var t,n,a,l,i,o,f,_,v,b,x,j,y,w,O,$,k,q,N,F=e.fn.name+"",C=zt(e.fn.date)+"",E=e.fn.size+"",P=e.fn.instrument+"";function S(...t){return e.click_handler(e,...t)}var M=e.fn.id in Y&&Et();return{c(){t=d("tr"),n=d("td"),(a=d("span")).innerHTML='<i class="fas fa-times"></i>',l=u(),i=d("td"),M&&M.c(),o=u(),f=d("td"),_=p(F),v=u(),b=d("td"),x=p(C),j=u(),y=d("td"),w=p(E),O=p("MB"),$=u(),k=d("td"),q=p(P),h(a,"class","icon is-small has-text-danger"),N=m(a,"click",S)},m(e,c){s(e,t,c),r(t,n),r(n,a),r(t,l),r(t,i),M&&M.m(i,null),r(t,o),r(t,f),r(f,_),r(t,v),r(t,b),r(b,x),r(t,j),r(t,y),r(y,w),r(y,O),r(t,$),r(t,k),r(k,q)},p(t,n){(e=n).fn.id in Y?M||((M=Et()).c(),M.m(i,null)):M&&(M.d(1),M=null),(t.Object||t.addedFiles||t.files||t.datasetFiles)&&F!==(F=e.fn.name+"")&&g(_,F),(t.Object||t.addedFiles||t.files||t.datasetFiles)&&C!==(C=zt(e.fn.date)+"")&&g(x,C),(t.Object||t.addedFiles||t.files||t.datasetFiles)&&E!==(E=e.fn.size+"")&&g(w,E),(t.Object||t.addedFiles||t.files||t.datasetFiles)&&P!==(P=e.fn.instrument+"")&&g(q,P)},d(e){e&&c(t),M&&M.d(),N()}}}function St(e){var t,n,a,l,i,o,f,_,v,b,x,j,y,w,O,$,k,q,N,F,C=e.fn.name+"",E=zt(e.fn.date)+"",P=e.fn.size+"",S=e.fn.instrument+"";function M(){e.input_change_handler.call(a,e)}return{c(){t=d("tr"),n=d("td"),a=d("input"),l=u(),i=d("td"),o=u(),f=d("td"),_=p(C),v=u(),b=d("td"),x=p(E),j=u(),y=d("td"),w=p(P),O=p("MB"),$=u(),k=d("td"),q=p(S),N=u(),h(a,"type","checkbox"),F=m(a,"change",M)},m(c,d){s(c,t,d),r(t,n),r(n,a),a.checked=e.fn.checked,r(t,l),r(t,i),r(t,o),r(t,f),r(f,_),r(t,v),r(t,b),r(b,x),r(t,j),r(t,y),r(y,w),r(y,O),r(t,$),r(t,k),r(k,q),r(t,N)},p(t,n){e=n,(t.Object||t.removed_files||t.files)&&(a.checked=e.fn.checked),(t.Object||t.removed_files||t.files)&&C!==(C=e.fn.name+"")&&g(_,C),(t.Object||t.removed_files||t.files)&&E!==(E=zt(e.fn.date)+"")&&g(x,E),(t.Object||t.removed_files||t.files)&&P!==(P=e.fn.size+"")&&g(w,P),(t.Object||t.removed_files||t.files)&&S!==(S=e.fn.instrument+"")&&g(q,S)},d(e){e&&c(t),F()}}}function Mt(t){var n,l,i,f,_,b,x,j,y,w,O,$,k,q,N,F,C,E,P,S,M,z,L,I,T,U,D,R,H,Q,A,B,J,G,K,V,W,X,Y,Z,ee,te,ne,ae,le,ie,re=t.files.newfn_order.length+"",se=t.selectedFiles.length+"",ce=t.files.dsfn_order.length+"",oe=t.Object.keys(t.removed_files).length+"",de=t.Object.keys(t.addedFiles).length+"";let pe=t.Object.values(t.addedFiles).concat(t.files.dsfn_order.map(t.func)),ue=[];for(let e=0;e<pe.length;e+=1)ue[e]=Pt(Ct(t,pe,e));let fe=t.Object.values(t.removed_files).concat(t.files.newfn_order.map(t.func_1)),me=[];for(let e=0;e<fe.length;e+=1)me[e]=St(Ft(t,fe,e));return{c(){n=d("div"),l=d("input"),i=u(),f=d("div"),_=p("Showing "),b=p(re),x=p(" new files ("),j=p(se),y=p(" selected), "),w=p(ce),O=p(" files in dataset (incl. "),$=p(oe),k=p(", excl. "),q=p(de),N=p(" added files)"),F=u(),C=d("div"),E=d("button"),P=p("Save"),M=u(),(z=d("button")).textContent="Revert",L=u(),I=d("button"),T=p("Add selected files"),D=u(),R=d("table"),H=d("thead"),Q=d("tr"),A=d("th"),B=d("input"),J=u(),G=d("th"),K=u(),(V=d("th")).textContent="File",W=u(),(X=d("th")).textContent="Date",Y=u(),(Z=d("th")).textContent="Size",ee=u(),(te=d("th")).textContent="Instrument",ne=u(),ae=d("tbody");for(let e=0;e<ue.length;e+=1)ue[e].c();le=u();for(let e=0;e<me.length;e+=1)me[e].c();h(l,"class","input is-small"),h(l,"type","text"),h(l,"placeholder","Type a query and press enter to find analyses"),h(E,"class","button is-danger is-small"),E.disabled=S=!t.changed,h(z,"class","button is-info is-small"),h(I,"class","button is-small"),I.disabled=U=!t.selectedFiles.length,h(B,"type","checkbox"),h(R,"class","table"),h(n,"class","content is-small"),ie=[m(l,"input",t.input0_input_handler),m(l,"keyup",t.findFiles),m(E,"click",t.save),m(z,"click",t.fetchFiles),m(I,"click",t.addFiles),m(B,"change",t.input1_change_handler),m(B,"click",t.selectAllNew)]},m(e,a){s(e,n,a),r(n,l),v(l,t.findQuery),r(n,i),r(n,f),r(f,_),r(f,b),r(f,x),r(f,j),r(f,y),r(f,w),r(f,O),r(f,$),r(f,k),r(f,q),r(f,N),r(n,F),r(n,C),r(C,E),r(E,P),r(C,M),r(C,z),r(C,L),r(C,I),r(I,T),r(n,D),r(n,R),r(R,H),r(H,Q),r(Q,A),r(A,B),B.checked=t.allNewSelector,r(Q,J),r(Q,G),r(Q,K),r(Q,V),r(Q,W),r(Q,X),r(Q,Y),r(Q,Z),r(Q,ee),r(Q,te),r(R,ne),r(R,ae);for(let e=0;e<ue.length;e+=1)ue[e].m(ae,null);r(ae,le);for(let e=0;e<me.length;e+=1)me[e].m(ae,null)},p(e,t){if(e.findQuery&&l.value!==t.findQuery&&v(l,t.findQuery),e.files&&re!==(re=t.files.newfn_order.length+"")&&g(b,re),e.selectedFiles&&se!==(se=t.selectedFiles.length+"")&&g(j,se),e.files&&ce!==(ce=t.files.dsfn_order.length+"")&&g(w,ce),(e.Object||e.removed_files)&&oe!==(oe=t.Object.keys(t.removed_files).length+"")&&g($,oe),(e.Object||e.addedFiles)&&de!==(de=t.Object.keys(t.addedFiles).length+"")&&g(q,de),e.changed&&S!==(S=!t.changed)&&(E.disabled=S),e.selectedFiles&&U!==(U=!t.selectedFiles.length)&&(I.disabled=U),e.allNewSelector&&(B.checked=t.allNewSelector),e.Object||e.addedFiles||e.files||e.datasetFiles||e.isoTime){let n;for(pe=t.Object.values(t.addedFiles).concat(t.files.dsfn_order.map(t.func)),n=0;n<pe.length;n+=1){const a=Ct(t,pe,n);ue[n]?ue[n].p(e,a):(ue[n]=Pt(a),ue[n].c(),ue[n].m(ae,le))}for(;n<ue.length;n+=1)ue[n].d(1);ue.length=pe.length}if(e.Object||e.removed_files||e.files||e.isoTime){let n;for(fe=t.Object.values(t.removed_files).concat(t.files.newfn_order.map(t.func_1)),n=0;n<fe.length;n+=1){const a=Ft(t,fe,n);me[n]?me[n].p(e,a):(me[n]=St(a),me[n].c(),me[n].m(ae,null))}for(;n<me.length;n+=1)me[n].d(1);me.length=fe.length}},i:e,o:e,d(e){e&&c(n),o(ue,e),o(me,e),a(ie)}}}function zt(e){return new Date(e).toISOString()}function Lt(e,t,n){let a={newFiles:{},dsfn_order:[],newfn_order:[]},l={},i={},r="",s=!1;function c(e){e in Y?(n("removed_files",i[e]=Y[e],i),n("files",a.dsfn_order=a.dsfn_order.filter(t=>t!==e),a)):e in l&&n("addedFiles",l=Object.fromEntries(Object.entries(l).filter(t=>t[1].id!==e)))}async function o(){let e="/datasets/show/files/";e=dataset_id?e+dataset_id:e;const t=await V(e);for(let[e,l]of Object.entries(t))n("files",a[e]=l,a);for(let e in Y)delete Y[e];for(let[e,n]of Object.entries(t.datasetFiles))Y[e]=n;n("addedFiles",l={}),n("removed_files",i={})}O(async()=>{o()});let d,p;return e.$$.update=((e={Object:1,addedFiles:1,removed_files:1,files:1})=>{(e.Object||e.addedFiles||e.removed_files)&&n("changed",d=Object.keys(l).length||Object.keys(i).length),(e.Object||e.files||e.removed_files)&&n("selectedFiles",p=Object.values(a.newFiles).concat(Object.values(i)).filter(e=>e.checked))}),{files:a,addedFiles:l,removed_files:i,findQuery:r,allNewSelector:s,findFiles:async function(e){if(13===e.keyCode){console.log("finding");const e=await V(`/datasets/find/files?q=${r.split(" ").join(",")}`);for(let[t,l]of Object.entries(e))n("files",a[t]=l,a)}},selectAllNew:function(){let e=!1===s;for(let t in a.newFiles)n("files",a.newFiles[t].checked=e,a)},deleteFile:c,addFiles:function(){for(let e of Object.values(i).filter(e=>e.checked))e.checked=!1,delete i[e.id],n("files",a.dsfn_order=[e.id].concat(a.dsfn_order),a);for(let e of Object.values(a.newFiles).filter(e=>e.checked))e.checked=!1,n("addedFiles",l[e.id]=e,l),n("files",a.newfn_order=a.newfn_order.filter(t=>t!==e.id),a)},save:async function(){let e={dataset_id:dataset_id,added_files:l,removed_files:i};await W("/datasets/save/files/",e),o()},fetchFiles:o,Object:Object,changed:d,selectedFiles:p,input0_input_handler:function(){r=this.value,n("findQuery",r)},input1_change_handler:function(){s=this.checked,n("allNewSelector",s)},func:e=>Y[e],click_handler:({fn:e},t)=>c(e.id),func_1:e=>a.newFiles[e],input_change_handler:function({fn:e,each_value:t,fn_index:l}){t[l].checked=this.checked,n("Object",Object),n("removed_files",i),n("files",a)}}}class It extends K{constructor(e){super(),G(this,e,Lt,Mt,i,[])}}const{Object:Tt}=H;function Ut(e,t,n){const a=Tt.create(e);return a.dstype=t[n],a}function Dt(e,t,n){const a=Tt.create(e);return a.expi=t[n],a}function Rt(e,t,n){const a=Tt.create(e);return a.ptype=t[n],a}function Ht(e,t,n){const a=Tt.create(e);return a.project=t[n],a}function Qt(e,t,n){const a=Tt.create(e);return a.error=t[n],a}function At(e,t,n){const a=Tt.create(e);return a.error=t[n],a}function Bt(e){var t,n,a;let l=e.Object.values(e.saveerrors).flat(),i=[];for(let t=0;t<l.length;t+=1)i[t]=Jt(At(e,l,t));let p=e.Object.values(e.errors).flat(),f=[];for(let t=0;t<p.length;t+=1)f[t]=Gt(Qt(e,p,t));return{c(){t=d("div"),n=d("ul");for(let e=0;e<i.length;e+=1)i[e].c();a=u();for(let e=0;e<f.length;e+=1)f[e].c();h(t,"class","notification errorbox is-danger svelte-15xns2n")},m(e,l){s(e,t,l),r(t,n);for(let e=0;e<i.length;e+=1)i[e].m(n,null);r(n,a);for(let e=0;e<f.length;e+=1)f[e].m(n,null)},p(e,t){if(e.Object||e.saveerrors){let r;for(l=t.Object.values(t.saveerrors).flat(),r=0;r<l.length;r+=1){const s=At(t,l,r);i[r]?i[r].p(e,s):(i[r]=Jt(s),i[r].c(),i[r].m(n,a))}for(;r<i.length;r+=1)i[r].d(1);i.length=l.length}if(e.Object||e.errors){let a;for(p=t.Object.values(t.errors).flat(),a=0;a<p.length;a+=1){const l=Qt(t,p,a);f[a]?f[a].p(e,l):(f[a]=Gt(l),f[a].c(),f[a].m(n,null))}for(;a<f.length;a+=1)f[a].d(1);f.length=p.length}},d(e){e&&c(t),o(i,e),o(f,e)}}}function Jt(e){var t,n,a,l=e.error+"";return{c(){t=d("li"),n=p("• "),a=p(l)},m(e,l){s(e,t,l),r(t,n),r(t,a)},p(e,t){e.saveerrors&&l!==(l=t.error+"")&&g(a,l)},d(e){e&&c(t)}}}function Gt(e){var t,n,a,l=e.error+"";return{c(){t=d("li"),n=p("• "),a=p(l)},m(e,l){s(e,t,l),r(t,n),r(t,a)},p(e,t){e.errors&&l!==(l=t.error+"")&&g(a,l)},d(e){e&&c(t)}}}function Kt(e){var t,n,a,l,i,o=e.dsinfo.storage_location+"";return{c(){t=d("article"),(n=d("div")).textContent="Storage location",a=u(),l=d("div"),i=p(o),h(n,"class","message-header"),h(l,"class","message-body"),h(t,"class","message is-info")},m(e,c){s(e,t,c),r(t,n),r(t,a),r(t,l),r(l,i)},p(e,t){e.dsinfo&&o!==(o=t.dsinfo.storage_location+"")&&g(i,o)},d(e){e&&c(t)}}}function Vt(e){var t;return{c(){t=p("Create new project")},m(e,n){s(e,t,n)},d(e){e&&c(t)}}}function Wt(e){var t;return{c(){t=p("Use existing project")},m(e,n){s(e,t,n)},d(e){e&&c(t)}}}function Xt(e){var t,n,l,i,p,f,_,g;let b=e.pdata.ptypes,j=[];for(let t=0;t<b.length;t+=1)j[t]=Zt(Rt(e,b,t));return{c(){t=d("input"),n=u(),(l=d("label")).textContent="Project type",i=u(),p=d("div"),f=d("select"),(_=d("option")).textContent="Please select one";for(let e=0;e<j.length;e+=1)j[e].c();h(t,"class","input"),h(t,"type","text"),h(t,"placeholder","Project name"),h(l,"class","label"),_.disabled=!0,_.__value="",_.value=_.__value,void 0===e.dsinfo.ptype_id&&P(()=>e.select_change_handler_1.call(f)),h(p,"class","select"),g=[m(t,"input",e.input_input_handler),m(f,"change",e.select_change_handler_1)]},m(a,c){s(a,t,c),v(t,e.dsinfo.newprojectname),s(a,n,c),s(a,l,c),s(a,i,c),s(a,p,c),r(p,f),r(f,_);for(let e=0;e<j.length;e+=1)j[e].m(f,null);x(f,e.dsinfo.ptype_id)},p(e,n){if(e.dsinfo&&t.value!==n.dsinfo.newprojectname&&v(t,n.dsinfo.newprojectname),e.pdata){let t;for(b=n.pdata.ptypes,t=0;t<b.length;t+=1){const a=Rt(n,b,t);j[t]?j[t].p(e,a):(j[t]=Zt(a),j[t].c(),j[t].m(f,null))}for(;t<j.length;t+=1)j[t].d(1);j.length=b.length}e.dsinfo&&x(f,n.dsinfo.ptype_id)},d(e){e&&(c(t),c(n),c(l),c(i),c(p)),o(j,e),a(g)}}}function Yt(e){var t,n,l,i;let p=e.pdata.projects,u=[];for(let t=0;t<p.length;t+=1)u[t]=en(Ht(e,p,t));return{c(){t=d("div"),n=d("select"),(l=d("option")).textContent="Please select one";for(let e=0;e<u.length;e+=1)u[e].c();l.disabled=!0,l.__value="",l.value=l.__value,void 0===e.dsinfo.project_id&&P(()=>e.select_change_handler.call(n)),h(t,"class","select"),i=[m(n,"change",e.select_change_handler),m(n,"change",e.project_selected)]},m(a,i){s(a,t,i),r(t,n),r(n,l);for(let e=0;e<u.length;e+=1)u[e].m(n,null);x(n,e.dsinfo.project_id)},p(e,t){if(e.pdata){let a;for(p=t.pdata.projects,a=0;a<p.length;a+=1){const l=Ht(t,p,a);u[a]?u[a].p(e,l):(u[a]=en(l),u[a].c(),u[a].m(n,null))}for(;a<u.length;a+=1)u[a].d(1);u.length=p.length}e.dsinfo&&x(n,t.dsinfo.project_id)},d(e){e&&c(t),o(u,e),a(i)}}}function Zt(e){var t,n,a,l=e.ptype.name+"";return{c(){t=d("option"),n=p(l),t.__value=a=e.ptype.id,t.value=t.__value},m(e,a){s(e,t,a),r(t,n)},p(e,i){e.pdata&&l!==(l=i.ptype.name+"")&&g(n,l),e.pdata&&a!==(a=i.ptype.id)&&(t.__value=a),t.value=t.__value},d(e){e&&c(t)}}}function en(e){var t,n,a,l=e.project.name+"";return{c(){t=d("option"),n=p(l),t.__value=a=e.project.id,t.value=t.__value},m(e,a){s(e,t,a),r(t,n)},p(e,i){e.pdata&&l!==(l=i.project.name+"")&&g(n,l),e.pdata&&a!==(a=i.project.id)&&(t.__value=a),t.value=t.__value},d(e){e&&c(t)}}}function tn(e){var t,n,a,l=e.dsinfo.pi.name+"";return{c(){t=d("span"),n=p("External project: "),a=p(l),h(t,"class","tag is-success is-medium")},m(e,l){s(e,t,l),r(t,n),r(t,a)},p(e,t){e.dsinfo&&l!==(l=t.dsinfo.pi.name+"")&&g(a,l)},d(e){e&&c(t)}}}function nn(e){var t,n,l,i,o,f,_,g;function b(e,t){return t.isNewProject&&t.isNewPI?ln:t.isNewProject?an:void 0}var x=b(0,e),j=x&&x(e);function y(e,t){return t.isNewProject&&!t.isNewPI?sn:t.isNewProject?rn:void 0}var w=y(0,e),O=w&&w(e);return{c(){t=d("div"),n=d("label"),l=p("contact(s)\n          "),j&&j.c(),i=u(),O&&O.c(),o=u(),f=d("div"),_=d("input"),h(n,"class","label"),h(_,"class","input"),h(_,"type","text"),h(_,"placeholder","operational contact email (e.g. postdoc)"),h(f,"class","control"),h(t,"class","field"),g=[m(_,"input",e.input_input_handler_2),m(_,"change",e.editMade)]},m(a,c){s(a,t,c),r(t,n),r(n,l),j&&j.m(n,null),r(t,i),O&&O.m(t,null),r(t,o),r(t,f),r(f,_),v(_,e.dsinfo.externalcontactmail)},p(e,a){x!==(x=b(0,a))&&(j&&j.d(1),(j=x&&x(a))&&(j.c(),j.m(n,null))),w===(w=y(0,a))&&O?O.p(e,a):(O&&O.d(1),(O=w&&w(a))&&(O.c(),O.m(t,o))),e.dsinfo&&_.value!==a.dsinfo.externalcontactmail&&v(_,a.dsinfo.externalcontactmail)},d(e){e&&c(t),j&&j.d(),O&&O.d(),a(g)}}}function an(e){var t,n;return{c(){(t=d("a")).textContent="Create new PI",h(t,"class","button is-danger is-outlined is-small"),n=m(t,"click",e.click_handler_1)},m(e,n){s(e,t,n)},d(e){e&&c(t),n()}}}function ln(e){var t,n;return{c(){(t=d("a")).textContent="Use existing PI",h(t,"class","button is-danger is-outlined is-small"),n=m(t,"click",e.click_handler)},m(e,n){s(e,t,n)},d(e){e&&c(t),n()}}}function rn(e){var t,n,l;return{c(){t=d("div"),h(n=d("input"),"class","input"),h(n,"type","text"),h(n,"placeholder","PI name"),h(t,"class","control"),l=[m(n,"input",e.input_input_handler_1),m(n,"input",e.editMade)]},m(a,l){s(a,t,l),r(t,n),v(n,e.dsinfo.newpiname)},p(e,t){e.dsinfo&&n.value!==t.dsinfo.newpiname&&v(n,t.dsinfo.newpiname)},d(e){e&&c(t),a(l)}}}function sn(e){var t,n,l,i,p;let u=e.pdata.external_pis,f=[];for(let t=0;t<u.length;t+=1)f[t]=cn(Dt(e,u,t));return{c(){t=d("div"),n=d("div"),l=d("select"),(i=d("option")).textContent="Please select one";for(let e=0;e<f.length;e+=1)f[e].c();i.disabled=!0,i.__value="",i.value=i.__value,void 0===e.dsinfo.pi&&P(()=>e.select_change_handler_2.call(l)),h(n,"class","select"),h(t,"class","control"),p=[m(l,"change",e.select_change_handler_2),m(l,"change",e.editMade)]},m(a,c){s(a,t,c),r(t,n),r(n,l),r(l,i);for(let e=0;e<f.length;e+=1)f[e].m(l,null);x(l,e.dsinfo.pi)},p(e,t){if(e.pdata){let n;for(u=t.pdata.external_pis,n=0;n<u.length;n+=1){const a=Dt(t,u,n);f[n]?f[n].p(e,a):(f[n]=cn(a),f[n].c(),f[n].m(l,null))}for(;n<f.length;n+=1)f[n].d(1);f.length=u.length}e.dsinfo&&x(l,t.dsinfo.pi)},d(e){e&&c(t),o(f,e),a(p)}}}function cn(e){var t,n,a,l=e.expi.name+"";return{c(){t=d("option"),n=p(l),t.__value=a=e.expi,t.value=t.__value},m(e,a){s(e,t,a),r(t,n)},p(e,i){e.pdata&&l!==(l=i.expi.name+"")&&g(n,l),e.pdata&&a!==(a=i.expi)&&(t.__value=a),t.value=t.__value},d(e){e&&c(t)}}}function on(e){var t,n,a,l=e.dstype.name+"";return{c(){t=d("option"),n=p(l),t.__value=a=e.dstype.id,t.value=t.__value},m(e,a){s(e,t,a),r(t,n)},p(e,i){e.pdata&&l!==(l=i.dstype.name+"")&&g(n,l),e.pdata&&a!==(a=i.dstype.id)&&(t.__value=a),t.value=t.__value},d(e){e&&c(t)}}}function dn(e){var t,n,a,l,i;function r(n){e.msdata_dsinfo_binding.call(null,n),t=!0,S(()=>t=!1)}function o(t){e.msdata_isNewExperiment_binding.call(null,t),n=!0,S(()=>n=!1)}let d={experiments:e.experiments,prefracs:e.pdata.prefracs,hirief_ranges:e.pdata.hirief_ranges};void 0!==e.dsinfo&&(d.dsinfo=e.dsinfo),void 0!==e.isNewExperiment&&(d.isNewExperiment=e.isNewExperiment);var p=new $t({props:d});e.msdata_binding(p),q.push(()=>Q(p,"dsinfo",r)),q.push(()=>Q(p,"isNewExperiment",o)),p.$on("edited",e.editMade);var m=e.dsinfo.dataset_id&&pn(e);return{c(){p.$$.fragment.c(),a=u(),m&&m.c(),l=f()},m(e,t){A(p,e,t),s(e,a,t),m&&m.m(e,t),s(e,l,t),i=!0},p(e,a){var i={};e.experiments&&(i.experiments=a.experiments),e.pdata&&(i.prefracs=a.pdata.prefracs),e.pdata&&(i.hirief_ranges=a.pdata.hirief_ranges),!t&&e.dsinfo&&(i.dsinfo=a.dsinfo),!n&&e.isNewExperiment&&(i.isNewExperiment=a.isNewExperiment),p.$set(i),a.dsinfo.dataset_id?m?(m.p(e,a),D(m,1)):((m=pn(a)).c(),D(m,1),m.m(l.parentNode,l)):m&&(T(),R(m,1,1,()=>{m=null}),U())},i(e){i||(D(p.$$.fragment,e),D(m),i=!0)},o(e){R(p.$$.fragment,e),R(m),i=!1},d(t){e.msdata_binding(null),B(p,t),t&&c(a),m&&m.d(t),t&&c(l)}}}function pn(e){var t,n;function a(n){e.acquicomp_1_errors_binding.call(null,n),t=!0,S(()=>t=!1)}let l={};void 0!==e.errors.acqui&&(l.errors=e.errors.acqui);var i=new xe({props:l});return e.acquicomp_1_binding(i),q.push(()=>Q(i,"errors",a)),{c(){i.$$.fragment.c()},m(e,t){A(i,e,t),n=!0},p(e,n){var a={};!t&&e.errors&&(a.errors=n.errors.acqui),i.$set(a)},i(e){n||(D(i.$$.fragment,e),n=!0)},o(e){R(i.$$.fragment,e),n=!1},d(t){e.acquicomp_1_binding(null),B(i,t)}}}function un(e){var t,n;function a(n){e.prepcomp_1_errors_binding.call(null,n),t=!0,S(()=>t=!1)}let l={};void 0!==e.errors.sprep&&(l.errors=e.errors.sprep);var i=new ot({props:l});return e.prepcomp_1_binding(i),q.push(()=>Q(i,"errors",a)),{c(){i.$$.fragment.c()},m(e,t){A(i,e,t),n=!0},p(e,n){var a={};!t&&e.errors&&(a.errors=n.errors.sprep),i.$set(a)},i(e){n||(D(i.$$.fragment,e),n=!0)},o(e){R(i.$$.fragment,e),n=!1},d(t){e.prepcomp_1_binding(null),B(i,t)}}}function fn(e){var t;var n=new qt({props:{}});return e.lcheck_binding(n),{c(){n.$$.fragment.c()},m(e,a){A(n,e,a),t=!0},p(e,t){n.$set({})},i(e){t||(D(n.$$.fragment,e),t=!0)},o(e){R(n.$$.fragment,e),t=!1},d(t){e.lcheck_binding(null),B(n,t)}}}function mn(e){var t,n,l,i,f,_,g,v,j,y,w,O,$,k,q,N,F,C,E,S,M,z,L,I,H,Q,J,G,K,V,W,X,Y,Z,ee,te,ne,ae,le,ie,re,se,ce,oe,de,pe,ue,fe,me,he,_e,ge,ve,be,xe,je=e.Object.values(e.errors).flat().length||e.Object.values(e.saveerrors).flat().length,ye=e.components.indexOf("sampleprep")>-1,we=e.components.indexOf("labelcheck")>-1,Oe=je&&Bt(e),$e=e.dataset_id&&function(e){var t,n,a,l;return{c(){t=d("li"),(n=d("a")).innerHTML="<span>Files</span>",h(t,"class",a="files"===e.tabshow?"is-active":""),l=m(n,"click",e.showFiles)},m(e,a){s(e,t,a),r(t,n)},p(e,n){e.tabshow&&a!==(a="files"===n.tabshow?"is-active":"")&&h(t,"class",a)},d(e){e&&c(t),l()}}}(e),ke=e.dsinfo.storage_location&&Kt(e),qe={c(){h(xe=d("i"),"class","icon fas fa-check-circle")},m(e,t){s(e,xe,t)},d(e){e&&c(xe)}};function Ne(e,t){return t.isNewProject?Wt:Vt}var Fe=Ne(0,e),Ce=Fe(e);function Ee(e,t){return t.isNewProject?Xt:Yt}var Pe=Ee(0,e),Se=Pe(e),Me=e.isExternal&&tn(e),ze=e.isExternal&&nn(e);let Le=e.pdata.datasettypes,Ie=[];for(let t=0;t<Le.length;t+=1)Ie[t]=on(Ut(e,Le,t));var Te=e.showMsdata&&dn(e),Ue=ye&&un(e),De=we&&fn(e);var Re=new It({props:{}});return e.files_binding(Re),{c(){Oe&&Oe.c(),t=u(),n=d("div"),l=d("ul"),i=d("li"),(f=d("a")).innerHTML="<span>Metadata</span>",g=u(),$e&&$e.c(),v=u(),(j=d("h4")).textContent="Dataset",y=u(),(w=d("button")).textContent="Top save",O=u(),$=d("div"),k=d("div"),q=u(),N=d("div"),F=d("div"),ke&&ke.c(),C=u(),E=d("h5"),qe&&qe.c(),S=p("\n        Basics\n        "),M=d("button"),z=p("Save"),I=u(),H=d("button"),Q=p("Revert"),G=u(),K=d("div"),V=d("label"),W=p("Project\n          "),X=d("a"),Ce.c(),Y=u(),Z=d("div"),Se.c(),ee=u(),Me&&Me.c(),te=u(),ze&&ze.c(),ne=u(),ae=d("div"),(le=d("label")).textContent="Dataset type",ie=u(),re=d("div"),se=d("div"),ce=d("select"),(oe=d("option")).textContent="Please select one";for(let e=0;e<Ie.length;e+=1)Ie[e].c();de=u(),Te&&Te.c(),pe=u(),Ue&&Ue.c(),ue=u(),De&&De.c(),fe=u(),me=d("div"),he=u(),_e=d("div"),ge=d("div"),Re.$$.fragment.c(),h(i,"class",_="meta"===e.tabshow?"is-active":""),h(n,"class","tabs is-toggle is-centered is-small"),h(j,"class","title is-4"),h(w,"class","button"),h(k,"class","column"),h(M,"class","button is-small is-danger has-text-weight-bold"),M.disabled=L=!e.edited||!e.dsinfo.datatype_id,h(H,"class","button is-small is-info has-text-weight-bold"),H.disabled=J=!e.edited||!e.dsinfo.datatype_id,h(E,"class","has-text-primary title is-5"),h(X,"class","button is-danger is-outlined is-small"),h(V,"class","label"),h(Z,"class","control"),h(K,"class","field"),h(le,"class","label"),oe.disabled=!0,oe.__value="",oe.value=oe.__value,void 0===e.dsinfo.datatype_id&&P(()=>e.select_change_handler_3.call(ce)),h(se,"class","select"),h(re,"class","control"),h(ae,"class","field"),h(F,"class","box"),h(F,"id","project"),h(N,"class","column is-two-thirds"),h(me,"class","column"),h($,"class","columns"),b($,"display","meta"!==e.tabshow?"none":""),h(ge,"class","column"),h(_e,"class","columns"),b(_e,"display","files"!==e.tabshow?"none":""),be=[m(f,"click",e.showMetadata),m(w,"click",hn),m(M,"click",e.save),m(H,"click",e.fetchDataset),m(X,"click",e.toggle_project),m(ce,"change",e.select_change_handler_3),m(ce,"change",e.getcomponents)]},m(a,c){Oe&&Oe.m(a,c),s(a,t,c),s(a,n,c),r(n,l),r(l,i),r(i,f),r(l,g),$e&&$e.m(l,null),s(a,v,c),s(a,j,c),s(a,y,c),s(a,w,c),s(a,O,c),s(a,$,c),r($,k),r($,q),r($,N),r(N,F),ke&&ke.m(F,null),r(F,C),r(F,E),qe&&qe.m(E,null),r(E,S),r(E,M),r(M,z),r(E,I),r(E,H),r(H,Q),r(F,G),r(F,K),r(K,V),r(V,W),r(V,X),Ce.m(X,null),r(K,Y),r(K,Z),Se.m(Z,null),r(Z,ee),Me&&Me.m(Z,null),r(F,te),ze&&ze.m(F,null),r(F,ne),r(F,ae),r(ae,le),r(ae,ie),r(ae,re),r(re,se),r(se,ce),r(ce,oe);for(let e=0;e<Ie.length;e+=1)Ie[e].m(ce,null);x(ce,e.dsinfo.datatype_id),r(F,de),Te&&Te.m(F,null),r(F,pe),Ue&&Ue.m(F,null),r(F,ue),De&&De.m(F,null),r($,fe),r($,me),s(a,he,c),s(a,_e,c),r(_e,ge),A(Re,ge,null),ve=!0},p(e,n){if((e.errors||e.saveerrors)&&(je=n.Object.values(n.errors).flat().length||n.Object.values(n.saveerrors).flat().length),je?Oe?Oe.p(e,n):((Oe=Bt(n)).c(),Oe.m(t.parentNode,t)):Oe&&(Oe.d(1),Oe=null),ve&&!e.tabshow||_===(_="meta"===n.tabshow?"is-active":"")||h(i,"class",_),n.dataset_id&&$e.p(e,n),n.dsinfo.storage_location?ke?ke.p(e,n):((ke=Kt(n)).c(),ke.m(F,C)):ke&&(ke.d(1),ke=null),ve&&!e.edited&&!e.dsinfo||L===(L=!n.edited||!n.dsinfo.datatype_id)||(M.disabled=L),ve&&!e.edited&&!e.dsinfo||J===(J=!n.edited||!n.dsinfo.datatype_id)||(H.disabled=J),Fe!==(Fe=Ne(0,n))&&(Ce.d(1),(Ce=Fe(n))&&(Ce.c(),Ce.m(X,null))),Pe===(Pe=Ee(0,n))&&Se?Se.p(e,n):(Se.d(1),(Se=Pe(n))&&(Se.c(),Se.m(Z,ee))),n.isExternal?Me?Me.p(e,n):((Me=tn(n)).c(),Me.m(Z,null)):Me&&(Me.d(1),Me=null),n.isExternal?ze?ze.p(e,n):((ze=nn(n)).c(),ze.m(F,ne)):ze&&(ze.d(1),ze=null),e.pdata){let t;for(Le=n.pdata.datasettypes,t=0;t<Le.length;t+=1){const a=Ut(n,Le,t);Ie[t]?Ie[t].p(e,a):(Ie[t]=on(a),Ie[t].c(),Ie[t].m(ce,null))}for(;t<Ie.length;t+=1)Ie[t].d(1);Ie.length=Le.length}e.dsinfo&&x(ce,n.dsinfo.datatype_id),n.showMsdata?Te?(Te.p(e,n),D(Te,1)):((Te=dn(n)).c(),D(Te,1),Te.m(F,pe)):Te&&(T(),R(Te,1,1,()=>{Te=null}),U()),e.components&&(ye=n.components.indexOf("sampleprep")>-1),ye?Ue?(Ue.p(e,n),D(Ue,1)):((Ue=un(n)).c(),D(Ue,1),Ue.m(F,ue)):Ue&&(T(),R(Ue,1,1,()=>{Ue=null}),U()),e.components&&(we=n.components.indexOf("labelcheck")>-1),we?De?(De.p(e,n),D(De,1)):((De=fn(n)).c(),D(De,1),De.m(F,null)):De&&(T(),R(De,1,1,()=>{De=null}),U()),ve&&!e.tabshow||b($,"display","meta"!==n.tabshow?"none":"");Re.$set({}),ve&&!e.tabshow||b(_e,"display","files"!==n.tabshow?"none":"")},i(e){ve||(D(Te),D(Ue),D(De),D(Re.$$.fragment,e),ve=!0)},o(e){R(Te),R(Ue),R(De),R(Re.$$.fragment,e),ve=!1},d(l){Oe&&Oe.d(l),l&&(c(t),c(n)),$e&&$e.d(),l&&(c(v),c(j),c(y),c(w),c(O),c($)),ke&&ke.d(),qe&&qe.d(),Ce.d(),Se.d(),Me&&Me.d(),ze&&ze.d(),o(Ie,l),Te&&Te.d(),Ue&&Ue.d(),De&&De.d(),l&&(c(he),c(_e)),e.files_binding(null),B(Re),a(be)}}}function hn(){}function _n(e,t,n){let a,l,i,r,s,c=!1,o={basics:[],sprep:[],acqui:[]},d=Object.assign({},o),p=[],u={datatype_id:"",project_id:"",ptype_id:"",storage_location:"",newprojectname:"",dataset_id:"",experiment_id:"",runname:"",pi:"",externalcontactmail:"",prefrac_id:"",prefrac_length:"",prefrac_amount:"",hiriefrange:""},f={datasettypes:[],ptypes:[],projects:[],local_ptype_id:"",external_pis:[],prefracs:[],hirief_ranges:[]},m=[],h=!1,_=!1,g=!1,v=[],b="meta";async function x(){const e=await V(`/datasets/show/components/${u.datatype_id}`);n("components",m=e.components)}async function y(e=!1,t=!1){if(u.project_id){const e=await V(`/datasets/show/project/${u.project_id}`);n("dsinfo",u.pi=f.external_pis.filter(t=>t.id===e.pi_id)[0],u),n("dsinfo",u.ptype_id=e.ptype_id,u),n("experiments",v=e.experiments),n("isNewProject",h=!1)}t||n("dsinfo",u.experiment_id="",u)}async function w(){let e="/datasets/show/info/";e=dataset_id?e+dataset_id:e;const t=await V(e);for(let[e,a]of Object.entries(t.projdata))n("pdata",f[e]=a,f);for(let[e,a]of Object.entries(t.dsinfo))n("dsinfo",u[e]=a,u);dataset_id&&(x(),await y(!1,!0),n("isNewExperiment",_=!1),n("isNewPI",g=!1)),n("edited",c=!1)}function $(){p=[];const e=RegExp("^[a-z0-9-_]+$","i");return h&&!u.newprojectname||!h&&!u.project_id?p.push("Project needs to be selected or created"):h&&u.newprojectname&&!e.test(u.newprojectname)&&p.push("Project name may only contain a-z 0-9 - _"),_&&!u.newexperimentname||!_&&!u.experiment_id?p.push("Experiment is required"):_&&u.newexperimentname&&!e.test(u.newexperimentname)&&p.push("Experiment name may only contain a-z 0-9 - _"),u.runname?e.test(u.runname)||p.push("Run name may only contain a-z 0-9 - _"):p.push("Run name is required"),N&&(u.newpiname||u.pi.id||p.push("Need to select or create a PI"),u.externalcontactmail||p.push("External contact is required")),u.datatype_id||p.push("Datatype is required"),p}O(async()=>{await w()});let k,N;return e.$$.update=((e={components:1,dsinfo:1,pdata:1})=>{e.components&&n("showMsdata",k=m.indexOf("acquisition")>-1),(e.dsinfo||e.pdata)&&n("isExternal",N=u.ptype_id!==f.local_ptype_id)}),{mssubcomp:a,acquicomp:l,prepcomp:i,lccomp:r,filescomp:s,edited:c,errors:o,saveerrors:d,dsinfo:u,pdata:f,components:m,isNewProject:h,isNewExperiment:_,isNewPI:g,experiments:v,tabshow:b,getcomponents:x,project_selected:y,toggle_project:function(){n("isNewProject",h=!1===h)},editMade:function(){n("edited",c=!0),n("errors",o.basics=o.basics.length?$():[],o)},fetchDataset:w,save:async function(){if(n("errors",o.basics=$(),o),k){let e=a.validate();n("errors",o.basics=[...o.basics,...e],o)}if(0===o.basics.length){let e={dataset_id:dataset_id,ptype_id:u.ptype_id,datatype_id:u.datatype_id,runname:u.runname,prefrac_id:u.prefrac_id,prefrac_length:u.prefrac_length,prefrac_amount:u.prefrac_amount,hiriefrange:u.hiriefrange};h?e.newprojectname=u.newprojectname:e.project_id=u.project_id,_?e.newexperimentname=u.newexperimentname:e.experiment_id=u.experiment_id,g?e.newpiname=u.newpiname:e.pi_id=N?u.pi.id:f.internal_pi_id,u.ptype_id!==f.local_ptype_id&&(e.externalcontact=u.externalcontactmail);const t=await W("/datasets/save/project/",e);"error"in t?n("saveerrors",d.basics=[t.error,...d.basics],d):(dataset_id=t.dataset_id,w())}},showMetadata:function(){n("tabshow",b="meta")},showFiles:function(){n("tabshow",b=dataset_id?"files":b)},Object:Object,showMsdata:k,isExternal:N,dataset_id:dataset_id,select_change_handler:function(){u.project_id=j(this),n("dsinfo",u),n("pdata",f)},input_input_handler:function(){u.newprojectname=this.value,n("dsinfo",u),n("pdata",f)},select_change_handler_1:function(){u.ptype_id=j(this),n("dsinfo",u),n("pdata",f)},click_handler:e=>n("isNewPI",g=!g),click_handler_1:e=>n("isNewPI",g=!g),select_change_handler_2:function(){u.pi=j(this),n("dsinfo",u),n("pdata",f)},input_input_handler_1:function(){u.newpiname=this.value,n("dsinfo",u),n("pdata",f)},input_input_handler_2:function(){u.externalcontactmail=this.value,n("dsinfo",u),n("pdata",f)},select_change_handler_3:function(){u.datatype_id=j(this),n("dsinfo",u),n("pdata",f)},msdata_binding:function(e){q[e?"unshift":"push"](()=>{n("mssubcomp",a=e)})},msdata_dsinfo_binding:function(e){n("dsinfo",u=e)},msdata_isNewExperiment_binding:function(e){n("isNewExperiment",_=e)},acquicomp_1_binding:function(e){q[e?"unshift":"push"](()=>{n("acquicomp",l=e)})},acquicomp_1_errors_binding:function(e){o.acqui=e,n("errors",o)},prepcomp_1_binding:function(e){q[e?"unshift":"push"](()=>{n("prepcomp",i=e)})},prepcomp_1_errors_binding:function(e){o.sprep=e,n("errors",o)},lcheck_binding:function(e){q[e?"unshift":"push"](()=>{n("lccomp",r=e)})},files_binding:function(e){q[e?"unshift":"push"](()=>{n("filescomp",s=e)})}}}return new class extends K{constructor(e){super(),G(this,e,_n,mn,i,[])}}({target:document.querySelector("#appbox")})}();
//# sourceMappingURL=bundle.js.map
