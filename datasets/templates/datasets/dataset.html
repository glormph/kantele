{% extends "datasets/base.html" %}
{% block content %}
<section id="apps">
<div class="tabs is-toggle is-centered is-small">
	<ul>
		<li v-bind:class="tabclassDef"><a v-on:click="showDef" >Definition</a></li>
		<li v-bind:class="tabclassFiles"><a  v-on:click="showFiles">Files</a></li>
		<li v-bind:class="tabclassAcq"><a v-on:click="showAcquisition">Acquisition</a></li>
		<li v-bind:class="tabclassSP"><a v-on:click="showSP">Sample prep</a></li>
	</ul>
</div>
<div class="container">
		<project-box v-show="viewtab === 'definition'" v-bind:dset_id="dataset_id" v-bind:pdata="projdata"></project-box>
		<acquisition-box v-show="viewtab === 'acquisition'" v-bind:dset_id="dataset_id" v-bind:acqdata="acqdata"></acquisition-box>
		<files-box v-show="viewtab === 'files'" v-bind:dset_id="dataset_id" v-bind:fndata="filesdata"></files-box>
		<sampleprep-box v-show="viewtab === 'sampleprep'" v-bind:dset_id="dataset_id" v-bind:assoc_filenames="filesdata.datasetAssociatedFiles" v-bind:spdata="sampledata"></sampleprep-box>
</div>
</section>

<script>
	Vue.component('sampleprep-box', {
		props: ['dset_id', 'spdata', 'assoc_filenames'],
		template: `
	<div class="columns">
			<div class="column" />
			<div class="column is-two-thirds">
			<div class="box" v-if="!isOpen">
				<div class="title is-5">MS Samples and preparation</div>
				<article class="message is-danger"> 
				<div class="message-body">Save definition first</div></article>
			</div>
		        <div class="box" id="sampleprep" v-if="isOpen">
			<article class="message is-danger" v-if="errors.length > 0">
				<div class="message-body">
					<ul>
						{% verbatim %}
						<li v-for="error in errors">{{ error }}</li>
						{% endverbatim %}
					</ul>
				</div>
			</article>
			<div class="title is-5">MS Samples and preparation
				<a class="button is-danger is-small" v-on:click="save">Save</a>
			</div> 
			<div class="field">
				<label class="label">Enzymes</label>
				<input type="checkbox" v-model="spdata.o_enzyme">No enzyme
				{% verbatim %}
				<div class="control" v-for="enzyme in spdata.show_enzymes" v-show="!spdata.o_enzyme">
					<input v-bind:value="enzyme.id" v-model="spdata.enzymes" type="checkbox">{{ enzyme.name }}
				</div>
				{% endverbatim %}
			</div>
			<template v-for="param in spdata.params">
			<div class="field">
			{% verbatim %}
				<label class="label">{{ param.title }}</label>
				<div class="control">
					<template v-if="param.inputtype != 'select'">
					<input type="text" v-if="param.inputtype === 'text'" class="input" v-bind:placeholder="param.placeholder" v-model="param.model">
					<input type="number" v-if="param.inputtype === 'number'" class="input" v-bind:placeholder="param.placeholder" v-model="param.model">
					</template>

					<template v-if="param.inputtype === 'select'">
					<div class="select">
						<select v-model="param.model">
							<option disabled value="">Please select one</option>
							<template v-for="option in param.fields">
							<option v-bind:value="option.value">
							{{ option.text }}
							</option>
							</template>
						</select>
					</div>
					</template>
				</div>
			{% endverbatim %}
			</div>
			</template>
			<div class="field">
				<label class="label">Quant type</label>
				<div class="control">
					<div class="select">
						<select v-model="spdata.quanttype">
							<option disabled value="">Please select one</option>
							{% verbatim %}
							<option v-for="quant in spdata.quants" v-bind:value="quant.id">{{ quant.name }}</option>
							{% endverbatim %}
						</select>
					</div>
				</div>
			</div>
			<div class="field" v-if="spdata.quanttype">
				<label class="label">Samples</label>
				<div class="control">
					<div id="labelfree_samples" v-if="spdata.quanttype === labelfree_quant_id">
						<input type="checkbox" v-model="spdata.labelfree_multisample">One sample per file?
					</div>
				</div>
				<table class="table is-fullwidth">
					<thead>
						<tr>
							<th v-if="spdata.quanttype === labelfree_quant_id && spdata.labelfree_multisample">Filename</th>
							<th v-if="spdata.quanttype != labelfree_quant_id">Channel</th>
							<th>Sample name</th>
						</tr>
					</thead>
					{% verbatim %}
					<tbody>
						<tr v-for="channel in spdata.quants[spdata.quanttype].chans" v-if="spdata.quanttype != labelfree_quant_id">
							<td>{{ channel.name }}</td>
							<td><input v-model="channel.model" class="input is-normal"></td>
						</tr>
						<template v-if="spdata.quanttype === labelfree_quant_id">
						<tr v-if="!filenames.length">
							<td><div class="notification is-danger">CLAIM FILES FIRST</div></td>
						</tr>
						<tr v-if="spdata.labelfree_multisample && filenames.length" v-for="file in filenames">
							<td>{{ file.name }}</td>
							<td><input v-model="spdata.samples[file.associd]" class="input is-normal"></td>
						</tr>
						<tr v-if="!spdata.labelfree_multisample && filenames.length && spdata.quanttype === labelfree_quant_id">
							<td><input v-model="spdata.quants[spdata.quanttype].model" class="input is-normal"></td>
						</tr>
						</template>
					</tbody>
					{% endverbatim %}
				</table>
			</div>
	</div>
</div>
			<div class="column" />
			</div>
`,

		data: function() {
		return { 
			errors: [],
			}
		},
		computed: {
			isOpen: function() {
				return this.dset_id !== '';
				},
			filenames: function() {
				fns = [];
				for (key in this.assoc_filenames) {
					fns.push(this.assoc_filenames[key]);
					}
				return fns
			},
			labelfree_quant_id: function() {
				for (qid in this.spdata.quants) {
					if (this.spdata.quants[qid].name === 'labelfree') {
						return this.spdata.quants[qid].id
						}
					}
				},
			},
		
		methods: {
			validate: function() {
				this.errors = [];
				// FIXME quant type and sample names
				if (!this.spdata.no_enzyme && !this.enzymes) {
					this.errors.push('Enzyme selection is required');
				}
				if (!this.quanttype) {
					this.errors.push('Quant type selection is required');
				}
				if (this.labelfree_quant_id === this.quanttype) {
					if (this.labelfree_multisample) {
						for (fn of this.filenames) {
							if (!this.samples[fn.associd]) {
								this.errors.push('Labelfree multi-sample requires sample name for each file');
								break;
							}
								
					 	}	
					}
					else if (!this.quants[this.quanttype].model) {
						this.errors.push('Labelfree requires sample name');
						}
				} else {
					for (ch of this.quants[this.quanttype].chans) {
						if (ch.model === '') { 
							this.errors.push('Sample name for each channel is required');
							break;
						}
					}
				}
				for (var i = 0; i < this.params.length; i++) {
					if (this.params[i].model === "") {
						this.errors.push(this.params[i].title + ' is required');
					}
				}
				console.log(this.errors);
				return this.errors.length ? false : true

			},
			save: function() {
				if (!this.validate()) {
					return false
				}
				data = {
					dataset_id: this.dset_id,
					enzymes: this.enzymes,
					params: this.params,
					quanttype: this.quanttype,
					labelfree: this.labelfree_quant_id === this.quanttype,
				};
				if (!data.labelfree) {
					data.samples = this.quants[this.quanttype].chans;
				} else if (this.labelfree_multisample) {
					data.multisample = true;
					data.filenames = this.filenames;
					data.samples = this.samples;
				} else {
					data.multisample = false;
					data.filenames = this.filenames;
					data.sample = this.quants[this.quanttype].model;
				}
				this.$http.post('/datasets/save/sampleprep/', data
					).then(response => {
						console.log(response);
						this.fetchData();
					}, response => {
						console.log(response);
				});
			},
		},
	})

	Vue.component('files-box', {
		template: `
			<div class="columns">
			<div class="column" />
			<div class="column is-two-thirds">
		<div class="box" v-show="!isOpen">
			<div class="title is-5">Files</div>
			<article class="message is-danger"> 
			<div class="message-body">Save definition first</div></article>
		</div>
		<div class="box" v-show="isOpen">
			<div class="title is-5">Files
				<span class="has-text-success icon" v-show="isOk"><i class="fa fa-check"></i></span>
			       	<a class="button is-danger is-small" v-on:click="save">Save</a>

			</div>
			<a class="button is-danger is-outlined is-small" v-show="showDatasetFiles" v-on:click="toggleFileView">Show available files</a>
			<a class="button is-danger is-outlined is-small" v-show="!showDatasetFiles" v-on:click="toggleFileView">
				{% verbatim %}
				Show {{ Object.keys(showingAssociatedFiles()).length }} dataset files
				{% endverbatim %}
			</a>
			<a class="button is-primary is-outlined is-small" v-show="!showDatasetFiles" v-on:click="addFiles">Add selected files</a>
			<input class="input"  v-model="filefilterString" type="text" placeholder="Filter files" v-show="!showDatasetFiles">
			<table class="table">
				<thead>
					<tr>
						<th>
					<div class="control">
						<input type="checkbox" v-show="!showDatasetFiles">
					</div>
			</th>
						<th>Filename</th>
						<th>Instrument</th>
						<th>Production date</th>
					</tr>
				</thead>
				<tbody>
					<tr v-for="file in showingAssociatedFiles()" v-if="showDatasetFiles">
						<td>
							<div class="control">
								<a class="has-text-danger icon" v-on:click="removeFile(file)">
									<i class="fa fa-times"></i>
								</a>
							</div>
						</td>
						{% verbatim %}
						<td>{{ file.name }}</td>
						<td>{{ file.instrument }}</td>
						<td>{{ file.date }}</td>
						{% endverbatim %}
					</tr>
					<tr v-for="file in showingNewFiles()" v-if="!showDatasetFiles" v-show="filtered_files(file)">
						<td>
							<div class="control">
								<input v-model="file.checked" type="checkbox">
							</div>
						</td>
						{% verbatim %}
						<td>{{ file.name }}</td>
						<td>{{ file.instrument }}</td>
						<td>{{ file.date }}</td>
						{% endverbatim %}
					</tr>
				</tbody>
			</table>
		</div> 
	</div> 
			<div class="column" />
			</div>
		`,
		props: ['dset_id', 'fndata'],
		data: function() {return {
			showDatasetFiles: {% if newdataset %}false{% else %}true{% endif %},
			filefilterString: '',
			addedFiles: {},
			removedFiles: {},
		}
		},
		computed: {
			isOpen: function() {
				return this.dset_id !== '';
			},
			isOk: function() {
				return false;
			},
		// sort file list
		},
		methods: {
			toggleFileView: function() {
				this.showDatasetFiles = this.showDatasetFiles === false;
			},
			showingAssociatedFiles: function() {
				var val = Object.assign({}, this.fndata.datasetAssociatedFiles, this.addedFiles)
				for (key in this.removedFiles) {
					delete val[key];
					}
				return val
				},
			showingNewFiles: function() {
				var val = Object.assign({}, this.fndata.newFiles, this.removedFiles)
				for (key in this.addedFiles) {
					delete val[key];
					}
				return val
				},
			addFiles: function() {
				shownew = this.showingNewFiles();
				add_from_remove = []
				for (key in shownew) {
					if (shownew[key].checked) {
						shownew[key].checked = false;
						if (key in this.removedFiles) {
							add_from_remove.push(key);
							} else {
							this.$set(this.addedFiles, key, shownew[key])
							}
					}
				}	
				rmf = Object.assign({}, this.removedFiles);
				for (i=0; i<add_from_remove.length; i++) {
					delete rmf[key];
				}
				this.removedFiles = rmf;
			},
			removeFile: function(file) {
				file_id = 'id_' + file.id
				if (file_id in this.addedFiles) {
					addf = Object.assign({}, this.addedFiles)
					delete addf[file_id];
					this.addedFiles = addf;
					} else {
					this.$set(this.removedFiles, file_id, file);
					}
			},
			save: function() {
				data = {
					'dataset_id': this.dset_id,
					'added_files': this.addedFiles,
					'removed_files': this.removedFiles,
					}
				this.$http.post('/datasets/save/files/', data
					).then(response => {
						this.fetchData();
					}, response => {
					console.log(response);
					})
				// call save URL with vue-resource, 
				// include values of project.
				// Parse response ok or not.
				// Show error or green and rollup.
			},
			filtered_files: function(file) {
				return file.name.indexOf(this.filefilterString) > -1
			},
		}
	})

	Vue.component('acquisition-box', {
		template: `
			<div class="columns">
			<div class="column" />
			<div class="column is-two-thirds">
			<div class="box" v-show="!isOpen">
				<div class="title is-5">Acquisition</div>
				<article class="message is-danger"> 
				<div class="message-body">Save definition first</div></article>
			</div>
		<div class="box" v-show="isOpen">
			<article class="message is-danger" v-if="errors.length > 0">
				<div class="message-body">
					<ul>
						{% verbatim %}
						<li v-for="error in errors">{{ error }}</li>
						{% endverbatim %}
					</ul>
				</div>
			</article>
			<div class="title is-5">Acquisition
				<a class="button is-danger is-small" v-on:click="save">Save</a>
		</div> 
		<div class="field">
			<label class="label">Operator</label>
			<div class="control">
				<div class="select">
					<select v-model="acqdata.operator_id">
						<option disabled value="">Please select one</option>
						{% verbatim %}
						<option v-for="operator in acqdata.operators" v-bind:value="operator.id">{{ operator.name }}</option>
					        {% endverbatim %}
					</select>
				</div>
			</div>
		</div>
		<template v-for="param in acqdata.params">
		<div class="field">
		{% verbatim %}
			<label class="label">{{ param.title }}</label>
			<div class="control">
				<template v-if="param.inputtype != 'select'">
				<input type="text" v-if="param.inputtype === 'text'" class="input" v-bind:placeholder="param.placeholder" v-model="param.model">
				<input type="number" v-if="param.inputtype === 'number'" class="input" v-bind:placeholder="param.placeholder" v-model="param.model">
				</template>

				<template v-if="param.inputtype === 'select'">
				<div class="select">
					<select v-model="param.model">
						<option disabled value="">Please select one</option>
						<template v-for="option in param.fields">
						<option v-bind:value="option.value">
						{{ option.text }}
						</option>
						</template>
					</select>
				</div>
				</template>
			</div>
		{% endverbatim %}
		</div>
		</template>
</div></div>
			<div class="column" />
			</div>
`,
	data: function() {
		return {
			errors: [],
			}
		},
	props: ['dset_id', 'acqdata'],
	computed: {
		isOpen: function() {
			return this.dset_id !== '';
		},
	},
	methods: {
		fetchData: function() {
			this.$http.get('/datasets/show/acquisition/' + this.dset_id)
			.then(response => {
				return response.json()
				}, response => {
				console.log(response)
				}).then(result => {
				for (key in result) {
					this[key] = result[key];
				}
			})
	       	},
		validate: function() {
			this.errors = [];
			if (!this.operator_id) {
				this.errors.push('Operator is required');
			}
			for (var i = 0; i < this.params.length; i++) {
				if (this.params[i].model === "") {
					this.errors.push(this.params[i].title + ' is required');
				}
			}
			console.log(this.errors);
			return this.errors.length ? false : true

		},
		save: function() {
			if (!this.validate()) {
				return false
			}
			data = {
				dataset_id: this.dset_id,
				operator_id: this.operator_id,
				params: this.params,
			};
			this.$http.post('/datasets/save/acquisition/', data
				).then(response => {
					console.log(response);
					this.fetchData();
				}, response => {
				console.log(response);
			});
			},
		
		},
	})
	
	Vue.component('project-box', {
		props: ['dset_id', 'pdata'],
		template: `
	<div class="columns">
		<div class="column"/>
		<div class="column is-two-thirds">
		<div class="box" id="project" v-if="isOpen">
			<article class="message is-danger" v-if="errors.length > 0">
				<div class="message-body">
					<ul>
						{% verbatim %}
						<li v-for="error in errors">{{ error }}</li>
						{% endverbatim %}
					</ul>
				</div>
			</article>
			<div class="title is-5">Project
				<a class="button is-danger is-small" v-on:click="save">Save</a>
			</div>
		<div class="field">
			<label class="label">Name
			<a class="button is-danger is-outlined is-small" v-show="isNewProject" v-on:click="toggle_project">Use existing project</a>
			<a class="button is-danger is-outlined is-small" v-show="!isNewProject" v-on:click="toggle_project">Create new project</a>
	</label>
			<div class="control" v-if="!isNewProject">
				<div class="select">
					<select v-model="pdata.project_id" v-on:change="project_selected">
						<option disabled value="">Please select one</option>
					        {% verbatim %}
						<option v-for="project in pdata.projects" v-bind:value="project.id">{{ project.name }}</option>
					        {% endverbatim %}
					</select>
				</div>
			</div>
			<template v-if="isNewProject">
			<div class="control">
				<input class="input" v-model="newprojectname" type="text" placeholder="Project name">
			</div>
		        <div class="field">
		        	<div class="control">
		        	<label class="checkbox">
					<input type="checkbox" v-model="newproject_iscf">
		        		Core facility project
		        	</label>
		        	</div>
		        </div>
			</template>
		</div>
		
		<div class="field" v-if="is_corefac">
			<label class="label">contact(s)
				<template v-if="isNewProject">
					<a class="button is-danger is-outlined is-small" v-show="isNewPI" v-on:click="new_pi">Use existing PI</a>
					<a class="button is-danger is-outlined is-small" v-show="!isNewPI" v-on:click="new_pi">Create new PI</a>
				</template>
				<span class="tag is-success is-medium">Core facility project</span>
	 	      	</label>
			<template v-if="isNewProject">
			<div class="control" v-if="!isNewPI">
				<div class="select">
					<select v-model="externpi">
						<option disabled value="">Please select one</option>
						{% verbatim %}
						<option v-for="externpi in pdata.external_pis" v-bind:value="externpi.id">{{ externpi.name }}</option>
						{% endverbatim %}
					</select>
				</div>
			</div>
			<div class="control" v-if="isNewPI">
				<input class="input" v-model="newpiname" type="text" placeholder="PI name">
			</div>
			</template>
			<div class="control">
				<input class="input" type="text" v-model="pdata.externalcontactmail" placeholder="operational contact email (e.g. postdoc)">
			</div>
		</div>
		
		<div class="field">
			<label class="label">Experiment name
				<a class="button is-danger is-outlined is-small" v-show="isNewExperiment" v-on:click="toggle_experiment">Existing experiment</a>
				<a class="button is-danger is-outlined is-small" v-show="!isNewExperiment" v-on:click="toggle_experiment">Create new experiment</a>
	       		</label>
			<div class="control" v-if="!isNewExperiment">
				<div class="select">
					<select v-model="pdata.experiment_id">
						<option disabled value="">Please select one</option>
						{% verbatim %}
						<option v-for="exp in proj_experiments" v-bind:value="exp.id">{{ exp.name }}</option>
						{% endverbatim %}
					</select>
				</div>
			</div>
			<div class="control" v-if="isNewExperiment">
				<input class="input" v-model="newexperimentname" type="text" placeholder="Experiment name">
			</div>
		</div>
		
		<div class="field">
			<label class="label">Dataset type</label>
			<div class="control">
				<div class="select">
					<select v-model="pdata.datatype_id">
						<option disabled value="">Please select one</option>
						{% verbatim %}
						<option v-for="dset_type in pdata.datasettypes" v-bind:value="dset_type.id">{{ dset_type.name }}</option>
						{% endverbatim %}
					</select>
				</div>
			</div>
		</div>
		<div class="field" v-show="pdata.datatype_id === 1">
			<label class="label">HiRIEF range</label>
			<div class="control">
				<div class="select">
					<select v-model="pdata.hiriefrange">
						<option disabled value="">Please select one</option>
					        {% verbatim %}
						<option v-for="range in pdata.hirief_ranges" v-bind:value="range.id">{{ range.name }}</option>
					        {% endverbatim %}
					</select>
				</div>
			</div>
		</div>
		<div class="field">
			<label class="label">Run name</label>
			<div class="control">
				<input class="input" v-model="pdata.runname" type="text" placeholder="E.g set1, run1, etc">
			</div>
		</div>
		<article class="message is-success"> 
		<div class="message-header">Storage location</div>
		{% verbatim %}
		<div class="message-body">{{ pdata.storage_location }}</div>
		{% endverbatim %}
		</article>
	</div>
	</div>
		<div class="column"/>
</div>
`,
		data: function() {
		return {
			errors: [],
			isOpen: true,
		       	isNewProject: false,
		       	isNewExperiment: false,
			isNewPI: false,
			newprojectname: '',
			newexperimentname: '',
			newproject_iscf: false,
			externpi: '',
			newpiname: '',
			}
		},
		computed: {
		is_corefac: function() {
			if (this.isNewProject) {return this.newproject_iscf}
			else {return this.pdata.existingproject_iscf}
			},
		proj_experiments: function() {
			return !this.pdata.project_id ? [] : this.pdata.experiments[this.pdata.project_id]
			},
		},
		methods: {
			project_selected: function() {
				if (this.pdata.project_id) {
					this.pdata.existingproject_iscf = this.pdata.project_lookup[this.pdata.project_id].corefac;
					this.pdata.pi_id = this.pdata.project_lookup[this.pdata.project_id].pi_id;
				}
			},
		       	toggle_project: function() {
				this.isNewProject = this.isNewProject === false;
		       	},
			toggle_experiment: function() {
				this.isNewExperiment = this.isNewExperiment === false;
			},
		       	new_pi: function() {
				this.isNewPI = this.isNewPI === false;
			},
			validate: function() {
				this.errors = [];
				if (!this.newprojectname && !this.pdata.project_id) {
					this.errors.push('Project needs to be selected or created');
				}
				if (!this.newexperimentname && !this.pdata.experiment_id) {
					this.errors.push('Experiment is required');
				}
				if (!this.pdata.datatype_id) {
					this.errors.push('Datatype is required');
				}
				if (this.pdata.datatype_id === '1' && !this.pdata.hiriefrange) {
					this.errors.push('HiRIEF range is required');
				}
				if (this.is_corefac) {
					if (!this.newpiname && !this.pdata.pi_id) {
						this.errors.push('Need to select or create a PI');
					}
					if (!this.pdata.externalcontactmail) {
						this.errors.push('External contact is required');
					}
				}
				console.log(this.errors);
				return this.errors.length ? false : true
			},

			save: function() {
				if (!this.validate()) {
					return false
				}
				data = {
					dataset_id: this.dataset_id,
					is_corefac: this.is_corefac,
					datatype_id: this.datatype_id,
					hiriefrange: this.hiriefrange,
					runname: this.runname,
				};
				if (this.isNewProject) {
					data.newprojectname = this.newprojectname;
					} else {
					data.project_id = this.project_id;
					}
				if (this.isNewExperiment) {
				data.newexperimentname = this.newexperimentname;
				} else {
			       	data.experiment_id = this.experiment_id;
				}
				if (this.isNewPI) {
				data.newpiname = this.newpiname;
				} else {
				data.pi_id = this.is_corefac ? this.externpi: this.internal_pi_id;
				}
				if (this.is_corefac) {
				data.corefaccontact = this.externalcontactmail;
				}
				this.$http.post('/datasets/save/project/', data
					).then(response => {
					       	this.isNewProject = false;
					       	this.isNewExperiment = false;
						this.isNewPI = false;
						return response.json()
					}, response => {
					console.log(response);
					}).then(result => {
						this.dataset_id = result.dataset_id;
						this.fetchData();
				})
			},
				},
				})
		
	var datasetapp = new Vue({
	el: '#apps',
	data: function() {
		return {
			tabclassDef: 'is-active',
			tabclassFiles: '',
			tabclassAcq: '',
			tabclassSP: '',
			viewtab: 'definition',
			projdata: {
				projects: [],
				external_pis: [],
				datasettypes: [],
				internal_pi_id: '',
				pi_id: '',
				hirief_ranges: [],
				project_id: '',
				datatype_id: '',
				hiriefrange: '',
				experiment_id: '',
				experiments: {},
				existingproject_iscf: false,
				externalcontactmail: '',
				runname: '',
				storage_location: '',
				},
			acqdata: {
				params: [],
				operators: [],
				operator_id: '',
				},
			filesdata: {
				newFiles: [],
				datasetAssociatedFiles: [],
				},
			sampledata: {
				no_enzyme: false,
				labelfree_multisample: false,
				show_enzymes: [],
				quants: {},
				params: [],
				enzymes: [],
				quanttype: '',
				samples: {},
				},
			dataset_id: '{{ dataset_id }}',
		}
	},
	mounted: function() {
		this.fetchProject();
		this.fetchFiles();
		this.fetchGeneral('/datasets/show/sampleprep/' + this.dataset_id, this.sampledata);
		this.fetchGeneral('/datasets/show/acquisition/' + this.dataset_id, this.acqdata);
	},
	methods: {
		showDef: function() {
			this.viewtab = 'definition';
			this.activateTabClass('tabclassDef');
		},
		showFiles: function() {
			this.viewtab = 'files';
			this.activateTabClass('tabclassFiles');
		},
		showAcquisition: function() {
			this.viewtab = 'acquisition';
			this.activateTabClass('tabclassAcq');
		},
		showSP: function() {
			this.viewtab = 'sampleprep';
			this.activateTabClass('tabclassSP');
		},
		activateTabClass: function(tabname) {
			tabs = ['tabclassDef', 'tabclassSP', 'tabclassAcq', 'tabclassFiles'];
			for (offtab of tabs) {
				this[offtab] = '';
				}
			this[tabname] = 'is-active';
		},
		fetchData: function(url) {
			return this.$http.get(url)
			},
		fetchProject: function() {
			this.fetchData('/datasets/show/project/' + this.dataset_id)
				.then(response => {
					return response.json()
					}, response => {
					console.log(response)
					}).then(result => {
					for (key in result) {
						this.projdata[key] = result[key];
					}
				this.projdata.project_lookup = {};
				for (var i = 0; i < result.projects.length; i++) {
					this.project_lookup[result.projects[i].id] = {'corefac': result.projects[i].corefac, 'pi_id': result.projects[i].pi_id, 'name': result.projects[i].name};
					}
				})
			},

		fetchFiles: function() {
			this.fetchGeneral('/datasets/show/files/' + this.dataset_id, this.filesdata);
		},
		fetchGeneral: function(url, store) {
			this.fetchData(url)
				.then(response => {
					return response.json()
					}, response => {
					console.log(response)
					}).then(result => {
					for (key in result) {
						if (key !== '') {
							store[key] = result[key];
						}
					}
				})
			},
	},
	})
</script>
{% endblock content %}
